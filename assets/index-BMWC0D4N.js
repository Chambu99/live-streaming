(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();function eA(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Cg={exports:{}},nu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mv;function kx(){if(mv)return nu;mv=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(i,n,a){var l=null;if(a!==void 0&&(l=""+a),n.key!==void 0&&(l=""+n.key),"key"in n){a={};for(var c in n)c!=="key"&&(a[c]=n[c])}else a=n;return n=a.ref,{$$typeof:r,type:i,key:l,ref:n!==void 0?n:null,props:a}}return nu.Fragment=t,nu.jsx=e,nu.jsxs=e,nu}var pv;function Nx(){return pv||(pv=1,Cg.exports=kx()),Cg.exports}var kt=Nx(),wg={exports:{}},Bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yv;function Fx(){if(yv)return Bt;yv=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.iterator;function E(F){return F===null||typeof F!="object"?null:(F=p&&F[p]||F["@@iterator"],typeof F=="function"?F:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,R={};function _(F,tt,at){this.props=F,this.context=tt,this.refs=R,this.updater=at||T}_.prototype.isReactComponent={},_.prototype.setState=function(F,tt){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,tt,"setState")},_.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function D(){}D.prototype=_.prototype;function N(F,tt,at){this.props=F,this.context=tt,this.refs=R,this.updater=at||T}var M=N.prototype=new D;M.constructor=N,S(M,_.prototype),M.isPureReactComponent=!0;var G=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},q=Object.prototype.hasOwnProperty;function w(F,tt,at,st,mt,Tt){return at=Tt.ref,{$$typeof:r,type:F,key:tt,ref:at!==void 0?at:null,props:Tt}}function L(F,tt){return w(F.type,tt,void 0,void 0,void 0,F.props)}function O(F){return typeof F=="object"&&F!==null&&F.$$typeof===r}function C(F){var tt={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(at){return tt[at]})}var U=/\/+/g;function V(F,tt){return typeof F=="object"&&F!==null&&F.key!=null?C(""+F.key):tt.toString(36)}function B(){}function pt(F){switch(F.status){case"fulfilled":return F.value;case"rejected":throw F.reason;default:switch(typeof F.status=="string"?F.then(B,B):(F.status="pending",F.then(function(tt){F.status==="pending"&&(F.status="fulfilled",F.value=tt)},function(tt){F.status==="pending"&&(F.status="rejected",F.reason=tt)})),F.status){case"fulfilled":return F.value;case"rejected":throw F.reason}}throw F}function gt(F,tt,at,st,mt){var Tt=typeof F;(Tt==="undefined"||Tt==="boolean")&&(F=null);var Et=!1;if(F===null)Et=!0;else switch(Tt){case"bigint":case"string":case"number":Et=!0;break;case"object":switch(F.$$typeof){case r:case t:Et=!0;break;case g:return Et=F._init,gt(Et(F._payload),tt,at,st,mt)}}if(Et)return mt=mt(F),Et=st===""?"."+V(F,0):st,G(mt)?(at="",Et!=null&&(at=Et.replace(U,"$&/")+"/"),gt(mt,tt,at,"",function(Ge){return Ge})):mt!=null&&(O(mt)&&(mt=L(mt,at+(mt.key==null||F&&F.key===mt.key?"":(""+mt.key).replace(U,"$&/")+"/")+Et)),tt.push(mt)),1;Et=0;var Yt=st===""?".":st+":";if(G(F))for(var Ut=0;Ut<F.length;Ut++)st=F[Ut],Tt=Yt+V(st,Ut),Et+=gt(st,tt,at,Tt,mt);else if(Ut=E(F),typeof Ut=="function")for(F=Ut.call(F),Ut=0;!(st=F.next()).done;)st=st.value,Tt=Yt+V(st,Ut++),Et+=gt(st,tt,at,Tt,mt);else if(Tt==="object"){if(typeof F.then=="function")return gt(pt(F),tt,at,st,mt);throw tt=String(F),Error("Objects are not valid as a React child (found: "+(tt==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":tt)+"). If you meant to render a collection of children, use an array instead.")}return Et}function K(F,tt,at){if(F==null)return F;var st=[],mt=0;return gt(F,st,"","",function(Tt){return tt.call(at,Tt,mt++)}),st}function it(F){if(F._status===-1){var tt=F._result;tt=tt(),tt.then(function(at){(F._status===0||F._status===-1)&&(F._status=1,F._result=at)},function(at){(F._status===0||F._status===-1)&&(F._status=2,F._result=at)}),F._status===-1&&(F._status=0,F._result=tt)}if(F._status===1)return F._result.default;throw F._result}var ct=typeof reportError=="function"?reportError:function(F){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var tt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof F=="object"&&F!==null&&typeof F.message=="string"?String(F.message):String(F),error:F});if(!window.dispatchEvent(tt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",F);return}console.error(F)};function rt(){}return Bt.Children={map:K,forEach:function(F,tt,at){K(F,function(){tt.apply(this,arguments)},at)},count:function(F){var tt=0;return K(F,function(){tt++}),tt},toArray:function(F){return K(F,function(tt){return tt})||[]},only:function(F){if(!O(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},Bt.Component=_,Bt.Fragment=e,Bt.Profiler=n,Bt.PureComponent=N,Bt.StrictMode=i,Bt.Suspense=f,Bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Bt.__COMPILER_RUNTIME={__proto__:null,c:function(F){return $.H.useMemoCache(F)}},Bt.cache=function(F){return function(){return F.apply(null,arguments)}},Bt.cloneElement=function(F,tt,at){if(F==null)throw Error("The argument must be a React element, but you passed "+F+".");var st=S({},F.props),mt=F.key,Tt=void 0;if(tt!=null)for(Et in tt.ref!==void 0&&(Tt=void 0),tt.key!==void 0&&(mt=""+tt.key),tt)!q.call(tt,Et)||Et==="key"||Et==="__self"||Et==="__source"||Et==="ref"&&tt.ref===void 0||(st[Et]=tt[Et]);var Et=arguments.length-2;if(Et===1)st.children=at;else if(1<Et){for(var Yt=Array(Et),Ut=0;Ut<Et;Ut++)Yt[Ut]=arguments[Ut+2];st.children=Yt}return w(F.type,mt,void 0,void 0,Tt,st)},Bt.createContext=function(F){return F={$$typeof:l,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null},F.Provider=F,F.Consumer={$$typeof:a,_context:F},F},Bt.createElement=function(F,tt,at){var st,mt={},Tt=null;if(tt!=null)for(st in tt.key!==void 0&&(Tt=""+tt.key),tt)q.call(tt,st)&&st!=="key"&&st!=="__self"&&st!=="__source"&&(mt[st]=tt[st]);var Et=arguments.length-2;if(Et===1)mt.children=at;else if(1<Et){for(var Yt=Array(Et),Ut=0;Ut<Et;Ut++)Yt[Ut]=arguments[Ut+2];mt.children=Yt}if(F&&F.defaultProps)for(st in Et=F.defaultProps,Et)mt[st]===void 0&&(mt[st]=Et[st]);return w(F,Tt,void 0,void 0,null,mt)},Bt.createRef=function(){return{current:null}},Bt.forwardRef=function(F){return{$$typeof:c,render:F}},Bt.isValidElement=O,Bt.lazy=function(F){return{$$typeof:g,_payload:{_status:-1,_result:F},_init:it}},Bt.memo=function(F,tt){return{$$typeof:h,type:F,compare:tt===void 0?null:tt}},Bt.startTransition=function(F){var tt=$.T,at={};$.T=at;try{var st=F(),mt=$.S;mt!==null&&mt(at,st),typeof st=="object"&&st!==null&&typeof st.then=="function"&&st.then(rt,ct)}catch(Tt){ct(Tt)}finally{$.T=tt}},Bt.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Bt.use=function(F){return $.H.use(F)},Bt.useActionState=function(F,tt,at){return $.H.useActionState(F,tt,at)},Bt.useCallback=function(F,tt){return $.H.useCallback(F,tt)},Bt.useContext=function(F){return $.H.useContext(F)},Bt.useDebugValue=function(){},Bt.useDeferredValue=function(F,tt){return $.H.useDeferredValue(F,tt)},Bt.useEffect=function(F,tt,at){var st=$.H;if(typeof at=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return st.useEffect(F,tt)},Bt.useId=function(){return $.H.useId()},Bt.useImperativeHandle=function(F,tt,at){return $.H.useImperativeHandle(F,tt,at)},Bt.useInsertionEffect=function(F,tt){return $.H.useInsertionEffect(F,tt)},Bt.useLayoutEffect=function(F,tt){return $.H.useLayoutEffect(F,tt)},Bt.useMemo=function(F,tt){return $.H.useMemo(F,tt)},Bt.useOptimistic=function(F,tt){return $.H.useOptimistic(F,tt)},Bt.useReducer=function(F,tt,at){return $.H.useReducer(F,tt,at)},Bt.useRef=function(F){return $.H.useRef(F)},Bt.useState=function(F){return $.H.useState(F)},Bt.useSyncExternalStore=function(F,tt,at){return $.H.useSyncExternalStore(F,tt,at)},Bt.useTransition=function(){return $.H.useTransition()},Bt.version="19.1.0",Bt}var Ev;function Jm(){return Ev||(Ev=1,wg.exports=Fx()),wg.exports}var fi=Jm();const Ux=eA(fi);var Og={exports:{}},su={},Pg={exports:{}},Mg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vv;function Bx(){return vv||(vv=1,function(r){function t(K,it){var ct=K.length;K.push(it);t:for(;0<ct;){var rt=ct-1>>>1,F=K[rt];if(0<n(F,it))K[rt]=it,K[ct]=F,ct=rt;else break t}}function e(K){return K.length===0?null:K[0]}function i(K){if(K.length===0)return null;var it=K[0],ct=K.pop();if(ct!==it){K[0]=ct;t:for(var rt=0,F=K.length,tt=F>>>1;rt<tt;){var at=2*(rt+1)-1,st=K[at],mt=at+1,Tt=K[mt];if(0>n(st,ct))mt<F&&0>n(Tt,st)?(K[rt]=Tt,K[mt]=ct,rt=mt):(K[rt]=st,K[at]=ct,rt=at);else if(mt<F&&0>n(Tt,ct))K[rt]=Tt,K[mt]=ct,rt=mt;else break t}}return it}function n(K,it){var ct=K.sortIndex-it.sortIndex;return ct!==0?ct:K.id-it.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;r.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();r.unstable_now=function(){return l.now()-c}}var f=[],h=[],g=1,p=null,E=3,T=!1,S=!1,R=!1,_=!1,D=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function G(K){for(var it=e(h);it!==null;){if(it.callback===null)i(h);else if(it.startTime<=K)i(h),it.sortIndex=it.expirationTime,t(f,it);else break;it=e(h)}}function $(K){if(R=!1,G(K),!S)if(e(f)!==null)S=!0,q||(q=!0,V());else{var it=e(h);it!==null&&gt($,it.startTime-K)}}var q=!1,w=-1,L=5,O=-1;function C(){return _?!0:!(r.unstable_now()-O<L)}function U(){if(_=!1,q){var K=r.unstable_now();O=K;var it=!0;try{t:{S=!1,R&&(R=!1,N(w),w=-1),T=!0;var ct=E;try{e:{for(G(K),p=e(f);p!==null&&!(p.expirationTime>K&&C());){var rt=p.callback;if(typeof rt=="function"){p.callback=null,E=p.priorityLevel;var F=rt(p.expirationTime<=K);if(K=r.unstable_now(),typeof F=="function"){p.callback=F,G(K),it=!0;break e}p===e(f)&&i(f),G(K)}else i(f);p=e(f)}if(p!==null)it=!0;else{var tt=e(h);tt!==null&&gt($,tt.startTime-K),it=!1}}break t}finally{p=null,E=ct,T=!1}it=void 0}}finally{it?V():q=!1}}}var V;if(typeof M=="function")V=function(){M(U)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,pt=B.port2;B.port1.onmessage=U,V=function(){pt.postMessage(null)}}else V=function(){D(U,0)};function gt(K,it){w=D(function(){K(r.unstable_now())},it)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(K){K.callback=null},r.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<K?Math.floor(1e3/K):5},r.unstable_getCurrentPriorityLevel=function(){return E},r.unstable_next=function(K){switch(E){case 1:case 2:case 3:var it=3;break;default:it=E}var ct=E;E=it;try{return K()}finally{E=ct}},r.unstable_requestPaint=function(){_=!0},r.unstable_runWithPriority=function(K,it){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ct=E;E=K;try{return it()}finally{E=ct}},r.unstable_scheduleCallback=function(K,it,ct){var rt=r.unstable_now();switch(typeof ct=="object"&&ct!==null?(ct=ct.delay,ct=typeof ct=="number"&&0<ct?rt+ct:rt):ct=rt,K){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=ct+F,K={id:g++,callback:it,priorityLevel:K,startTime:ct,expirationTime:F,sortIndex:-1},ct>rt?(K.sortIndex=ct,t(h,K),e(f)===null&&K===e(h)&&(R?(N(w),w=-1):R=!0,gt($,ct-rt))):(K.sortIndex=F,t(f,K),S||T||(S=!0,q||(q=!0,V()))),K},r.unstable_shouldYield=C,r.unstable_wrapCallback=function(K){var it=E;return function(){var ct=E;E=it;try{return K.apply(this,arguments)}finally{E=ct}}}}(Mg)),Mg}var Tv;function Vx(){return Tv||(Tv=1,Pg.exports=Bx()),Pg.exports}var kg={exports:{}},Ei={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sv;function Gx(){if(Sv)return Ei;Sv=1;var r=Jm();function t(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)h+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var i={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},n=Symbol.for("react.portal");function a(f,h,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:p==null?null:""+p,children:f,containerInfo:h,implementation:g}}var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Ei.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ei.createPortal=function(f,h){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return a(f,h,null,g)},Ei.flushSync=function(f){var h=l.T,g=i.p;try{if(l.T=null,i.p=2,f)return f()}finally{l.T=h,i.p=g,i.d.f()}},Ei.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(f,h))},Ei.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Ei.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var g=h.as,p=c(g,h.crossOrigin),E=typeof h.integrity=="string"?h.integrity:void 0,T=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;g==="style"?i.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:E,fetchPriority:T}):g==="script"&&i.d.X(f,{crossOrigin:p,integrity:E,fetchPriority:T,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Ei.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var g=c(h.as,h.crossOrigin);i.d.M(f,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(f)},Ei.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var g=h.as,p=c(g,h.crossOrigin);i.d.L(f,g,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Ei.preloadModule=function(f,h){if(typeof f=="string")if(h){var g=c(h.as,h.crossOrigin);i.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(f)},Ei.requestFormReset=function(f){i.d.r(f)},Ei.unstable_batchedUpdates=function(f,h){return f(h)},Ei.useFormState=function(f,h,g){return l.H.useFormState(f,h,g)},Ei.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ei.version="19.1.0",Ei}var Av;function $x(){if(Av)return kg.exports;Av=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),kg.exports=Gx(),kg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _v;function Hx(){if(_v)return su;_v=1;var r=Vx(),t=Jm(),e=$x();function i(s){var o="https://react.dev/errors/"+s;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function a(s){var o=s,u=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(u=o.return),s=o.return;while(s)}return o.tag===3?u:null}function l(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function c(s){if(a(s)!==s)throw Error(i(188))}function f(s){var o=s.alternate;if(!o){if(o=a(s),o===null)throw Error(i(188));return o!==s?null:s}for(var u=s,d=o;;){var y=u.return;if(y===null)break;var v=y.alternate;if(v===null){if(d=y.return,d!==null){u=d;continue}break}if(y.child===v.child){for(v=y.child;v;){if(v===u)return c(y),s;if(v===d)return c(y),o;v=v.sibling}throw Error(i(188))}if(u.return!==d.return)u=y,d=v;else{for(var I=!1,P=y.child;P;){if(P===u){I=!0,u=y,d=v;break}if(P===d){I=!0,d=y,u=v;break}P=P.sibling}if(!I){for(P=v.child;P;){if(P===u){I=!0,u=v,d=y;break}if(P===d){I=!0,d=v,u=y;break}P=P.sibling}if(!I)throw Error(i(189))}}if(u.alternate!==d)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?s:o}function h(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s;for(s=s.child;s!==null;){if(o=h(s),o!==null)return o;s=s.sibling}return null}var g=Object.assign,p=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),N=Symbol.for("react.consumer"),M=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),C=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function V(s){return s===null||typeof s!="object"?null:(s=U&&s[U]||s["@@iterator"],typeof s=="function"?s:null)}var B=Symbol.for("react.client.reference");function pt(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===B?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case S:return"Fragment";case _:return"Profiler";case R:return"StrictMode";case $:return"Suspense";case q:return"SuspenseList";case O:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case T:return"Portal";case M:return(s.displayName||"Context")+".Provider";case N:return(s._context.displayName||"Context")+".Consumer";case G:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case w:return o=s.displayName||null,o!==null?o:pt(s.type)||"Memo";case L:o=s._payload,s=s._init;try{return pt(s(o))}catch{}}return null}var gt=Array.isArray,K=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,it=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ct={pending:!1,data:null,method:null,action:null},rt=[],F=-1;function tt(s){return{current:s}}function at(s){0>F||(s.current=rt[F],rt[F]=null,F--)}function st(s,o){F++,rt[F]=s.current,s.current=o}var mt=tt(null),Tt=tt(null),Et=tt(null),Yt=tt(null);function Ut(s,o){switch(st(Et,o),st(Tt,s),st(mt,null),o.nodeType){case 9:case 11:s=(s=o.documentElement)&&(s=s.namespaceURI)?HE(s):0;break;default:if(s=o.tagName,o=o.namespaceURI)o=HE(o),s=KE(o,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}at(mt),st(mt,s)}function Ge(){at(mt),at(Tt),at(Et)}function dn(s){s.memoizedState!==null&&st(Yt,s);var o=mt.current,u=KE(o,s.type);o!==u&&(st(Tt,s),st(mt,u))}function gn(s){Tt.current===s&&(at(mt),at(Tt)),Yt.current===s&&(at(Yt),Zl._currentValue=ct)}var ss=Object.prototype.hasOwnProperty,mn=r.unstable_scheduleCallback,pn=r.unstable_cancelCallback,Ca=r.unstable_shouldYield,Kt=r.unstable_requestPaint,le=r.unstable_now,pi=r.unstable_getCurrentPriorityLevel,ki=r.unstable_ImmediatePriority,Ze=r.unstable_UserBlockingPriority,Li=r.unstable_NormalPriority,yn=r.unstable_LowPriority,rs=r.unstable_IdlePriority,Ln=r.log,Pr=r.unstable_setDisableYieldValue,fe=null,te=null;function _i(s){if(typeof Ln=="function"&&Pr(s),te&&typeof te.setStrictMode=="function")try{te.setStrictMode(fe,s)}catch{}}var $e=Math.clz32?Math.clz32:kr,Mr=Math.log,as=Math.LN2;function kr(s){return s>>>=0,s===0?32:31-(Mr(s)/as|0)|0}var Nr=256,Fr=4194304;function En(s){var o=s&42;if(o!==0)return o;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function wa(s,o,u){var d=s.pendingLanes;if(d===0)return 0;var y=0,v=s.suspendedLanes,I=s.pingedLanes;s=s.warmLanes;var P=d&134217727;return P!==0?(d=P&~v,d!==0?y=En(d):(I&=P,I!==0?y=En(I):u||(u=P&~s,u!==0&&(y=En(u))))):(P=d&~v,P!==0?y=En(P):I!==0?y=En(I):u||(u=d&~s,u!==0&&(y=En(u)))),y===0?0:o!==0&&o!==y&&(o&v)===0&&(v=y&-y,u=o&-o,v>=u||v===32&&(u&4194048)!==0)?o:y}function Ur(s,o){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&o)===0}function Zo(s,o){switch(s){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jo(){var s=Nr;return Nr<<=1,(Nr&4194048)===0&&(Nr=256),s}function tl(){var s=Fr;return Fr<<=1,(Fr&62914560)===0&&(Fr=4194304),s}function os(s){for(var o=[],u=0;31>u;u++)o.push(s);return o}function ls(s,o){s.pendingLanes|=o,o!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function el(s,o,u,d,y,v){var I=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var P=s.entanglements,H=s.expirationTimes,Z=s.hiddenUpdates;for(u=I&~u;0<u;){var ot=31-$e(u),ft=1<<ot;P[ot]=0,H[ot]=-1;var J=Z[ot];if(J!==null)for(Z[ot]=null,ot=0;ot<J.length;ot++){var et=J[ot];et!==null&&(et.lane&=-536870913)}u&=~ft}d!==0&&Dn(s,d,0),v!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=v&~(I&~o))}function Dn(s,o,u){s.pendingLanes|=o,s.suspendedLanes&=~o;var d=31-$e(o);s.entangledLanes|=o,s.entanglements[d]=s.entanglements[d]|1073741824|u&4194090}function il(s,o){var u=s.entangledLanes|=o;for(s=s.entanglements;u;){var d=31-$e(u),y=1<<d;y&o|s[d]&o&&(s[d]|=o),u&=~y}}function Gs(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Oa(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function $s(){var s=it.p;return s!==0?s:(s=window.event,s===void 0?32:uv(s.type))}function Ku(s,o){var u=it.p;try{return it.p=s,o()}finally{it.p=u}}var Ae=Math.random().toString(36).slice(2),He="__reactFiber$"+Ae,Me="__reactProps$"+Ae,ji="__reactContainer$"+Ae,nl="__reactEvents$"+Ae,Pf="__reactListeners$"+Ae,Hs="__reactHandles$"+Ae,zu="__reactResources$"+Ae,Br="__reactMarker$"+Ae;function Ks(s){delete s[He],delete s[Me],delete s[nl],delete s[Pf],delete s[Hs]}function us(s){var o=s[He];if(o)return o;for(var u=s.parentNode;u;){if(o=u[ji]||u[He]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(s=YE(s);s!==null;){if(u=s[He])return u;s=YE(s)}return o}s=u,u=s.parentNode}return null}function Cn(s){if(s=s[He]||s[ji]){var o=s.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return s}return null}function wn(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s.stateNode;throw Error(i(33))}function Ri(s){var o=s[zu];return o||(o=s[zu]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Ce(s){s[Br]=!0}var sl=new Set,Pa={};function vn(s,o){cs(s,o),cs(s+"Capture",o)}function cs(s,o){for(Pa[s]=o,s=0;s<o.length;s++)sl.add(o[s])}var qu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ju={},Vr={};function Yu(s){return ss.call(Vr,s)?!0:ss.call(ju,s)?!1:qu.test(s)?Vr[s]=!0:(ju[s]=!0,!1)}function zs(s,o,u){if(Yu(o))if(u===null)s.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(o);return;case"boolean":var d=o.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){s.removeAttribute(o);return}}s.setAttribute(o,""+u)}}function On(s,o,u){if(u===null)s.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(o);return}s.setAttribute(o,""+u)}}function oi(s,o,u,d){if(d===null)s.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(o,u,""+d)}}var Gr,Qu;function hs(s){if(Gr===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Gr=o&&o[1]||"",Qu=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Gr+s+Qu}var Ma=!1;function ka(s,o){if(!s||Ma)return"";Ma=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(o){var ft=function(){throw Error()};if(Object.defineProperty(ft.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ft,[])}catch(et){var J=et}Reflect.construct(s,[],ft)}else{try{ft.call()}catch(et){J=et}s.call(ft.prototype)}}else{try{throw Error()}catch(et){J=et}(ft=s())&&typeof ft.catch=="function"&&ft.catch(function(){})}}catch(et){if(et&&J&&typeof et.stack=="string")return[et.stack,J.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=d.DetermineComponentFrameRoot(),I=v[0],P=v[1];if(I&&P){var H=I.split(`
`),Z=P.split(`
`);for(y=d=0;d<H.length&&!H[d].includes("DetermineComponentFrameRoot");)d++;for(;y<Z.length&&!Z[y].includes("DetermineComponentFrameRoot");)y++;if(d===H.length||y===Z.length)for(d=H.length-1,y=Z.length-1;1<=d&&0<=y&&H[d]!==Z[y];)y--;for(;1<=d&&0<=y;d--,y--)if(H[d]!==Z[y]){if(d!==1||y!==1)do if(d--,y--,0>y||H[d]!==Z[y]){var ot=`
`+H[d].replace(" at new "," at ");return s.displayName&&ot.includes("<anonymous>")&&(ot=ot.replace("<anonymous>",s.displayName)),ot}while(1<=d&&0<=y);break}}}finally{Ma=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?hs(u):""}function rl(s){switch(s.tag){case 26:case 27:case 5:return hs(s.type);case 16:return hs("Lazy");case 13:return hs("Suspense");case 19:return hs("SuspenseList");case 0:case 15:return ka(s.type,!1);case 11:return ka(s.type.render,!1);case 1:return ka(s.type,!0);case 31:return hs("Activity");default:return""}}function Na(s){try{var o="";do o+=rl(s),s=s.return;while(s);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function bi(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function al(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Mf(s){var o=al(s)?"checked":"value",u=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),d=""+s[o];if(!s.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var y=u.get,v=u.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return y.call(this)},set:function(I){d=""+I,v.call(this,I)}}),Object.defineProperty(s,o,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(I){d=""+I},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function Fa(s){s._valueTracker||(s._valueTracker=Mf(s))}function ol(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var u=o.getValue(),d="";return s&&(d=al(s)?s.checked?"true":"false":s.value),s=d,s!==u?(o.setValue(s),!0):!1}function $r(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var kf=/[\n"\\]/g;function ke(s){return s.replace(kf,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Ni(s,o,u,d,y,v,I,P){s.name="",I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?s.type=I:s.removeAttribute("type"),o!=null?I==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+bi(o)):s.value!==""+bi(o)&&(s.value=""+bi(o)):I!=="submit"&&I!=="reset"||s.removeAttribute("value"),o!=null?qs(s,I,bi(o)):u!=null?qs(s,I,bi(u)):d!=null&&s.removeAttribute("value"),y==null&&v!=null&&(s.defaultChecked=!!v),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?s.name=""+bi(P):s.removeAttribute("name")}function Hr(s,o,u,d,y,v,I,P){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(s.type=v),o!=null||u!=null){if(!(v!=="submit"&&v!=="reset"||o!=null))return;u=u!=null?""+bi(u):"",o=o!=null?""+bi(o):u,P||o===s.value||(s.value=o),s.defaultValue=o}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,s.checked=P?s.checked:!!d,s.defaultChecked=!!d,I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(s.name=I)}function qs(s,o,u){o==="number"&&$r(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function fs(s,o,u,d){if(s=s.options,o){o={};for(var y=0;y<u.length;y++)o["$"+u[y]]=!0;for(u=0;u<s.length;u++)y=o.hasOwnProperty("$"+s[u].value),s[u].selected!==y&&(s[u].selected=y),y&&d&&(s[u].defaultSelected=!0)}else{for(u=""+bi(u),o=null,y=0;y<s.length;y++){if(s[y].value===u){s[y].selected=!0,d&&(s[y].defaultSelected=!0);return}o!==null||s[y].disabled||(o=s[y])}o!==null&&(o.selected=!0)}}function de(s,o,u){if(o!=null&&(o=""+bi(o),o!==s.value&&(s.value=o),u==null)){s.defaultValue!==o&&(s.defaultValue=o);return}s.defaultValue=u!=null?""+bi(u):""}function Kr(s,o,u,d){if(o==null){if(d!=null){if(u!=null)throw Error(i(92));if(gt(d)){if(1<d.length)throw Error(i(93));d=d[0]}u=d}u==null&&(u=""),o=u}u=bi(o),s.defaultValue=u,d=s.textContent,d===u&&d!==""&&d!==null&&(s.value=d)}function Yi(s,o){if(o){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=o;return}}s.textContent=o}var zr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Xu(s,o,u){var d=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?d?s.setProperty(o,""):o==="float"?s.cssFloat="":s[o]="":d?s.setProperty(o,u):typeof u!="number"||u===0||zr.has(o)?o==="float"?s.cssFloat=u:s[o]=(""+u).trim():s[o]=u+"px"}function ll(s,o,u){if(o!=null&&typeof o!="object")throw Error(i(62));if(s=s.style,u!=null){for(var d in u)!u.hasOwnProperty(d)||o!=null&&o.hasOwnProperty(d)||(d.indexOf("--")===0?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="");for(var y in o)d=o[y],o.hasOwnProperty(y)&&u[y]!==d&&Xu(s,y,d)}else for(var v in o)o.hasOwnProperty(v)&&Xu(s,v,o[v])}function ul(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ff=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ua(s){return Ff.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var ds=null;function Qi(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var gs=null,ms=null;function cl(s){var o=Cn(s);if(o&&(s=o.stateNode)){var u=s[Me]||null;t:switch(s=o.stateNode,o.type){case"input":if(Ni(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ke(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var d=u[o];if(d!==s&&d.form===s.form){var y=d[Me]||null;if(!y)throw Error(i(90));Ni(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(o=0;o<u.length;o++)d=u[o],d.form===s.form&&ol(d)}break t;case"textarea":de(s,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&fs(s,!!u.multiple,o,!1)}}}var Pn=!1;function Wu(s,o,u){if(Pn)return s(o,u);Pn=!0;try{var d=s(o);return d}finally{if(Pn=!1,(gs!==null||ms!==null)&&(Kc(),gs&&(o=gs,s=ms,ms=gs=null,cl(o),s)))for(o=0;o<s.length;o++)cl(s[o])}}function qr(s,o){var u=s.stateNode;if(u===null)return null;var d=u[Me]||null;if(d===null)return null;u=d[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break t;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(i(231,o,typeof u));return u}var Tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xi=!1;if(Tn)try{var jr={};Object.defineProperty(jr,"passive",{get:function(){Xi=!0}}),window.addEventListener("test",jr,jr),window.removeEventListener("test",jr,jr)}catch{Xi=!1}var Mn=null,js=null,ps=null;function hl(){if(ps)return ps;var s,o=js,u=o.length,d,y="value"in Mn?Mn.value:Mn.textContent,v=y.length;for(s=0;s<u&&o[s]===y[s];s++);var I=u-s;for(d=1;d<=I&&o[u-d]===y[v-d];d++);return ps=y.slice(s,1<d?1-d:void 0)}function kn(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function Nn(){return!0}function fl(){return!1}function Je(s){function o(u,d,y,v,I){this._reactName=u,this._targetInst=y,this.type=d,this.nativeEvent=v,this.target=I,this.currentTarget=null;for(var P in s)s.hasOwnProperty(P)&&(u=s[P],this[P]=u?u(v):v[P]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Nn:fl,this.isPropagationStopped=fl,this}return g(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Nn)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Nn)},persist:function(){},isPersistent:Nn}),o}var se={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ba=Je(se),Yr=g({},se,{view:0,detail:0}),Zu=Je(Yr),Va,Ga,Fn,Qr=g({},Yr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zr,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Fn&&(Fn&&s.type==="mousemove"?(Va=s.screenX-Fn.screenX,Ga=s.screenY-Fn.screenY):Ga=Va=0,Fn=s),Va)},movementY:function(s){return"movementY"in s?s.movementY:Ga}}),Wi=Je(Qr),Ju=g({},Qr,{dataTransfer:0}),Uf=Je(Ju),Xr=g({},Yr,{relatedTarget:0}),$a=Je(Xr),dl=g({},se,{animationName:0,elapsedTime:0,pseudoElement:0}),Ha=Je(dl),tc=g({},se,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ka=Je(tc),Bf=g({},se,{data:0}),gl=Je(Bf),Wr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ec={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ic={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ml(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=ic[s])?!!o[s]:!1}function Zr(){return ml}var nc=g({},Yr,{key:function(s){if(s.key){var o=Wr[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=kn(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?ec[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zr,charCode:function(s){return s.type==="keypress"?kn(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?kn(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),za=Je(nc),sc=g({},Qr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pl=Je(sc),ys=g({},Yr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zr}),rc=Je(ys),ac=g({},se,{propertyName:0,elapsedTime:0,pseudoElement:0}),oc=Je(ac),lc=g({},Qr,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),qa=Je(lc),xi=g({},se,{newState:0,oldState:0}),uc=Je(xi),cc=[9,13,27,32],Un=Tn&&"CompositionEvent"in window,m=null;Tn&&"documentMode"in document&&(m=document.documentMode);var A=Tn&&"TextEvent"in window&&!m,x=Tn&&(!Un||m&&8<m&&11>=m),k=" ",Q=!1;function nt(s,o){switch(s){case"keyup":return cc.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yt(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Qt=!1;function Ke(s,o){switch(s){case"compositionend":return yt(o);case"keypress":return o.which!==32?null:(Q=!0,k);case"textInput":return s=o.data,s===k&&Q?null:s;default:return null}}function Xt(s,o){if(Qt)return s==="compositionend"||!Un&&nt(s,o)?(s=hl(),ps=js=Mn=null,Qt=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return x&&o.locale!=="ko"?null:o.data;default:return null}}var ti={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ze(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!ti[s.type]:o==="textarea"}function Es(s,o,u,d){gs?ms?ms.push(d):ms=[d]:gs=d,o=Xc(o,"onChange"),0<o.length&&(u=new Ba("onChange","change",null,u,d),s.push({event:u,listeners:o}))}var li=null,Bn=null;function yl(s){UE(s,0)}function hc(s){var o=wn(s);if(ol(o))return s}function r0(s,o){if(s==="change")return o}var a0=!1;if(Tn){var Vf;if(Tn){var Gf="oninput"in document;if(!Gf){var o0=document.createElement("div");o0.setAttribute("oninput","return;"),Gf=typeof o0.oninput=="function"}Vf=Gf}else Vf=!1;a0=Vf&&(!document.documentMode||9<document.documentMode)}function l0(){li&&(li.detachEvent("onpropertychange",u0),Bn=li=null)}function u0(s){if(s.propertyName==="value"&&hc(Bn)){var o=[];Es(o,Bn,s,Qi(s)),Wu(yl,o)}}function hb(s,o,u){s==="focusin"?(l0(),li=o,Bn=u,li.attachEvent("onpropertychange",u0)):s==="focusout"&&l0()}function fb(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return hc(Bn)}function db(s,o){if(s==="click")return hc(o)}function gb(s,o){if(s==="input"||s==="change")return hc(o)}function mb(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var Fi=typeof Object.is=="function"?Object.is:mb;function El(s,o){if(Fi(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var u=Object.keys(s),d=Object.keys(o);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var y=u[d];if(!ss.call(o,y)||!Fi(s[y],o[y]))return!1}return!0}function c0(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function h0(s,o){var u=c0(s);s=0;for(var d;u;){if(u.nodeType===3){if(d=s+u.textContent.length,s<=o&&d>=o)return{node:u,offset:o-s};s=d}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=c0(u)}}function f0(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?f0(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function d0(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var o=$r(s.document);o instanceof s.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)s=o.contentWindow;else break;o=$r(s.document)}return o}function $f(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}var pb=Tn&&"documentMode"in document&&11>=document.documentMode,ja=null,Hf=null,vl=null,Kf=!1;function g0(s,o,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Kf||ja==null||ja!==$r(d)||(d=ja,"selectionStart"in d&&$f(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),vl&&El(vl,d)||(vl=d,d=Xc(Hf,"onSelect"),0<d.length&&(o=new Ba("onSelect","select",null,o,u),s.push({event:o,listeners:d}),o.target=ja)))}function Jr(s,o){var u={};return u[s.toLowerCase()]=o.toLowerCase(),u["Webkit"+s]="webkit"+o,u["Moz"+s]="moz"+o,u}var Ya={animationend:Jr("Animation","AnimationEnd"),animationiteration:Jr("Animation","AnimationIteration"),animationstart:Jr("Animation","AnimationStart"),transitionrun:Jr("Transition","TransitionRun"),transitionstart:Jr("Transition","TransitionStart"),transitioncancel:Jr("Transition","TransitionCancel"),transitionend:Jr("Transition","TransitionEnd")},zf={},m0={};Tn&&(m0=document.createElement("div").style,"AnimationEvent"in window||(delete Ya.animationend.animation,delete Ya.animationiteration.animation,delete Ya.animationstart.animation),"TransitionEvent"in window||delete Ya.transitionend.transition);function ta(s){if(zf[s])return zf[s];if(!Ya[s])return s;var o=Ya[s],u;for(u in o)if(o.hasOwnProperty(u)&&u in m0)return zf[s]=o[u];return s}var p0=ta("animationend"),y0=ta("animationiteration"),E0=ta("animationstart"),yb=ta("transitionrun"),Eb=ta("transitionstart"),vb=ta("transitioncancel"),v0=ta("transitionend"),T0=new Map,qf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");qf.push("scrollEnd");function Sn(s,o){T0.set(s,o),vn(o,[s])}var S0=new WeakMap;function Zi(s,o){if(typeof s=="object"&&s!==null){var u=S0.get(s);return u!==void 0?u:(o={value:s,source:o,stack:Na(o)},S0.set(s,o),o)}return{value:s,source:o,stack:Na(o)}}var Ji=[],Qa=0,jf=0;function fc(){for(var s=Qa,o=jf=Qa=0;o<s;){var u=Ji[o];Ji[o++]=null;var d=Ji[o];Ji[o++]=null;var y=Ji[o];Ji[o++]=null;var v=Ji[o];if(Ji[o++]=null,d!==null&&y!==null){var I=d.pending;I===null?y.next=y:(y.next=I.next,I.next=y),d.pending=y}v!==0&&A0(u,y,v)}}function dc(s,o,u,d){Ji[Qa++]=s,Ji[Qa++]=o,Ji[Qa++]=u,Ji[Qa++]=d,jf|=d,s.lanes|=d,s=s.alternate,s!==null&&(s.lanes|=d)}function Yf(s,o,u,d){return dc(s,o,u,d),gc(s)}function Xa(s,o){return dc(s,null,null,o),gc(s)}function A0(s,o,u){s.lanes|=u;var d=s.alternate;d!==null&&(d.lanes|=u);for(var y=!1,v=s.return;v!==null;)v.childLanes|=u,d=v.alternate,d!==null&&(d.childLanes|=u),v.tag===22&&(s=v.stateNode,s===null||s._visibility&1||(y=!0)),s=v,v=v.return;return s.tag===3?(v=s.stateNode,y&&o!==null&&(y=31-$e(u),s=v.hiddenUpdates,d=s[y],d===null?s[y]=[o]:d.push(o),o.lane=u|536870912),v):null}function gc(s){if(50<Kl)throw Kl=0,tg=null,Error(i(185));for(var o=s.return;o!==null;)s=o,o=s.return;return s.tag===3?s.stateNode:null}var Wa={};function Tb(s,o,u,d){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ui(s,o,u,d){return new Tb(s,o,u,d)}function Qf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function vs(s,o){var u=s.alternate;return u===null?(u=Ui(s.tag,o,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=o,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&65011712,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,o=s.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function _0(s,o){s.flags&=65011714;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=o,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,o=u.dependencies,s.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),s}function mc(s,o,u,d,y,v){var I=0;if(d=s,typeof s=="function")Qf(s)&&(I=1);else if(typeof s=="string")I=Ax(s,u,mt.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case O:return s=Ui(31,u,o,y),s.elementType=O,s.lanes=v,s;case S:return ea(u.children,y,v,o);case R:I=8,y|=24;break;case _:return s=Ui(12,u,o,y|2),s.elementType=_,s.lanes=v,s;case $:return s=Ui(13,u,o,y),s.elementType=$,s.lanes=v,s;case q:return s=Ui(19,u,o,y),s.elementType=q,s.lanes=v,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case D:case M:I=10;break t;case N:I=9;break t;case G:I=11;break t;case w:I=14;break t;case L:I=16,d=null;break t}I=29,u=Error(i(130,s===null?"null":typeof s,"")),d=null}return o=Ui(I,u,o,y),o.elementType=s,o.type=d,o.lanes=v,o}function ea(s,o,u,d){return s=Ui(7,s,d,o),s.lanes=u,s}function Xf(s,o,u){return s=Ui(6,s,null,o),s.lanes=u,s}function Wf(s,o,u){return o=Ui(4,s.children!==null?s.children:[],s.key,o),o.lanes=u,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}var Za=[],Ja=0,pc=null,yc=0,tn=[],en=0,ia=null,Ts=1,Ss="";function na(s,o){Za[Ja++]=yc,Za[Ja++]=pc,pc=s,yc=o}function R0(s,o,u){tn[en++]=Ts,tn[en++]=Ss,tn[en++]=ia,ia=s;var d=Ts;s=Ss;var y=32-$e(d)-1;d&=~(1<<y),u+=1;var v=32-$e(o)+y;if(30<v){var I=y-y%5;v=(d&(1<<I)-1).toString(32),d>>=I,y-=I,Ts=1<<32-$e(o)+y|u<<y|d,Ss=v+s}else Ts=1<<v|u<<y|d,Ss=s}function Zf(s){s.return!==null&&(na(s,1),R0(s,1,0))}function Jf(s){for(;s===pc;)pc=Za[--Ja],Za[Ja]=null,yc=Za[--Ja],Za[Ja]=null;for(;s===ia;)ia=tn[--en],tn[en]=null,Ss=tn[--en],tn[en]=null,Ts=tn[--en],tn[en]=null}var Ii=null,Le=null,ne=!1,sa=null,Vn=!1,td=Error(i(519));function ra(s){var o=Error(i(418,""));throw Al(Zi(o,s)),td}function b0(s){var o=s.stateNode,u=s.type,d=s.memoizedProps;switch(o[He]=s,o[Me]=d,u){case"dialog":qt("cancel",o),qt("close",o);break;case"iframe":case"object":case"embed":qt("load",o);break;case"video":case"audio":for(u=0;u<ql.length;u++)qt(ql[u],o);break;case"source":qt("error",o);break;case"img":case"image":case"link":qt("error",o),qt("load",o);break;case"details":qt("toggle",o);break;case"input":qt("invalid",o),Hr(o,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),Fa(o);break;case"select":qt("invalid",o);break;case"textarea":qt("invalid",o),Kr(o,d.value,d.defaultValue,d.children),Fa(o)}u=d.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||d.suppressHydrationWarning===!0||$E(o.textContent,u)?(d.popover!=null&&(qt("beforetoggle",o),qt("toggle",o)),d.onScroll!=null&&qt("scroll",o),d.onScrollEnd!=null&&qt("scrollend",o),d.onClick!=null&&(o.onclick=Wc),o=!0):o=!1,o||ra(s)}function x0(s){for(Ii=s.return;Ii;)switch(Ii.tag){case 5:case 13:Vn=!1;return;case 27:case 3:Vn=!0;return;default:Ii=Ii.return}}function Tl(s){if(s!==Ii)return!1;if(!ne)return x0(s),ne=!0,!1;var o=s.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||pg(s.type,s.memoizedProps)),u=!u),u&&Le&&ra(s),x0(s),o===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));t:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8)if(u=s.data,u==="/$"){if(o===0){Le=_n(s.nextSibling);break t}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;s=s.nextSibling}Le=null}}else o===27?(o=Le,ur(s.type)?(s=Tg,Tg=null,Le=s):Le=o):Le=Ii?_n(s.stateNode.nextSibling):null;return!0}function Sl(){Le=Ii=null,ne=!1}function I0(){var s=sa;return s!==null&&(wi===null?wi=s:wi.push.apply(wi,s),sa=null),s}function Al(s){sa===null?sa=[s]:sa.push(s)}var ed=tt(null),aa=null,As=null;function Ys(s,o,u){st(ed,o._currentValue),o._currentValue=u}function _s(s){s._currentValue=ed.current,at(ed)}function id(s,o,u){for(;s!==null;){var d=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),s===u)break;s=s.return}}function nd(s,o,u,d){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var v=y.dependencies;if(v!==null){var I=y.child;v=v.firstContext;t:for(;v!==null;){var P=v;v=y;for(var H=0;H<o.length;H++)if(P.context===o[H]){v.lanes|=u,P=v.alternate,P!==null&&(P.lanes|=u),id(v.return,u,s),d||(I=null);break t}v=P.next}}else if(y.tag===18){if(I=y.return,I===null)throw Error(i(341));I.lanes|=u,v=I.alternate,v!==null&&(v.lanes|=u),id(I,u,s),I=null}else I=y.child;if(I!==null)I.return=y;else for(I=y;I!==null;){if(I===s){I=null;break}if(y=I.sibling,y!==null){y.return=I.return,I=y;break}I=I.return}y=I}}function _l(s,o,u,d){s=null;for(var y=o,v=!1;y!==null;){if(!v){if((y.flags&524288)!==0)v=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var I=y.alternate;if(I===null)throw Error(i(387));if(I=I.memoizedProps,I!==null){var P=y.type;Fi(y.pendingProps.value,I.value)||(s!==null?s.push(P):s=[P])}}else if(y===Yt.current){if(I=y.alternate,I===null)throw Error(i(387));I.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(Zl):s=[Zl])}y=y.return}s!==null&&nd(o,s,u,d),o.flags|=262144}function Ec(s){for(s=s.firstContext;s!==null;){if(!Fi(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function oa(s){aa=s,As=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function yi(s){return L0(aa,s)}function vc(s,o){return aa===null&&oa(s),L0(s,o)}function L0(s,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},As===null){if(s===null)throw Error(i(308));As=o,s.dependencies={lanes:0,firstContext:o},s.flags|=524288}else As=As.next=o;return u}var Sb=typeof AbortController<"u"?AbortController:function(){var s=[],o=this.signal={aborted:!1,addEventListener:function(u,d){s.push(d)}};this.abort=function(){o.aborted=!0,s.forEach(function(u){return u()})}},Ab=r.unstable_scheduleCallback,_b=r.unstable_NormalPriority,qe={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sd(){return{controller:new Sb,data:new Map,refCount:0}}function Rl(s){s.refCount--,s.refCount===0&&Ab(_b,function(){s.controller.abort()})}var bl=null,rd=0,to=0,eo=null;function Rb(s,o){if(bl===null){var u=bl=[];rd=0,to=og(),eo={status:"pending",value:void 0,then:function(d){u.push(d)}}}return rd++,o.then(D0,D0),o}function D0(){if(--rd===0&&bl!==null){eo!==null&&(eo.status="fulfilled");var s=bl;bl=null,to=0,eo=null;for(var o=0;o<s.length;o++)(0,s[o])()}}function bb(s,o){var u=[],d={status:"pending",value:null,reason:null,then:function(y){u.push(y)}};return s.then(function(){d.status="fulfilled",d.value=o;for(var y=0;y<u.length;y++)(0,u[y])(o)},function(y){for(d.status="rejected",d.reason=y,y=0;y<u.length;y++)(0,u[y])(void 0)}),d}var C0=K.S;K.S=function(s,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Rb(s,o),C0!==null&&C0(s,o)};var la=tt(null);function ad(){var s=la.current;return s!==null?s:ve.pooledCache}function Tc(s,o){o===null?st(la,la.current):st(la,o.pool)}function w0(){var s=ad();return s===null?null:{parent:qe._currentValue,pool:s}}var xl=Error(i(460)),O0=Error(i(474)),Sc=Error(i(542)),od={then:function(){}};function P0(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Ac(){}function M0(s,o,u){switch(u=s[u],u===void 0?s.push(o):u!==o&&(o.then(Ac,Ac),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,N0(s),s;default:if(typeof o.status=="string")o.then(Ac,Ac);else{if(s=ve,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=o,s.status="pending",s.then(function(d){if(o.status==="pending"){var y=o;y.status="fulfilled",y.value=d}},function(d){if(o.status==="pending"){var y=o;y.status="rejected",y.reason=d}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,N0(s),s}throw Il=o,xl}}var Il=null;function k0(){if(Il===null)throw Error(i(459));var s=Il;return Il=null,s}function N0(s){if(s===xl||s===Sc)throw Error(i(483))}var Qs=!1;function ld(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ud(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Xs(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ws(s,o,u){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,(ue&2)!==0){var y=d.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),d.pending=o,o=gc(s),A0(s,null,u),o}return dc(s,d,o,u),gc(s)}function Ll(s,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var d=o.lanes;d&=s.pendingLanes,u|=d,o.lanes=u,il(s,u)}}function cd(s,o){var u=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var y=null,v=null;if(u=u.firstBaseUpdate,u!==null){do{var I={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};v===null?y=v=I:v=v.next=I,u=u.next}while(u!==null);v===null?y=v=o:v=v.next=o}else y=v=o;u={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:v,shared:d.shared,callbacks:d.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=o:s.next=o,u.lastBaseUpdate=o}var hd=!1;function Dl(){if(hd){var s=eo;if(s!==null)throw s}}function Cl(s,o,u,d){hd=!1;var y=s.updateQueue;Qs=!1;var v=y.firstBaseUpdate,I=y.lastBaseUpdate,P=y.shared.pending;if(P!==null){y.shared.pending=null;var H=P,Z=H.next;H.next=null,I===null?v=Z:I.next=Z,I=H;var ot=s.alternate;ot!==null&&(ot=ot.updateQueue,P=ot.lastBaseUpdate,P!==I&&(P===null?ot.firstBaseUpdate=Z:P.next=Z,ot.lastBaseUpdate=H))}if(v!==null){var ft=y.baseState;I=0,ot=Z=H=null,P=v;do{var J=P.lane&-536870913,et=J!==P.lane;if(et?(Wt&J)===J:(d&J)===J){J!==0&&J===to&&(hd=!0),ot!==null&&(ot=ot.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});t:{var Ot=s,Lt=P;J=o;var pe=u;switch(Lt.tag){case 1:if(Ot=Lt.payload,typeof Ot=="function"){ft=Ot.call(pe,ft,J);break t}ft=Ot;break t;case 3:Ot.flags=Ot.flags&-65537|128;case 0:if(Ot=Lt.payload,J=typeof Ot=="function"?Ot.call(pe,ft,J):Ot,J==null)break t;ft=g({},ft,J);break t;case 2:Qs=!0}}J=P.callback,J!==null&&(s.flags|=64,et&&(s.flags|=8192),et=y.callbacks,et===null?y.callbacks=[J]:et.push(J))}else et={lane:J,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ot===null?(Z=ot=et,H=ft):ot=ot.next=et,I|=J;if(P=P.next,P===null){if(P=y.shared.pending,P===null)break;et=P,P=et.next,et.next=null,y.lastBaseUpdate=et,y.shared.pending=null}}while(!0);ot===null&&(H=ft),y.baseState=H,y.firstBaseUpdate=Z,y.lastBaseUpdate=ot,v===null&&(y.shared.lanes=0),rr|=I,s.lanes=I,s.memoizedState=ft}}function F0(s,o){if(typeof s!="function")throw Error(i(191,s));s.call(o)}function U0(s,o){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)F0(u[s],o)}var io=tt(null),_c=tt(0);function B0(s,o){s=Cs,st(_c,s),st(io,o),Cs=s|o.baseLanes}function fd(){st(_c,Cs),st(io,io.current)}function dd(){Cs=_c.current,at(io),at(_c)}var Zs=0,Vt=null,ge=null,Ne=null,Rc=!1,no=!1,ua=!1,bc=0,wl=0,so=null,xb=0;function we(){throw Error(i(321))}function gd(s,o){if(o===null)return!1;for(var u=0;u<o.length&&u<s.length;u++)if(!Fi(s[u],o[u]))return!1;return!0}function md(s,o,u,d,y,v){return Zs=v,Vt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,K.H=s===null||s.memoizedState===null?Ay:_y,ua=!1,v=u(d,y),ua=!1,no&&(v=G0(o,u,d,y)),V0(s),v}function V0(s){K.H=wc;var o=ge!==null&&ge.next!==null;if(Zs=0,Ne=ge=Vt=null,Rc=!1,wl=0,so=null,o)throw Error(i(300));s===null||ei||(s=s.dependencies,s!==null&&Ec(s)&&(ei=!0))}function G0(s,o,u,d){Vt=s;var y=0;do{if(no&&(so=null),wl=0,no=!1,25<=y)throw Error(i(301));if(y+=1,Ne=ge=null,s.updateQueue!=null){var v=s.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}K.H=Pb,v=o(u,d)}while(no);return v}function Ib(){var s=K.H,o=s.useState()[0];return o=typeof o.then=="function"?Ol(o):o,s=s.useState()[0],(ge!==null?ge.memoizedState:null)!==s&&(Vt.flags|=1024),o}function pd(){var s=bc!==0;return bc=0,s}function yd(s,o,u){o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~u}function Ed(s){if(Rc){for(s=s.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}Rc=!1}Zs=0,Ne=ge=Vt=null,no=!1,wl=bc=0,so=null}function Di(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ne===null?Vt.memoizedState=Ne=s:Ne=Ne.next=s,Ne}function Fe(){if(ge===null){var s=Vt.alternate;s=s!==null?s.memoizedState:null}else s=ge.next;var o=Ne===null?Vt.memoizedState:Ne.next;if(o!==null)Ne=o,ge=s;else{if(s===null)throw Vt.alternate===null?Error(i(467)):Error(i(310));ge=s,s={memoizedState:ge.memoizedState,baseState:ge.baseState,baseQueue:ge.baseQueue,queue:ge.queue,next:null},Ne===null?Vt.memoizedState=Ne=s:Ne=Ne.next=s}return Ne}function vd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ol(s){var o=wl;return wl+=1,so===null&&(so=[]),s=M0(so,s,o),o=Vt,(Ne===null?o.memoizedState:Ne.next)===null&&(o=o.alternate,K.H=o===null||o.memoizedState===null?Ay:_y),s}function xc(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Ol(s);if(s.$$typeof===M)return yi(s)}throw Error(i(438,String(s)))}function Td(s){var o=null,u=Vt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var d=Vt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(o={data:d.data.map(function(y){return y.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=vd(),Vt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(s),d=0;d<s;d++)u[d]=C;return o.index++,u}function Rs(s,o){return typeof o=="function"?o(s):o}function Ic(s){var o=Fe();return Sd(o,ge,s)}function Sd(s,o,u){var d=s.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=u;var y=s.baseQueue,v=d.pending;if(v!==null){if(y!==null){var I=y.next;y.next=v.next,v.next=I}o.baseQueue=y=v,d.pending=null}if(v=s.baseState,y===null)s.memoizedState=v;else{o=y.next;var P=I=null,H=null,Z=o,ot=!1;do{var ft=Z.lane&-536870913;if(ft!==Z.lane?(Wt&ft)===ft:(Zs&ft)===ft){var J=Z.revertLane;if(J===0)H!==null&&(H=H.next={lane:0,revertLane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),ft===to&&(ot=!0);else if((Zs&J)===J){Z=Z.next,J===to&&(ot=!0);continue}else ft={lane:0,revertLane:Z.revertLane,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},H===null?(P=H=ft,I=v):H=H.next=ft,Vt.lanes|=J,rr|=J;ft=Z.action,ua&&u(v,ft),v=Z.hasEagerState?Z.eagerState:u(v,ft)}else J={lane:ft,revertLane:Z.revertLane,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},H===null?(P=H=J,I=v):H=H.next=J,Vt.lanes|=ft,rr|=ft;Z=Z.next}while(Z!==null&&Z!==o);if(H===null?I=v:H.next=P,!Fi(v,s.memoizedState)&&(ei=!0,ot&&(u=eo,u!==null)))throw u;s.memoizedState=v,s.baseState=I,s.baseQueue=H,d.lastRenderedState=v}return y===null&&(d.lanes=0),[s.memoizedState,d.dispatch]}function Ad(s){var o=Fe(),u=o.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=s;var d=u.dispatch,y=u.pending,v=o.memoizedState;if(y!==null){u.pending=null;var I=y=y.next;do v=s(v,I.action),I=I.next;while(I!==y);Fi(v,o.memoizedState)||(ei=!0),o.memoizedState=v,o.baseQueue===null&&(o.baseState=v),u.lastRenderedState=v}return[v,d]}function $0(s,o,u){var d=Vt,y=Fe(),v=ne;if(v){if(u===void 0)throw Error(i(407));u=u()}else u=o();var I=!Fi((ge||y).memoizedState,u);I&&(y.memoizedState=u,ei=!0),y=y.queue;var P=z0.bind(null,d,y,s);if(Pl(2048,8,P,[s]),y.getSnapshot!==o||I||Ne!==null&&Ne.memoizedState.tag&1){if(d.flags|=2048,ro(9,Lc(),K0.bind(null,d,y,u,o),null),ve===null)throw Error(i(349));v||(Zs&124)!==0||H0(d,o,u)}return u}function H0(s,o,u){s.flags|=16384,s={getSnapshot:o,value:u},o=Vt.updateQueue,o===null?(o=vd(),Vt.updateQueue=o,o.stores=[s]):(u=o.stores,u===null?o.stores=[s]:u.push(s))}function K0(s,o,u,d){o.value=u,o.getSnapshot=d,q0(o)&&j0(s)}function z0(s,o,u){return u(function(){q0(o)&&j0(s)})}function q0(s){var o=s.getSnapshot;s=s.value;try{var u=o();return!Fi(s,u)}catch{return!0}}function j0(s){var o=Xa(s,2);o!==null&&Hi(o,s,2)}function _d(s){var o=Di();if(typeof s=="function"){var u=s;if(s=u(),ua){_i(!0);try{u()}finally{_i(!1)}}}return o.memoizedState=o.baseState=s,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:s},o}function Y0(s,o,u,d){return s.baseState=u,Sd(s,ge,typeof d=="function"?d:Rs)}function Lb(s,o,u,d,y){if(Cc(s))throw Error(i(485));if(s=o.action,s!==null){var v={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(I){v.listeners.push(I)}};K.T!==null?u(!0):v.isTransition=!1,d(v),u=o.pending,u===null?(v.next=o.pending=v,Q0(o,v)):(v.next=u.next,o.pending=u.next=v)}}function Q0(s,o){var u=o.action,d=o.payload,y=s.state;if(o.isTransition){var v=K.T,I={};K.T=I;try{var P=u(y,d),H=K.S;H!==null&&H(I,P),X0(s,o,P)}catch(Z){Rd(s,o,Z)}finally{K.T=v}}else try{v=u(y,d),X0(s,o,v)}catch(Z){Rd(s,o,Z)}}function X0(s,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(d){W0(s,o,d)},function(d){return Rd(s,o,d)}):W0(s,o,u)}function W0(s,o,u){o.status="fulfilled",o.value=u,Z0(o),s.state=u,o=s.pending,o!==null&&(u=o.next,u===o?s.pending=null:(u=u.next,o.next=u,Q0(s,u)))}function Rd(s,o,u){var d=s.pending;if(s.pending=null,d!==null){d=d.next;do o.status="rejected",o.reason=u,Z0(o),o=o.next;while(o!==d)}s.action=null}function Z0(s){s=s.listeners;for(var o=0;o<s.length;o++)(0,s[o])()}function J0(s,o){return o}function ty(s,o){if(ne){var u=ve.formState;if(u!==null){t:{var d=Vt;if(ne){if(Le){e:{for(var y=Le,v=Vn;y.nodeType!==8;){if(!v){y=null;break e}if(y=_n(y.nextSibling),y===null){y=null;break e}}v=y.data,y=v==="F!"||v==="F"?y:null}if(y){Le=_n(y.nextSibling),d=y.data==="F!";break t}}ra(d)}d=!1}d&&(o=u[0])}}return u=Di(),u.memoizedState=u.baseState=o,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:J0,lastRenderedState:o},u.queue=d,u=vy.bind(null,Vt,d),d.dispatch=u,d=_d(!1),v=Dd.bind(null,Vt,!1,d.queue),d=Di(),y={state:o,dispatch:null,action:s,pending:null},d.queue=y,u=Lb.bind(null,Vt,y,v,u),y.dispatch=u,d.memoizedState=s,[o,u,!1]}function ey(s){var o=Fe();return iy(o,ge,s)}function iy(s,o,u){if(o=Sd(s,o,J0)[0],s=Ic(Rs)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var d=Ol(o)}catch(I){throw I===xl?Sc:I}else d=o;o=Fe();var y=o.queue,v=y.dispatch;return u!==o.memoizedState&&(Vt.flags|=2048,ro(9,Lc(),Db.bind(null,y,u),null)),[d,v,s]}function Db(s,o){s.action=o}function ny(s){var o=Fe(),u=ge;if(u!==null)return iy(o,u,s);Fe(),o=o.memoizedState,u=Fe();var d=u.queue.dispatch;return u.memoizedState=s,[o,d,!1]}function ro(s,o,u,d){return s={tag:s,create:u,deps:d,inst:o,next:null},o=Vt.updateQueue,o===null&&(o=vd(),Vt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=s.next=s:(d=u.next,u.next=s,s.next=d,o.lastEffect=s),s}function Lc(){return{destroy:void 0,resource:void 0}}function sy(){return Fe().memoizedState}function Dc(s,o,u,d){var y=Di();d=d===void 0?null:d,Vt.flags|=s,y.memoizedState=ro(1|o,Lc(),u,d)}function Pl(s,o,u,d){var y=Fe();d=d===void 0?null:d;var v=y.memoizedState.inst;ge!==null&&d!==null&&gd(d,ge.memoizedState.deps)?y.memoizedState=ro(o,v,u,d):(Vt.flags|=s,y.memoizedState=ro(1|o,v,u,d))}function ry(s,o){Dc(8390656,8,s,o)}function ay(s,o){Pl(2048,8,s,o)}function oy(s,o){return Pl(4,2,s,o)}function ly(s,o){return Pl(4,4,s,o)}function uy(s,o){if(typeof o=="function"){s=s();var u=o(s);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function cy(s,o,u){u=u!=null?u.concat([s]):null,Pl(4,4,uy.bind(null,o,s),u)}function bd(){}function hy(s,o){var u=Fe();o=o===void 0?null:o;var d=u.memoizedState;return o!==null&&gd(o,d[1])?d[0]:(u.memoizedState=[s,o],s)}function fy(s,o){var u=Fe();o=o===void 0?null:o;var d=u.memoizedState;if(o!==null&&gd(o,d[1]))return d[0];if(d=s(),ua){_i(!0);try{s()}finally{_i(!1)}}return u.memoizedState=[d,o],d}function xd(s,o,u){return u===void 0||(Zs&1073741824)!==0?s.memoizedState=o:(s.memoizedState=u,s=mE(),Vt.lanes|=s,rr|=s,u)}function dy(s,o,u,d){return Fi(u,o)?u:io.current!==null?(s=xd(s,u,d),Fi(s,o)||(ei=!0),s):(Zs&42)===0?(ei=!0,s.memoizedState=u):(s=mE(),Vt.lanes|=s,rr|=s,o)}function gy(s,o,u,d,y){var v=it.p;it.p=v!==0&&8>v?v:8;var I=K.T,P={};K.T=P,Dd(s,!1,o,u);try{var H=y(),Z=K.S;if(Z!==null&&Z(P,H),H!==null&&typeof H=="object"&&typeof H.then=="function"){var ot=bb(H,d);Ml(s,o,ot,$i(s))}else Ml(s,o,d,$i(s))}catch(ft){Ml(s,o,{then:function(){},status:"rejected",reason:ft},$i())}finally{it.p=v,K.T=I}}function Cb(){}function Id(s,o,u,d){if(s.tag!==5)throw Error(i(476));var y=my(s).queue;gy(s,y,o,ct,u===null?Cb:function(){return py(s),u(d)})}function my(s){var o=s.memoizedState;if(o!==null)return o;o={memoizedState:ct,baseState:ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:ct},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:u},next:null},s.memoizedState=o,s=s.alternate,s!==null&&(s.memoizedState=o),o}function py(s){var o=my(s).next.queue;Ml(s,o,{},$i())}function Ld(){return yi(Zl)}function yy(){return Fe().memoizedState}function Ey(){return Fe().memoizedState}function wb(s){for(var o=s.return;o!==null;){switch(o.tag){case 24:case 3:var u=$i();s=Xs(u);var d=Ws(o,s,u);d!==null&&(Hi(d,o,u),Ll(d,o,u)),o={cache:sd()},s.payload=o;return}o=o.return}}function Ob(s,o,u){var d=$i();u={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Cc(s)?Ty(o,u):(u=Yf(s,o,u,d),u!==null&&(Hi(u,s,d),Sy(u,o,d)))}function vy(s,o,u){var d=$i();Ml(s,o,u,d)}function Ml(s,o,u,d){var y={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Cc(s))Ty(o,y);else{var v=s.alternate;if(s.lanes===0&&(v===null||v.lanes===0)&&(v=o.lastRenderedReducer,v!==null))try{var I=o.lastRenderedState,P=v(I,u);if(y.hasEagerState=!0,y.eagerState=P,Fi(P,I))return dc(s,o,y,0),ve===null&&fc(),!1}catch{}finally{}if(u=Yf(s,o,y,d),u!==null)return Hi(u,s,d),Sy(u,o,d),!0}return!1}function Dd(s,o,u,d){if(d={lane:2,revertLane:og(),action:d,hasEagerState:!1,eagerState:null,next:null},Cc(s)){if(o)throw Error(i(479))}else o=Yf(s,u,d,2),o!==null&&Hi(o,s,2)}function Cc(s){var o=s.alternate;return s===Vt||o!==null&&o===Vt}function Ty(s,o){no=Rc=!0;var u=s.pending;u===null?o.next=o:(o.next=u.next,u.next=o),s.pending=o}function Sy(s,o,u){if((u&4194048)!==0){var d=o.lanes;d&=s.pendingLanes,u|=d,o.lanes=u,il(s,u)}}var wc={readContext:yi,use:xc,useCallback:we,useContext:we,useEffect:we,useImperativeHandle:we,useLayoutEffect:we,useInsertionEffect:we,useMemo:we,useReducer:we,useRef:we,useState:we,useDebugValue:we,useDeferredValue:we,useTransition:we,useSyncExternalStore:we,useId:we,useHostTransitionStatus:we,useFormState:we,useActionState:we,useOptimistic:we,useMemoCache:we,useCacheRefresh:we},Ay={readContext:yi,use:xc,useCallback:function(s,o){return Di().memoizedState=[s,o===void 0?null:o],s},useContext:yi,useEffect:ry,useImperativeHandle:function(s,o,u){u=u!=null?u.concat([s]):null,Dc(4194308,4,uy.bind(null,o,s),u)},useLayoutEffect:function(s,o){return Dc(4194308,4,s,o)},useInsertionEffect:function(s,o){Dc(4,2,s,o)},useMemo:function(s,o){var u=Di();o=o===void 0?null:o;var d=s();if(ua){_i(!0);try{s()}finally{_i(!1)}}return u.memoizedState=[d,o],d},useReducer:function(s,o,u){var d=Di();if(u!==void 0){var y=u(o);if(ua){_i(!0);try{u(o)}finally{_i(!1)}}}else y=o;return d.memoizedState=d.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},d.queue=s,s=s.dispatch=Ob.bind(null,Vt,s),[d.memoizedState,s]},useRef:function(s){var o=Di();return s={current:s},o.memoizedState=s},useState:function(s){s=_d(s);var o=s.queue,u=vy.bind(null,Vt,o);return o.dispatch=u,[s.memoizedState,u]},useDebugValue:bd,useDeferredValue:function(s,o){var u=Di();return xd(u,s,o)},useTransition:function(){var s=_d(!1);return s=gy.bind(null,Vt,s.queue,!0,!1),Di().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,o,u){var d=Vt,y=Di();if(ne){if(u===void 0)throw Error(i(407));u=u()}else{if(u=o(),ve===null)throw Error(i(349));(Wt&124)!==0||H0(d,o,u)}y.memoizedState=u;var v={value:u,getSnapshot:o};return y.queue=v,ry(z0.bind(null,d,v,s),[s]),d.flags|=2048,ro(9,Lc(),K0.bind(null,d,v,u,o),null),u},useId:function(){var s=Di(),o=ve.identifierPrefix;if(ne){var u=Ss,d=Ts;u=(d&~(1<<32-$e(d)-1)).toString(32)+u,o="«"+o+"R"+u,u=bc++,0<u&&(o+="H"+u.toString(32)),o+="»"}else u=xb++,o="«"+o+"r"+u.toString(32)+"»";return s.memoizedState=o},useHostTransitionStatus:Ld,useFormState:ty,useActionState:ty,useOptimistic:function(s){var o=Di();o.memoizedState=o.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Dd.bind(null,Vt,!0,u),u.dispatch=o,[s,o]},useMemoCache:Td,useCacheRefresh:function(){return Di().memoizedState=wb.bind(null,Vt)}},_y={readContext:yi,use:xc,useCallback:hy,useContext:yi,useEffect:ay,useImperativeHandle:cy,useInsertionEffect:oy,useLayoutEffect:ly,useMemo:fy,useReducer:Ic,useRef:sy,useState:function(){return Ic(Rs)},useDebugValue:bd,useDeferredValue:function(s,o){var u=Fe();return dy(u,ge.memoizedState,s,o)},useTransition:function(){var s=Ic(Rs)[0],o=Fe().memoizedState;return[typeof s=="boolean"?s:Ol(s),o]},useSyncExternalStore:$0,useId:yy,useHostTransitionStatus:Ld,useFormState:ey,useActionState:ey,useOptimistic:function(s,o){var u=Fe();return Y0(u,ge,s,o)},useMemoCache:Td,useCacheRefresh:Ey},Pb={readContext:yi,use:xc,useCallback:hy,useContext:yi,useEffect:ay,useImperativeHandle:cy,useInsertionEffect:oy,useLayoutEffect:ly,useMemo:fy,useReducer:Ad,useRef:sy,useState:function(){return Ad(Rs)},useDebugValue:bd,useDeferredValue:function(s,o){var u=Fe();return ge===null?xd(u,s,o):dy(u,ge.memoizedState,s,o)},useTransition:function(){var s=Ad(Rs)[0],o=Fe().memoizedState;return[typeof s=="boolean"?s:Ol(s),o]},useSyncExternalStore:$0,useId:yy,useHostTransitionStatus:Ld,useFormState:ny,useActionState:ny,useOptimistic:function(s,o){var u=Fe();return ge!==null?Y0(u,ge,s,o):(u.baseState=s,[s,u.queue.dispatch])},useMemoCache:Td,useCacheRefresh:Ey},ao=null,kl=0;function Oc(s){var o=kl;return kl+=1,ao===null&&(ao=[]),M0(ao,s,o)}function Nl(s,o){o=o.props.ref,s.ref=o!==void 0?o:null}function Pc(s,o){throw o.$$typeof===p?Error(i(525)):(s=Object.prototype.toString.call(o),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)))}function Ry(s){var o=s._init;return o(s._payload)}function by(s){function o(j,z){if(s){var X=j.deletions;X===null?(j.deletions=[z],j.flags|=16):X.push(z)}}function u(j,z){if(!s)return null;for(;z!==null;)o(j,z),z=z.sibling;return null}function d(j){for(var z=new Map;j!==null;)j.key!==null?z.set(j.key,j):z.set(j.index,j),j=j.sibling;return z}function y(j,z){return j=vs(j,z),j.index=0,j.sibling=null,j}function v(j,z,X){return j.index=X,s?(X=j.alternate,X!==null?(X=X.index,X<z?(j.flags|=67108866,z):X):(j.flags|=67108866,z)):(j.flags|=1048576,z)}function I(j){return s&&j.alternate===null&&(j.flags|=67108866),j}function P(j,z,X,ut){return z===null||z.tag!==6?(z=Xf(X,j.mode,ut),z.return=j,z):(z=y(z,X),z.return=j,z)}function H(j,z,X,ut){var _t=X.type;return _t===S?ot(j,z,X.props.children,ut,X.key):z!==null&&(z.elementType===_t||typeof _t=="object"&&_t!==null&&_t.$$typeof===L&&Ry(_t)===z.type)?(z=y(z,X.props),Nl(z,X),z.return=j,z):(z=mc(X.type,X.key,X.props,null,j.mode,ut),Nl(z,X),z.return=j,z)}function Z(j,z,X,ut){return z===null||z.tag!==4||z.stateNode.containerInfo!==X.containerInfo||z.stateNode.implementation!==X.implementation?(z=Wf(X,j.mode,ut),z.return=j,z):(z=y(z,X.children||[]),z.return=j,z)}function ot(j,z,X,ut,_t){return z===null||z.tag!==7?(z=ea(X,j.mode,ut,_t),z.return=j,z):(z=y(z,X),z.return=j,z)}function ft(j,z,X){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return z=Xf(""+z,j.mode,X),z.return=j,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case E:return X=mc(z.type,z.key,z.props,null,j.mode,X),Nl(X,z),X.return=j,X;case T:return z=Wf(z,j.mode,X),z.return=j,z;case L:var ut=z._init;return z=ut(z._payload),ft(j,z,X)}if(gt(z)||V(z))return z=ea(z,j.mode,X,null),z.return=j,z;if(typeof z.then=="function")return ft(j,Oc(z),X);if(z.$$typeof===M)return ft(j,vc(j,z),X);Pc(j,z)}return null}function J(j,z,X,ut){var _t=z!==null?z.key:null;if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return _t!==null?null:P(j,z,""+X,ut);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case E:return X.key===_t?H(j,z,X,ut):null;case T:return X.key===_t?Z(j,z,X,ut):null;case L:return _t=X._init,X=_t(X._payload),J(j,z,X,ut)}if(gt(X)||V(X))return _t!==null?null:ot(j,z,X,ut,null);if(typeof X.then=="function")return J(j,z,Oc(X),ut);if(X.$$typeof===M)return J(j,z,vc(j,X),ut);Pc(j,X)}return null}function et(j,z,X,ut,_t){if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return j=j.get(X)||null,P(z,j,""+ut,_t);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case E:return j=j.get(ut.key===null?X:ut.key)||null,H(z,j,ut,_t);case T:return j=j.get(ut.key===null?X:ut.key)||null,Z(z,j,ut,_t);case L:var $t=ut._init;return ut=$t(ut._payload),et(j,z,X,ut,_t)}if(gt(ut)||V(ut))return j=j.get(X)||null,ot(z,j,ut,_t,null);if(typeof ut.then=="function")return et(j,z,X,Oc(ut),_t);if(ut.$$typeof===M)return et(j,z,X,vc(z,ut),_t);Pc(z,ut)}return null}function Ot(j,z,X,ut){for(var _t=null,$t=null,xt=z,Dt=z=0,ni=null;xt!==null&&Dt<X.length;Dt++){xt.index>Dt?(ni=xt,xt=null):ni=xt.sibling;var ee=J(j,xt,X[Dt],ut);if(ee===null){xt===null&&(xt=ni);break}s&&xt&&ee.alternate===null&&o(j,xt),z=v(ee,z,Dt),$t===null?_t=ee:$t.sibling=ee,$t=ee,xt=ni}if(Dt===X.length)return u(j,xt),ne&&na(j,Dt),_t;if(xt===null){for(;Dt<X.length;Dt++)xt=ft(j,X[Dt],ut),xt!==null&&(z=v(xt,z,Dt),$t===null?_t=xt:$t.sibling=xt,$t=xt);return ne&&na(j,Dt),_t}for(xt=d(xt);Dt<X.length;Dt++)ni=et(xt,j,Dt,X[Dt],ut),ni!==null&&(s&&ni.alternate!==null&&xt.delete(ni.key===null?Dt:ni.key),z=v(ni,z,Dt),$t===null?_t=ni:$t.sibling=ni,$t=ni);return s&&xt.forEach(function(gr){return o(j,gr)}),ne&&na(j,Dt),_t}function Lt(j,z,X,ut){if(X==null)throw Error(i(151));for(var _t=null,$t=null,xt=z,Dt=z=0,ni=null,ee=X.next();xt!==null&&!ee.done;Dt++,ee=X.next()){xt.index>Dt?(ni=xt,xt=null):ni=xt.sibling;var gr=J(j,xt,ee.value,ut);if(gr===null){xt===null&&(xt=ni);break}s&&xt&&gr.alternate===null&&o(j,xt),z=v(gr,z,Dt),$t===null?_t=gr:$t.sibling=gr,$t=gr,xt=ni}if(ee.done)return u(j,xt),ne&&na(j,Dt),_t;if(xt===null){for(;!ee.done;Dt++,ee=X.next())ee=ft(j,ee.value,ut),ee!==null&&(z=v(ee,z,Dt),$t===null?_t=ee:$t.sibling=ee,$t=ee);return ne&&na(j,Dt),_t}for(xt=d(xt);!ee.done;Dt++,ee=X.next())ee=et(xt,j,Dt,ee.value,ut),ee!==null&&(s&&ee.alternate!==null&&xt.delete(ee.key===null?Dt:ee.key),z=v(ee,z,Dt),$t===null?_t=ee:$t.sibling=ee,$t=ee);return s&&xt.forEach(function(Mx){return o(j,Mx)}),ne&&na(j,Dt),_t}function pe(j,z,X,ut){if(typeof X=="object"&&X!==null&&X.type===S&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case E:t:{for(var _t=X.key;z!==null;){if(z.key===_t){if(_t=X.type,_t===S){if(z.tag===7){u(j,z.sibling),ut=y(z,X.props.children),ut.return=j,j=ut;break t}}else if(z.elementType===_t||typeof _t=="object"&&_t!==null&&_t.$$typeof===L&&Ry(_t)===z.type){u(j,z.sibling),ut=y(z,X.props),Nl(ut,X),ut.return=j,j=ut;break t}u(j,z);break}else o(j,z);z=z.sibling}X.type===S?(ut=ea(X.props.children,j.mode,ut,X.key),ut.return=j,j=ut):(ut=mc(X.type,X.key,X.props,null,j.mode,ut),Nl(ut,X),ut.return=j,j=ut)}return I(j);case T:t:{for(_t=X.key;z!==null;){if(z.key===_t)if(z.tag===4&&z.stateNode.containerInfo===X.containerInfo&&z.stateNode.implementation===X.implementation){u(j,z.sibling),ut=y(z,X.children||[]),ut.return=j,j=ut;break t}else{u(j,z);break}else o(j,z);z=z.sibling}ut=Wf(X,j.mode,ut),ut.return=j,j=ut}return I(j);case L:return _t=X._init,X=_t(X._payload),pe(j,z,X,ut)}if(gt(X))return Ot(j,z,X,ut);if(V(X)){if(_t=V(X),typeof _t!="function")throw Error(i(150));return X=_t.call(X),Lt(j,z,X,ut)}if(typeof X.then=="function")return pe(j,z,Oc(X),ut);if(X.$$typeof===M)return pe(j,z,vc(j,X),ut);Pc(j,X)}return typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint"?(X=""+X,z!==null&&z.tag===6?(u(j,z.sibling),ut=y(z,X),ut.return=j,j=ut):(u(j,z),ut=Xf(X,j.mode,ut),ut.return=j,j=ut),I(j)):u(j,z)}return function(j,z,X,ut){try{kl=0;var _t=pe(j,z,X,ut);return ao=null,_t}catch(xt){if(xt===xl||xt===Sc)throw xt;var $t=Ui(29,xt,null,j.mode);return $t.lanes=ut,$t.return=j,$t}finally{}}}var oo=by(!0),xy=by(!1),nn=tt(null),Gn=null;function Js(s){var o=s.alternate;st(je,je.current&1),st(nn,s),Gn===null&&(o===null||io.current!==null||o.memoizedState!==null)&&(Gn=s)}function Iy(s){if(s.tag===22){if(st(je,je.current),st(nn,s),Gn===null){var o=s.alternate;o!==null&&o.memoizedState!==null&&(Gn=s)}}else tr()}function tr(){st(je,je.current),st(nn,nn.current)}function bs(s){at(nn),Gn===s&&(Gn=null),at(je)}var je=tt(0);function Mc(s){for(var o=s;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||vg(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Cd(s,o,u,d){o=s.memoizedState,u=u(d,o),u=u==null?o:g({},o,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var wd={enqueueSetState:function(s,o,u){s=s._reactInternals;var d=$i(),y=Xs(d);y.payload=o,u!=null&&(y.callback=u),o=Ws(s,y,d),o!==null&&(Hi(o,s,d),Ll(o,s,d))},enqueueReplaceState:function(s,o,u){s=s._reactInternals;var d=$i(),y=Xs(d);y.tag=1,y.payload=o,u!=null&&(y.callback=u),o=Ws(s,y,d),o!==null&&(Hi(o,s,d),Ll(o,s,d))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var u=$i(),d=Xs(u);d.tag=2,o!=null&&(d.callback=o),o=Ws(s,d,u),o!==null&&(Hi(o,s,u),Ll(o,s,u))}};function Ly(s,o,u,d,y,v,I){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,v,I):o.prototype&&o.prototype.isPureReactComponent?!El(u,d)||!El(y,v):!0}function Dy(s,o,u,d){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,d),o.state!==s&&wd.enqueueReplaceState(o,o.state,null)}function ca(s,o){var u=o;if("ref"in o){u={};for(var d in o)d!=="ref"&&(u[d]=o[d])}if(s=s.defaultProps){u===o&&(u=g({},u));for(var y in s)u[y]===void 0&&(u[y]=s[y])}return u}var kc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Cy(s){kc(s)}function wy(s){console.error(s)}function Oy(s){kc(s)}function Nc(s,o){try{var u=s.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(d){setTimeout(function(){throw d})}}function Py(s,o,u){try{var d=s.onCaughtError;d(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Od(s,o,u){return u=Xs(u),u.tag=3,u.payload={element:null},u.callback=function(){Nc(s,o)},u}function My(s){return s=Xs(s),s.tag=3,s}function ky(s,o,u,d){var y=u.type.getDerivedStateFromError;if(typeof y=="function"){var v=d.value;s.payload=function(){return y(v)},s.callback=function(){Py(o,u,d)}}var I=u.stateNode;I!==null&&typeof I.componentDidCatch=="function"&&(s.callback=function(){Py(o,u,d),typeof y!="function"&&(ar===null?ar=new Set([this]):ar.add(this));var P=d.stack;this.componentDidCatch(d.value,{componentStack:P!==null?P:""})})}function Mb(s,o,u,d,y){if(u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(o=u.alternate,o!==null&&_l(o,u,y,!0),u=nn.current,u!==null){switch(u.tag){case 13:return Gn===null?ig():u.alternate===null&&De===0&&(De=3),u.flags&=-257,u.flags|=65536,u.lanes=y,d===od?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([d]):o.add(d),sg(s,d,y)),!1;case 22:return u.flags|=65536,d===od?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([d])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([d]):u.add(d)),sg(s,d,y)),!1}throw Error(i(435,u.tag))}return sg(s,d,y),ig(),!1}if(ne)return o=nn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=y,d!==td&&(s=Error(i(422),{cause:d}),Al(Zi(s,u)))):(d!==td&&(o=Error(i(423),{cause:d}),Al(Zi(o,u))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,d=Zi(d,u),y=Od(s.stateNode,d,y),cd(s,y),De!==4&&(De=2)),!1;var v=Error(i(520),{cause:d});if(v=Zi(v,u),Hl===null?Hl=[v]:Hl.push(v),De!==4&&(De=2),o===null)return!0;d=Zi(d,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,s=y&-y,u.lanes|=s,s=Od(u.stateNode,d,s),cd(u,s),!1;case 1:if(o=u.type,v=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(ar===null||!ar.has(v))))return u.flags|=65536,y&=-y,u.lanes|=y,y=My(y),ky(y,s,u,d),cd(u,y),!1}u=u.return}while(u!==null);return!1}var Ny=Error(i(461)),ei=!1;function ui(s,o,u,d){o.child=s===null?xy(o,null,u,d):oo(o,s.child,u,d)}function Fy(s,o,u,d,y){u=u.render;var v=o.ref;if("ref"in d){var I={};for(var P in d)P!=="ref"&&(I[P]=d[P])}else I=d;return oa(o),d=md(s,o,u,I,v,y),P=pd(),s!==null&&!ei?(yd(s,o,y),xs(s,o,y)):(ne&&P&&Zf(o),o.flags|=1,ui(s,o,d,y),o.child)}function Uy(s,o,u,d,y){if(s===null){var v=u.type;return typeof v=="function"&&!Qf(v)&&v.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=v,By(s,o,v,d,y)):(s=mc(u.type,null,d,o,o.mode,y),s.ref=o.ref,s.return=o,o.child=s)}if(v=s.child,!Vd(s,y)){var I=v.memoizedProps;if(u=u.compare,u=u!==null?u:El,u(I,d)&&s.ref===o.ref)return xs(s,o,y)}return o.flags|=1,s=vs(v,d),s.ref=o.ref,s.return=o,o.child=s}function By(s,o,u,d,y){if(s!==null){var v=s.memoizedProps;if(El(v,d)&&s.ref===o.ref)if(ei=!1,o.pendingProps=d=v,Vd(s,y))(s.flags&131072)!==0&&(ei=!0);else return o.lanes=s.lanes,xs(s,o,y)}return Pd(s,o,u,d,y)}function Vy(s,o,u){var d=o.pendingProps,y=d.children,v=s!==null?s.memoizedState:null;if(d.mode==="hidden"){if((o.flags&128)!==0){if(d=v!==null?v.baseLanes|u:u,s!==null){for(y=o.child=s.child,v=0;y!==null;)v=v|y.lanes|y.childLanes,y=y.sibling;o.childLanes=v&~d}else o.childLanes=0,o.child=null;return Gy(s,o,d,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},s!==null&&Tc(o,v!==null?v.cachePool:null),v!==null?B0(o,v):fd(),Iy(o);else return o.lanes=o.childLanes=536870912,Gy(s,o,v!==null?v.baseLanes|u:u,u)}else v!==null?(Tc(o,v.cachePool),B0(o,v),tr(),o.memoizedState=null):(s!==null&&Tc(o,null),fd(),tr());return ui(s,o,y,u),o.child}function Gy(s,o,u,d){var y=ad();return y=y===null?null:{parent:qe._currentValue,pool:y},o.memoizedState={baseLanes:u,cachePool:y},s!==null&&Tc(o,null),fd(),Iy(o),s!==null&&_l(s,o,d,!0),null}function Fc(s,o){var u=o.ref;if(u===null)s!==null&&s.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(s===null||s.ref!==u)&&(o.flags|=4194816)}}function Pd(s,o,u,d,y){return oa(o),u=md(s,o,u,d,void 0,y),d=pd(),s!==null&&!ei?(yd(s,o,y),xs(s,o,y)):(ne&&d&&Zf(o),o.flags|=1,ui(s,o,u,y),o.child)}function $y(s,o,u,d,y,v){return oa(o),o.updateQueue=null,u=G0(o,d,u,y),V0(s),d=pd(),s!==null&&!ei?(yd(s,o,v),xs(s,o,v)):(ne&&d&&Zf(o),o.flags|=1,ui(s,o,u,v),o.child)}function Hy(s,o,u,d,y){if(oa(o),o.stateNode===null){var v=Wa,I=u.contextType;typeof I=="object"&&I!==null&&(v=yi(I)),v=new u(d,v),o.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=wd,o.stateNode=v,v._reactInternals=o,v=o.stateNode,v.props=d,v.state=o.memoizedState,v.refs={},ld(o),I=u.contextType,v.context=typeof I=="object"&&I!==null?yi(I):Wa,v.state=o.memoizedState,I=u.getDerivedStateFromProps,typeof I=="function"&&(Cd(o,u,I,d),v.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(I=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),I!==v.state&&wd.enqueueReplaceState(v,v.state,null),Cl(o,d,v,y),Dl(),v.state=o.memoizedState),typeof v.componentDidMount=="function"&&(o.flags|=4194308),d=!0}else if(s===null){v=o.stateNode;var P=o.memoizedProps,H=ca(u,P);v.props=H;var Z=v.context,ot=u.contextType;I=Wa,typeof ot=="object"&&ot!==null&&(I=yi(ot));var ft=u.getDerivedStateFromProps;ot=typeof ft=="function"||typeof v.getSnapshotBeforeUpdate=="function",P=o.pendingProps!==P,ot||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(P||Z!==I)&&Dy(o,v,d,I),Qs=!1;var J=o.memoizedState;v.state=J,Cl(o,d,v,y),Dl(),Z=o.memoizedState,P||J!==Z||Qs?(typeof ft=="function"&&(Cd(o,u,ft,d),Z=o.memoizedState),(H=Qs||Ly(o,u,H,d,J,Z,I))?(ot||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(o.flags|=4194308)):(typeof v.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=Z),v.props=d,v.state=Z,v.context=I,d=H):(typeof v.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{v=o.stateNode,ud(s,o),I=o.memoizedProps,ot=ca(u,I),v.props=ot,ft=o.pendingProps,J=v.context,Z=u.contextType,H=Wa,typeof Z=="object"&&Z!==null&&(H=yi(Z)),P=u.getDerivedStateFromProps,(Z=typeof P=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(I!==ft||J!==H)&&Dy(o,v,d,H),Qs=!1,J=o.memoizedState,v.state=J,Cl(o,d,v,y),Dl();var et=o.memoizedState;I!==ft||J!==et||Qs||s!==null&&s.dependencies!==null&&Ec(s.dependencies)?(typeof P=="function"&&(Cd(o,u,P,d),et=o.memoizedState),(ot=Qs||Ly(o,u,ot,d,J,et,H)||s!==null&&s.dependencies!==null&&Ec(s.dependencies))?(Z||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,et,H),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,et,H)),typeof v.componentDidUpdate=="function"&&(o.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof v.componentDidUpdate!="function"||I===s.memoizedProps&&J===s.memoizedState||(o.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||I===s.memoizedProps&&J===s.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=et),v.props=d,v.state=et,v.context=H,d=ot):(typeof v.componentDidUpdate!="function"||I===s.memoizedProps&&J===s.memoizedState||(o.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||I===s.memoizedProps&&J===s.memoizedState||(o.flags|=1024),d=!1)}return v=d,Fc(s,o),d=(o.flags&128)!==0,v||d?(v=o.stateNode,u=d&&typeof u.getDerivedStateFromError!="function"?null:v.render(),o.flags|=1,s!==null&&d?(o.child=oo(o,s.child,null,y),o.child=oo(o,null,u,y)):ui(s,o,u,y),o.memoizedState=v.state,s=o.child):s=xs(s,o,y),s}function Ky(s,o,u,d){return Sl(),o.flags|=256,ui(s,o,u,d),o.child}var Md={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function kd(s){return{baseLanes:s,cachePool:w0()}}function Nd(s,o,u){return s=s!==null?s.childLanes&~u:0,o&&(s|=sn),s}function zy(s,o,u){var d=o.pendingProps,y=!1,v=(o.flags&128)!==0,I;if((I=v)||(I=s!==null&&s.memoizedState===null?!1:(je.current&2)!==0),I&&(y=!0,o.flags&=-129),I=(o.flags&32)!==0,o.flags&=-33,s===null){if(ne){if(y?Js(o):tr(),ne){var P=Le,H;if(H=P){t:{for(H=P,P=Vn;H.nodeType!==8;){if(!P){P=null;break t}if(H=_n(H.nextSibling),H===null){P=null;break t}}P=H}P!==null?(o.memoizedState={dehydrated:P,treeContext:ia!==null?{id:Ts,overflow:Ss}:null,retryLane:536870912,hydrationErrors:null},H=Ui(18,null,null,0),H.stateNode=P,H.return=o,o.child=H,Ii=o,Le=null,H=!0):H=!1}H||ra(o)}if(P=o.memoizedState,P!==null&&(P=P.dehydrated,P!==null))return vg(P)?o.lanes=32:o.lanes=536870912,null;bs(o)}return P=d.children,d=d.fallback,y?(tr(),y=o.mode,P=Uc({mode:"hidden",children:P},y),d=ea(d,y,u,null),P.return=o,d.return=o,P.sibling=d,o.child=P,y=o.child,y.memoizedState=kd(u),y.childLanes=Nd(s,I,u),o.memoizedState=Md,d):(Js(o),Fd(o,P))}if(H=s.memoizedState,H!==null&&(P=H.dehydrated,P!==null)){if(v)o.flags&256?(Js(o),o.flags&=-257,o=Ud(s,o,u)):o.memoizedState!==null?(tr(),o.child=s.child,o.flags|=128,o=null):(tr(),y=d.fallback,P=o.mode,d=Uc({mode:"visible",children:d.children},P),y=ea(y,P,u,null),y.flags|=2,d.return=o,y.return=o,d.sibling=y,o.child=d,oo(o,s.child,null,u),d=o.child,d.memoizedState=kd(u),d.childLanes=Nd(s,I,u),o.memoizedState=Md,o=y);else if(Js(o),vg(P)){if(I=P.nextSibling&&P.nextSibling.dataset,I)var Z=I.dgst;I=Z,d=Error(i(419)),d.stack="",d.digest=I,Al({value:d,source:null,stack:null}),o=Ud(s,o,u)}else if(ei||_l(s,o,u,!1),I=(u&s.childLanes)!==0,ei||I){if(I=ve,I!==null&&(d=u&-u,d=(d&42)!==0?1:Gs(d),d=(d&(I.suspendedLanes|u))!==0?0:d,d!==0&&d!==H.retryLane))throw H.retryLane=d,Xa(s,d),Hi(I,s,d),Ny;P.data==="$?"||ig(),o=Ud(s,o,u)}else P.data==="$?"?(o.flags|=192,o.child=s.child,o=null):(s=H.treeContext,Le=_n(P.nextSibling),Ii=o,ne=!0,sa=null,Vn=!1,s!==null&&(tn[en++]=Ts,tn[en++]=Ss,tn[en++]=ia,Ts=s.id,Ss=s.overflow,ia=o),o=Fd(o,d.children),o.flags|=4096);return o}return y?(tr(),y=d.fallback,P=o.mode,H=s.child,Z=H.sibling,d=vs(H,{mode:"hidden",children:d.children}),d.subtreeFlags=H.subtreeFlags&65011712,Z!==null?y=vs(Z,y):(y=ea(y,P,u,null),y.flags|=2),y.return=o,d.return=o,d.sibling=y,o.child=d,d=y,y=o.child,P=s.child.memoizedState,P===null?P=kd(u):(H=P.cachePool,H!==null?(Z=qe._currentValue,H=H.parent!==Z?{parent:Z,pool:Z}:H):H=w0(),P={baseLanes:P.baseLanes|u,cachePool:H}),y.memoizedState=P,y.childLanes=Nd(s,I,u),o.memoizedState=Md,d):(Js(o),u=s.child,s=u.sibling,u=vs(u,{mode:"visible",children:d.children}),u.return=o,u.sibling=null,s!==null&&(I=o.deletions,I===null?(o.deletions=[s],o.flags|=16):I.push(s)),o.child=u,o.memoizedState=null,u)}function Fd(s,o){return o=Uc({mode:"visible",children:o},s.mode),o.return=s,s.child=o}function Uc(s,o){return s=Ui(22,s,null,o),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function Ud(s,o,u){return oo(o,s.child,null,u),s=Fd(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function qy(s,o,u){s.lanes|=o;var d=s.alternate;d!==null&&(d.lanes|=o),id(s.return,o,u)}function Bd(s,o,u,d,y){var v=s.memoizedState;v===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:y}:(v.isBackwards=o,v.rendering=null,v.renderingStartTime=0,v.last=d,v.tail=u,v.tailMode=y)}function jy(s,o,u){var d=o.pendingProps,y=d.revealOrder,v=d.tail;if(ui(s,o,d.children,u),d=je.current,(d&2)!==0)d=d&1|2,o.flags|=128;else{if(s!==null&&(s.flags&128)!==0)t:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&qy(s,u,o);else if(s.tag===19)qy(s,u,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break t;for(;s.sibling===null;){if(s.return===null||s.return===o)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}d&=1}switch(st(je,d),y){case"forwards":for(u=o.child,y=null;u!==null;)s=u.alternate,s!==null&&Mc(s)===null&&(y=u),u=u.sibling;u=y,u===null?(y=o.child,o.child=null):(y=u.sibling,u.sibling=null),Bd(o,!1,y,u,v);break;case"backwards":for(u=null,y=o.child,o.child=null;y!==null;){if(s=y.alternate,s!==null&&Mc(s)===null){o.child=y;break}s=y.sibling,y.sibling=u,u=y,y=s}Bd(o,!0,u,null,v);break;case"together":Bd(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function xs(s,o,u){if(s!==null&&(o.dependencies=s.dependencies),rr|=o.lanes,(u&o.childLanes)===0)if(s!==null){if(_l(s,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(s!==null&&o.child!==s.child)throw Error(i(153));if(o.child!==null){for(s=o.child,u=vs(s,s.pendingProps),o.child=u,u.return=o;s.sibling!==null;)s=s.sibling,u=u.sibling=vs(s,s.pendingProps),u.return=o;u.sibling=null}return o.child}function Vd(s,o){return(s.lanes&o)!==0?!0:(s=s.dependencies,!!(s!==null&&Ec(s)))}function kb(s,o,u){switch(o.tag){case 3:Ut(o,o.stateNode.containerInfo),Ys(o,qe,s.memoizedState.cache),Sl();break;case 27:case 5:dn(o);break;case 4:Ut(o,o.stateNode.containerInfo);break;case 10:Ys(o,o.type,o.memoizedProps.value);break;case 13:var d=o.memoizedState;if(d!==null)return d.dehydrated!==null?(Js(o),o.flags|=128,null):(u&o.child.childLanes)!==0?zy(s,o,u):(Js(o),s=xs(s,o,u),s!==null?s.sibling:null);Js(o);break;case 19:var y=(s.flags&128)!==0;if(d=(u&o.childLanes)!==0,d||(_l(s,o,u,!1),d=(u&o.childLanes)!==0),y){if(d)return jy(s,o,u);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),st(je,je.current),d)break;return null;case 22:case 23:return o.lanes=0,Vy(s,o,u);case 24:Ys(o,qe,s.memoizedState.cache)}return xs(s,o,u)}function Yy(s,o,u){if(s!==null)if(s.memoizedProps!==o.pendingProps)ei=!0;else{if(!Vd(s,u)&&(o.flags&128)===0)return ei=!1,kb(s,o,u);ei=(s.flags&131072)!==0}else ei=!1,ne&&(o.flags&1048576)!==0&&R0(o,yc,o.index);switch(o.lanes=0,o.tag){case 16:t:{s=o.pendingProps;var d=o.elementType,y=d._init;if(d=y(d._payload),o.type=d,typeof d=="function")Qf(d)?(s=ca(d,s),o.tag=1,o=Hy(null,o,d,s,u)):(o.tag=0,o=Pd(null,o,d,s,u));else{if(d!=null){if(y=d.$$typeof,y===G){o.tag=11,o=Fy(null,o,d,s,u);break t}else if(y===w){o.tag=14,o=Uy(null,o,d,s,u);break t}}throw o=pt(d)||d,Error(i(306,o,""))}}return o;case 0:return Pd(s,o,o.type,o.pendingProps,u);case 1:return d=o.type,y=ca(d,o.pendingProps),Hy(s,o,d,y,u);case 3:t:{if(Ut(o,o.stateNode.containerInfo),s===null)throw Error(i(387));d=o.pendingProps;var v=o.memoizedState;y=v.element,ud(s,o),Cl(o,d,null,u);var I=o.memoizedState;if(d=I.cache,Ys(o,qe,d),d!==v.cache&&nd(o,[qe],u,!0),Dl(),d=I.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:I.cache},o.updateQueue.baseState=v,o.memoizedState=v,o.flags&256){o=Ky(s,o,d,u);break t}else if(d!==y){y=Zi(Error(i(424)),o),Al(y),o=Ky(s,o,d,u);break t}else{switch(s=o.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Le=_n(s.firstChild),Ii=o,ne=!0,sa=null,Vn=!0,u=xy(o,null,d,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Sl(),d===y){o=xs(s,o,u);break t}ui(s,o,d,u)}o=o.child}return o;case 26:return Fc(s,o),s===null?(u=ZE(o.type,null,o.pendingProps,null))?o.memoizedState=u:ne||(u=o.type,s=o.pendingProps,d=Zc(Et.current).createElement(u),d[He]=o,d[Me]=s,hi(d,u,s),Ce(d),o.stateNode=d):o.memoizedState=ZE(o.type,s.memoizedProps,o.pendingProps,s.memoizedState),null;case 27:return dn(o),s===null&&ne&&(d=o.stateNode=QE(o.type,o.pendingProps,Et.current),Ii=o,Vn=!0,y=Le,ur(o.type)?(Tg=y,Le=_n(d.firstChild)):Le=y),ui(s,o,o.pendingProps.children,u),Fc(s,o),s===null&&(o.flags|=4194304),o.child;case 5:return s===null&&ne&&((y=d=Le)&&(d=ux(d,o.type,o.pendingProps,Vn),d!==null?(o.stateNode=d,Ii=o,Le=_n(d.firstChild),Vn=!1,y=!0):y=!1),y||ra(o)),dn(o),y=o.type,v=o.pendingProps,I=s!==null?s.memoizedProps:null,d=v.children,pg(y,v)?d=null:I!==null&&pg(y,I)&&(o.flags|=32),o.memoizedState!==null&&(y=md(s,o,Ib,null,null,u),Zl._currentValue=y),Fc(s,o),ui(s,o,d,u),o.child;case 6:return s===null&&ne&&((s=u=Le)&&(u=cx(u,o.pendingProps,Vn),u!==null?(o.stateNode=u,Ii=o,Le=null,s=!0):s=!1),s||ra(o)),null;case 13:return zy(s,o,u);case 4:return Ut(o,o.stateNode.containerInfo),d=o.pendingProps,s===null?o.child=oo(o,null,d,u):ui(s,o,d,u),o.child;case 11:return Fy(s,o,o.type,o.pendingProps,u);case 7:return ui(s,o,o.pendingProps,u),o.child;case 8:return ui(s,o,o.pendingProps.children,u),o.child;case 12:return ui(s,o,o.pendingProps.children,u),o.child;case 10:return d=o.pendingProps,Ys(o,o.type,d.value),ui(s,o,d.children,u),o.child;case 9:return y=o.type._context,d=o.pendingProps.children,oa(o),y=yi(y),d=d(y),o.flags|=1,ui(s,o,d,u),o.child;case 14:return Uy(s,o,o.type,o.pendingProps,u);case 15:return By(s,o,o.type,o.pendingProps,u);case 19:return jy(s,o,u);case 31:return d=o.pendingProps,u=o.mode,d={mode:d.mode,children:d.children},s===null?(u=Uc(d,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=vs(s.child,d),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return Vy(s,o,u);case 24:return oa(o),d=yi(qe),s===null?(y=ad(),y===null&&(y=ve,v=sd(),y.pooledCache=v,v.refCount++,v!==null&&(y.pooledCacheLanes|=u),y=v),o.memoizedState={parent:d,cache:y},ld(o),Ys(o,qe,y)):((s.lanes&u)!==0&&(ud(s,o),Cl(o,null,null,u),Dl()),y=s.memoizedState,v=o.memoizedState,y.parent!==d?(y={parent:d,cache:d},o.memoizedState=y,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=y),Ys(o,qe,d)):(d=v.cache,Ys(o,qe,d),d!==y.cache&&nd(o,[qe],u,!0))),ui(s,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(i(156,o.tag))}function Is(s){s.flags|=4}function Qy(s,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!nv(o)){if(o=nn.current,o!==null&&((Wt&4194048)===Wt?Gn!==null:(Wt&62914560)!==Wt&&(Wt&536870912)===0||o!==Gn))throw Il=od,O0;s.flags|=8192}}function Bc(s,o){o!==null&&(s.flags|=4),s.flags&16384&&(o=s.tag!==22?tl():536870912,s.lanes|=o,ho|=o)}function Fl(s,o){if(!ne)switch(s.tailMode){case"hidden":o=s.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function be(s){var o=s.alternate!==null&&s.alternate.child===s.child,u=0,d=0;if(o)for(var y=s.child;y!==null;)u|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)u|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=d,s.childLanes=u,o}function Nb(s,o,u){var d=o.pendingProps;switch(Jf(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return be(o),null;case 1:return be(o),null;case 3:return u=o.stateNode,d=null,s!==null&&(d=s.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),_s(qe),Ge(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(Tl(o)?Is(o):s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,I0())),be(o),null;case 26:return u=o.memoizedState,s===null?(Is(o),u!==null?(be(o),Qy(o,u)):(be(o),o.flags&=-16777217)):u?u!==s.memoizedState?(Is(o),be(o),Qy(o,u)):(be(o),o.flags&=-16777217):(s.memoizedProps!==d&&Is(o),be(o),o.flags&=-16777217),null;case 27:gn(o),u=Et.current;var y=o.type;if(s!==null&&o.stateNode!=null)s.memoizedProps!==d&&Is(o);else{if(!d){if(o.stateNode===null)throw Error(i(166));return be(o),null}s=mt.current,Tl(o)?b0(o):(s=QE(y,d,u),o.stateNode=s,Is(o))}return be(o),null;case 5:if(gn(o),u=o.type,s!==null&&o.stateNode!=null)s.memoizedProps!==d&&Is(o);else{if(!d){if(o.stateNode===null)throw Error(i(166));return be(o),null}if(s=mt.current,Tl(o))b0(o);else{switch(y=Zc(Et.current),s){case 1:s=y.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:s=y.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":s=y.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":s=y.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":s=y.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof d.is=="string"?y.createElement("select",{is:d.is}):y.createElement("select"),d.multiple?s.multiple=!0:d.size&&(s.size=d.size);break;default:s=typeof d.is=="string"?y.createElement(u,{is:d.is}):y.createElement(u)}}s[He]=o,s[Me]=d;t:for(y=o.child;y!==null;){if(y.tag===5||y.tag===6)s.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===o)break t;for(;y.sibling===null;){if(y.return===null||y.return===o)break t;y=y.return}y.sibling.return=y.return,y=y.sibling}o.stateNode=s;t:switch(hi(s,u,d),u){case"button":case"input":case"select":case"textarea":s=!!d.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&Is(o)}}return be(o),o.flags&=-16777217,null;case 6:if(s&&o.stateNode!=null)s.memoizedProps!==d&&Is(o);else{if(typeof d!="string"&&o.stateNode===null)throw Error(i(166));if(s=Et.current,Tl(o)){if(s=o.stateNode,u=o.memoizedProps,d=null,y=Ii,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}s[He]=o,s=!!(s.nodeValue===u||d!==null&&d.suppressHydrationWarning===!0||$E(s.nodeValue,u)),s||ra(o)}else s=Zc(s).createTextNode(d),s[He]=o,o.stateNode=s}return be(o),null;case 13:if(d=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=Tl(o),d!==null&&d.dehydrated!==null){if(s===null){if(!y)throw Error(i(318));if(y=o.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(i(317));y[He]=o}else Sl(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;be(o),y=!1}else y=I0(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return o.flags&256?(bs(o),o):(bs(o),null)}if(bs(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=d!==null,s=s!==null&&s.memoizedState!==null,u){d=o.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool);var v=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==y&&(d.flags|=2048)}return u!==s&&u&&(o.child.flags|=8192),Bc(o,o.updateQueue),be(o),null;case 4:return Ge(),s===null&&hg(o.stateNode.containerInfo),be(o),null;case 10:return _s(o.type),be(o),null;case 19:if(at(je),y=o.memoizedState,y===null)return be(o),null;if(d=(o.flags&128)!==0,v=y.rendering,v===null)if(d)Fl(y,!1);else{if(De!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(v=Mc(s),v!==null){for(o.flags|=128,Fl(y,!1),s=v.updateQueue,o.updateQueue=s,Bc(o,s),o.subtreeFlags=0,s=u,u=o.child;u!==null;)_0(u,s),u=u.sibling;return st(je,je.current&1|2),o.child}s=s.sibling}y.tail!==null&&le()>$c&&(o.flags|=128,d=!0,Fl(y,!1),o.lanes=4194304)}else{if(!d)if(s=Mc(v),s!==null){if(o.flags|=128,d=!0,s=s.updateQueue,o.updateQueue=s,Bc(o,s),Fl(y,!0),y.tail===null&&y.tailMode==="hidden"&&!v.alternate&&!ne)return be(o),null}else 2*le()-y.renderingStartTime>$c&&u!==536870912&&(o.flags|=128,d=!0,Fl(y,!1),o.lanes=4194304);y.isBackwards?(v.sibling=o.child,o.child=v):(s=y.last,s!==null?s.sibling=v:o.child=v,y.last=v)}return y.tail!==null?(o=y.tail,y.rendering=o,y.tail=o.sibling,y.renderingStartTime=le(),o.sibling=null,s=je.current,st(je,d?s&1|2:s&1),o):(be(o),null);case 22:case 23:return bs(o),dd(),d=o.memoizedState!==null,s!==null?s.memoizedState!==null!==d&&(o.flags|=8192):d&&(o.flags|=8192),d?(u&536870912)!==0&&(o.flags&128)===0&&(be(o),o.subtreeFlags&6&&(o.flags|=8192)):be(o),u=o.updateQueue,u!==null&&Bc(o,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),d=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==u&&(o.flags|=2048),s!==null&&at(la),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),_s(qe),be(o),null;case 25:return null;case 30:return null}throw Error(i(156,o.tag))}function Fb(s,o){switch(Jf(o),o.tag){case 1:return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return _s(qe),Ge(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 26:case 27:case 5:return gn(o),null;case 13:if(bs(o),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(i(340));Sl()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return at(je),null;case 4:return Ge(),null;case 10:return _s(o.type),null;case 22:case 23:return bs(o),dd(),s!==null&&at(la),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 24:return _s(qe),null;case 25:return null;default:return null}}function Xy(s,o){switch(Jf(o),o.tag){case 3:_s(qe),Ge();break;case 26:case 27:case 5:gn(o);break;case 4:Ge();break;case 13:bs(o);break;case 19:at(je);break;case 10:_s(o.type);break;case 22:case 23:bs(o),dd(),s!==null&&at(la);break;case 24:_s(qe)}}function Ul(s,o){try{var u=o.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var y=d.next;u=y;do{if((u.tag&s)===s){d=void 0;var v=u.create,I=u.inst;d=v(),I.destroy=d}u=u.next}while(u!==y)}}catch(P){ye(o,o.return,P)}}function er(s,o,u){try{var d=o.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var v=y.next;d=v;do{if((d.tag&s)===s){var I=d.inst,P=I.destroy;if(P!==void 0){I.destroy=void 0,y=o;var H=u,Z=P;try{Z()}catch(ot){ye(y,H,ot)}}}d=d.next}while(d!==v)}}catch(ot){ye(o,o.return,ot)}}function Wy(s){var o=s.updateQueue;if(o!==null){var u=s.stateNode;try{U0(o,u)}catch(d){ye(s,s.return,d)}}}function Zy(s,o,u){u.props=ca(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(d){ye(s,o,d)}}function Bl(s,o){try{var u=s.ref;if(u!==null){switch(s.tag){case 26:case 27:case 5:var d=s.stateNode;break;case 30:d=s.stateNode;break;default:d=s.stateNode}typeof u=="function"?s.refCleanup=u(d):u.current=d}}catch(y){ye(s,o,y)}}function $n(s,o){var u=s.ref,d=s.refCleanup;if(u!==null)if(typeof d=="function")try{d()}catch(y){ye(s,o,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(y){ye(s,o,y)}else u.current=null}function Jy(s){var o=s.type,u=s.memoizedProps,d=s.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&d.focus();break t;case"img":u.src?d.src=u.src:u.srcSet&&(d.srcset=u.srcSet)}}catch(y){ye(s,s.return,y)}}function Gd(s,o,u){try{var d=s.stateNode;sx(d,s.type,u,o),d[Me]=o}catch(y){ye(s,s.return,y)}}function tE(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ur(s.type)||s.tag===4}function $d(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||tE(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ur(s.type)||s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Hd(s,o,u){var d=s.tag;if(d===5||d===6)s=s.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(s,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(s),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Wc));else if(d!==4&&(d===27&&ur(s.type)&&(u=s.stateNode,o=null),s=s.child,s!==null))for(Hd(s,o,u),s=s.sibling;s!==null;)Hd(s,o,u),s=s.sibling}function Vc(s,o,u){var d=s.tag;if(d===5||d===6)s=s.stateNode,o?u.insertBefore(s,o):u.appendChild(s);else if(d!==4&&(d===27&&ur(s.type)&&(u=s.stateNode),s=s.child,s!==null))for(Vc(s,o,u),s=s.sibling;s!==null;)Vc(s,o,u),s=s.sibling}function eE(s){var o=s.stateNode,u=s.memoizedProps;try{for(var d=s.type,y=o.attributes;y.length;)o.removeAttributeNode(y[0]);hi(o,d,u),o[He]=s,o[Me]=u}catch(v){ye(s,s.return,v)}}var Ls=!1,Oe=!1,Kd=!1,iE=typeof WeakSet=="function"?WeakSet:Set,ii=null;function Ub(s,o){if(s=s.containerInfo,gg=sh,s=d0(s),$f(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else t:{u=(u=s.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var y=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{u.nodeType,v.nodeType}catch{u=null;break t}var I=0,P=-1,H=-1,Z=0,ot=0,ft=s,J=null;e:for(;;){for(var et;ft!==u||y!==0&&ft.nodeType!==3||(P=I+y),ft!==v||d!==0&&ft.nodeType!==3||(H=I+d),ft.nodeType===3&&(I+=ft.nodeValue.length),(et=ft.firstChild)!==null;)J=ft,ft=et;for(;;){if(ft===s)break e;if(J===u&&++Z===y&&(P=I),J===v&&++ot===d&&(H=I),(et=ft.nextSibling)!==null)break;ft=J,J=ft.parentNode}ft=et}u=P===-1||H===-1?null:{start:P,end:H}}else u=null}u=u||{start:0,end:0}}else u=null;for(mg={focusedElem:s,selectionRange:u},sh=!1,ii=o;ii!==null;)if(o=ii,s=o.child,(o.subtreeFlags&1024)!==0&&s!==null)s.return=o,ii=s;else for(;ii!==null;){switch(o=ii,v=o.alternate,s=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&v!==null){s=void 0,u=o,y=v.memoizedProps,v=v.memoizedState,d=u.stateNode;try{var Ot=ca(u.type,y,u.elementType===u.type);s=d.getSnapshotBeforeUpdate(Ot,v),d.__reactInternalSnapshotBeforeUpdate=s}catch(Lt){ye(u,u.return,Lt)}}break;case 3:if((s&1024)!==0){if(s=o.stateNode.containerInfo,u=s.nodeType,u===9)Eg(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Eg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=o.sibling,s!==null){s.return=o.return,ii=s;break}ii=o.return}}function nE(s,o,u){var d=u.flags;switch(u.tag){case 0:case 11:case 15:ir(s,u),d&4&&Ul(5,u);break;case 1:if(ir(s,u),d&4)if(s=u.stateNode,o===null)try{s.componentDidMount()}catch(I){ye(u,u.return,I)}else{var y=ca(u.type,o.memoizedProps);o=o.memoizedState;try{s.componentDidUpdate(y,o,s.__reactInternalSnapshotBeforeUpdate)}catch(I){ye(u,u.return,I)}}d&64&&Wy(u),d&512&&Bl(u,u.return);break;case 3:if(ir(s,u),d&64&&(s=u.updateQueue,s!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{U0(s,o)}catch(I){ye(u,u.return,I)}}break;case 27:o===null&&d&4&&eE(u);case 26:case 5:ir(s,u),o===null&&d&4&&Jy(u),d&512&&Bl(u,u.return);break;case 12:ir(s,u);break;case 13:ir(s,u),d&4&&aE(s,u),d&64&&(s=u.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(u=jb.bind(null,u),hx(s,u))));break;case 22:if(d=u.memoizedState!==null||Ls,!d){o=o!==null&&o.memoizedState!==null||Oe,y=Ls;var v=Oe;Ls=d,(Oe=o)&&!v?nr(s,u,(u.subtreeFlags&8772)!==0):ir(s,u),Ls=y,Oe=v}break;case 30:break;default:ir(s,u)}}function sE(s){var o=s.alternate;o!==null&&(s.alternate=null,sE(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&Ks(o)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var _e=null,Ci=!1;function Ds(s,o,u){for(u=u.child;u!==null;)rE(s,o,u),u=u.sibling}function rE(s,o,u){if(te&&typeof te.onCommitFiberUnmount=="function")try{te.onCommitFiberUnmount(fe,u)}catch{}switch(u.tag){case 26:Oe||$n(u,o),Ds(s,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Oe||$n(u,o);var d=_e,y=Ci;ur(u.type)&&(_e=u.stateNode,Ci=!1),Ds(s,o,u),Yl(u.stateNode),_e=d,Ci=y;break;case 5:Oe||$n(u,o);case 6:if(d=_e,y=Ci,_e=null,Ds(s,o,u),_e=d,Ci=y,_e!==null)if(Ci)try{(_e.nodeType===9?_e.body:_e.nodeName==="HTML"?_e.ownerDocument.body:_e).removeChild(u.stateNode)}catch(v){ye(u,o,v)}else try{_e.removeChild(u.stateNode)}catch(v){ye(u,o,v)}break;case 18:_e!==null&&(Ci?(s=_e,jE(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,u.stateNode),iu(s)):jE(_e,u.stateNode));break;case 4:d=_e,y=Ci,_e=u.stateNode.containerInfo,Ci=!0,Ds(s,o,u),_e=d,Ci=y;break;case 0:case 11:case 14:case 15:Oe||er(2,u,o),Oe||er(4,u,o),Ds(s,o,u);break;case 1:Oe||($n(u,o),d=u.stateNode,typeof d.componentWillUnmount=="function"&&Zy(u,o,d)),Ds(s,o,u);break;case 21:Ds(s,o,u);break;case 22:Oe=(d=Oe)||u.memoizedState!==null,Ds(s,o,u),Oe=d;break;default:Ds(s,o,u)}}function aE(s,o){if(o.memoizedState===null&&(s=o.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{iu(s)}catch(u){ye(o,o.return,u)}}function Bb(s){switch(s.tag){case 13:case 19:var o=s.stateNode;return o===null&&(o=s.stateNode=new iE),o;case 22:return s=s.stateNode,o=s._retryCache,o===null&&(o=s._retryCache=new iE),o;default:throw Error(i(435,s.tag))}}function zd(s,o){var u=Bb(s);o.forEach(function(d){var y=Yb.bind(null,s,d);u.has(d)||(u.add(d),d.then(y,y))})}function Bi(s,o){var u=o.deletions;if(u!==null)for(var d=0;d<u.length;d++){var y=u[d],v=s,I=o,P=I;t:for(;P!==null;){switch(P.tag){case 27:if(ur(P.type)){_e=P.stateNode,Ci=!1;break t}break;case 5:_e=P.stateNode,Ci=!1;break t;case 3:case 4:_e=P.stateNode.containerInfo,Ci=!0;break t}P=P.return}if(_e===null)throw Error(i(160));rE(v,I,y),_e=null,Ci=!1,v=y.alternate,v!==null&&(v.return=null),y.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)oE(o,s),o=o.sibling}var An=null;function oE(s,o){var u=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Bi(o,s),Vi(s),d&4&&(er(3,s,s.return),Ul(3,s),er(5,s,s.return));break;case 1:Bi(o,s),Vi(s),d&512&&(Oe||u===null||$n(u,u.return)),d&64&&Ls&&(s=s.updateQueue,s!==null&&(d=s.callbacks,d!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?d:u.concat(d))));break;case 26:var y=An;if(Bi(o,s),Vi(s),d&512&&(Oe||u===null||$n(u,u.return)),d&4){var v=u!==null?u.memoizedState:null;if(d=s.memoizedState,u===null)if(d===null)if(s.stateNode===null){t:{d=s.type,u=s.memoizedProps,y=y.ownerDocument||y;e:switch(d){case"title":v=y.getElementsByTagName("title")[0],(!v||v[Br]||v[He]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=y.createElement(d),y.head.insertBefore(v,y.querySelector("head > title"))),hi(v,d,u),v[He]=s,Ce(v),d=v;break t;case"link":var I=ev("link","href",y).get(d+(u.href||""));if(I){for(var P=0;P<I.length;P++)if(v=I[P],v.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&v.getAttribute("rel")===(u.rel==null?null:u.rel)&&v.getAttribute("title")===(u.title==null?null:u.title)&&v.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){I.splice(P,1);break e}}v=y.createElement(d),hi(v,d,u),y.head.appendChild(v);break;case"meta":if(I=ev("meta","content",y).get(d+(u.content||""))){for(P=0;P<I.length;P++)if(v=I[P],v.getAttribute("content")===(u.content==null?null:""+u.content)&&v.getAttribute("name")===(u.name==null?null:u.name)&&v.getAttribute("property")===(u.property==null?null:u.property)&&v.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&v.getAttribute("charset")===(u.charSet==null?null:u.charSet)){I.splice(P,1);break e}}v=y.createElement(d),hi(v,d,u),y.head.appendChild(v);break;default:throw Error(i(468,d))}v[He]=s,Ce(v),d=v}s.stateNode=d}else iv(y,s.type,s.stateNode);else s.stateNode=tv(y,d,s.memoizedProps);else v!==d?(v===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):v.count--,d===null?iv(y,s.type,s.stateNode):tv(y,d,s.memoizedProps)):d===null&&s.stateNode!==null&&Gd(s,s.memoizedProps,u.memoizedProps)}break;case 27:Bi(o,s),Vi(s),d&512&&(Oe||u===null||$n(u,u.return)),u!==null&&d&4&&Gd(s,s.memoizedProps,u.memoizedProps);break;case 5:if(Bi(o,s),Vi(s),d&512&&(Oe||u===null||$n(u,u.return)),s.flags&32){y=s.stateNode;try{Yi(y,"")}catch(et){ye(s,s.return,et)}}d&4&&s.stateNode!=null&&(y=s.memoizedProps,Gd(s,y,u!==null?u.memoizedProps:y)),d&1024&&(Kd=!0);break;case 6:if(Bi(o,s),Vi(s),d&4){if(s.stateNode===null)throw Error(i(162));d=s.memoizedProps,u=s.stateNode;try{u.nodeValue=d}catch(et){ye(s,s.return,et)}}break;case 3:if(eh=null,y=An,An=Jc(o.containerInfo),Bi(o,s),An=y,Vi(s),d&4&&u!==null&&u.memoizedState.isDehydrated)try{iu(o.containerInfo)}catch(et){ye(s,s.return,et)}Kd&&(Kd=!1,lE(s));break;case 4:d=An,An=Jc(s.stateNode.containerInfo),Bi(o,s),Vi(s),An=d;break;case 12:Bi(o,s),Vi(s);break;case 13:Bi(o,s),Vi(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Wd=le()),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,zd(s,d)));break;case 22:y=s.memoizedState!==null;var H=u!==null&&u.memoizedState!==null,Z=Ls,ot=Oe;if(Ls=Z||y,Oe=ot||H,Bi(o,s),Oe=ot,Ls=Z,Vi(s),d&8192)t:for(o=s.stateNode,o._visibility=y?o._visibility&-2:o._visibility|1,y&&(u===null||H||Ls||Oe||ha(s)),u=null,o=s;;){if(o.tag===5||o.tag===26){if(u===null){H=u=o;try{if(v=H.stateNode,y)I=v.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none";else{P=H.stateNode;var ft=H.memoizedProps.style,J=ft!=null&&ft.hasOwnProperty("display")?ft.display:null;P.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(et){ye(H,H.return,et)}}}else if(o.tag===6){if(u===null){H=o;try{H.stateNode.nodeValue=y?"":H.memoizedProps}catch(et){ye(H,H.return,et)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===s)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break t;for(;o.sibling===null;){if(o.return===null||o.return===s)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}d&4&&(d=s.updateQueue,d!==null&&(u=d.retryQueue,u!==null&&(d.retryQueue=null,zd(s,u))));break;case 19:Bi(o,s),Vi(s),d&4&&(d=s.updateQueue,d!==null&&(s.updateQueue=null,zd(s,d)));break;case 30:break;case 21:break;default:Bi(o,s),Vi(s)}}function Vi(s){var o=s.flags;if(o&2){try{for(var u,d=s.return;d!==null;){if(tE(d)){u=d;break}d=d.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var y=u.stateNode,v=$d(s);Vc(s,v,y);break;case 5:var I=u.stateNode;u.flags&32&&(Yi(I,""),u.flags&=-33);var P=$d(s);Vc(s,P,I);break;case 3:case 4:var H=u.stateNode.containerInfo,Z=$d(s);Hd(s,Z,H);break;default:throw Error(i(161))}}catch(ot){ye(s,s.return,ot)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function lE(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var o=s;lE(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),s=s.sibling}}function ir(s,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)nE(s,o.alternate,o),o=o.sibling}function ha(s){for(s=s.child;s!==null;){var o=s;switch(o.tag){case 0:case 11:case 14:case 15:er(4,o,o.return),ha(o);break;case 1:$n(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&Zy(o,o.return,u),ha(o);break;case 27:Yl(o.stateNode);case 26:case 5:$n(o,o.return),ha(o);break;case 22:o.memoizedState===null&&ha(o);break;case 30:ha(o);break;default:ha(o)}s=s.sibling}}function nr(s,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var d=o.alternate,y=s,v=o,I=v.flags;switch(v.tag){case 0:case 11:case 15:nr(y,v,u),Ul(4,v);break;case 1:if(nr(y,v,u),d=v,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(Z){ye(d,d.return,Z)}if(d=v,y=d.updateQueue,y!==null){var P=d.stateNode;try{var H=y.shared.hiddenCallbacks;if(H!==null)for(y.shared.hiddenCallbacks=null,y=0;y<H.length;y++)F0(H[y],P)}catch(Z){ye(d,d.return,Z)}}u&&I&64&&Wy(v),Bl(v,v.return);break;case 27:eE(v);case 26:case 5:nr(y,v,u),u&&d===null&&I&4&&Jy(v),Bl(v,v.return);break;case 12:nr(y,v,u);break;case 13:nr(y,v,u),u&&I&4&&aE(y,v);break;case 22:v.memoizedState===null&&nr(y,v,u),Bl(v,v.return);break;case 30:break;default:nr(y,v,u)}o=o.sibling}}function qd(s,o){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(s=o.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&Rl(u))}function jd(s,o){s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&Rl(s))}function Hn(s,o,u,d){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)uE(s,o,u,d),o=o.sibling}function uE(s,o,u,d){var y=o.flags;switch(o.tag){case 0:case 11:case 15:Hn(s,o,u,d),y&2048&&Ul(9,o);break;case 1:Hn(s,o,u,d);break;case 3:Hn(s,o,u,d),y&2048&&(s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&Rl(s)));break;case 12:if(y&2048){Hn(s,o,u,d),s=o.stateNode;try{var v=o.memoizedProps,I=v.id,P=v.onPostCommit;typeof P=="function"&&P(I,o.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(H){ye(o,o.return,H)}}else Hn(s,o,u,d);break;case 13:Hn(s,o,u,d);break;case 23:break;case 22:v=o.stateNode,I=o.alternate,o.memoizedState!==null?v._visibility&2?Hn(s,o,u,d):Vl(s,o):v._visibility&2?Hn(s,o,u,d):(v._visibility|=2,lo(s,o,u,d,(o.subtreeFlags&10256)!==0)),y&2048&&qd(I,o);break;case 24:Hn(s,o,u,d),y&2048&&jd(o.alternate,o);break;default:Hn(s,o,u,d)}}function lo(s,o,u,d,y){for(y=y&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var v=s,I=o,P=u,H=d,Z=I.flags;switch(I.tag){case 0:case 11:case 15:lo(v,I,P,H,y),Ul(8,I);break;case 23:break;case 22:var ot=I.stateNode;I.memoizedState!==null?ot._visibility&2?lo(v,I,P,H,y):Vl(v,I):(ot._visibility|=2,lo(v,I,P,H,y)),y&&Z&2048&&qd(I.alternate,I);break;case 24:lo(v,I,P,H,y),y&&Z&2048&&jd(I.alternate,I);break;default:lo(v,I,P,H,y)}o=o.sibling}}function Vl(s,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=s,d=o,y=d.flags;switch(d.tag){case 22:Vl(u,d),y&2048&&qd(d.alternate,d);break;case 24:Vl(u,d),y&2048&&jd(d.alternate,d);break;default:Vl(u,d)}o=o.sibling}}var Gl=8192;function uo(s){if(s.subtreeFlags&Gl)for(s=s.child;s!==null;)cE(s),s=s.sibling}function cE(s){switch(s.tag){case 26:uo(s),s.flags&Gl&&s.memoizedState!==null&&Rx(An,s.memoizedState,s.memoizedProps);break;case 5:uo(s);break;case 3:case 4:var o=An;An=Jc(s.stateNode.containerInfo),uo(s),An=o;break;case 22:s.memoizedState===null&&(o=s.alternate,o!==null&&o.memoizedState!==null?(o=Gl,Gl=16777216,uo(s),Gl=o):uo(s));break;default:uo(s)}}function hE(s){var o=s.alternate;if(o!==null&&(s=o.child,s!==null)){o.child=null;do o=s.sibling,s.sibling=null,s=o;while(s!==null)}}function $l(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var d=o[u];ii=d,dE(d,s)}hE(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)fE(s),s=s.sibling}function fE(s){switch(s.tag){case 0:case 11:case 15:$l(s),s.flags&2048&&er(9,s,s.return);break;case 3:$l(s);break;case 12:$l(s);break;case 22:var o=s.stateNode;s.memoizedState!==null&&o._visibility&2&&(s.return===null||s.return.tag!==13)?(o._visibility&=-3,Gc(s)):$l(s);break;default:$l(s)}}function Gc(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var d=o[u];ii=d,dE(d,s)}hE(s)}for(s=s.child;s!==null;){switch(o=s,o.tag){case 0:case 11:case 15:er(8,o,o.return),Gc(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Gc(o));break;default:Gc(o)}s=s.sibling}}function dE(s,o){for(;ii!==null;){var u=ii;switch(u.tag){case 0:case 11:case 15:er(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var d=u.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Rl(u.memoizedState.cache)}if(d=u.child,d!==null)d.return=u,ii=d;else t:for(u=s;ii!==null;){d=ii;var y=d.sibling,v=d.return;if(sE(d),d===u){ii=null;break t}if(y!==null){y.return=v,ii=y;break t}ii=v}}}var Vb={getCacheForType:function(s){var o=yi(qe),u=o.data.get(s);return u===void 0&&(u=s(),o.data.set(s,u)),u}},Gb=typeof WeakMap=="function"?WeakMap:Map,ue=0,ve=null,zt=null,Wt=0,ce=0,Gi=null,sr=!1,co=!1,Yd=!1,Cs=0,De=0,rr=0,fa=0,Qd=0,sn=0,ho=0,Hl=null,wi=null,Xd=!1,Wd=0,$c=1/0,Hc=null,ar=null,ci=0,or=null,fo=null,go=0,Zd=0,Jd=null,gE=null,Kl=0,tg=null;function $i(){if((ue&2)!==0&&Wt!==0)return Wt&-Wt;if(K.T!==null){var s=to;return s!==0?s:og()}return $s()}function mE(){sn===0&&(sn=(Wt&536870912)===0||ne?Jo():536870912);var s=nn.current;return s!==null&&(s.flags|=32),sn}function Hi(s,o,u){(s===ve&&(ce===2||ce===9)||s.cancelPendingCommit!==null)&&(mo(s,0),lr(s,Wt,sn,!1)),ls(s,u),((ue&2)===0||s!==ve)&&(s===ve&&((ue&2)===0&&(fa|=u),De===4&&lr(s,Wt,sn,!1)),Kn(s))}function pE(s,o,u){if((ue&6)!==0)throw Error(i(327));var d=!u&&(o&124)===0&&(o&s.expiredLanes)===0||Ur(s,o),y=d?Kb(s,o):ng(s,o,!0),v=d;do{if(y===0){co&&!d&&lr(s,o,0,!1);break}else{if(u=s.current.alternate,v&&!$b(u)){y=ng(s,o,!1),v=!1;continue}if(y===2){if(v=o,s.errorRecoveryDisabledLanes&v)var I=0;else I=s.pendingLanes&-536870913,I=I!==0?I:I&536870912?536870912:0;if(I!==0){o=I;t:{var P=s;y=Hl;var H=P.current.memoizedState.isDehydrated;if(H&&(mo(P,I).flags|=256),I=ng(P,I,!1),I!==2){if(Yd&&!H){P.errorRecoveryDisabledLanes|=v,fa|=v,y=4;break t}v=wi,wi=y,v!==null&&(wi===null?wi=v:wi.push.apply(wi,v))}y=I}if(v=!1,y!==2)continue}}if(y===1){mo(s,0),lr(s,o,0,!0);break}t:{switch(d=s,v=y,v){case 0:case 1:throw Error(i(345));case 4:if((o&4194048)!==o)break;case 6:lr(d,o,sn,!sr);break t;case 2:wi=null;break;case 3:case 5:break;default:throw Error(i(329))}if((o&62914560)===o&&(y=Wd+300-le(),10<y)){if(lr(d,o,sn,!sr),wa(d,0,!0)!==0)break t;d.timeoutHandle=zE(yE.bind(null,d,u,wi,Hc,Xd,o,sn,fa,ho,sr,v,2,-0,0),y);break t}yE(d,u,wi,Hc,Xd,o,sn,fa,ho,sr,v,0,-0,0)}}break}while(!0);Kn(s)}function yE(s,o,u,d,y,v,I,P,H,Z,ot,ft,J,et){if(s.timeoutHandle=-1,ft=o.subtreeFlags,(ft&8192||(ft&16785408)===16785408)&&(Wl={stylesheets:null,count:0,unsuspend:_x},cE(o),ft=bx(),ft!==null)){s.cancelPendingCommit=ft(RE.bind(null,s,o,v,u,d,y,I,P,H,ot,1,J,et)),lr(s,v,I,!Z);return}RE(s,o,v,u,d,y,I,P,H)}function $b(s){for(var o=s;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var d=0;d<u.length;d++){var y=u[d],v=y.getSnapshot;y=y.value;try{if(!Fi(v(),y))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function lr(s,o,u,d){o&=~Qd,o&=~fa,s.suspendedLanes|=o,s.pingedLanes&=~o,d&&(s.warmLanes|=o),d=s.expirationTimes;for(var y=o;0<y;){var v=31-$e(y),I=1<<v;d[v]=-1,y&=~I}u!==0&&Dn(s,u,o)}function Kc(){return(ue&6)===0?(zl(0),!1):!0}function eg(){if(zt!==null){if(ce===0)var s=zt.return;else s=zt,As=aa=null,Ed(s),ao=null,kl=0,s=zt;for(;s!==null;)Xy(s.alternate,s),s=s.return;zt=null}}function mo(s,o){var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,ax(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),eg(),ve=s,zt=u=vs(s.current,null),Wt=o,ce=0,Gi=null,sr=!1,co=Ur(s,o),Yd=!1,ho=sn=Qd=fa=rr=De=0,wi=Hl=null,Xd=!1,(o&8)!==0&&(o|=o&32);var d=s.entangledLanes;if(d!==0)for(s=s.entanglements,d&=o;0<d;){var y=31-$e(d),v=1<<y;o|=s[y],d&=~v}return Cs=o,fc(),u}function EE(s,o){Vt=null,K.H=wc,o===xl||o===Sc?(o=k0(),ce=3):o===O0?(o=k0(),ce=4):ce=o===Ny?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Gi=o,zt===null&&(De=1,Nc(s,Zi(o,s.current)))}function vE(){var s=K.H;return K.H=wc,s===null?wc:s}function TE(){var s=K.A;return K.A=Vb,s}function ig(){De=4,sr||(Wt&4194048)!==Wt&&nn.current!==null||(co=!0),(rr&134217727)===0&&(fa&134217727)===0||ve===null||lr(ve,Wt,sn,!1)}function ng(s,o,u){var d=ue;ue|=2;var y=vE(),v=TE();(ve!==s||Wt!==o)&&(Hc=null,mo(s,o)),o=!1;var I=De;t:do try{if(ce!==0&&zt!==null){var P=zt,H=Gi;switch(ce){case 8:eg(),I=6;break t;case 3:case 2:case 9:case 6:nn.current===null&&(o=!0);var Z=ce;if(ce=0,Gi=null,po(s,P,H,Z),u&&co){I=0;break t}break;default:Z=ce,ce=0,Gi=null,po(s,P,H,Z)}}Hb(),I=De;break}catch(ot){EE(s,ot)}while(!0);return o&&s.shellSuspendCounter++,As=aa=null,ue=d,K.H=y,K.A=v,zt===null&&(ve=null,Wt=0,fc()),I}function Hb(){for(;zt!==null;)SE(zt)}function Kb(s,o){var u=ue;ue|=2;var d=vE(),y=TE();ve!==s||Wt!==o?(Hc=null,$c=le()+500,mo(s,o)):co=Ur(s,o);t:do try{if(ce!==0&&zt!==null){o=zt;var v=Gi;e:switch(ce){case 1:ce=0,Gi=null,po(s,o,v,1);break;case 2:case 9:if(P0(v)){ce=0,Gi=null,AE(o);break}o=function(){ce!==2&&ce!==9||ve!==s||(ce=7),Kn(s)},v.then(o,o);break t;case 3:ce=7;break t;case 4:ce=5;break t;case 7:P0(v)?(ce=0,Gi=null,AE(o)):(ce=0,Gi=null,po(s,o,v,7));break;case 5:var I=null;switch(zt.tag){case 26:I=zt.memoizedState;case 5:case 27:var P=zt;if(!I||nv(I)){ce=0,Gi=null;var H=P.sibling;if(H!==null)zt=H;else{var Z=P.return;Z!==null?(zt=Z,zc(Z)):zt=null}break e}}ce=0,Gi=null,po(s,o,v,5);break;case 6:ce=0,Gi=null,po(s,o,v,6);break;case 8:eg(),De=6;break t;default:throw Error(i(462))}}zb();break}catch(ot){EE(s,ot)}while(!0);return As=aa=null,K.H=d,K.A=y,ue=u,zt!==null?0:(ve=null,Wt=0,fc(),De)}function zb(){for(;zt!==null&&!Ca();)SE(zt)}function SE(s){var o=Yy(s.alternate,s,Cs);s.memoizedProps=s.pendingProps,o===null?zc(s):zt=o}function AE(s){var o=s,u=o.alternate;switch(o.tag){case 15:case 0:o=$y(u,o,o.pendingProps,o.type,void 0,Wt);break;case 11:o=$y(u,o,o.pendingProps,o.type.render,o.ref,Wt);break;case 5:Ed(o);default:Xy(u,o),o=zt=_0(o,Cs),o=Yy(u,o,Cs)}s.memoizedProps=s.pendingProps,o===null?zc(s):zt=o}function po(s,o,u,d){As=aa=null,Ed(o),ao=null,kl=0;var y=o.return;try{if(Mb(s,y,o,u,Wt)){De=1,Nc(s,Zi(u,s.current)),zt=null;return}}catch(v){if(y!==null)throw zt=y,v;De=1,Nc(s,Zi(u,s.current)),zt=null;return}o.flags&32768?(ne||d===1?s=!0:co||(Wt&536870912)!==0?s=!1:(sr=s=!0,(d===2||d===9||d===3||d===6)&&(d=nn.current,d!==null&&d.tag===13&&(d.flags|=16384))),_E(o,s)):zc(o)}function zc(s){var o=s;do{if((o.flags&32768)!==0){_E(o,sr);return}s=o.return;var u=Nb(o.alternate,o,Cs);if(u!==null){zt=u;return}if(o=o.sibling,o!==null){zt=o;return}zt=o=s}while(o!==null);De===0&&(De=5)}function _E(s,o){do{var u=Fb(s.alternate,s);if(u!==null){u.flags&=32767,zt=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(s=s.sibling,s!==null)){zt=s;return}zt=s=u}while(s!==null);De=6,zt=null}function RE(s,o,u,d,y,v,I,P,H){s.cancelPendingCommit=null;do qc();while(ci!==0);if((ue&6)!==0)throw Error(i(327));if(o!==null){if(o===s.current)throw Error(i(177));if(v=o.lanes|o.childLanes,v|=jf,el(s,u,v,I,P,H),s===ve&&(zt=ve=null,Wt=0),fo=o,or=s,go=u,Zd=v,Jd=y,gE=d,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,Qb(Li,function(){return DE(),null})):(s.callbackNode=null,s.callbackPriority=0),d=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||d){d=K.T,K.T=null,y=it.p,it.p=2,I=ue,ue|=4;try{Ub(s,o,u)}finally{ue=I,it.p=y,K.T=d}}ci=1,bE(),xE(),IE()}}function bE(){if(ci===1){ci=0;var s=or,o=fo,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=K.T,K.T=null;var d=it.p;it.p=2;var y=ue;ue|=4;try{oE(o,s);var v=mg,I=d0(s.containerInfo),P=v.focusedElem,H=v.selectionRange;if(I!==P&&P&&P.ownerDocument&&f0(P.ownerDocument.documentElement,P)){if(H!==null&&$f(P)){var Z=H.start,ot=H.end;if(ot===void 0&&(ot=Z),"selectionStart"in P)P.selectionStart=Z,P.selectionEnd=Math.min(ot,P.value.length);else{var ft=P.ownerDocument||document,J=ft&&ft.defaultView||window;if(J.getSelection){var et=J.getSelection(),Ot=P.textContent.length,Lt=Math.min(H.start,Ot),pe=H.end===void 0?Lt:Math.min(H.end,Ot);!et.extend&&Lt>pe&&(I=pe,pe=Lt,Lt=I);var j=h0(P,Lt),z=h0(P,pe);if(j&&z&&(et.rangeCount!==1||et.anchorNode!==j.node||et.anchorOffset!==j.offset||et.focusNode!==z.node||et.focusOffset!==z.offset)){var X=ft.createRange();X.setStart(j.node,j.offset),et.removeAllRanges(),Lt>pe?(et.addRange(X),et.extend(z.node,z.offset)):(X.setEnd(z.node,z.offset),et.addRange(X))}}}}for(ft=[],et=P;et=et.parentNode;)et.nodeType===1&&ft.push({element:et,left:et.scrollLeft,top:et.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<ft.length;P++){var ut=ft[P];ut.element.scrollLeft=ut.left,ut.element.scrollTop=ut.top}}sh=!!gg,mg=gg=null}finally{ue=y,it.p=d,K.T=u}}s.current=o,ci=2}}function xE(){if(ci===2){ci=0;var s=or,o=fo,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=K.T,K.T=null;var d=it.p;it.p=2;var y=ue;ue|=4;try{nE(s,o.alternate,o)}finally{ue=y,it.p=d,K.T=u}}ci=3}}function IE(){if(ci===4||ci===3){ci=0,Kt();var s=or,o=fo,u=go,d=gE;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?ci=5:(ci=0,fo=or=null,LE(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(ar=null),Oa(u),o=o.stateNode,te&&typeof te.onCommitFiberRoot=="function")try{te.onCommitFiberRoot(fe,o,void 0,(o.current.flags&128)===128)}catch{}if(d!==null){o=K.T,y=it.p,it.p=2,K.T=null;try{for(var v=s.onRecoverableError,I=0;I<d.length;I++){var P=d[I];v(P.value,{componentStack:P.stack})}}finally{K.T=o,it.p=y}}(go&3)!==0&&qc(),Kn(s),y=s.pendingLanes,(u&4194090)!==0&&(y&42)!==0?s===tg?Kl++:(Kl=0,tg=s):Kl=0,zl(0)}}function LE(s,o){(s.pooledCacheLanes&=o)===0&&(o=s.pooledCache,o!=null&&(s.pooledCache=null,Rl(o)))}function qc(s){return bE(),xE(),IE(),DE()}function DE(){if(ci!==5)return!1;var s=or,o=Zd;Zd=0;var u=Oa(go),d=K.T,y=it.p;try{it.p=32>u?32:u,K.T=null,u=Jd,Jd=null;var v=or,I=go;if(ci=0,fo=or=null,go=0,(ue&6)!==0)throw Error(i(331));var P=ue;if(ue|=4,fE(v.current),uE(v,v.current,I,u),ue=P,zl(0,!1),te&&typeof te.onPostCommitFiberRoot=="function")try{te.onPostCommitFiberRoot(fe,v)}catch{}return!0}finally{it.p=y,K.T=d,LE(s,o)}}function CE(s,o,u){o=Zi(u,o),o=Od(s.stateNode,o,2),s=Ws(s,o,2),s!==null&&(ls(s,2),Kn(s))}function ye(s,o,u){if(s.tag===3)CE(s,s,u);else for(;o!==null;){if(o.tag===3){CE(o,s,u);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(ar===null||!ar.has(d))){s=Zi(u,s),u=My(2),d=Ws(o,u,2),d!==null&&(ky(u,d,o,s),ls(d,2),Kn(d));break}}o=o.return}}function sg(s,o,u){var d=s.pingCache;if(d===null){d=s.pingCache=new Gb;var y=new Set;d.set(o,y)}else y=d.get(o),y===void 0&&(y=new Set,d.set(o,y));y.has(u)||(Yd=!0,y.add(u),s=qb.bind(null,s,o,u),o.then(s,s))}function qb(s,o,u){var d=s.pingCache;d!==null&&d.delete(o),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,ve===s&&(Wt&u)===u&&(De===4||De===3&&(Wt&62914560)===Wt&&300>le()-Wd?(ue&2)===0&&mo(s,0):Qd|=u,ho===Wt&&(ho=0)),Kn(s)}function wE(s,o){o===0&&(o=tl()),s=Xa(s,o),s!==null&&(ls(s,o),Kn(s))}function jb(s){var o=s.memoizedState,u=0;o!==null&&(u=o.retryLane),wE(s,u)}function Yb(s,o){var u=0;switch(s.tag){case 13:var d=s.stateNode,y=s.memoizedState;y!==null&&(u=y.retryLane);break;case 19:d=s.stateNode;break;case 22:d=s.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(o),wE(s,u)}function Qb(s,o){return mn(s,o)}var jc=null,yo=null,rg=!1,Yc=!1,ag=!1,da=0;function Kn(s){s!==yo&&s.next===null&&(yo===null?jc=yo=s:yo=yo.next=s),Yc=!0,rg||(rg=!0,Wb())}function zl(s,o){if(!ag&&Yc){ag=!0;do for(var u=!1,d=jc;d!==null;){if(s!==0){var y=d.pendingLanes;if(y===0)var v=0;else{var I=d.suspendedLanes,P=d.pingedLanes;v=(1<<31-$e(42|s)+1)-1,v&=y&~(I&~P),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(u=!0,kE(d,v))}else v=Wt,v=wa(d,d===ve?v:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(v&3)===0||Ur(d,v)||(u=!0,kE(d,v));d=d.next}while(u);ag=!1}}function Xb(){OE()}function OE(){Yc=rg=!1;var s=0;da!==0&&(rx()&&(s=da),da=0);for(var o=le(),u=null,d=jc;d!==null;){var y=d.next,v=PE(d,o);v===0?(d.next=null,u===null?jc=y:u.next=y,y===null&&(yo=u)):(u=d,(s!==0||(v&3)!==0)&&(Yc=!0)),d=y}zl(s)}function PE(s,o){for(var u=s.suspendedLanes,d=s.pingedLanes,y=s.expirationTimes,v=s.pendingLanes&-62914561;0<v;){var I=31-$e(v),P=1<<I,H=y[I];H===-1?((P&u)===0||(P&d)!==0)&&(y[I]=Zo(P,o)):H<=o&&(s.expiredLanes|=P),v&=~P}if(o=ve,u=Wt,u=wa(s,s===o?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d=s.callbackNode,u===0||s===o&&(ce===2||ce===9)||s.cancelPendingCommit!==null)return d!==null&&d!==null&&pn(d),s.callbackNode=null,s.callbackPriority=0;if((u&3)===0||Ur(s,u)){if(o=u&-u,o===s.callbackPriority)return o;switch(d!==null&&pn(d),Oa(u)){case 2:case 8:u=Ze;break;case 32:u=Li;break;case 268435456:u=rs;break;default:u=Li}return d=ME.bind(null,s),u=mn(u,d),s.callbackPriority=o,s.callbackNode=u,o}return d!==null&&d!==null&&pn(d),s.callbackPriority=2,s.callbackNode=null,2}function ME(s,o){if(ci!==0&&ci!==5)return s.callbackNode=null,s.callbackPriority=0,null;var u=s.callbackNode;if(qc()&&s.callbackNode!==u)return null;var d=Wt;return d=wa(s,s===ve?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),d===0?null:(pE(s,d,o),PE(s,le()),s.callbackNode!=null&&s.callbackNode===u?ME.bind(null,s):null)}function kE(s,o){if(qc())return null;pE(s,o,!0)}function Wb(){ox(function(){(ue&6)!==0?mn(ki,Xb):OE()})}function og(){return da===0&&(da=Jo()),da}function NE(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Ua(""+s)}function FE(s,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,s.id&&u.setAttribute("form",s.id),o.parentNode.insertBefore(u,o),s=new FormData(s),u.parentNode.removeChild(u),s}function Zb(s,o,u,d,y){if(o==="submit"&&u&&u.stateNode===y){var v=NE((y[Me]||null).action),I=d.submitter;I&&(o=(o=I[Me]||null)?NE(o.formAction):I.getAttribute("formAction"),o!==null&&(v=o,I=null));var P=new Ba("action","action",null,d,y);s.push({event:P,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(da!==0){var H=I?FE(y,I):new FormData(y);Id(u,{pending:!0,data:H,method:y.method,action:v},null,H)}}else typeof v=="function"&&(P.preventDefault(),H=I?FE(y,I):new FormData(y),Id(u,{pending:!0,data:H,method:y.method,action:v},v,H))},currentTarget:y}]})}}for(var lg=0;lg<qf.length;lg++){var ug=qf[lg],Jb=ug.toLowerCase(),tx=ug[0].toUpperCase()+ug.slice(1);Sn(Jb,"on"+tx)}Sn(p0,"onAnimationEnd"),Sn(y0,"onAnimationIteration"),Sn(E0,"onAnimationStart"),Sn("dblclick","onDoubleClick"),Sn("focusin","onFocus"),Sn("focusout","onBlur"),Sn(yb,"onTransitionRun"),Sn(Eb,"onTransitionStart"),Sn(vb,"onTransitionCancel"),Sn(v0,"onTransitionEnd"),cs("onMouseEnter",["mouseout","mouseover"]),cs("onMouseLeave",["mouseout","mouseover"]),cs("onPointerEnter",["pointerout","pointerover"]),cs("onPointerLeave",["pointerout","pointerover"]),vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ex=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ql));function UE(s,o){o=(o&4)!==0;for(var u=0;u<s.length;u++){var d=s[u],y=d.event;d=d.listeners;t:{var v=void 0;if(o)for(var I=d.length-1;0<=I;I--){var P=d[I],H=P.instance,Z=P.currentTarget;if(P=P.listener,H!==v&&y.isPropagationStopped())break t;v=P,y.currentTarget=Z;try{v(y)}catch(ot){kc(ot)}y.currentTarget=null,v=H}else for(I=0;I<d.length;I++){if(P=d[I],H=P.instance,Z=P.currentTarget,P=P.listener,H!==v&&y.isPropagationStopped())break t;v=P,y.currentTarget=Z;try{v(y)}catch(ot){kc(ot)}y.currentTarget=null,v=H}}}}function qt(s,o){var u=o[nl];u===void 0&&(u=o[nl]=new Set);var d=s+"__bubble";u.has(d)||(BE(o,s,2,!1),u.add(d))}function cg(s,o,u){var d=0;o&&(d|=4),BE(u,s,d,o)}var Qc="_reactListening"+Math.random().toString(36).slice(2);function hg(s){if(!s[Qc]){s[Qc]=!0,sl.forEach(function(u){u!=="selectionchange"&&(ex.has(u)||cg(u,!1,s),cg(u,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[Qc]||(o[Qc]=!0,cg("selectionchange",!1,o))}}function BE(s,o,u,d){switch(uv(o)){case 2:var y=Lx;break;case 8:y=Dx;break;default:y=bg}u=y.bind(null,o,u,s),y=void 0,!Xi||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),d?y!==void 0?s.addEventListener(o,u,{capture:!0,passive:y}):s.addEventListener(o,u,!0):y!==void 0?s.addEventListener(o,u,{passive:y}):s.addEventListener(o,u,!1)}function fg(s,o,u,d,y){var v=d;if((o&1)===0&&(o&2)===0&&d!==null)t:for(;;){if(d===null)return;var I=d.tag;if(I===3||I===4){var P=d.stateNode.containerInfo;if(P===y)break;if(I===4)for(I=d.return;I!==null;){var H=I.tag;if((H===3||H===4)&&I.stateNode.containerInfo===y)return;I=I.return}for(;P!==null;){if(I=us(P),I===null)return;if(H=I.tag,H===5||H===6||H===26||H===27){d=v=I;continue t}P=P.parentNode}}d=d.return}Wu(function(){var Z=v,ot=Qi(u),ft=[];t:{var J=T0.get(s);if(J!==void 0){var et=Ba,Ot=s;switch(s){case"keypress":if(kn(u)===0)break t;case"keydown":case"keyup":et=za;break;case"focusin":Ot="focus",et=$a;break;case"focusout":Ot="blur",et=$a;break;case"beforeblur":case"afterblur":et=$a;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":et=Wi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":et=Uf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":et=rc;break;case p0:case y0:case E0:et=Ha;break;case v0:et=oc;break;case"scroll":case"scrollend":et=Zu;break;case"wheel":et=qa;break;case"copy":case"cut":case"paste":et=Ka;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":et=pl;break;case"toggle":case"beforetoggle":et=uc}var Lt=(o&4)!==0,pe=!Lt&&(s==="scroll"||s==="scrollend"),j=Lt?J!==null?J+"Capture":null:J;Lt=[];for(var z=Z,X;z!==null;){var ut=z;if(X=ut.stateNode,ut=ut.tag,ut!==5&&ut!==26&&ut!==27||X===null||j===null||(ut=qr(z,j),ut!=null&&Lt.push(jl(z,ut,X))),pe)break;z=z.return}0<Lt.length&&(J=new et(J,Ot,null,u,ot),ft.push({event:J,listeners:Lt}))}}if((o&7)===0){t:{if(J=s==="mouseover"||s==="pointerover",et=s==="mouseout"||s==="pointerout",J&&u!==ds&&(Ot=u.relatedTarget||u.fromElement)&&(us(Ot)||Ot[ji]))break t;if((et||J)&&(J=ot.window===ot?ot:(J=ot.ownerDocument)?J.defaultView||J.parentWindow:window,et?(Ot=u.relatedTarget||u.toElement,et=Z,Ot=Ot?us(Ot):null,Ot!==null&&(pe=a(Ot),Lt=Ot.tag,Ot!==pe||Lt!==5&&Lt!==27&&Lt!==6)&&(Ot=null)):(et=null,Ot=Z),et!==Ot)){if(Lt=Wi,ut="onMouseLeave",j="onMouseEnter",z="mouse",(s==="pointerout"||s==="pointerover")&&(Lt=pl,ut="onPointerLeave",j="onPointerEnter",z="pointer"),pe=et==null?J:wn(et),X=Ot==null?J:wn(Ot),J=new Lt(ut,z+"leave",et,u,ot),J.target=pe,J.relatedTarget=X,ut=null,us(ot)===Z&&(Lt=new Lt(j,z+"enter",Ot,u,ot),Lt.target=X,Lt.relatedTarget=pe,ut=Lt),pe=ut,et&&Ot)e:{for(Lt=et,j=Ot,z=0,X=Lt;X;X=Eo(X))z++;for(X=0,ut=j;ut;ut=Eo(ut))X++;for(;0<z-X;)Lt=Eo(Lt),z--;for(;0<X-z;)j=Eo(j),X--;for(;z--;){if(Lt===j||j!==null&&Lt===j.alternate)break e;Lt=Eo(Lt),j=Eo(j)}Lt=null}else Lt=null;et!==null&&VE(ft,J,et,Lt,!1),Ot!==null&&pe!==null&&VE(ft,pe,Ot,Lt,!0)}}t:{if(J=Z?wn(Z):window,et=J.nodeName&&J.nodeName.toLowerCase(),et==="select"||et==="input"&&J.type==="file")var _t=r0;else if(ze(J))if(a0)_t=gb;else{_t=fb;var $t=hb}else et=J.nodeName,!et||et.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?Z&&ul(Z.elementType)&&(_t=r0):_t=db;if(_t&&(_t=_t(s,Z))){Es(ft,_t,u,ot);break t}$t&&$t(s,J,Z),s==="focusout"&&Z&&J.type==="number"&&Z.memoizedProps.value!=null&&qs(J,"number",J.value)}switch($t=Z?wn(Z):window,s){case"focusin":(ze($t)||$t.contentEditable==="true")&&(ja=$t,Hf=Z,vl=null);break;case"focusout":vl=Hf=ja=null;break;case"mousedown":Kf=!0;break;case"contextmenu":case"mouseup":case"dragend":Kf=!1,g0(ft,u,ot);break;case"selectionchange":if(pb)break;case"keydown":case"keyup":g0(ft,u,ot)}var xt;if(Un)t:{switch(s){case"compositionstart":var Dt="onCompositionStart";break t;case"compositionend":Dt="onCompositionEnd";break t;case"compositionupdate":Dt="onCompositionUpdate";break t}Dt=void 0}else Qt?nt(s,u)&&(Dt="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(Dt="onCompositionStart");Dt&&(x&&u.locale!=="ko"&&(Qt||Dt!=="onCompositionStart"?Dt==="onCompositionEnd"&&Qt&&(xt=hl()):(Mn=ot,js="value"in Mn?Mn.value:Mn.textContent,Qt=!0)),$t=Xc(Z,Dt),0<$t.length&&(Dt=new gl(Dt,s,null,u,ot),ft.push({event:Dt,listeners:$t}),xt?Dt.data=xt:(xt=yt(u),xt!==null&&(Dt.data=xt)))),(xt=A?Ke(s,u):Xt(s,u))&&(Dt=Xc(Z,"onBeforeInput"),0<Dt.length&&($t=new gl("onBeforeInput","beforeinput",null,u,ot),ft.push({event:$t,listeners:Dt}),$t.data=xt)),Zb(ft,s,Z,u,ot)}UE(ft,o)})}function jl(s,o,u){return{instance:s,listener:o,currentTarget:u}}function Xc(s,o){for(var u=o+"Capture",d=[];s!==null;){var y=s,v=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||v===null||(y=qr(s,u),y!=null&&d.unshift(jl(s,y,v)),y=qr(s,o),y!=null&&d.push(jl(s,y,v))),s.tag===3)return d;s=s.return}return[]}function Eo(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function VE(s,o,u,d,y){for(var v=o._reactName,I=[];u!==null&&u!==d;){var P=u,H=P.alternate,Z=P.stateNode;if(P=P.tag,H!==null&&H===d)break;P!==5&&P!==26&&P!==27||Z===null||(H=Z,y?(Z=qr(u,v),Z!=null&&I.unshift(jl(u,Z,H))):y||(Z=qr(u,v),Z!=null&&I.push(jl(u,Z,H)))),u=u.return}I.length!==0&&s.push({event:o,listeners:I})}var ix=/\r\n?/g,nx=/\u0000|\uFFFD/g;function GE(s){return(typeof s=="string"?s:""+s).replace(ix,`
`).replace(nx,"")}function $E(s,o){return o=GE(o),GE(s)===o}function Wc(){}function me(s,o,u,d,y,v){switch(u){case"children":typeof d=="string"?o==="body"||o==="textarea"&&d===""||Yi(s,d):(typeof d=="number"||typeof d=="bigint")&&o!=="body"&&Yi(s,""+d);break;case"className":On(s,"class",d);break;case"tabIndex":On(s,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":On(s,u,d);break;case"style":ll(s,d,v);break;case"data":if(o!=="object"){On(s,"data",d);break}case"src":case"href":if(d===""&&(o!=="a"||u!=="href")){s.removeAttribute(u);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(u);break}d=Ua(""+d),s.setAttribute(u,d);break;case"action":case"formAction":if(typeof d=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(u==="formAction"?(o!=="input"&&me(s,o,"name",y.name,y,null),me(s,o,"formEncType",y.formEncType,y,null),me(s,o,"formMethod",y.formMethod,y,null),me(s,o,"formTarget",y.formTarget,y,null)):(me(s,o,"encType",y.encType,y,null),me(s,o,"method",y.method,y,null),me(s,o,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){s.removeAttribute(u);break}d=Ua(""+d),s.setAttribute(u,d);break;case"onClick":d!=null&&(s.onclick=Wc);break;case"onScroll":d!=null&&qt("scroll",s);break;case"onScrollEnd":d!=null&&qt("scrollend",s);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(y.children!=null)throw Error(i(60));s.innerHTML=u}}break;case"multiple":s.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":s.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){s.removeAttribute("xlink:href");break}u=Ua(""+d),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(u,""+d):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":d===!0?s.setAttribute(u,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?s.setAttribute(u,d):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?s.setAttribute(u,d):s.removeAttribute(u);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?s.removeAttribute(u):s.setAttribute(u,d);break;case"popover":qt("beforetoggle",s),qt("toggle",s),zs(s,"popover",d);break;case"xlinkActuate":oi(s,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":oi(s,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":oi(s,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":oi(s,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":oi(s,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":oi(s,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":oi(s,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":oi(s,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":oi(s,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":zs(s,"is",d);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Nf.get(u)||u,zs(s,u,d))}}function dg(s,o,u,d,y,v){switch(u){case"style":ll(s,d,v);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(y.children!=null)throw Error(i(60));s.innerHTML=u}}break;case"children":typeof d=="string"?Yi(s,d):(typeof d=="number"||typeof d=="bigint")&&Yi(s,""+d);break;case"onScroll":d!=null&&qt("scroll",s);break;case"onScrollEnd":d!=null&&qt("scrollend",s);break;case"onClick":d!=null&&(s.onclick=Wc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pa.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(y=u.endsWith("Capture"),o=u.slice(2,y?u.length-7:void 0),v=s[Me]||null,v=v!=null?v[u]:null,typeof v=="function"&&s.removeEventListener(o,v,y),typeof d=="function")){typeof v!="function"&&v!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(o,d,y);break t}u in s?s[u]=d:d===!0?s.setAttribute(u,""):zs(s,u,d)}}}function hi(s,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":qt("error",s),qt("load",s);var d=!1,y=!1,v;for(v in u)if(u.hasOwnProperty(v)){var I=u[v];if(I!=null)switch(v){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:me(s,o,v,I,u,null)}}y&&me(s,o,"srcSet",u.srcSet,u,null),d&&me(s,o,"src",u.src,u,null);return;case"input":qt("invalid",s);var P=v=I=y=null,H=null,Z=null;for(d in u)if(u.hasOwnProperty(d)){var ot=u[d];if(ot!=null)switch(d){case"name":y=ot;break;case"type":I=ot;break;case"checked":H=ot;break;case"defaultChecked":Z=ot;break;case"value":v=ot;break;case"defaultValue":P=ot;break;case"children":case"dangerouslySetInnerHTML":if(ot!=null)throw Error(i(137,o));break;default:me(s,o,d,ot,u,null)}}Hr(s,v,P,H,Z,I,y,!1),Fa(s);return;case"select":qt("invalid",s),d=I=v=null;for(y in u)if(u.hasOwnProperty(y)&&(P=u[y],P!=null))switch(y){case"value":v=P;break;case"defaultValue":I=P;break;case"multiple":d=P;default:me(s,o,y,P,u,null)}o=v,u=I,s.multiple=!!d,o!=null?fs(s,!!d,o,!1):u!=null&&fs(s,!!d,u,!0);return;case"textarea":qt("invalid",s),v=y=d=null;for(I in u)if(u.hasOwnProperty(I)&&(P=u[I],P!=null))switch(I){case"value":d=P;break;case"defaultValue":y=P;break;case"children":v=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(i(91));break;default:me(s,o,I,P,u,null)}Kr(s,d,y,v),Fa(s);return;case"option":for(H in u)if(u.hasOwnProperty(H)&&(d=u[H],d!=null))switch(H){case"selected":s.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:me(s,o,H,d,u,null)}return;case"dialog":qt("beforetoggle",s),qt("toggle",s),qt("cancel",s),qt("close",s);break;case"iframe":case"object":qt("load",s);break;case"video":case"audio":for(d=0;d<ql.length;d++)qt(ql[d],s);break;case"image":qt("error",s),qt("load",s);break;case"details":qt("toggle",s);break;case"embed":case"source":case"link":qt("error",s),qt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Z in u)if(u.hasOwnProperty(Z)&&(d=u[Z],d!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:me(s,o,Z,d,u,null)}return;default:if(ul(o)){for(ot in u)u.hasOwnProperty(ot)&&(d=u[ot],d!==void 0&&dg(s,o,ot,d,u,void 0));return}}for(P in u)u.hasOwnProperty(P)&&(d=u[P],d!=null&&me(s,o,P,d,u,null))}function sx(s,o,u,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,v=null,I=null,P=null,H=null,Z=null,ot=null;for(et in u){var ft=u[et];if(u.hasOwnProperty(et)&&ft!=null)switch(et){case"checked":break;case"value":break;case"defaultValue":H=ft;default:d.hasOwnProperty(et)||me(s,o,et,null,d,ft)}}for(var J in d){var et=d[J];if(ft=u[J],d.hasOwnProperty(J)&&(et!=null||ft!=null))switch(J){case"type":v=et;break;case"name":y=et;break;case"checked":Z=et;break;case"defaultChecked":ot=et;break;case"value":I=et;break;case"defaultValue":P=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(i(137,o));break;default:et!==ft&&me(s,o,J,et,d,ft)}}Ni(s,I,P,H,Z,ot,v,y);return;case"select":et=I=P=J=null;for(v in u)if(H=u[v],u.hasOwnProperty(v)&&H!=null)switch(v){case"value":break;case"multiple":et=H;default:d.hasOwnProperty(v)||me(s,o,v,null,d,H)}for(y in d)if(v=d[y],H=u[y],d.hasOwnProperty(y)&&(v!=null||H!=null))switch(y){case"value":J=v;break;case"defaultValue":P=v;break;case"multiple":I=v;default:v!==H&&me(s,o,y,v,d,H)}o=P,u=I,d=et,J!=null?fs(s,!!u,J,!1):!!d!=!!u&&(o!=null?fs(s,!!u,o,!0):fs(s,!!u,u?[]:"",!1));return;case"textarea":et=J=null;for(P in u)if(y=u[P],u.hasOwnProperty(P)&&y!=null&&!d.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:me(s,o,P,null,d,y)}for(I in d)if(y=d[I],v=u[I],d.hasOwnProperty(I)&&(y!=null||v!=null))switch(I){case"value":J=y;break;case"defaultValue":et=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(i(91));break;default:y!==v&&me(s,o,I,y,d,v)}de(s,J,et);return;case"option":for(var Ot in u)if(J=u[Ot],u.hasOwnProperty(Ot)&&J!=null&&!d.hasOwnProperty(Ot))switch(Ot){case"selected":s.selected=!1;break;default:me(s,o,Ot,null,d,J)}for(H in d)if(J=d[H],et=u[H],d.hasOwnProperty(H)&&J!==et&&(J!=null||et!=null))switch(H){case"selected":s.selected=J&&typeof J!="function"&&typeof J!="symbol";break;default:me(s,o,H,J,d,et)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Lt in u)J=u[Lt],u.hasOwnProperty(Lt)&&J!=null&&!d.hasOwnProperty(Lt)&&me(s,o,Lt,null,d,J);for(Z in d)if(J=d[Z],et=u[Z],d.hasOwnProperty(Z)&&J!==et&&(J!=null||et!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(137,o));break;default:me(s,o,Z,J,d,et)}return;default:if(ul(o)){for(var pe in u)J=u[pe],u.hasOwnProperty(pe)&&J!==void 0&&!d.hasOwnProperty(pe)&&dg(s,o,pe,void 0,d,J);for(ot in d)J=d[ot],et=u[ot],!d.hasOwnProperty(ot)||J===et||J===void 0&&et===void 0||dg(s,o,ot,J,d,et);return}}for(var j in u)J=u[j],u.hasOwnProperty(j)&&J!=null&&!d.hasOwnProperty(j)&&me(s,o,j,null,d,J);for(ft in d)J=d[ft],et=u[ft],!d.hasOwnProperty(ft)||J===et||J==null&&et==null||me(s,o,ft,J,d,et)}var gg=null,mg=null;function Zc(s){return s.nodeType===9?s:s.ownerDocument}function HE(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function KE(s,o){if(s===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&o==="foreignObject"?0:s}function pg(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var yg=null;function rx(){var s=window.event;return s&&s.type==="popstate"?s===yg?!1:(yg=s,!0):(yg=null,!1)}var zE=typeof setTimeout=="function"?setTimeout:void 0,ax=typeof clearTimeout=="function"?clearTimeout:void 0,qE=typeof Promise=="function"?Promise:void 0,ox=typeof queueMicrotask=="function"?queueMicrotask:typeof qE<"u"?function(s){return qE.resolve(null).then(s).catch(lx)}:zE;function lx(s){setTimeout(function(){throw s})}function ur(s){return s==="head"}function jE(s,o){var u=o,d=0,y=0;do{var v=u.nextSibling;if(s.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"){if(0<d&&8>d){u=d;var I=s.ownerDocument;if(u&1&&Yl(I.documentElement),u&2&&Yl(I.body),u&4)for(u=I.head,Yl(u),I=u.firstChild;I;){var P=I.nextSibling,H=I.nodeName;I[Br]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&I.rel.toLowerCase()==="stylesheet"||u.removeChild(I),I=P}}if(y===0){s.removeChild(v),iu(o);return}y--}else u==="$"||u==="$?"||u==="$!"?y++:d=u.charCodeAt(0)-48;else d=0;u=v}while(u);iu(o)}function Eg(s){var o=s.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Eg(u),Ks(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function ux(s,o,u,d){for(;s.nodeType===1;){var y=u;if(s.nodeName.toLowerCase()!==o.toLowerCase()){if(!d&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(d){if(!s[Br])switch(o){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(v=s.getAttribute("rel"),v==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(v!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(v=s.getAttribute("src"),(v!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&v&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(o==="input"&&s.type==="hidden"){var v=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===v)return s}else return s;if(s=_n(s.nextSibling),s===null)break}return null}function cx(s,o,u){if(o==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=_n(s.nextSibling),s===null))return null;return s}function vg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function hx(s,o){var u=s.ownerDocument;if(s.data!=="$?"||u.readyState==="complete")o();else{var d=function(){o(),u.removeEventListener("DOMContentLoaded",d)};u.addEventListener("DOMContentLoaded",d),s._reactRetry=d}}function _n(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return s}var Tg=null;function YE(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return s;o--}else u==="/$"&&o++}s=s.previousSibling}return null}function QE(s,o,u){switch(o=Zc(u),s){case"html":if(s=o.documentElement,!s)throw Error(i(452));return s;case"head":if(s=o.head,!s)throw Error(i(453));return s;case"body":if(s=o.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function Yl(s){for(var o=s.attributes;o.length;)s.removeAttributeNode(o[0]);Ks(s)}var rn=new Map,XE=new Set;function Jc(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var ws=it.d;it.d={f:fx,r:dx,D:gx,C:mx,L:px,m:yx,X:vx,S:Ex,M:Tx};function fx(){var s=ws.f(),o=Kc();return s||o}function dx(s){var o=Cn(s);o!==null&&o.tag===5&&o.type==="form"?py(o):ws.r(s)}var vo=typeof document>"u"?null:document;function WE(s,o,u){var d=vo;if(d&&typeof o=="string"&&o){var y=ke(o);y='link[rel="'+s+'"][href="'+y+'"]',typeof u=="string"&&(y+='[crossorigin="'+u+'"]'),XE.has(y)||(XE.add(y),s={rel:s,crossOrigin:u,href:o},d.querySelector(y)===null&&(o=d.createElement("link"),hi(o,"link",s),Ce(o),d.head.appendChild(o)))}}function gx(s){ws.D(s),WE("dns-prefetch",s,null)}function mx(s,o){ws.C(s,o),WE("preconnect",s,o)}function px(s,o,u){ws.L(s,o,u);var d=vo;if(d&&s&&o){var y='link[rel="preload"][as="'+ke(o)+'"]';o==="image"&&u&&u.imageSrcSet?(y+='[imagesrcset="'+ke(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(y+='[imagesizes="'+ke(u.imageSizes)+'"]')):y+='[href="'+ke(s)+'"]';var v=y;switch(o){case"style":v=To(s);break;case"script":v=So(s)}rn.has(v)||(s=g({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:s,as:o},u),rn.set(v,s),d.querySelector(y)!==null||o==="style"&&d.querySelector(Ql(v))||o==="script"&&d.querySelector(Xl(v))||(o=d.createElement("link"),hi(o,"link",s),Ce(o),d.head.appendChild(o)))}}function yx(s,o){ws.m(s,o);var u=vo;if(u&&s){var d=o&&typeof o.as=="string"?o.as:"script",y='link[rel="modulepreload"][as="'+ke(d)+'"][href="'+ke(s)+'"]',v=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=So(s)}if(!rn.has(v)&&(s=g({rel:"modulepreload",href:s},o),rn.set(v,s),u.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Xl(v)))return}d=u.createElement("link"),hi(d,"link",s),Ce(d),u.head.appendChild(d)}}}function Ex(s,o,u){ws.S(s,o,u);var d=vo;if(d&&s){var y=Ri(d).hoistableStyles,v=To(s);o=o||"default";var I=y.get(v);if(!I){var P={loading:0,preload:null};if(I=d.querySelector(Ql(v)))P.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":o},u),(u=rn.get(v))&&Sg(s,u);var H=I=d.createElement("link");Ce(H),hi(H,"link",s),H._p=new Promise(function(Z,ot){H.onload=Z,H.onerror=ot}),H.addEventListener("load",function(){P.loading|=1}),H.addEventListener("error",function(){P.loading|=2}),P.loading|=4,th(I,o,d)}I={type:"stylesheet",instance:I,count:1,state:P},y.set(v,I)}}}function vx(s,o){ws.X(s,o);var u=vo;if(u&&s){var d=Ri(u).hoistableScripts,y=So(s),v=d.get(y);v||(v=u.querySelector(Xl(y)),v||(s=g({src:s,async:!0},o),(o=rn.get(y))&&Ag(s,o),v=u.createElement("script"),Ce(v),hi(v,"link",s),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(y,v))}}function Tx(s,o){ws.M(s,o);var u=vo;if(u&&s){var d=Ri(u).hoistableScripts,y=So(s),v=d.get(y);v||(v=u.querySelector(Xl(y)),v||(s=g({src:s,async:!0,type:"module"},o),(o=rn.get(y))&&Ag(s,o),v=u.createElement("script"),Ce(v),hi(v,"link",s),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(y,v))}}function ZE(s,o,u,d){var y=(y=Et.current)?Jc(y):null;if(!y)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=To(u.href),u=Ri(y).hoistableStyles,d=u.get(o),d||(d={type:"style",instance:null,count:0,state:null},u.set(o,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=To(u.href);var v=Ri(y).hoistableStyles,I=v.get(s);if(I||(y=y.ownerDocument||y,I={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(s,I),(v=y.querySelector(Ql(s)))&&!v._p&&(I.instance=v,I.state.loading=5),rn.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},rn.set(s,u),v||Sx(y,s,u,I.state))),o&&d===null)throw Error(i(528,""));return I}if(o&&d!==null)throw Error(i(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=So(u),u=Ri(y).hoistableScripts,d=u.get(o),d||(d={type:"script",instance:null,count:0,state:null},u.set(o,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function To(s){return'href="'+ke(s)+'"'}function Ql(s){return'link[rel="stylesheet"]['+s+"]"}function JE(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function Sx(s,o,u,d){s.querySelector('link[rel="preload"][as="style"]['+o+"]")?d.loading=1:(o=s.createElement("link"),d.preload=o,o.addEventListener("load",function(){return d.loading|=1}),o.addEventListener("error",function(){return d.loading|=2}),hi(o,"link",u),Ce(o),s.head.appendChild(o))}function So(s){return'[src="'+ke(s)+'"]'}function Xl(s){return"script[async]"+s}function tv(s,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var d=s.querySelector('style[data-href~="'+ke(u.href)+'"]');if(d)return o.instance=d,Ce(d),d;var y=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return d=(s.ownerDocument||s).createElement("style"),Ce(d),hi(d,"style",y),th(d,u.precedence,s),o.instance=d;case"stylesheet":y=To(u.href);var v=s.querySelector(Ql(y));if(v)return o.state.loading|=4,o.instance=v,Ce(v),v;d=JE(u),(y=rn.get(y))&&Sg(d,y),v=(s.ownerDocument||s).createElement("link"),Ce(v);var I=v;return I._p=new Promise(function(P,H){I.onload=P,I.onerror=H}),hi(v,"link",d),o.state.loading|=4,th(v,u.precedence,s),o.instance=v;case"script":return v=So(u.src),(y=s.querySelector(Xl(v)))?(o.instance=y,Ce(y),y):(d=u,(y=rn.get(v))&&(d=g({},u),Ag(d,y)),s=s.ownerDocument||s,y=s.createElement("script"),Ce(y),hi(y,"link",d),s.head.appendChild(y),o.instance=y);case"void":return null;default:throw Error(i(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(d=o.instance,o.state.loading|=4,th(d,u.precedence,s));return o.instance}function th(s,o,u){for(var d=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,v=y,I=0;I<d.length;I++){var P=d[I];if(P.dataset.precedence===o)v=P;else if(v!==y)break}v?v.parentNode.insertBefore(s,v.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(s,o.firstChild))}function Sg(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.title==null&&(s.title=o.title)}function Ag(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.integrity==null&&(s.integrity=o.integrity)}var eh=null;function ev(s,o,u){if(eh===null){var d=new Map,y=eh=new Map;y.set(u,d)}else y=eh,d=y.get(u),d||(d=new Map,y.set(u,d));if(d.has(s))return d;for(d.set(s,null),u=u.getElementsByTagName(s),y=0;y<u.length;y++){var v=u[y];if(!(v[Br]||v[He]||s==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var I=v.getAttribute(o)||"";I=s+I;var P=d.get(I);P?P.push(v):d.set(I,[v])}}return d}function iv(s,o,u){s=s.ownerDocument||s,s.head.insertBefore(u,o==="title"?s.querySelector("head > title"):null)}function Ax(s,o,u){if(u===1||o.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return s=o.disabled,typeof o.precedence=="string"&&s==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function nv(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var Wl=null;function _x(){}function Rx(s,o,u){if(Wl===null)throw Error(i(475));var d=Wl;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var y=To(u.href),v=s.querySelector(Ql(y));if(v){s=v._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(d.count++,d=ih.bind(d),s.then(d,d)),o.state.loading|=4,o.instance=v,Ce(v);return}v=s.ownerDocument||s,u=JE(u),(y=rn.get(y))&&Sg(u,y),v=v.createElement("link"),Ce(v);var I=v;I._p=new Promise(function(P,H){I.onload=P,I.onerror=H}),hi(v,"link",u),o.instance=v}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(d.count++,o=ih.bind(d),s.addEventListener("load",o),s.addEventListener("error",o))}}function bx(){if(Wl===null)throw Error(i(475));var s=Wl;return s.stylesheets&&s.count===0&&_g(s,s.stylesheets),0<s.count?function(o){var u=setTimeout(function(){if(s.stylesheets&&_g(s,s.stylesheets),s.unsuspend){var d=s.unsuspend;s.unsuspend=null,d()}},6e4);return s.unsuspend=o,function(){s.unsuspend=null,clearTimeout(u)}}:null}function ih(){if(this.count--,this.count===0){if(this.stylesheets)_g(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var nh=null;function _g(s,o){s.stylesheets=null,s.unsuspend!==null&&(s.count++,nh=new Map,o.forEach(xx,s),nh=null,ih.call(s))}function xx(s,o){if(!(o.state.loading&4)){var u=nh.get(s);if(u)var d=u.get(null);else{u=new Map,nh.set(s,u);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<y.length;v++){var I=y[v];(I.nodeName==="LINK"||I.getAttribute("media")!=="not all")&&(u.set(I.dataset.precedence,I),d=I)}d&&u.set(null,d)}y=o.instance,I=y.getAttribute("data-precedence"),v=u.get(I)||d,v===d&&u.set(null,y),u.set(I,y),this.count++,d=ih.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),v?v.parentNode.insertBefore(y,v.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),o.state.loading|=4}}var Zl={$$typeof:M,Provider:null,Consumer:null,_currentValue:ct,_currentValue2:ct,_threadCount:0};function Ix(s,o,u,d,y,v,I,P){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=os(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=os(0),this.hiddenUpdates=os(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=v,this.onRecoverableError=I,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=P,this.incompleteTransitions=new Map}function sv(s,o,u,d,y,v,I,P,H,Z,ot,ft){return s=new Ix(s,o,u,I,P,H,Z,ft),o=1,v===!0&&(o|=24),v=Ui(3,null,null,o),s.current=v,v.stateNode=s,o=sd(),o.refCount++,s.pooledCache=o,o.refCount++,v.memoizedState={element:d,isDehydrated:u,cache:o},ld(v),s}function rv(s){return s?(s=Wa,s):Wa}function av(s,o,u,d,y,v){y=rv(y),d.context===null?d.context=y:d.pendingContext=y,d=Xs(o),d.payload={element:u},v=v===void 0?null:v,v!==null&&(d.callback=v),u=Ws(s,d,o),u!==null&&(Hi(u,s,o),Ll(u,s,o))}function ov(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<o?u:o}}function Rg(s,o){ov(s,o),(s=s.alternate)&&ov(s,o)}function lv(s){if(s.tag===13){var o=Xa(s,67108864);o!==null&&Hi(o,s,67108864),Rg(s,67108864)}}var sh=!0;function Lx(s,o,u,d){var y=K.T;K.T=null;var v=it.p;try{it.p=2,bg(s,o,u,d)}finally{it.p=v,K.T=y}}function Dx(s,o,u,d){var y=K.T;K.T=null;var v=it.p;try{it.p=8,bg(s,o,u,d)}finally{it.p=v,K.T=y}}function bg(s,o,u,d){if(sh){var y=xg(d);if(y===null)fg(s,o,d,rh,u),cv(s,d);else if(wx(y,s,o,u,d))d.stopPropagation();else if(cv(s,d),o&4&&-1<Cx.indexOf(s)){for(;y!==null;){var v=Cn(y);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var I=En(v.pendingLanes);if(I!==0){var P=v;for(P.pendingLanes|=2,P.entangledLanes|=2;I;){var H=1<<31-$e(I);P.entanglements[1]|=H,I&=~H}Kn(v),(ue&6)===0&&($c=le()+500,zl(0))}}break;case 13:P=Xa(v,2),P!==null&&Hi(P,v,2),Kc(),Rg(v,2)}if(v=xg(d),v===null&&fg(s,o,d,rh,u),v===y)break;y=v}y!==null&&d.stopPropagation()}else fg(s,o,d,null,u)}}function xg(s){return s=Qi(s),Ig(s)}var rh=null;function Ig(s){if(rh=null,s=us(s),s!==null){var o=a(s);if(o===null)s=null;else{var u=o.tag;if(u===13){if(s=l(o),s!==null)return s;s=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null)}}return rh=s,null}function uv(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pi()){case ki:return 2;case Ze:return 8;case Li:case yn:return 32;case rs:return 268435456;default:return 32}default:return 32}}var Lg=!1,cr=null,hr=null,fr=null,Jl=new Map,tu=new Map,dr=[],Cx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function cv(s,o){switch(s){case"focusin":case"focusout":cr=null;break;case"dragenter":case"dragleave":hr=null;break;case"mouseover":case"mouseout":fr=null;break;case"pointerover":case"pointerout":Jl.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":tu.delete(o.pointerId)}}function eu(s,o,u,d,y,v){return s===null||s.nativeEvent!==v?(s={blockedOn:o,domEventName:u,eventSystemFlags:d,nativeEvent:v,targetContainers:[y]},o!==null&&(o=Cn(o),o!==null&&lv(o)),s):(s.eventSystemFlags|=d,o=s.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),s)}function wx(s,o,u,d,y){switch(o){case"focusin":return cr=eu(cr,s,o,u,d,y),!0;case"dragenter":return hr=eu(hr,s,o,u,d,y),!0;case"mouseover":return fr=eu(fr,s,o,u,d,y),!0;case"pointerover":var v=y.pointerId;return Jl.set(v,eu(Jl.get(v)||null,s,o,u,d,y)),!0;case"gotpointercapture":return v=y.pointerId,tu.set(v,eu(tu.get(v)||null,s,o,u,d,y)),!0}return!1}function hv(s){var o=us(s.target);if(o!==null){var u=a(o);if(u!==null){if(o=u.tag,o===13){if(o=l(u),o!==null){s.blockedOn=o,Ku(s.priority,function(){if(u.tag===13){var d=$i();d=Gs(d);var y=Xa(u,d);y!==null&&Hi(y,u,d),Rg(u,d)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function ah(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var u=xg(s.nativeEvent);if(u===null){u=s.nativeEvent;var d=new u.constructor(u.type,u);ds=d,u.target.dispatchEvent(d),ds=null}else return o=Cn(u),o!==null&&lv(o),s.blockedOn=u,!1;o.shift()}return!0}function fv(s,o,u){ah(s)&&u.delete(o)}function Ox(){Lg=!1,cr!==null&&ah(cr)&&(cr=null),hr!==null&&ah(hr)&&(hr=null),fr!==null&&ah(fr)&&(fr=null),Jl.forEach(fv),tu.forEach(fv)}function oh(s,o){s.blockedOn===o&&(s.blockedOn=null,Lg||(Lg=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ox)))}var lh=null;function dv(s){lh!==s&&(lh=s,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){lh===s&&(lh=null);for(var o=0;o<s.length;o+=3){var u=s[o],d=s[o+1],y=s[o+2];if(typeof d!="function"){if(Ig(d||u)===null)continue;break}var v=Cn(u);v!==null&&(s.splice(o,3),o-=3,Id(v,{pending:!0,data:y,method:u.method,action:d},d,y))}}))}function iu(s){function o(H){return oh(H,s)}cr!==null&&oh(cr,s),hr!==null&&oh(hr,s),fr!==null&&oh(fr,s),Jl.forEach(o),tu.forEach(o);for(var u=0;u<dr.length;u++){var d=dr[u];d.blockedOn===s&&(d.blockedOn=null)}for(;0<dr.length&&(u=dr[0],u.blockedOn===null);)hv(u),u.blockedOn===null&&dr.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(d=0;d<u.length;d+=3){var y=u[d],v=u[d+1],I=y[Me]||null;if(typeof v=="function")I||dv(u);else if(I){var P=null;if(v&&v.hasAttribute("formAction")){if(y=v,I=v[Me]||null)P=I.formAction;else if(Ig(y)!==null)continue}else P=I.action;typeof P=="function"?u[d+1]=P:(u.splice(d,3),d-=3),dv(u)}}}function Dg(s){this._internalRoot=s}uh.prototype.render=Dg.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(i(409));var u=o.current,d=$i();av(u,d,s,o,null,null)},uh.prototype.unmount=Dg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;av(s.current,2,null,s,null,null),Kc(),o[ji]=null}};function uh(s){this._internalRoot=s}uh.prototype.unstable_scheduleHydration=function(s){if(s){var o=$s();s={blockedOn:null,target:s,priority:o};for(var u=0;u<dr.length&&o!==0&&o<dr[u].priority;u++);dr.splice(u,0,s),u===0&&hv(s)}};var gv=t.version;if(gv!=="19.1.0")throw Error(i(527,gv,"19.1.0"));it.findDOMNode=function(s){var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=f(o),s=s!==null?h(s):null,s=s===null?null:s.stateNode,s};var Px={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ch=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ch.isDisabled&&ch.supportsFiber)try{fe=ch.inject(Px),te=ch}catch{}}return su.createRoot=function(s,o){if(!n(s))throw Error(i(299));var u=!1,d="",y=Cy,v=wy,I=Oy,P=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(v=o.onCaughtError),o.onRecoverableError!==void 0&&(I=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(P=o.unstable_transitionCallbacks)),o=sv(s,1,!1,null,null,u,d,y,v,I,P,null),s[ji]=o.current,hg(s),new Dg(o)},su.hydrateRoot=function(s,o,u){if(!n(s))throw Error(i(299));var d=!1,y="",v=Cy,I=wy,P=Oy,H=null,Z=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onUncaughtError!==void 0&&(v=u.onUncaughtError),u.onCaughtError!==void 0&&(I=u.onCaughtError),u.onRecoverableError!==void 0&&(P=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(H=u.unstable_transitionCallbacks),u.formState!==void 0&&(Z=u.formState)),o=sv(s,1,!0,o,u??null,d,y,v,I,P,H,Z),o.context=rv(null),u=o.current,d=$i(),d=Gs(d),y=Xs(d),y.callback=null,Ws(u,y,d),u=d,o.current.lanes=u,ls(o,u),Kn(o),s[ji]=o.current,hg(s),new uh(o)},su.version="19.1.0",su}var Rv;function Kx(){if(Rv)return Og.exports;Rv=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Og.exports=Hx(),Og.exports}var zx=Kx();const qx=eA(zx);function jx({channel:r,onSelect:t}){return r?kt.jsxs("div",{className:"channel-card",onClick:()=>t(r.streamUrl),children:[kt.jsx("img",{src:r.logo,alt:r.name,className:"channel-logo"}),kt.jsx("h2",{style:{marginTop:"0.4rem"},children:r.name}),kt.jsx("p",{style:{fontSize:"0.8rem",color:"#666"},children:r.category})]}):null}function Yx({channels:r,onChannelSelect:t}){return kt.jsx("div",{children:kt.jsx("div",{className:"channel-list",children:r.map(e=>kt.jsx(jx,{channel:e,onSelect:t},e.id))})})}const Qx=()=>kt.jsx("div",{className:"vpn-banner",children:"⚠️ For better streaming performance, please use a VPN."}),vt=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},Xx=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=Wx},Wx=Number.MAX_SAFE_INTEGER||9007199254740991;let bt=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),W=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),b=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var Ht={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Rt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ao{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class Zx{constructor(t,e,i,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ao(t),this.fast_=new Ao(e),this.defaultTTFB_=n,this.ttfb_=new Ao(t)}update(t,e){const{slow_:i,fast_:n,ttfb_:a}=this;i.halfLife!==t&&(this.slow_=new Ao(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.fast_=new Ao(e,n.getEstimate(),n.getTotalWeight())),a.halfLife!==t&&(this.ttfb_=new Ao(t,a.getEstimate(),a.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const i=8*e,n=t/1e3,a=i/n;this.fast_.sample(n,a),this.slow_.sample(n,a)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Jx(r,t,e){return(t=eI(t))in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function he(){return he=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)({}).hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},he.apply(null,arguments)}function bv(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),e.push.apply(e,i)}return e}function re(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?bv(Object(e),!0).forEach(function(i){Jx(r,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):bv(Object(e)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(e,i))})}return r}function tI(r,t){if(typeof r!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var i=e.call(r,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function eI(r){var t=tI(r,"string");return typeof t=="symbol"?t:t+""}let Vs=class{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${t}]:`;this.trace=yr,this.debug=e.debug.bind(null,i),this.log=e.log.bind(null,i),this.warn=e.warn.bind(null,i),this.info=e.info.bind(null,i),this.error=e.error.bind(null,i)}};const yr=function(){},iI={trace:yr,debug:yr,log:yr,warn:yr,info:yr,error:yr};function gm(){return he({},iI)}function nI(r,t){const e=self.console[r];return e?e.bind(self.console,`${t?"["+t+"] ":""}[${r}] >`):yr}function xv(r,t,e){return t[r]?t[r].bind(t):nI(r,e)}const mm=gm();function sI(r,t,e){const i=gm();if(typeof console=="object"&&r===!0||typeof r=="object"){const n=["debug","log","info","warn","error"];n.forEach(a=>{i[a]=xv(a,r,e)});try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.5`)}catch{return gm()}n.forEach(a=>{mm[a]=xv(a,r)})}else he(mm,i);return i}const ie=mm;function Rr(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rI(r){return typeof self<"u"&&r===self.ManagedMediaSource}function iA(r,t){const e=Object.keys(r),i=Object.keys(t),n=e.length,a=i.length;return!n||!a||n===a&&!e.some(l=>i.indexOf(l)===-1)}function qi(r,t=!1){if(typeof TextDecoder<"u"){const h=new TextDecoder("utf-8").decode(r);if(t){const g=h.indexOf("\0");return g!==-1?h.substring(0,g):h}return h.replace(/\0/g,"")}const e=r.length;let i,n,a,l="",c=0;for(;c<e;){if(i=r[c++],i===0&&t)return l;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(i);break;case 12:case 13:n=r[c++],l+=String.fromCharCode((i&31)<<6|n&63);break;case 14:n=r[c++],a=r[c++],l+=String.fromCharCode((i&15)<<12|(n&63)<<6|(a&63)<<0);break}}return l}const jn={hexDump:function(r){let t="";for(let e=0;e<r.length;e++){let i=r[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}};function aI(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ng={exports:{}},Iv;function oI(){return Iv||(Iv=1,function(r,t){(function(e){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(f,h,g){if(g=g||{},f=f.trim(),h=h.trim(),!h){if(!g.alwaysNormalize)return f;var p=c.parseURL(f);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var E=c.parseURL(h);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return g.alwaysNormalize?(E.path=c.normalizePath(E.path),c.buildURLFromParts(E)):h;var T=c.parseURL(f);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var S=n.exec(T.path);T.netLoc=S[1],T.path=S[2]}T.netLoc&&!T.path&&(T.path="/");var R={scheme:T.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(R.netLoc=T.netLoc,E.path[0]!=="/"))if(!E.path)R.path=T.path,E.params||(R.params=T.params,E.query||(R.query=T.query));else{var _=T.path,D=_.substring(0,_.lastIndexOf("/")+1)+E.path;R.path=c.normalizePath(D)}return R.path===null&&(R.path=g.alwaysNormalize?c.normalizePath(E.path):E.path),c.buildURLFromParts(R)},parseURL:function(f){var h=i.exec(f);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(a,"");f.length!==(f=f.replace(l,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};r.exports=c})()}(Ng)),Ng.exports}var tp=oI();class ep{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ee={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class nA{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof t=="string"&&(t={url:t}),this.base=t,uI(this,"stats")}setByteRange(t,e){const i=t.split("@",2);let n;i.length===1?n=e?.byteRangeEndOffset||0:n=parseInt(i[1]),this._byteRange=[n,parseInt(i[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ee.AUDIO]:null,[Ee.VIDEO]:null,[Ee.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new ep),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=tp.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Ee.AUDIO]=null,t[Ee.VIDEO]=null,t[Ee.AUDIOVIDEO]=null}}function ai(r){return r.sn!=="initSegment"}class Fg extends nA{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange){const t=this.byteRange[0],e=this.byteRange[1];if(vt(t)&&vt(e))return e-t}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const t=vt(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),i=e.length;if(i>1||i===1&&this.levelkeys[e[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){if(!vt(t)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=t}get ref(){return ai(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,i,n,a,l=!1){const{elementaryStreams:c}=this,f=c[t];if(!f){c[t]={startPTS:e,endPTS:i,startDTS:n,endDTS:a,partial:l};return}f.startPTS=Math.min(f.startPTS,e),f.endPTS=Math.max(f.endPTS,i),f.startDTS=Math.min(f.startDTS,n),f.endDTS=Math.max(f.endDTS,a)}}class lI extends nA{constructor(t,e,i,n,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=n;const l=t.enumeratedString("BYTERANGE");l&&this.setByteRange(l,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function sA(r,t){const e=Object.getPrototypeOf(r);if(e){const i=Object.getOwnPropertyDescriptor(e,t);return i||sA(e,t)}}function uI(r,t){const e=sA(r,t);e&&(e.enumerable=!0,Object.defineProperty(r,t,e))}const zh=Math.pow(2,32)-1,cI=[].push,rA={video:1,audio:2,id3:3,text:4};function Ye(r){return String.fromCharCode.apply(null,r)}function aA(r,t){const e=r[t]<<8|r[t+1];return e<0?65536+e:e}function Ct(r,t){const e=oA(r,t);return e<0?4294967296+e:e}function Lv(r,t){let e=Ct(r,t);return e*=Math.pow(2,32),e+=Ct(r,t+4),e}function oA(r,t){return r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]}function Ug(r,t,e){r[t]=e>>24,r[t+1]=e>>16&255,r[t+2]=e>>8&255,r[t+3]=e&255}function hI(r){const t=r.byteLength;for(let e=0;e<t;){const i=Ct(r,e);if(i>8&&r[e+4]===109&&r[e+5]===111&&r[e+6]===111&&r[e+7]===102)return!0;e=i>1?e+i:t}return!1}function Ft(r,t){const e=[];if(!t.length)return e;const i=r.byteLength;for(let n=0;n<i;){const a=Ct(r,n),l=Ye(r.subarray(n+4,n+8)),c=a>1?n+a:i;if(l===t[0])if(t.length===1)e.push(r.subarray(n+8,c));else{const f=Ft(r.subarray(n+8,c),t.slice(1));f.length&&cI.apply(e,f)}n=c}return e}function fI(r){const t=[],e=r[0];let i=8;const n=Ct(r,i);i+=4;let a=0,l=0;e===0?(a=Ct(r,i),l=Ct(r,i+4),i+=8):(a=Lv(r,i),l=Lv(r,i+8),i+=16),i+=2;let c=r.length+l;const f=aA(r,i);i+=2;for(let h=0;h<f;h++){let g=i;const p=Ct(r,g);g+=4;const E=p&2147483647;if((p&2147483648)>>>31===1)return ie.warn("SIDX has hierarchical references (not supported)"),null;const S=Ct(r,g);g+=4,t.push({referenceSize:E,subsegmentDuration:S,info:{duration:S/n,start:c,end:c+E-1}}),c+=E,g+=4,i=g}return{earliestPresentationTime:a,timescale:n,version:e,referencesCount:f,references:t}}function lA(r){const t=[],e=Ft(r,["moov","trak"]);for(let n=0;n<e.length;n++){const a=e[n],l=Ft(a,["tkhd"])[0];if(l){let c=l[0];const f=Ct(l,c===0?12:20),h=Ft(a,["mdia","mdhd"])[0];if(h){c=h[0];const g=Ct(h,c===0?12:20),p=Ft(a,["mdia","hdlr"])[0];if(p){const E=Ye(p.subarray(8,12)),T={soun:Ee.AUDIO,vide:Ee.VIDEO}[E],S=Ft(a,["mdia","minf","stbl","stsd"])[0],R=dI(S);T?(t[f]={timescale:g,type:T,stsd:R},t[T]=re({timescale:g,id:f},R)):t[f]={timescale:g,type:E,stsd:R}}}}}return Ft(r,["moov","mvex","trex"]).forEach(n=>{const a=Ct(n,4),l=t[a];l&&(l.default={duration:Ct(n,12),flags:Ct(n,20)})}),t}function dI(r){const t=r.subarray(8),e=t.subarray(86),i=Ye(t.subarray(4,8));let n=i,a;const l=i==="enca"||i==="encv";if(l){const h=Ft(t,[i])[0].subarray(i==="enca"?28:78);Ft(h,["sinf"]).forEach(p=>{const E=Ft(p,["schm"])[0];if(E){const T=Ye(E.subarray(4,8));if(T==="cbcs"||T==="cenc"){const S=Ft(p,["frma"])[0];S&&(n=Ye(S))}}})}const c=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const f=Ft(e,["avcC"])[0];f&&f.length>3&&(n+="."+fh(f[1])+fh(f[2])+fh(f[3]),a=hh(c==="avc1"?"dva1":"dvav",e));break}case"mp4a":{const f=Ft(t,[i])[0],h=Ft(f.subarray(28),["esds"])[0];if(h&&h.length>7){let g=4;if(h[g++]!==3)break;g=Bg(h,g),g+=2;const p=h[g++];if(p&128&&(g+=2),p&64&&(g+=h[g++]),h[g++]!==4)break;g=Bg(h,g);const E=h[g++];if(E===64)n+="."+fh(E);else break;if(g+=12,h[g++]!==5)break;g=Bg(h,g);const T=h[g++];let S=(T&248)>>3;S===31&&(S+=1+((T&7)<<3)+((h[g]&224)>>5)),n+="."+S}break}case"hvc1":case"hev1":{const f=Ft(e,["hvcC"])[0];if(f&&f.length>12){const h=f[1],g=["","A","B","C"][h>>6],p=h&31,E=Ct(f,2),T=(h&32)>>5?"H":"L",S=f[12],R=f.subarray(6,12);n+="."+g+p,n+="."+gI(E).toString(16).toUpperCase(),n+="."+T+S;let _="";for(let D=R.length;D--;){const N=R[D];(N||_)&&(_="."+N.toString(16).toUpperCase()+_)}n+=_}a=hh(c=="hev1"?"dvhe":"dvh1",e);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=hh(n,e)||n;break}case"vp09":{const f=Ft(e,["vpcC"])[0];if(f&&f.length>6){const h=f[4],g=f[5],p=f[6]>>4&15;n+="."+qn(h)+"."+qn(g)+"."+qn(p)}break}case"av01":{const f=Ft(e,["av1C"])[0];if(f&&f.length>2){const h=f[1]>>>5,g=f[1]&31,p=f[2]>>>7?"H":"M",E=(f[2]&64)>>6,T=(f[2]&32)>>5,S=h===2&&E?T?12:10:E?10:8,R=(f[2]&16)>>4,_=(f[2]&8)>>3,D=(f[2]&4)>>2,N=f[2]&3;n+="."+h+"."+qn(g)+p+"."+qn(S)+"."+R+"."+_+D+N+"."+qn(1)+"."+qn(1)+"."+qn(1)+"."+0,a=hh("dav1",e)}break}}return{codec:n,encrypted:l,supplemental:a}}function hh(r,t){const e=Ft(t,["dvvC"]),i=e.length?e[0]:Ft(t,["dvcC"])[0];if(i){const n=i[2]>>1&127,a=i[2]<<5&32|i[3]>>3&31;return r+"."+qn(n)+"."+qn(a)}}function gI(r){let t=0;for(let e=0;e<32;e++)t|=(r>>e&1)<<31-e;return t>>>0}function Bg(r,t){const e=t+5;for(;r[t++]&128&&t<e;);return t}function fh(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function qn(r){return(r<10?"0":"")+r}function mI(r,t){if(!r||!t)return r;const e=t.keyId;return e&&t.isCommonEncryption&&Ft(r,["moov","trak"]).forEach(n=>{const l=Ft(n,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=Ft(l,["enca"]);const f=c.length>0;f||(c=Ft(l,["encv"])),c.forEach(h=>{const g=f?h.subarray(28):h.subarray(78);Ft(g,["sinf"]).forEach(E=>{const T=uA(E);if(T){const S=T.subarray(8,24);S.some(R=>R!==0)||(ie.log(`[eme] Patching keyId in 'enc${f?"a":"v"}>sinf>>tenc' box: ${jn.hexDump(S)} -> ${jn.hexDump(e)}`),T.set(e,8))}})})}),r}function uA(r){const t=Ft(r,["schm"])[0];if(t){const e=Ye(t.subarray(4,8));if(e==="cbcs"||e==="cenc")return Ft(r,["schi","tenc"])[0]}return null}function pI(r,t,e){const i={},n=Ft(r,["moof","traf"]);for(let a=0;a<n.length;a++){const l=n[a],c=Ft(l,["tfhd"])[0],f=Ct(c,4),h=t[f];if(!h)continue;const g=i[f]||(i[f]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type}),p=Ft(l,["tfdt"])[0];if(p){const M=p[0];let G=Ct(p,4);M===1&&(G===zh?e.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(G*=zh+1,G+=Ct(p,8))),vt(G)&&(!vt(g.start)||G<g.start)&&(g.start=G)}const E=h.default,T=Ct(c,0)|E?.flags;let S=E?.duration||0;T&8&&(T&2?S=Ct(c,12):S=Ct(c,8));const R=Ft(l,["trun"]);let _=g.start||0,D=0,N=S;for(let M=0;M<R.length;M++){const G=R[M],$=Ct(G,4),q=g.sampleCount;g.sampleCount+=$;const w=G[3]&1,L=G[3]&4,O=G[2]&1,C=G[2]&2,U=G[2]&4,V=G[2]&8;let B=8,pt=$;for(w&&(B+=4),L&&$&&(!(G[B+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=q),B+=4,O?(N=Ct(G,B),B+=4):N=S,C&&(B+=4),V&&(B+=4),_+=N,D+=N,pt--);pt--;)O?(N=Ct(G,B),B+=4):N=S,C&&(B+=4),U&&(G[B+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(pt+1),g.keyFrameStart=_),B+=4),V&&(B+=4),_+=N,D+=N;!D&&S&&(D+=S*$)}g.duration+=D}if(!Object.keys(i).some(a=>i[a].duration)){let a=1/0,l=0;const c=Ft(r,["sidx"]);for(let f=0;f<c.length;f++){const h=fI(c[f]);if(h!=null&&h.references){a=Math.min(a,h.earliestPresentationTime/h.timescale);const g=h.references.reduce((p,E)=>p+E.info.duration||0,0);l=Math.max(l,g+h.earliestPresentationTime/h.timescale)}}l&&vt(l)&&Object.keys(i).forEach(f=>{i[f].duration||(i[f].duration=l*i[f].timescale-i[f].start)})}return i}function yI(r,t,e){Ft(t,["moof","traf"]).forEach(i=>{Ft(i,["tfhd"]).forEach(n=>{const a=Ct(n,4),l=r[a];if(!l)return;const c=l.timescale||9e4;Ft(i,["tfdt"]).forEach(f=>{const h=f[0],g=e*c;if(g){let p=Ct(f,4);if(h===0)p-=g,p=Math.max(p,0),Ug(f,4,p);else{p*=Math.pow(2,32),p+=Ct(f,8),p-=g,p=Math.max(p,0);const E=Math.floor(p/(zh+1)),T=Math.floor(p%(zh+1));Ug(f,4,E),Ug(f,8,T)}}})})})}function EI(r){const t={valid:null,remainder:null},e=Ft(r,["moof"]);if(e.length<2)return t.remainder=r,t;const i=e[e.length-1];return t.valid=r.slice(0,i.byteOffset-8),t.remainder=r.slice(i.byteOffset-8),t}function fn(r,t){const e=new Uint8Array(r.length+t.length);return e.set(r),e.set(t,r.length),e}function Dv(r,t){const e=[],i=t.samples,n=t.timescale,a=t.id;let l=!1;return Ft(i,["moof"]).map(f=>{const h=f.byteOffset-8;Ft(f,["traf"]).map(p=>{const E=Ft(p,["tfdt"]).map(T=>{const S=T[0];let R=Ct(T,4);return S===1&&(R*=Math.pow(2,32),R+=Ct(T,8)),R/n})[0];return E!==void 0&&(r=E),Ft(p,["tfhd"]).map(T=>{const S=Ct(T,4),R=Ct(T,0)&16777215,_=(R&1)!==0,D=(R&2)!==0,N=(R&8)!==0;let M=0;const G=(R&16)!==0;let $=0;const q=(R&32)!==0;let w=8;S===a&&(_&&(w+=8),D&&(w+=4),N&&(M=Ct(T,w),w+=4),G&&($=Ct(T,w),w+=4),q&&(w+=4),t.type==="video"&&(l=Ef(t.codec)),Ft(p,["trun"]).map(L=>{const O=L[0],C=Ct(L,0)&16777215,U=(C&1)!==0;let V=0;const B=(C&4)!==0,pt=(C&256)!==0;let gt=0;const K=(C&512)!==0;let it=0;const ct=(C&1024)!==0,rt=(C&2048)!==0;let F=0;const tt=Ct(L,4);let at=8;U&&(V=Ct(L,at),at+=4),B&&(at+=4);let st=V+h;for(let mt=0;mt<tt;mt++){if(pt?(gt=Ct(L,at),at+=4):gt=M,K?(it=Ct(L,at),at+=4):it=$,ct&&(at+=4),rt&&(O===0?F=Ct(L,at):F=oA(L,at),at+=4),t.type===Ee.VIDEO){let Tt=0;for(;Tt<it;){const Et=Ct(i,st);if(st+=4,vI(l,i[st])){const Yt=i.subarray(st,st+Et);ip(Yt,l?2:1,r+F/n,e)}st+=Et,Tt+=Et+4}}r+=gt/n}}))})})}),e}function Ef(r){if(!r)return!1;const t=r.substring(0,4);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function vI(r,t){if(r){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function ip(r,t,e,i){const n=cA(r);let a=0;a+=t;let l=0,c=0,f=0;for(;a<n.length;){l=0;do{if(a>=n.length)break;f=n[a++],l+=f}while(f===255);c=0;do{if(a>=n.length)break;f=n[a++],c+=f}while(f===255);const h=n.length-a;let g=a;if(c<h)a+=c;else if(c>h){ie.error(`Malformed SEI payload. ${c} is too small, only ${h} bytes left to parse.`);break}if(l===4){if(n[g++]===181){const E=aA(n,g);if(g+=2,E===49){const T=Ct(n,g);if(g+=4,T===1195456820){const S=n[g++];if(S===3){const R=n[g++],_=31&R,D=64&R,N=D?2+_*3:0,M=new Uint8Array(N);if(D){M[0]=R;for(let G=1;G<N;G++)M[G]=n[g++]}i.push({type:S,payloadType:l,pts:e,bytes:M})}}}}}else if(l===5&&c>16){const p=[];for(let S=0;S<16;S++){const R=n[g++].toString(16);p.push(R.length==1?"0"+R:R),(S===3||S===5||S===7||S===9)&&p.push("-")}const E=c-16,T=new Uint8Array(E);for(let S=0;S<E;S++)T[S]=n[g++];i.push({payloadType:l,pts:e,uuid:p.join(""),userData:qi(T),userDataBytes:T})}}}function cA(r){const t=r.byteLength,e=[];let i=1;for(;i<t-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(e.push(i+2),i+=2):i++;if(e.length===0)return r;const n=t-e.length,a=new Uint8Array(n);let l=0;for(i=0;i<n;l++,i++)l===e[0]&&(l++,e.shift()),a[i]=r[l];return a}function TI(r){const t=r[0];let e="",i="",n=0,a=0,l=0,c=0,f=0,h=0;if(t===0){for(;Ye(r.subarray(h,h+1))!=="\0";)e+=Ye(r.subarray(h,h+1)),h+=1;for(e+=Ye(r.subarray(h,h+1)),h+=1;Ye(r.subarray(h,h+1))!=="\0";)i+=Ye(r.subarray(h,h+1)),h+=1;i+=Ye(r.subarray(h,h+1)),h+=1,n=Ct(r,12),a=Ct(r,16),c=Ct(r,20),f=Ct(r,24),h=28}else if(t===1){h+=4,n=Ct(r,h),h+=4;const p=Ct(r,h);h+=4;const E=Ct(r,h);for(h+=4,l=2**32*p+E,Xx(l)||(l=Number.MAX_SAFE_INTEGER,ie.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Ct(r,h),h+=4,f=Ct(r,h),h+=4;Ye(r.subarray(h,h+1))!=="\0";)e+=Ye(r.subarray(h,h+1)),h+=1;for(e+=Ye(r.subarray(h,h+1)),h+=1;Ye(r.subarray(h,h+1))!=="\0";)i+=Ye(r.subarray(h,h+1)),h+=1;i+=Ye(r.subarray(h,h+1)),h+=1}const g=r.subarray(h,r.byteLength);return{schemeIdUri:e,value:i,timeScale:n,presentationTime:l,presentationTimeDelta:a,eventDuration:c,id:f,payload:g}}function SI(r,...t){const e=t.length;let i=8,n=e;for(;n--;)i+=t[n].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(r,4),n=0,i=8;n<e;n++)a.set(t[n],i),i+=t[n].byteLength;return a}function AI(r,t,e){if(r.byteLength!==16)throw new RangeError("Invalid system id");let i,n;i=0,n=new Uint8Array;let a;i>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;const l=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(l.buffer).setUint32(0,e.byteLength,!1),SI([112,115,115,104],new Uint8Array([i,0,0,0]),r,a,n,l,e||new Uint8Array)}function _I(r){const t=[];if(r instanceof ArrayBuffer){const e=r.byteLength;let i=0;for(;i+32<e;){const n=new DataView(r,i),a=RI(n);t.push(a),i+=a.size}}return t}function RI(r){const t=r.getUint32(0),e=r.byteOffset,i=r.byteLength;if(i<t)return{offset:e,size:i};if(r.getUint32(4)!==1886614376)return{offset:e,size:t};const a=r.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:e,size:t};const l=r.buffer,c=jn.hexDump(new Uint8Array(l,e+12,16)),f=r.getUint32(28);let h=null,g=null;if(a===0){if(t-32<f||f<22)return{offset:e,size:t};g=new Uint8Array(l,e+32,f)}else if(a===1){if(!f||i<e+32+f*16+16)return{offset:e,size:t};h=[];for(let p=0;p<f;p++)h.push(new Uint8Array(l,e+32+p*16,16))}return{version:a,systemId:c,kids:h,data:g,offset:e,size:t}}const hA=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Uo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function fA(r,t){const e=Uo[t];return!!e&&!!e[r.slice(0,4)]}function pm(r,t,e=!0){return!r.split(",").some(i=>!dA(i,t,e))}function dA(r,t,e=!0){var i;const n=Rr(e);return(i=n?.isTypeSupported(Su(r,t)))!=null?i:!1}function Su(r,t){return`${t}/mp4;codecs=${r}`}function Cv(r){if(r){const t=r.substring(0,4);return Uo.video[t]}return 2}function qh(r){const t=hA();return r.split(",").reduce((e,i)=>{const a=t&&Ef(i)?9:Uo.video[i];return a?(a*2+e)/(e?3:2):(Uo.audio[i]+e)/(e?2:1)},0)}const Vg={};function bI(r,t=!0){if(Vg[r])return Vg[r];const e={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let n=0;n<e.length;n++){var i;if(dA(e[n],"audio",t))return Vg[r]=e[n],e[n];if(e[n]==="mp3"&&(i=Rr(t))!=null&&i.isTypeSupported("audio/mpeg"))return""}return r}const xI=/flac|opus|mp4a\.40\.34/i;function jh(r,t=!0){return r.replace(xI,e=>bI(e.toLowerCase(),t))}function II(r,t){const e=[];if(r){const i=r.split(",");for(let n=0;n<i.length;n++)fA(i[n],"video")||e.push(i[n])}return t&&e.push(t),e.join(",")}function wh(r,t){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1))return r;if(t){const e=t.split(",");if(e.length>1){if(r){for(let i=e.length;i--;)if(e[i].substring(0,4)===r.substring(0,4))return e[i]}return e[0]}}return t||r}function LI(r){const t=r.split(",");for(let e=0;e<t.length;e++){const i=t[e].split(".");i.length>2&&i[0]==="avc1"&&(t[e]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return t.join(",")}function DI(r){if(r.startsWith("av01.")){const t=r.split("."),e=["0","111","01","01","01","0"];for(let i=t.length;i>4&&i<10;i++)t[i]=e[i-4];return t.join(".")}return r}function wv(r){const t=Rr(r)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function gA(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const mA={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function pA(r,t){return{supported:!1,configurations:t,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:r}}const Ov={};function CI(r,t,e,i,n,a){const l=r.audioCodec?r.audioGroups:null,c=a?.audioCodec,f=a?.channels,h=f?parseInt(f):c?1/0:2;let g=null;if(l!=null&&l.length)try{l.length===1&&l[0]?g=t.groups[l[0]].channels:g=l.reduce((p,E)=>{if(E){const T=t.groups[E];if(!T)throw new Error(`Audio track group ${E} not found`);Object.keys(T.channels).forEach(S=>{p[S]=(p[S]||0)+T.channels[S]})}return p},{2:0})}catch{return!0}return r.videoCodec!==void 0&&(r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(i,30)||r.videoRange!=="SDR"&&r.videoRange!==e||r.bitrate>Math.max(n,8e6))||!!g&&vt(h)&&Object.keys(g).some(p=>parseInt(p)>h)}function yA(r,t,e){const i=r.videoCodec,n=r.audioCodec;if(!i&&!n||!e)return Promise.resolve(mA);const a=[];if(i){const l={width:r.width,height:r.height,bitrate:Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)),framerate:r.frameRate||30},c=r.videoRange;c!=="SDR"&&(l.transferFunction=c.toLowerCase());const f=i.split(","),h=navigator.userAgent;if(f.some(g=>Ef(g))&&hA())return Promise.resolve(pA(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${h})`),a));a.push.apply(a,f.map(g=>({type:"media-source",video:re(re({},l),{},{contentType:Su(DI(g),"video")})})))}return n&&r.audioGroups&&r.audioGroups.forEach(l=>{var c;l&&((c=t.groups[l])==null||c.tracks.forEach(f=>{if(f.groupId===l){const h=f.channels||"",g=parseFloat(h);vt(g)&&g>2&&a.push.apply(a,n.split(",").map(p=>({type:"media-source",audio:{contentType:Su(p,"audio"),channels:""+g}})))}}))}),Promise.all(a.map(l=>{const c=wI(l);return Ov[c]||(Ov[c]=e.decodingInfo(l))})).then(l=>({supported:!l.some(c=>!c.supported),configurations:a,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:a,decodingInfoResults:[],error:l}))}function wI(r){const{audio:t,video:e}=r,i=e||t;if(i){const n=gA(i.contentType);if(e)return`r${e.height}x${e.width}f${Math.ceil(e.framerate)}${e.transferFunction||"sd"}_${n}_${Math.ceil(e.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${n}`}return""}const ym=["NONE","TYPE-0","TYPE-1",null];function OI(r){return ym.indexOf(r)>-1}const Yh=["SDR","PQ","HLG"];function PI(r){return!!r&&Yh.indexOf(r)>-1}var Oh={No:"",Yes:"YES",v2:"v2"};function Pv(r){const{canSkipUntil:t,canSkipDateRanges:e,age:i}=r,n=i<t/2;return t&&n?e?Oh.v2:Oh.Yes:Oh.No}class Mv{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Au{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const i=(e=t.supplemental)==null?void 0:e.videoCodec;i&&i!==t.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return kv(this._audioGroups,t)}hasSubtitleGroup(t){return kv(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e){if(t==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(e)===-1&&i.push(e)}else if(t==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(e)===-1&&i.push(e)}}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return(t=this.audioGroups)==null?void 0:t[0]}get textGroupId(){var t;return(t=this.subtitleGroups)==null?void 0:t[0]}addFallback(){}}function kv(r,t){return!t||!r?!1:r.indexOf(t)!==-1}function MI(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(r.media!==t.media)return r.matches===!0}return!1}function kI(r,t){let e=!1,i=[];if(r&&(e=r!=="SDR",i=[r]),t){i=t.allowedVideoRanges||Yh.slice(0);const n=i.join("")!=="SDR"&&!t.videoCodec;e=t.preferHDR!==void 0?t.preferHDR:n&&MI(),e||(i=["SDR"])}return{preferHDR:e,allowedVideoRanges:i}}const NI=r=>{const t=new WeakSet;return(e,i)=>{if(r&&(i=r(e,i)),typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}},Re=(r,t)=>JSON.stringify(r,NI(t));function FI(r,t,e,i,n){const a=Object.keys(r),l=i?.channels,c=i?.audioCodec,f=n?.videoCodec,h=l&&parseInt(l)===2;let g=!1,p=!1,E=1/0,T=1/0,S=1/0,R=1/0,_=0,D=[];const{preferHDR:N,allowedVideoRanges:M}=kI(t,n);for(let L=a.length;L--;){const O=r[a[L]];g||(g=O.channels[2]>0),E=Math.min(E,O.minHeight),T=Math.min(T,O.minFramerate),S=Math.min(S,O.minBitrate),M.filter(U=>O.videoRanges[U]>0).length>0&&(p=!0)}E=vt(E)?E:0,T=vt(T)?T:0;const G=Math.max(1080,E),$=Math.max(30,T);S=vt(S)?S:e,e=Math.max(S,e),p||(t=void 0);const q=a.length>1;return{codecSet:a.reduce((L,O)=>{const C=r[O];if(O===L)return L;if(D=p?M.filter(U=>C.videoRanges[U]>0):[],q){if(C.minBitrate>e)return zn(O,`min bitrate of ${C.minBitrate} > current estimate of ${e}`),L;if(!C.hasDefaultAudio)return zn(O,"no renditions with default or auto-select sound found"),L;if(c&&O.indexOf(c.substring(0,4))%5!==0)return zn(O,`audio codec preference "${c}" not found`),L;if(l&&!h){if(!C.channels[l])return zn(O,`no renditions with ${l} channel sound found (channels options: ${Object.keys(C.channels)})`),L}else if((!c||h)&&g&&C.channels[2]===0)return zn(O,"no renditions with stereo sound found"),L;if(C.minHeight>G)return zn(O,`min resolution of ${C.minHeight} > maximum of ${G}`),L;if(C.minFramerate>$)return zn(O,`min framerate of ${C.minFramerate} > maximum of ${$}`),L;if(!D.some(U=>C.videoRanges[U]>0))return zn(O,`no variants with VIDEO-RANGE of ${Re(D)} found`),L;if(f&&O.indexOf(f.substring(0,4))%5!==0)return zn(O,`video codec preference "${f}" not found`),L;if(C.maxScore<_)return zn(O,`max score of ${C.maxScore} < selected max of ${_}`),L}return L&&(qh(O)>=qh(L)||C.fragmentError>r[L].fragmentError)?L:(R=C.minIndex,_=C.maxScore,O)},void 0),videoRanges:D,preferHDR:N,minFramerate:T,minBitrate:S,minIndex:R}}function zn(r,t){ie.log(`[abr] start candidates with "${r}" ignored because ${t}`)}function EA(r){return r.reduce((t,e)=>{let i=t.groups[e.groupId];i||(i=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(e);const n=e.channels||"2";return i.channels[n]=(i.channels[n]||0)+1,i.hasDefault=i.hasDefault||e.default,i.hasAutoSelect=i.hasAutoSelect||e.autoselect,i.hasDefault&&(t.hasDefaultAudio=!0),i.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function UI(r,t,e,i){return r.slice(e,i+1).reduce((n,a,l)=>{if(!a.codecSet)return n;const c=a.audioGroups;let f=n[a.codecSet];f||(n[a.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,a.bitrate);const h=Math.min(a.height,a.width);return f.minHeight=Math.min(f.minHeight,h),f.minFramerate=Math.min(f.minFramerate,a.frameRate),f.minIndex=Math.min(f.minIndex,l),f.maxScore=Math.max(f.maxScore,a.score),f.fragmentError+=a.fragmentError,f.videoRanges[a.videoRange]=(f.videoRanges[a.videoRange]||0)+1,c&&c.forEach(g=>{if(!g)return;const p=t.groups[g];p&&(f.hasDefaultAudio=f.hasDefaultAudio||t.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(p.channels).forEach(E=>{f.channels[E]=(f.channels[E]||0)+p.channels[E]}))}),n},{})}function Nv(r){if(!r)return r;const{lang:t,assocLang:e,characteristics:i,channels:n,audioCodec:a}=r;return{lang:t,assocLang:e,characteristics:i,channels:n,audioCodec:a}}function Xn(r,t,e){if("attrs"in r){const i=t.indexOf(r);if(i!==-1)return i}for(let i=0;i<t.length;i++){const n=t[i];if(Ea(r,n,e))return i}return-1}function Ea(r,t,e){const{groupId:i,name:n,lang:a,assocLang:l,default:c}=r,f=r.forced;return(i===void 0||t.groupId===i)&&(n===void 0||t.name===n)&&(a===void 0||BI(a,t.lang))&&(a===void 0||t.assocLang===l)&&(c===void 0||t.default===c)&&(f===void 0||t.forced===f)&&(!("characteristics"in r)||VI(r.characteristics||"",t.characteristics))&&(e===void 0||e(r,t))}function BI(r,t="--"){return r.length===t.length?r===t:r.startsWith(t)||t.startsWith(r)}function VI(r,t=""){const e=r.split(","),i=t.split(",");return e.length===i.length&&!e.some(n=>i.indexOf(n)===-1)}function ma(r,t){const{audioCodec:e,channels:i}=r;return(e===void 0||(t.audioCodec||"").substring(0,4)===e.substring(0,4))&&(i===void 0||i===(t.channels||"2"))}function GI(r,t,e,i,n){const a=t[i],c=t.reduce((E,T,S)=>{const R=T.uri;return(E[R]||(E[R]=[])).push(S),E},{})[a.uri];c.length>1&&(i=Math.max.apply(Math,c));const f=a.videoRange,h=a.frameRate,g=a.codecSet.substring(0,4),p=Fv(t,i,E=>{if(E.videoRange!==f||E.frameRate!==h||E.codecSet.substring(0,4)!==g)return!1;const T=E.audioGroups,S=e.filter(R=>!T||T.indexOf(R.groupId)!==-1);return Xn(r,S,n)>-1});return p>-1?p:Fv(t,i,E=>{const T=E.audioGroups,S=e.filter(R=>!T||T.indexOf(R.groupId)!==-1);return Xn(r,S,n)>-1})}function Fv(r,t,e){for(let i=t;i>-1;i--)if(e(r[i]))return i;for(let i=t+1;i<r.length;i++)if(e(r[i]))return i;return-1}function Qh(r,t){var e;return!!r&&r!==((e=t.loadLevelObj)==null?void 0:e.uri)}class $I extends Vs{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var i;const{fragCurrent:n,partCurrent:a,hls:l}=this,{autoLevelEnabled:c,media:f}=l;if(!n||!f)return;const h=performance.now(),g=a?a.stats:n.stats,p=a?a.duration:n.duration,E=h-g.loading.start,T=l.minAutoLevel,S=n.level,R=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||S<=T){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const _=R>-1&&R!==S,D=!!e||_;if(!D&&(f.paused||!f.playbackRate||!f.readyState))return;const N=l.mainForwardBufferInfo;if(!D&&N===null)return;const M=this.bwEstimator.getEstimateTTFB(),G=Math.abs(f.playbackRate);if(E<=Math.max(M,1e3*(p/(G*2))))return;const $=N?N.len/G:0,q=g.loading.first?g.loading.first-g.loading.start:-1,w=g.loaded&&q>-1,L=this.getBwEstimate(),O=l.levels,C=O[S],U=Math.max(g.loaded,Math.round(p*(n.bitrate||C.averageBitrate)/8));let V=w?E-q:E;V<1&&w&&(V=Math.min(E,g.loaded*8/L));const B=w?g.loaded*1e3/V:0,pt=M/1e3,gt=B?(U-g.loaded)/B:U*8/L+pt;if(gt<=$)return;const K=B?B*8:L,it=((i=e?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,ct=this.hls.config.abrBandWidthUpFactor;let rt=Number.POSITIVE_INFINITY,F;for(F=S-1;F>T;F--){const mt=O[F].maxBitrate,Tt=!O[F].details||it;if(rt=this.getTimeToLoadFrag(pt,K,p*mt,Tt),rt<Math.min($,p+pt))break}if(rt>=gt||rt>p*10)return;w?this.bwEstimator.sample(E-Math.min(M,q),g.loaded):this.bwEstimator.sampleTTFB(E);const tt=O[F].maxBitrate;this.getBwEstimate()*ct>tt&&this.resetEstimator(tt);const at=this.findBestLevel(tt,T,F,0,$,1,1);at>-1&&(F=at),this.warn(`Fragment ${n.sn}${a?" part "+a.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${$.toFixed(3)} s
      Estimated load time for current fragment: ${gt.toFixed(3)} s
      Estimated load time for down switch fragment: ${rt.toFixed(3)} s
      TTFB estimate: ${q|0} ms
      Current BW estimate: ${vt(L)?L|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${F} @ ${tt|0} bps`),l.nextLoadLevel=l.nextAutoLevel=F,this.clearTimer();const st=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===F&&F>0){const mt=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${F>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${mt.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,F>T){let Tt=this.findBestLevel(this.hls.levels[T].bitrate,T,F,0,mt,1,1);Tt===-1&&(Tt=T),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Tt,this.resetEstimator(this.hls.levels[Tt].bitrate)}}};_||gt>rt*2?st():this.timer=self.setInterval(st,rt*1e3),l.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:a,stats:g})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new Zx(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.FRAG_LOADING,this.onFragLoading,this),t.on(b.FRAG_LOADED,this.onFragLoaded,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this),t.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.FRAG_LOADING,this.onFragLoading,this),t.off(b.FRAG_LOADED,this.onFragLoaded,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this),t.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const i=e.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var n;this.fragCurrent=i,this.partCurrent=(n=e.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case W.FRAG_LOAD_TIMEOUT:{const i=e.frag,{fragCurrent:n,partCurrent:a}=this;if(i&&n&&i.sn===n.sn&&i.level===n.level){const l=performance.now(),c=a?a.stats:i.stats,f=l-c.loading.start,h=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&h>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(p,h),c.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(t,e,i,n){const a=t+i/e,l=n?t+this.lastLevelLoadSec:0;return a+l}onLevelLoaded(t,e){const i=this.hls.config,{loading:n}=e.stats,a=n.end-n.first;vt(a)&&(this.lastLevelLoadSec=a/1e3),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,{frag:e,part:i}){const n=i?i.stats:e.stats;if(e.type===Rt.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=i?i.duration:e.duration,l=this.hls.levels[e.level],c=(l.loaded?l.loaded.bytes:0)+n.loaded,f=(l.loaded?l.loaded.duration:0)+a;l.loaded={bytes:c,duration:f},l.realBitrate=Math.round(8*c/f)}if(e.bitrateTest){const a={stats:n,frag:e,part:i,id:e.type};this.onFragBuffered(b.FRAG_BUFFERED,a),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:i,part:n}=e,a=n!=null&&n.stats.loaded?n.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;const l=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,a.loaded),a.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==Rt.MAIN||t.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,i=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,a=this.findBestLevel(i,e,t,0,n,1,1);if(a>-1)return a;const l=this.hls.firstLevel,c=Math.min(Math.max(l,e),t);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(t!==-1&&(!i||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return t;const a=i&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){const l=this.hls.levels;if(l.length>Math.max(t,a)&&l[t].loadError<=l[a].loadError)return t}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:n,config:a,minAutoLevel:l}=i,c=e?e.duration:t?t.duration:0,f=this.getBwEstimate(),h=this.getStarvationDelay();let g=a.abrBandWidthFactor,p=a.abrBandWidthUpFactor;if(h){const _=this.findBestLevel(f,l,n,h,0,g,p);if(_>=0)return this.rebufferNotice=-1,_}let E=c?Math.min(c,a.maxStarvationDelay):a.maxStarvationDelay;if(!h){const _=this.bitrateTestDelay;_&&(E=(c?Math.min(c,a.maxLoadingDelay):a.maxLoadingDelay)-_,this.info(`bitrate test took ${Math.round(1e3*_)}ms, set first fragment max fetchDuration to ${Math.round(1e3*E)} ms`),g=p=1)}const T=this.findBestLevel(f,l,n,h,E,g,p);if(this.rebufferNotice!==T&&(this.rebufferNotice=T,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${T}`)),T>-1)return T;const S=i.levels[l],R=i.loadLevelObj;return R&&S?.bitrate<R.bitrate?l:i.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const i=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,n=t.mainForwardBufferInfo;return(n?n.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,i,n,a,l,c){var f;const h=n+a,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:E,partCurrent:T}=this,{levels:S,allAudioTracks:R,loadLevel:_,config:D}=this.hls;if(S.length===1)return 0;const N=S[p],M=!!((f=this.hls.latestLevelDetails)!=null&&f.live),G=_===-1||g===-1;let $,q="SDR",w=N?.frameRate||0;const{audioPreference:L,videoPreference:O}=D,C=this.audioTracksByGroup||(this.audioTracksByGroup=EA(R));let U=-1;if(G){if(this.firstSelection!==-1)return this.firstSelection;const K=this.codecTiers||(this.codecTiers=UI(S,C,e,i)),it=FI(K,q,t,L,O),{codecSet:ct,videoRanges:rt,minFramerate:F,minBitrate:tt,minIndex:at,preferHDR:st}=it;U=at,$=ct,q=st?rt[rt.length-1]:rt[0],w=F,t=Math.max(t,tt),this.log(`picked start tier ${Re(it)}`)}else $=N?.codecSet,q=N?.videoRange;const V=T?T.duration:E?E.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,pt=[];for(let K=i;K>=e;K--){var gt;const it=S[K],ct=K>p;if(!it)continue;if(D.useMediaCapabilities&&!it.supportedResult&&!it.supportedPromise){const Tt=navigator.mediaCapabilities;typeof Tt?.decodingInfo=="function"&&(CI(it,C,q,w,t,L)||Ef(it.videoCodec))?(it.supportedPromise=yA(it,C,Tt),it.supportedPromise.then(Et=>{if(!this.hls)return;it.supportedResult=Et;const Yt=this.hls.levels,Ut=Yt.indexOf(it);Et.error?this.warn(`MediaCapabilities decodingInfo error: "${Et.error}" for level ${Ut} ${Re(Et)}`):Et.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ut} ${Re(Et)}`),Ut>-1&&Yt.length>1&&(this.log(`Removing unsupported level ${Ut}`),this.hls.removeLevel(Ut),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):it.supportedResult=mA}if(($&&it.codecSet!==$||q&&it.videoRange!==q||ct&&w>it.frameRate||!ct&&w>0&&w<it.frameRate||it.supportedResult&&!((gt=it.supportedResult.decodingInfoResults)!=null&&gt[0].smooth))&&(!G||K!==U)){pt.push(K);continue}const rt=it.details,F=(T?rt?.partTarget:rt?.averagetargetduration)||V;let tt;ct?tt=c*t:tt=l*t;const at=V&&n>=V*2&&a===0?it.averageBitrate:it.maxBitrate,st=this.getTimeToLoadFrag(B,tt,at*F,rt===void 0);if(tt>=at&&(K===g||it.loadError===0&&it.fragmentError===0)&&(st<=B||!vt(st)||M&&!this.bitrateTestDelay||st<h)){const Tt=this.forcedAutoLevel;return K!==_&&(Tt===-1||Tt!==_)&&(pt.length&&this.trace(`Skipped level(s) ${pt.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${S[pt[0]].codecs}" ${S[pt[0]].videoRange}; not compatible with "${$}" ${q}`),this.info(`switch candidate:${p}->${K} adjustedbw(${Math.round(tt)})-bitrate=${Math.round(tt-at)} ttfb:${B.toFixed(1)} avgDuration:${F.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${st.toFixed(1)} firstSelection:${G} codecSet:${it.codecSet} videoRange:${it.videoRange} hls.loadLevel:${_}`)),G&&(this.firstSelection=K),K}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:i}=this.hls;return Math.min(Math.max(t,i),e)}}const vA={search:function(r,t){let e=0,i=r.length-1,n=null,a=null;for(;e<=i;){n=(e+i)/2|0,a=r[n];const l=t(a);if(l>0)e=n+1;else if(l<0)i=n-1;else return a}return null}};function HI(r,t,e){if(t===null||!Array.isArray(r)||!r.length||!vt(t))return null;const i=r[0].programDateTime;if(t<(i||0))return null;const n=r[r.length-1].endProgramDateTime;if(t>=(n||0))return null;for(let a=0;a<r.length;++a){const l=r[a];if(zI(t,e,l))return l}return null}function Sa(r,t,e=0,i=0,n=.005){let a=null;if(r){a=t[1+r.sn-t[0].sn]||null;const c=r.endDTS-e;c>0&&c<15e-7&&(e+=15e-7),a&&r.level!==a.level&&a.end<=r.end&&(a=t[2+r.sn-t[0].sn]||null)}else e===0&&t[0].start===0&&(a=t[0]);if(a&&((!r||r.level===a.level)&&Uv(e,i,a)===0||KI(a,r,Math.min(n,i))))return a;const l=vA.search(t,Uv.bind(null,e,i));return l&&(l!==r||!a)?l:a}function KI(r,t,e){if(t&&t.start===0&&t.level<r.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((n,a)=>(a[0]==="INF"&&(n+=parseFloat(a[1])),n),e);return r.start<=i}return!1}function Uv(r=0,t=0,e){if(e.start<=r&&e.start+e.duration>r)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=r?1:e.start-i>r&&e.start?-1:0}function zI(r,t,e){const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-i>r}function TA(r,t,e){if(r&&r.startCC<=t&&r.endCC>=t){let i=r.fragments;const{fragmentHint:n}=r;n&&(i=i.concat(n));let a;return vA.search(i,l=>l.cc<t?1:l.cc>t?-1:(a=l,l.end<=e?1:l.start>e?-1:0)),a||null}return null}function Xh(r){switch(r.details){case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_TIMEOUT:case W.LEVEL_LOAD_TIMEOUT:case W.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Bv(r,t){const e=Xh(t);return r.default[`${e?"timeout":"error"}Retry`]}function np(r,t){const e=r.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*r.retryDelayMs,r.maxRetryDelayMs)}function Vv(r){return re(re({},r),{errorRetry:null,timeoutRetry:null})}function Wh(r,t,e,i){if(!r)return!1;const n=i?.code,a=t<r.maxNumRetry&&(qI(n)||!!e);return r.shouldRetry?r.shouldRetry(r,t,e,i,a):a}function qI(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}var Ti={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},bn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class jI extends Vs{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(b.ERROR,this.onError,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(b.ERROR,this.onError,this),t.off(b.ERROR,this.onErrorOut,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return t?.type===Rt.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var i;if(e.fatal)return;const n=this.hls,a=e.context;switch(e.details){case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case W.FRAG_PARSING_ERROR:if((i=e.frag)!=null&&i.gap){e.errorAction=_u();return}case W.FRAG_GAP:case W.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=Ti.SendAlternateToPenaltyBox;return}case W.LEVEL_EMPTY_ERROR:case W.LEVEL_PARSING_ERROR:{var l,c;const h=e.parent===Rt.MAIN?e.level:n.loadLevel;e.details===W.LEVEL_EMPTY_ERROR&&((l=e.context)!=null&&(c=l.levelDetails)!=null&&c.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,h):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,h))}return;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:typeof a?.level=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,a.level));return;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.SUBTITLE_LOAD_ERROR:case W.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=n.loadLevelObj;if(h&&(a.type===Ht.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===Ht.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,n.loadLevel),e.errorAction.action=Ti.SendAlternateToPenaltyBox,e.errorAction.flags=bn.MoveAllAlternatesMatchingHost;return}}return;case W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const h=n.loadLevelObj,g=h?.attrs["HDCP-LEVEL"];g?e.errorAction={action:Ti.SendAlternateToPenaltyBox,flags:bn.MoveAllAlternatesMatchingHDCP,hdcpLevel:g}:this.keySystemError(e)}return;case W.BUFFER_ADD_CODEC_ERROR:case W.REMUX_ALLOC_ERROR:case W.BUFFER_APPEND_ERROR:if(!e.errorAction){var f;e.errorAction=this.getLevelSwitchAction(e,(f=e.level)!=null?f:n.loadLevel)}return;case W.INTERNAL_EXCEPTION:case W.BUFFER_APPENDING_ERROR:case W.BUFFER_FULL_ERROR:case W.LEVEL_SWITCH_ERROR:case W.BUFFER_STALLED_ERROR:case W.BUFFER_SEEK_OVER_HOLE:case W.BUFFER_NUDGE_ON_STALL:e.errorAction=_u();return}e.type===bt.KEY_SYSTEM_ERROR&&this.keySystemError(e)}keySystemError(t){const e=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e)}getPlaylistRetryOrSwitchAction(t,e){const i=this.hls,n=Bv(i.config.playlistLoadPolicy,t),a=this.playlistError++;if(Wh(n,a,Xh(t),t.response))return{action:Ti.RetryRequest,flags:bn.None,retryConfig:n,retryCount:a};const c=this.getLevelSwitchAction(t,e);return n&&(c.retryConfig=n,c.retryCount=a),c}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),n=e.levels[i],{fragLoadPolicy:a,keyLoadPolicy:l}=e.config,c=Bv(t.details.startsWith("key")?l:a,t),f=e.levels.reduce((g,p)=>g+p.fragmentError,0);if(n&&(t.details!==W.FRAG_GAP&&n.fragmentError++,Wh(c,f,Xh(t),t.response)))return{action:Ti.RetryRequest,flags:bn.None,retryConfig:c,retryCount:f};const h=this.getLevelSwitchAction(t,i);return c&&(h.retryConfig=c,h.retryCount=f),h}getLevelSwitchAction(t,e){const i=this.hls;e==null&&(e=i.loadLevel);const n=this.hls.levels[e];if(n){var a,l;const h=t.details;n.loadError++,h===W.BUFFER_APPEND_ERROR&&n.fragmentError++;let g=-1;const{levels:p,loadLevel:E,minAutoLevel:T,maxAutoLevel:S}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const R=(a=t.frag)==null?void 0:a.type,D=(R===Rt.AUDIO&&h===W.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(h===W.BUFFER_ADD_CODEC_ERROR||h===W.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:q})=>n.audioCodec!==q),M=t.sourceBufferName==="video"&&(h===W.BUFFER_ADD_CODEC_ERROR||h===W.BUFFER_APPEND_ERROR)&&p.some(({codecSet:q,audioCodec:w})=>n.codecSet!==q&&n.audioCodec===w),{type:G,groupId:$}=(l=t.context)!=null?l:{};for(let q=p.length;q--;){const w=(q+E)%p.length;if(w!==E&&w>=T&&w<=S&&p[w].loadError===0){var c,f;const L=p[w];if(h===W.FRAG_GAP&&R===Rt.MAIN&&t.frag){const O=p[w].details;if(O){const C=Sa(t.frag,O.fragments,t.frag.start);if(C!=null&&C.gap)continue}}else{if(G===Ht.AUDIO_TRACK&&L.hasAudioGroup($)||G===Ht.SUBTITLE_TRACK&&L.hasSubtitleGroup($))continue;if(R===Rt.AUDIO&&(c=n.audioGroups)!=null&&c.some(O=>L.hasAudioGroup(O))||R===Rt.SUBTITLE&&(f=n.subtitleGroups)!=null&&f.some(O=>L.hasSubtitleGroup(O))||D&&n.audioCodec===L.audioCodec||!D&&n.audioCodec!==L.audioCodec||M&&n.codecSet===L.codecSet)continue}g=w;break}}if(g>-1&&i.loadLevel!==g)return t.levelRetry=!0,this.playlistError=0,{action:Ti.SendAlternateToPenaltyBox,flags:bn.None,nextAutoLevel:g}}return{action:Ti.SendAlternateToPenaltyBox,flags:bn.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case Ti.DoNothing:break;case Ti.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==W.FRAG_GAP?e.fatal=!0:/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:n,hdcpLevel:a,nextAutoLevel:l}=i;switch(n){case bn.None:this.switchLevel(t,l);break;case bn.MoveAllAlternatesMatchingHDCP:a&&(e.maxHdcpLevel=ym[ym.indexOf(a)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(t,l)}switchLevel(t,e){if(e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===W.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo")){const i=gA(t.mimeType),n=this.hls.levels;for(let a=n.length;a--;)n[a][`${t.sourceBufferName}Codec`]===i&&this.hls.removeLevel(a)}}}function _u(r){const t={action:Ti.DoNothing,flags:bn.None};return r&&(t.resolved=!0),t}var Qe={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class YI{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.BUFFER_APPENDED,this.onBufferAppended,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this),t.on(b.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.BUFFER_APPENDED,this.onBufferAppended,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this),t.off(b.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let n=i.length;n--;){const a=i[n];if(!a)break;const l=a.end;if(a.start<=t&&l!==null&&t<=l)return a}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,i){const{fragments:n}=this,a=Object.keys(n);for(let l=a.length;l--;){const c=n[a[l]];if(c?.body.type===e&&(!i||c.buffered)){const f=c.body;if(f.start<=t&&t<=f.end)return f}}return null}detectEvictedFragments(t,e,i,n,a){this.timeRanges&&(this.timeRanges[t]=e);const l=n?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const f=this.fragments[c];if(!f||l>=f.body.sn)return;if(!f.buffered&&(!f.loaded||a)){f.body.type===i&&this.removeFragment(f.body);return}const h=f.range[t];if(h){if(h.time.length===0){this.removeFragment(f.body);return}h.time.some(g=>{const p=!this.isTimeBuffered(g.startPTS,g.endPTS,e);return p&&this.removeFragment(f.body),p})}})}detectPartialFragments(t){const e=this.timeRanges;if(!e||t.frag.sn==="initSegment")return;const i=t.frag,n=_o(i),a=this.fragments[n];if(!a||a.buffered&&i.gap)return;const l=!i.relurl;Object.keys(e).forEach(c=>{const f=i.elementaryStreams[c];if(!f)return;const h=e[c],g=l||f.partial===!0;a.range[c]=this.getBufferedTimes(i,t.part,g,h)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=i.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),dh(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}removeParts(t,e){const i=this.activePartLists[e];i&&(this.activePartLists[e]=Gv(i,n=>n.fragment.sn>=t))}fragBuffered(t,e){const i=_o(t);let n=this.fragments[i];!n&&e&&(n=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(t,e,i,n){const a={time:[],partial:i},l=t.start,c=t.end,f=t.minEndPTS||c,h=t.maxStartPTS||l;for(let g=0;g<n.length;g++){const p=n.start(g)-this.bufferPadding,E=n.end(g)+this.bufferPadding;if(h>=p&&f<=E){a.time.push({startPTS:Math.max(l,n.start(g)),endPTS:Math.min(c,n.end(g))});break}else if(l<E&&c>p){const T=Math.max(l,n.start(g)),S=Math.min(c,n.end(g));S>T&&(a.partial=!0,a.time.push({startPTS:T,endPTS:S}))}else if(c<=p)break}return a}getPartialFragment(t){let e=null,i,n,a,l=0;const{bufferPadding:c,fragments:f}=this;return Object.keys(f).forEach(h=>{const g=f[h];g&&dh(g)&&(n=g.body.start-c,a=g.body.end+c,t>=n&&t<=a&&(i=Math.min(t-n,a-t),l<=i&&(e=g.body,l=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||dh(e))}getState(t){const e=_o(t),i=this.fragments[e];return i?i.buffered?dh(i)?Qe.PARTIAL:Qe.OK:Qe.APPENDING:Qe.NOT_LOADED}isTimeBuffered(t,e,i){let n,a;for(let l=0;l<i.length;l++){if(n=i.start(l)-this.bufferPadding,a=i.end(l)+this.bufferPadding,t>=n&&e<=a)return!0;if(e<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if(e.frag.sn==="initSegment"||e.frag.bitrateTest)return;const i=e.frag,n=e.part?null:e,a=_o(i);this.fragments[a]={body:i,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:n,timeRanges:a,type:l}=e;if(i.sn==="initSegment")return;const c=i.type;if(n){let h=this.activePartLists[c];h||(this.activePartLists[c]=h=[]),h.push(n)}this.timeRanges=a;const f=a[l];this.detectEvictedFragments(l,f,c,n)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=_o(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,i=Object.keys(e);if(!t)return i.length>0;for(let n=i.length;n--;){const a=e[i[n]];if(a?.body.type===t)return!0}return!1}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,i,n,a){n&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const f=c.body;f.type!==i||n&&!f.gap||f.start<e&&f.end>t&&(c.buffered||a)&&this.removeFragment(f)})}removeFragment(t){const e=_o(t);t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const n=t.sn;this.activePartLists[t.type]=Gv(i,a=>a.fragment.sn!==n)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t,e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(t=this.hls)==null||(e=t.latestLevelDetails)==null?void 0:e.partList;i&&i.forEach(n=>n.clearElementaryStreamInfo())}}function dh(r){var t,e,i;return r.buffered&&(r.body.gap||((t=r.range.video)==null?void 0:t.partial)||((e=r.range.audio)==null?void 0:e.partial)||((i=r.range.audiovideo)==null?void 0:i.partial))}function _o(r){return`${r.type}_${r.level}_${r.sn}`}function Gv(r,t){return r.filter(e=>{const i=t(e);return i||e.clearElementaryStreamInfo(),i})}var br={cbc:0,ctr:1};class QI{constructor(t,e,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=i}decrypt(t,e){switch(this.aesMode){case br.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case br.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function XI(r){const t=r.byteLength,e=t&&new DataView(r.buffer).getUint8(t-1);return e?r.slice(0,t-e):r}class WI{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let n=0;n<4;n++)i[n]=e.getUint32(n*4);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,n=i[0],a=i[1],l=i[2],c=i[3],f=this.invSubMix,h=f[0],g=f[1],p=f[2],E=f[3],T=new Uint32Array(256);let S=0,R=0,_=0;for(_=0;_<256;_++)_<128?T[_]=_<<1:T[_]=_<<1^283;for(_=0;_<256;_++){let D=R^R<<1^R<<2^R<<3^R<<4;D=D>>>8^D&255^99,t[S]=D,e[D]=S;const N=T[S],M=T[N],G=T[M];let $=T[D]*257^D*16843008;n[S]=$<<24|$>>>8,a[S]=$<<16|$>>>16,l[S]=$<<8|$>>>24,c[S]=$,$=G*16843009^M*65537^N*257^S*16843008,h[D]=$<<24|$>>>8,g[D]=$<<16|$>>>16,p[D]=$<<8|$>>>24,E[D]=$,S?(S=N^T[T[T[G^N]]],R^=T[T[R]]):S=R=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,n=0;for(;n<e.length&&i;)i=e[n]===this.key[n],n++;if(i)return;this.key=e;const a=this.keySize=e.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const l=this.ksRows=(a+6+1)*4;let c,f;const h=this.keySchedule=new Uint32Array(l),g=this.invKeySchedule=new Uint32Array(l),p=this.sBox,E=this.rcon,T=this.invSubMix,S=T[0],R=T[1],_=T[2],D=T[3];let N,M;for(c=0;c<l;c++){if(c<a){N=h[c]=e[c];continue}M=N,c%a===0?(M=M<<8|M>>>24,M=p[M>>>24]<<24|p[M>>>16&255]<<16|p[M>>>8&255]<<8|p[M&255],M^=E[c/a|0]<<24):a>6&&c%a===4&&(M=p[M>>>24]<<24|p[M>>>16&255]<<16|p[M>>>8&255]<<8|p[M&255]),h[c]=N=(h[c-a]^M)>>>0}for(f=0;f<l;f++)c=l-f,f&3?M=h[c]:M=h[c-4],f<4||c<=4?g[f]=M:g[f]=S[p[M>>>24]]^R[p[M>>>16&255]]^_[p[M>>>8&255]]^D[p[M&255]],g[f]=g[f]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,i){const n=this.keySize+6,a=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,f=c[0],h=c[1],g=c[2],p=c[3],E=this.uint8ArrayToUint32Array_(i);let T=E[0],S=E[1],R=E[2],_=E[3];const D=new Int32Array(t),N=new Int32Array(D.length);let M,G,$,q,w,L,O,C,U,V,B,pt,gt,K;const it=this.networkToHostOrderSwap;for(;e<D.length;){for(U=it(D[e]),V=it(D[e+1]),B=it(D[e+2]),pt=it(D[e+3]),w=U^a[0],L=pt^a[1],O=B^a[2],C=V^a[3],gt=4,K=1;K<n;K++)M=f[w>>>24]^h[L>>16&255]^g[O>>8&255]^p[C&255]^a[gt],G=f[L>>>24]^h[O>>16&255]^g[C>>8&255]^p[w&255]^a[gt+1],$=f[O>>>24]^h[C>>16&255]^g[w>>8&255]^p[L&255]^a[gt+2],q=f[C>>>24]^h[w>>16&255]^g[L>>8&255]^p[O&255]^a[gt+3],w=M,L=G,O=$,C=q,gt=gt+4;M=l[w>>>24]<<24^l[L>>16&255]<<16^l[O>>8&255]<<8^l[C&255]^a[gt],G=l[L>>>24]<<24^l[O>>16&255]<<16^l[C>>8&255]<<8^l[w&255]^a[gt+1],$=l[O>>>24]<<24^l[C>>16&255]<<16^l[w>>8&255]<<8^l[L&255]^a[gt+2],q=l[C>>>24]<<24^l[w>>16&255]<<16^l[L>>8&255]<<8^l[O&255]^a[gt+3],N[e]=it(M^T),N[e+1]=it(q^S),N[e+2]=it($^R),N[e+3]=it(G^_),T=U,S=V,R=B,_=pt,e=e+4}return N.buffer}}class ZI{constructor(t,e,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=i}expandKey(){const t=JI(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}function JI(r){switch(r){case br.cbc:return"AES-CBC";case br.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const t1=16;class sp{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?XI(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i,n){return this.useSoftware?new Promise((a,l)=>{const c=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(c,e,i,n);const f=this.flush();f?a(f.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i,n)}softwareDecrypt(t,e,i,n){const{currentIV:a,currentResult:l,remainderData:c}=this;if(n!==br.cbc||e.byteLength!==16)return ie.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(t=fn(c,t),this.remainderData=null);const f=this.getValidChunk(t);if(!f.length)return null;a&&(i=a);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new WI),h.expandKey(e);const g=l;return this.currentResult=h.decrypt(f.buffer,0,i),this.currentIV=f.slice(-16).buffer,g||null}webCryptoDecrypt(t,e,i,n){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,i,n));this.key=e,this.fastAesKey=new ZI(this.subtle,e,n)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new QI(this.subtle,new Uint8Array(i),n).decrypt(t.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(ie.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(t,e,i,n)))}onWebCryptoError(t,e,i,n){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i,n);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%t1;return i!==t.length&&(e=t.slice(0,i),this.remainderData=t.slice(i)),e}logOnce(t){this.logEnabled&&(ie.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const $v=Math.pow(2,17);class e1{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Ms({type:bt.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,a=n.fLoader,l=n.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),t.gap)if(t.tagList.some(S=>S[0]==="GAP")){f(Kv(t));return}else t.gap=!1;const h=this.loader=a?new a(n):new l(n),g=Hv(t);t.loader=h;const p=Vv(n.fragLoadPolicy.default),E={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:$v};t.stats=h.stats;const T={onSuccess:(S,R,_,D)=>{this.resetLoader(t,h);let N=S.data;_.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(N.slice(0,16)),N=N.slice(16)),c({frag:t,part:null,payload:N,networkDetails:D})},onError:(S,R,_,D)=>{this.resetLoader(t,h),f(new Ms({type:bt.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:re({url:i,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:_,stats:D}))},onAbort:(S,R,_)=>{this.resetLoader(t,h),f(new Ms({type:bt.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:_,stats:S}))},onTimeout:(S,R,_)=>{this.resetLoader(t,h),f(new Ms({type:bt.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${E.timeout}ms`),networkDetails:_,stats:S}))}};e&&(T.onProgress=(S,R,_,D)=>e({frag:t,part:null,payload:_,networkDetails:D})),h.load(g,E,T)})}loadPart(t,e,i){this.abort();const n=this.config,a=n.fLoader,l=n.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){f(Kv(t,e));return}const h=this.loader=a?new a(n):new l(n),g=Hv(t,e);t.loader=h;const p=Vv(n.fragLoadPolicy.default),E={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:$v};e.stats=h.stats,h.load(g,E,{onSuccess:(T,S,R,_)=>{this.resetLoader(t,h),this.updateStatsFromPart(t,e);const D={frag:t,part:e,payload:T.data,networkDetails:_};i(D),c(D)},onError:(T,S,R,_)=>{this.resetLoader(t,h),f(new Ms({type:bt.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:re({url:g.url,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:R,stats:_}))},onAbort:(T,S,R)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,h),f(new Ms({type:bt.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:R,stats:T}))},onTimeout:(T,S,R)=>{this.resetLoader(t,h),f(new Ms({type:bt.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${E.timeout}ms`),networkDetails:R,stats:T}))}})})}updateStatsFromPart(t,e){const i=t.stats,n=e.stats,a=n.total;if(i.loaded+=n.loaded,a){const f=Math.round(t.duration/e.duration),h=Math.min(Math.round(i.loaded/a),f),p=(f-h)*Math.round(i.loaded/h);i.total=i.loaded+p}else i.total=Math.max(i.loaded,i.total);const l=i.loading,c=n.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Hv(r,t=null){const e=t||r,i={frag:r,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},n=e.byteRangeStartOffset,a=e.byteRangeEndOffset;if(vt(n)&&vt(a)){var l;let c=n,f=a;if(r.sn==="initSegment"&&i1((l=r.decryptdata)==null?void 0:l.method)){const h=a-n;h%16&&(f=a+(16-h%16)),n!==0&&(i.resetIV=!0,c=n-16)}i.rangeStart=c,i.rangeEnd=f}return i}function Kv(r,t){const e=new Error(`GAP ${r.gap?"tag":"attribute"} found`),i={type:bt.MEDIA_ERROR,details:W.FRAG_GAP,fatal:!1,frag:r,error:e,networkDetails:null};return t&&(i.part=t),(t||r).stats.aborted=!0,new Ms(i)}function i1(r){return r==="AES-128"||r==="AES-256"}class Ms extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class SA extends Vs{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class rp{constructor(t,e,i,n=0,a=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=gh(),this.buffering={audio:gh(),video:gh(),audiovideo:gh()},this.level=t,this.sn=e,this.id=i,this.size=n,this.part=a,this.partial=l}}function gh(){return{start:0,executeStart:0,executeEnd:0,end:0}}const zv={length:0,start:()=>0,end:()=>0};class Pt{static isBuffered(t,e){if(t){const i=Pt.getBuffered(t);for(let n=i.length;n--;)if(e>=i.start(n)&&e<=i.end(n))return!0}return!1}static bufferedRanges(t){if(t){const e=Pt.getBuffered(t);return Pt.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e}static bufferInfo(t,e,i){if(t){const n=Pt.bufferedRanges(t);if(n.length)return Pt.bufferedInfo(n,e,i)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.length>1&&t.sort((g,p)=>g.start-p.start||p.end-g.end);let n=-1,a=[];if(i)for(let g=0;g<t.length;g++){e>=t[g].start&&e<=t[g].end&&(n=g);const p=a.length;if(p){const E=a[p-1].end;t[g].start-E<i?t[g].end>E&&(a[p-1].end=t[g].end):a.push(t[g])}else a.push(t[g])}else a=t;let l=0,c,f=e,h=e;for(let g=0;g<a.length;g++){const p=a[g].start,E=a[g].end;if(n===-1&&e>=p&&e<=E&&(n=g),e+i>=p&&e<E)f=p,h=E,l=h-e;else if(e+i<p){c=p;break}}return{len:l,start:f||0,end:h||0,nextStart:c,buffered:t,bufferedIndex:n}}static getBuffered(t){try{return t.buffered||zv}catch(e){return ie.log("failed to get media.buffered",e),zv}}}const AA=/\{\$([a-zA-Z0-9-_]+)\}/g;function qv(r){return AA.test(r)}function Em(r,t){if(r.variableList!==null||r.hasVariableRefs){const e=r.variableList;return t.replace(AA,i=>{const n=i.substring(2,i.length-1),a=e?.[n];return a===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),i):a})}return t}function jv(r,t,e){let i=r.variableList;i||(r.variableList=i={});let n,a;if("QUERYPARAM"in t){n=t.QUERYPARAM;try{const l=new self.URL(e).searchParams;if(l.has(n))a=l.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${e}"`)}catch(l){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else n=t.NAME,a=t.VALUE;n in i?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):i[n]=a||""}function n1(r,t,e){const i=t.IMPORT;if(e&&i in e){let n=r.variableList;n||(r.variableList=n={}),n[i]=e[i]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const s1=/^(\d+)x(\d+)$/,Yv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class xe{constructor(t,e){typeof t=="string"&&(t=xe.parseAttrList(t,e)),he(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>t.substring(0,2)==="X-")}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const i=new Uint8Array(e.length/2);for(let n=0;n<e.length/2;n++)i[n]=parseInt(e.slice(n*2,n*2+2),16);return i}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const i=this[t];return(i?i.split(/[ ,]+/):[]).reduce((n,a)=>(n[a.toLowerCase()]=!0,n),e)}bool(t){return this[t]==="YES"}decimalResolution(t){const e=s1.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let i;const n={},a='"';for(Yv.lastIndex=0;(i=Yv.exec(t))!==null;){const l=i[1].trim();let c=i[2];const f=c.indexOf(a)===0&&c.lastIndexOf(a)===c.length-1;let h=!1;if(f)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(e&&(f||h))c=Em(e,c);else if(!h&&!f)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ie.warn(`${t}: attribute ${l} is missing quotes`)}n[l]=c}return n}}const r1="com.apple.hls.interstitial";function a1(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function o1(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class _A{constructor(t,e,i=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=e?.tagAnchor||null,this.tagOrder=(n=e?.tagOrder)!=null?n:i,e){const a=e.attr;for(const l in a)if(Object.prototype.hasOwnProperty.call(t,l)&&t[l]!==a[l]){ie.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=l;break}t=he(new xe({}),a,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const a=e?.endDate||new Date(this.attr["END-DATE"]);vt(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return t===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return t===null||t.programDateTime===null?(ie.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${t}`),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return e!==null?this._dateAtEnd=new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(vt(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===r1}get isValid(){return!!this.id&&!this._badValueForSameId&&vt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const l1=10;class u1{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||e===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1}get hasProgramDateTime(){return this.fragments.length?vt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||l1}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(e!==-1){for(let i=t.length;i--;)if(t[i].index>e)return t[i].index;return e}}return 0}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}function Oo(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function ap(r){switch(r){case"AES-128":case"AES-256":return br.cbc;case"AES-256-CTR":return br.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function op(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0))}function vm(r){return Uint8Array.from(unescape(encodeURIComponent(r)),t=>t.charCodeAt(0))}function c1(r){const t=vm(r).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function h1(r){const t=function(i,n,a){const l=i[n];i[n]=i[a],i[a]=l};t(r,0,3),t(r,1,2),t(r,4,5),t(r,6,7)}function f1(r){const t=r.split(":");let e=null;if(t[0]==="data"&&t.length===2){const i=t[1].split(";"),n=i[i.length-1].split(",");if(n.length===2){const a=n[0]==="base64",l=n[1];a?(i.splice(-1,1),e=op(l)):e=c1(l)}}return e}const Zh=typeof self<"u"?self:void 0;var ae={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Mi={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Ph(r){switch(r){case Mi.FAIRPLAY:return ae.FAIRPLAY;case Mi.PLAYREADY:return ae.PLAYREADY;case Mi.WIDEVINE:return ae.WIDEVINE;case Mi.CLEARKEY:return ae.CLEARKEY}}var mh={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Gg(r){if(r===mh.WIDEVINE)return ae.WIDEVINE;if(r===mh.PLAYREADY)return ae.PLAYREADY;if(r===mh.CENC||r===mh.CLEARKEY)return ae.CLEARKEY}function ph(r){switch(r){case ae.FAIRPLAY:return Mi.FAIRPLAY;case ae.PLAYREADY:return Mi.PLAYREADY;case ae.WIDEVINE:return Mi.WIDEVINE;case ae.CLEARKEY:return Mi.CLEARKEY}}function au(r){const{drmSystems:t,widevineLicenseUrl:e}=r,i=t?[ae.FAIRPLAY,ae.WIDEVINE,ae.PLAYREADY,ae.CLEARKEY].filter(n=>!!t[n]):[];return!i[ae.WIDEVINE]&&e&&i.push(ae.WIDEVINE),i}const RA=function(r){return Zh!=null&&(r=Zh.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function d1(r,t,e,i){let n;switch(r){case ae.FAIRPLAY:n=["cenc","sinf"];break;case ae.WIDEVINE:case ae.PLAYREADY:n=["cenc"];break;case ae.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return g1(n,t,e,i)}function g1(r,t,e,i){return[{initDataTypes:r,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function m1(r){var t;return r.sessionType==="persistent-license"||!!((t=r.sessionTypes)!=null&&t.some(e=>e==="persistent-license"))}function bA(r){const t=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),e=String.fromCharCode.apply(null,Array.from(t)),i=e.substring(e.indexOf("<"),e.length),l=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const f=op(c).subarray(0,16);return h1(f),f}}return null}let yh={};class Ru{static clearKeyUriToKeyIdMap(){yh={}}constructor(t,e,i,n=[1],a=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=n,this.iv=a,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Oo(t)}isSupported(){if(this.method){if(Oo(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Mi.FAIRPLAY:case Mi.WIDEVINE:case Mi.PLAYREADY:case Mi.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(Oo(this.method)&&this.uri&&!this.iv){typeof t!="number"&&(ie.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const i=p1(t);return new Ru(this.method,this.uri,"identity",this.keyFormatVersions,i)}const e=f1(this.uri);if(e)switch(this.keyFormat){case Mi.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case Mi.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=AI(i,null,e),this.keyId=bA(e);break}default:{let i=e.subarray(0,16);if(i.length!==16){const n=new Uint8Array(16);n.set(i,16-i.length),i=n}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=yh[this.uri];if(!i){const n=Object.keys(yh).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,n),yh[this.uri]=i}this.keyId=i}return this}}function p1(r){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=r>>8*(15-e)&255;return t}const Qv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Xv=/#EXT-X-MEDIA:(.*)/g,y1=/^#EXT(?:INF|-X-TARGETDURATION):/m,$g=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),E1=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Wn{static findGroup(t,e){for(let i=0;i<t.length;i++){const n=t[i];if(n.id===e)return n}}static resolve(t,e){return tp.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return y1.test(t)}static parseMasterPlaylist(t,e){const i=qv(t),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},a=[];Qv.lastIndex=0;let l;for(;(l=Qv.exec(t))!=null;)if(l[1]){var c;const h=new xe(l[1],n),g=Em(n,l[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:Wn.resolve(g,e)},E=h.decimalResolution("RESOLUTION");E&&(p.width=E.width,p.height=E.height),Jv(h.CODECS,p);const T=h["SUPPLEMENTAL-CODECS"];T&&(p.supplemental={},Jv(T,p.supplemental)),(c=p.unknownCodecs)!=null&&c.length||a.push(p),n.levels.push(p)}else if(l[3]){const h=l[3],g=l[4];switch(h){case"SESSION-DATA":{const p=new xe(g,n),E=p["DATA-ID"];E&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[E]=p);break}case"SESSION-KEY":{const p=Wv(g,e,n);p.encrypted&&p.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(p)):ie.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new xe(g,n);jv(n,p,e)}break}case"CONTENT-STEERING":{const p=new xe(g,n);n.contentSteering={uri:Wn.resolve(p["SERVER-URI"],e),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Zv(g);break}}}const f=a.length>0&&a.length<n.levels.length;return n.levels=f?a:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(t,e,i){let n;const a={},l=i.levels,c={AUDIO:l.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:l.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(Xv.lastIndex=0;(n=Xv.exec(t))!==null;){const h=new xe(n[1],i),g=h.TYPE;if(g){const p=c[g],E=a[g]||[];a[g]=E;const T=h.LANGUAGE,S=h["ASSOC-LANGUAGE"],R=h.CHANNELS,_=h.CHARACTERISTICS,D=h["INSTREAM-ID"],N={attrs:h,bitrate:0,id:f++,groupId:h["GROUP-ID"]||"",name:h.NAME||T||"",type:g,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:T,url:h.URI?Wn.resolve(h.URI,e):""};if(S&&(N.assocLang=S),R&&(N.channels=R),_&&(N.characteristics=_),D&&(N.instreamId=D),p!=null&&p.length){const M=Wn.findGroup(p,N.groupId)||p[0];tT(N,M,"audioCodec"),tT(N,M,"textCodec")}E.push(N)}}return a}static parseLevelPlaylist(t,e,i,n,a,l){var c;const f={url:e},h=new u1(e),g=h.fragments,p=[];let E=null,T=0,S=0,R=0,_=0,D=0,N=null,M=new Fg(n,f),G,$,q,w=-1,L=!1,O=null,C;if($g.lastIndex=0,h.m3u8=t,h.hasVariableRefs=qv(t),((c=$g.exec(t))==null?void 0:c[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(G=$g.exec(t))!==null;){L&&(L=!1,M=new Fg(n,f),M.playlistOffset=R,M.start=R,M.sn=T,M.cc=_,D&&(M.bitrate=D),M.level=i,E&&(M.initSegment=E,E.rawProgramDateTime&&(M.rawProgramDateTime=E.rawProgramDateTime,E.rawProgramDateTime=null),O&&(M.setByteRange(O),O=null)));const pt=G[1];if(pt){M.duration=parseFloat(pt);const gt=(" "+G[2]).slice(1);M.title=gt||null,M.tagList.push(gt?["INF",pt,gt]:["INF",pt])}else if(G[3]){if(vt(M.duration)){M.playlistOffset=R,M.start=R,q&&iT(M,q,h),M.sn=T,M.level=i,M.cc=_,g.push(M);const gt=(" "+G[3]).slice(1);M.relurl=Em(h,gt),Tm(M,N,p),N=M,R+=M.duration,T++,S=0,L=!0}}else{if(G=G[0].match(E1),!G){ie.warn("No matches on slow regex match for level playlist!");continue}for($=1;$<G.length&&G[$]===void 0;$++);const gt=(" "+G[$]).slice(1),K=(" "+G[$+1]).slice(1),it=G[$+2]?(" "+G[$+2]).slice(1):null;switch(gt){case"BYTERANGE":N?M.setByteRange(K,N):M.setByteRange(K);break;case"PROGRAM-DATE-TIME":M.rawProgramDateTime=K,M.tagList.push(["PROGRAM-DATE-TIME",K]),w===-1&&(w=g.length);break;case"PLAYLIST-TYPE":h.type&&Os(h,gt,G),h.type=K.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?Os(h,gt,G):g.length>0&&nT(h,gt,G),T=h.startSN=parseInt(K);break;case"SKIP":{h.skippedSegments&&Os(h,gt,G);const ct=new xe(K,h),rt=ct.decimalInteger("SKIPPED-SEGMENTS");if(vt(rt)){h.skippedSegments+=rt;for(let tt=rt;tt--;)g.push(null);T+=rt}const F=ct.enumeratedString("RECENTLY-REMOVED-DATERANGES");F&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(F.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&Os(h,gt,G),h.targetduration=Math.max(parseInt(K),1);break;case"VERSION":h.version!==null&&Os(h,gt,G),h.version=parseInt(K);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||Os(h,gt,G),h.live=!1;break;case"#":(K||it)&&M.tagList.push(it?[K,it]:[K]);break;case"DISCONTINUITY":_++,M.tagList.push(["DIS"]);break;case"GAP":M.gap=!0,M.tagList.push([gt]);break;case"BITRATE":M.tagList.push([gt,K]),D=parseInt(K)*1e3,vt(D)?M.bitrate=D:D=0;break;case"DATERANGE":{const ct=new xe(K,h),rt=new _A(ct,h.dateRanges[ct.ID],h.dateRangeTagCount);h.dateRangeTagCount++,rt.isValid||h.skippedSegments?h.dateRanges[rt.id]=rt:ie.warn(`Ignoring invalid DATERANGE tag: "${K}"`),M.tagList.push(["EXT-X-DATERANGE",K]);break}case"DEFINE":{{const ct=new xe(K,h);"IMPORT"in ct?n1(h,ct,l):jv(h,ct,e)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?Os(h,gt,G):g.length>0&&nT(h,gt,G),h.startCC=_=parseInt(K);break;case"KEY":{const ct=Wv(K,e,h);if(ct.isSupported()){if(ct.method==="NONE"){q=void 0;break}q||(q={}),q[ct.keyFormat]&&(q=he({},q)),q[ct.keyFormat]=ct}else ie.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${K}"`);break}case"START":h.startTimeOffset=Zv(K);break;case"MAP":{const ct=new xe(K,h);if(M.duration){const rt=new Fg(n,f);eT(rt,ct,i,q),E=rt,M.initSegment=E,E.rawProgramDateTime&&!M.rawProgramDateTime&&(M.rawProgramDateTime=E.rawProgramDateTime)}else{const rt=M.byteRangeEndOffset;if(rt){const F=M.byteRangeStartOffset;O=`${rt-F}@${F}`}else O=null;eT(M,ct,i,q),E=M,L=!0}E.cc=_;break}case"SERVER-CONTROL":{C&&Os(h,gt,G),C=new xe(K),h.canBlockReload=C.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=C.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&C.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=C.optionalFloat("PART-HOLD-BACK",0),h.holdBack=C.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&Os(h,gt,G);const ct=new xe(K);h.partTarget=ct.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ct=h.partList;ct||(ct=h.partList=[]);const rt=S>0?ct[ct.length-1]:void 0,F=S++,tt=new xe(K,h),at=new lI(tt,M,f,F,rt);ct.push(at),M.duration+=at.duration;break}case"PRELOAD-HINT":{const ct=new xe(K,h);h.preloadHint=ct;break}case"RENDITION-REPORT":{const ct=new xe(K,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(ct);break}default:ie.warn(`line parsed but not handled: ${G}`);break}}}N&&!N.relurl?(g.pop(),R-=N.duration,h.partList&&(h.fragmentHint=N)):h.partList&&(Tm(M,N,p),M.cc=_,h.fragmentHint=M,q&&iT(M,q,h)),h.targetduration||(h.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const U=g.length,V=g[0],B=g[U-1];if(R+=h.skippedSegments*h.targetduration,R>0&&U&&B){h.averagetargetduration=R/U;const pt=B.sn;h.endSN=pt!=="initSegment"?pt:0,h.live||(B.endList=!0),V&&h.startCC===void 0&&(h.startCC=V.cc),w>0&&(T1(g,w),V&&p.unshift(V))}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(R+=h.fragmentHint.duration),h.totalduration=R,p.length&&h.dateRangeTagCount&&V&&xA(p,h),h.endCC=_,h}}function xA(r,t){const e=r.length;if(!e)return;const i=r[e-1],n=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let l=a.length;l--;){const c=t.dateRanges[a[l]],f=c.startDate.getTime();c.tagAnchor=i.ref;for(let h=e;h--;){const g=v1(t,f,r,h,n);if(g!==-1){c.tagAnchor=t.fragments[g].ref;break}}}}function v1(r,t,e,i,n){const a=e[i];if(a){const c=a.programDateTime;if(t>=c||i===0){var l;const f=(((l=e[i+1])==null?void 0:l.start)||n)-a.start;if(t<=c+f*1e3){const h=e[i].sn-r.startSN,g=r.fragments;if(g.length>e.length){const E=(e[i+1]||g[g.length-1]).sn-r.startSN;for(let T=E;T>h;T--){const S=g[T].programDateTime;if(t>=S&&t<S+g[T].duration*1e3)return T}}return h}}}return-1}function Wv(r,t,e){var i,n;const a=new xe(r,e),l=(i=a.METHOD)!=null?i:"",c=a.URI,f=a.hexadecimalInteger("IV"),h=a.KEYFORMATVERSIONS,g=(n=a.KEYFORMAT)!=null?n:"identity";c&&a.IV&&!f&&ie.error(`Invalid IV: ${a.IV}`);const p=c?Wn.resolve(c,t):"",E=(h||"1").split("/").map(Number).filter(Number.isFinite);return new Ru(l,p,g,E,f)}function Zv(r){const e=new xe(r).decimalFloatingPoint("TIME-OFFSET");return vt(e)?e:null}function Jv(r,t){let e=(r||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const n=e.filter(a=>fA(a,i));n.length&&(t[`${i}Codec`]=n.map(a=>a.split("/")[0]).join(","),e=e.filter(a=>n.indexOf(a)===-1))}),t.unknownCodecs=e}function tT(r,t,e){const i=t[e];i&&(r[e]=i)}function T1(r,t){let e=r[t];for(let i=t;i--;){const n=r[i];if(!n)return;n.programDateTime=e.programDateTime-n.duration*1e3,e=n}}function Tm(r,t,e){r.rawProgramDateTime?e.push(r):t!=null&&t.programDateTime&&(r.programDateTime=t.endProgramDateTime)}function eT(r,t,e,i){r.relurl=t.URI,t.BYTERANGE&&r.setByteRange(t.BYTERANGE),r.level=e,r.sn="initSegment",i&&(r.levelkeys=i),r.initSegment=null}function iT(r,t,e){r.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(n=>t[n].isCommonEncryption)&&i.push(r)}function Os(r,t,e){r.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${e[0]})`)}function nT(r,t,e){r.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${e[0]})`)}function Hg(r,t){const e=t.startPTS;if(vt(e)){let i=0,n;t.sn>r.sn?(i=e-r.start,n=r):(i=r.start-e,n=t),n.duration!==i&&n.setDuration(i)}else t.sn>r.sn?r.cc===t.cc&&r.minEndPTS?t.setStart(r.start+(r.minEndPTS-r.start)):t.setStart(r.start+r.duration):t.setStart(Math.max(r.start-t.duration,0))}function IA(r,t,e,i,n,a){i-e<=0&&(ie.warn("Fragment should have a positive duration",t),i=e+t.duration,a=n+t.duration);let c=e,f=i;const h=t.startPTS,g=t.endPTS;if(vt(h)){const _=Math.abs(h-e);vt(t.deltaPTS)?t.deltaPTS=Math.max(_,t.deltaPTS):t.deltaPTS=_,c=Math.max(e,h),e=Math.min(e,h),n=Math.min(n,t.startDTS),f=Math.min(i,g),i=Math.max(i,g),a=Math.max(a,t.endDTS)}const p=e-t.start;t.start!==0&&t.setStart(e),t.setDuration(i-t.start),t.startPTS=e,t.maxStartPTS=c,t.startDTS=n,t.endPTS=i,t.minEndPTS=f,t.endDTS=a;const E=t.sn;if(!r||E<r.startSN||E>r.endSN)return 0;let T;const S=E-r.startSN,R=r.fragments;for(R[S]=t,T=S;T>0;T--)Hg(R[T],R[T-1]);for(T=S;T<R.length-1;T++)Hg(R[T],R[T+1]);return r.fragmentHint&&Hg(R[R.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,p}function S1(r,t){if(r===t)return;let e=null;const i=r.fragments;for(let h=i.length-1;h>=0;h--){const g=i[h].initSegment;if(g){e=g;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let n;R1(r,t,(h,g,p,E)=>{if((!t.startCC||t.skippedSegments)&&g.cc!==h.cc){const T=h.cc-g.cc;for(let S=p;S<E.length;S++)E[S].cc+=T;t.endCC=E[E.length-1].cc}vt(h.startPTS)&&vt(h.endPTS)&&(g.setStart(g.startPTS=h.startPTS),g.startDTS=h.startDTS,g.maxStartPTS=h.maxStartPTS,g.endPTS=h.endPTS,g.endDTS=h.endDTS,g.minEndPTS=h.minEndPTS,g.setDuration(h.endPTS-h.startPTS),g.duration&&(n=g),t.PTSKnown=t.alignedSliding=!0),h.hasStreams&&(g.elementaryStreams=h.elementaryStreams),g.loader=h.loader,h.hasStats&&(g.stats=h.stats),h.initSegment&&(g.initSegment=h.initSegment,e=h.initSegment)});const a=t.fragments,l=t.fragmentHint?a.concat(t.fragmentHint):a;if(e&&l.forEach(h=>{var g;h&&(!h.initSegment||h.initSegment.relurl===((g=e)==null?void 0:g.relurl))&&(h.initSegment=e)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(h=>!h),t.deltaUpdateFailed){ie.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=t.skippedSegments;h--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=A1(r.dateRanges,t));const h=r.fragments.filter(g=>g.rawProgramDateTime);if(r.hasProgramDateTime&&!t.hasProgramDateTime)for(let g=1;g<l.length;g++)l[g].programDateTime===null&&Tm(l[g],l[g-1],h);xA(h,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var c;const h=CA(r,t.startSN-1);t.startCC=(c=h?.cc)!=null?c:a[0].cc}_1(r.partList,t.partList,(h,g)=>{g.elementaryStreams=h.elementaryStreams,g.stats=h.stats}),n?IA(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):LA(r,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=r.driftStartTime,t.driftStart=r.driftStart;const f=t.advancedDateTime;if(t.advanced&&f){const h=t.edge;t.driftStart||(t.driftStartTime=f,t.driftStart=h),t.driftEndTime=f,t.driftEnd=h}else t.driftEndTime=r.driftEndTime,t.driftEnd=r.driftEnd,t.advancedDateTime=r.advancedDateTime;t.requestScheduled===-1&&(t.requestScheduled=r.requestScheduled)}function A1(r,t){const{dateRanges:e,recentlyRemovedDateranges:i}=t,n=he({},r);i&&i.forEach(c=>{delete n[c]});const l=Object.keys(n).length;return l&&Object.keys(e).forEach(c=>{const f=n[c],h=new _A(e[c].attr,f);h.isValid?(n[c]=h,f||(h.tagOrder+=l)):ie.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Re(e[c].attr)}"`)}),n}function _1(r,t,e){if(r&&t){let i=0;for(let n=0,a=r.length;n<=a;n++){const l=r[n],c=t[n+i];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?e(l,c):i--}}}function R1(r,t,e){const i=t.skippedSegments,n=Math.max(r.startSN,t.startSN)-t.startSN,a=(r.fragmentHint?1:0)+(i?t.endSN:Math.min(r.endSN,t.endSN))-t.startSN,l=t.startSN-r.startSN,c=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,f=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let h=n;h<=a;h++){const g=f[l+h];let p=c[h];if(i&&!p&&g&&(p=t.fragments[h]=g),g&&p){if(e(g,p,h,c),g.url&&g.url!==p.url){t.playlistParsingError=sT(`media sequence mismatch ${p.sn}:`,r,t,g,p);return}else if(g.cc!==p.cc){t.playlistParsingError=sT(`discontinuity sequence mismatch (${g.cc}!=${p.cc})`,r,t,g,p);return}}}}function sT(r,t,e,i,n){return new Error(`${r} ${n.url}
Playlist starting @${t.startSN}
${t.m3u8}

Playlist starting @${e.startSN}
${e.m3u8}`)}function LA(r,t,e=!0){const i=t.startSN+t.skippedSegments-r.startSN,n=r.fragments,a=i>=0;let l=0;if(a&&i<n.length)l=n[i].start;else if(a&&t.startSN===r.endSN+1)l=r.fragmentEnd;else if(a&&e)l=r.fragmentStart+i*t.levelTargetDuration;else if(!t.skippedSegments&&t.fragmentStart===0)l=r.fragmentStart;else return;Sm(t,l)}function Sm(r,t){if(t){const e=r.fragments;for(let i=r.skippedSegments;i<e.length;i++)e[i].addStart(t);r.fragmentHint&&r.fragmentHint.addStart(t)}}function DA(r,t=1/0){let e=1e3*r.targetduration;if(r.updated){const i=r.fragments;if(i.length&&e*4>t){const a=i[i.length-1].duration*1e3;a<e&&(e=a)}}else e/=2;return Math.round(e)}function CA(r,t,e){if(!r)return null;let i=r.fragments[t-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===t)?i:t<r.startSN&&e&&e.sn===t?e:null}function rT(r,t,e){return r?wA(r.partList,t,e):null}function wA(r,t,e){if(r)for(let i=r.length;i--;){const n=r[i];if(n.index===e&&n.fragment.sn===t)return n}return null}function OA(r){r.forEach((t,e)=>{var i;(i=t.details)==null||i.fragments.forEach(n=>{n.level=e,n.initSegment&&(n.initSegment.level=e)})})}function fu(r,t){for(let i=0,n=r.length;i<n;i++){var e;if(((e=r[i])==null?void 0:e.cc)===t)return r[i]}return null}function b1(r,t){return!!(r&&t.startCC<r.endCC&&t.endCC>r.startCC)}function aT(r,t){if(r){const e=r.start+t;r.start=r.startPTS=e,r.endPTS=e+r.duration}}function PA(r,t){const e=t.fragments;for(let i=0,n=e.length;i<n;i++)aT(e[i],r);t.fragmentHint&&aT(t.fragmentHint,r),t.alignedSliding=!0}function x1(r,t){r&&(MA(t,r),!t.alignedSliding&&r&&Jh(t,r),!t.alignedSliding&&r&&!t.skippedSegments&&LA(r,t,!1))}function MA(r,t){if(!b1(t,r))return;const e=Math.min(t.endCC,r.endCC),i=fu(t.fragments,e),n=fu(r.fragments,e);if(!i||!n)return;ie.log(`Aligning playlist at start of dicontinuity sequence ${e}`);const a=i.start-n.start;PA(a,r)}function Jh(r,t){if(!r.hasProgramDateTime||!t.hasProgramDateTime)return;const e=r.fragments,i=t.fragments;if(!e.length||!i.length)return;let n,a;const l=Math.min(t.endCC,r.endCC);t.startCC<l&&r.startCC<l&&(n=fu(i,l),a=fu(e,l)),(!n||!a)&&(n=i[Math.floor(i.length/2)],a=fu(e,n.cc)||e[Math.floor(e.length/2)]);const c=n.programDateTime,f=a.programDateTime;if(!c||!f)return;const h=(f-c)/1e3-(a.start-n.start);PA(h,r)}const I1={toString:function(r){let t="";const e=r.length;for(let i=0;i<e;i++)t+=`[${r.start(i).toFixed(3)}-${r.end(i).toFixed(3)}]`;return t}},lt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class lp extends SA{constructor(t,e,i,n,a){super(n,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=lt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:f,mediaBuffer:h,state:g}=this,p=f?f.currentTime:0,E=Pt.bufferInfo(h||f,p,l.maxBufferHole);if(this.log(`media seeking to ${vt(p)?p.toFixed(3):p}, state: ${g}`),this.state===lt.ENDED)this.resetLoadingState();else if(c){const T=l.maxFragLookUpTolerance,S=c.start-T,R=c.start+c.duration+T;if(!E.len||R<E.start||S>E.end){const _=p>R;(p<S||_)&&(_&&c.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const T=this.lastCurrentTime;if(p>T&&(this.lastCurrentTime=p),!this.loadingParts){const S=Math.max(E.end,p),R=this.shouldLoadParts(this.getLevelDetails(),S);R&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=R)}}!this.hls.hasEnoughToStart&&!E.len&&(this.log(`setting startPosition to ${p} because of seek before start`),this.nextLoadPosition=this.startPosition=p),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=t,this.fragmentLoader=new e1(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new sp(t.config)}registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if(this.state===lt.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=lt.STOPPED}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return e===-1&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const i=t.end||0,n=this.config.timelineOffset||0;if(i<=n)return!1;const a=t.buffered;this.config.maxBufferHole&&a&&a.length>1&&(t=Pt.bufferedInfo(a,t.start,0));const l=t.nextStart;if(l&&l>n&&l<e.edge||this.media.currentTime<t.start)return!1;const f=e.partList;if(f!=null&&f.length){const g=f[f.length-1];return Pt.isBuffered(this.media,g.start+g.duration/2)}const h=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var t;return(t=this.levelLastLoaded)==null?void 0:t.details}}get timelineOffset(){const t=this.config.timelineOffset;if(t){var e;return((e=this.getLevelDetails())==null?void 0:e.appliedTimelineOffset)||t}return 0}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===lt.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(t,e){const i=!!e.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=lt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this.startFragRequested=!0,this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){const n=a=>{const l=a.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(l,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(t,e,i,n).then(a=>{if(!a)return;const l=this.state,c=a.frag;if(this.fragContextChanged(c)){(l===lt.FRAG_LOADING||!this.fragCurrent&&l===lt.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=lt.IDLE);return}"payload"in a&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(b.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===lt.STOPPED||this.state===lt.ERROR||(this.warn(`Frag error: ${a?.message||a}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if(i.getState(t)===Qe.APPENDING){const a=t.type,l=this.getFwdBufferInfo(this.mediaBuffer,a),c=Math.max(t.duration,l?l.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?t.sn-f.sn:0)===1||this.reduceMaxBufferLength(c,t.duration))&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===Qe.PARTIAL&&i.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return e?.live&&e.type!=="EVENT"&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e,i=null){if(!(t-e))return;const n={startOffset:t,endOffset:e,type:i};this.hls.trigger(b.BUFFER_FLUSHING,n)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{const n=i?.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:n}=this,{frag:a,payload:l}=i,c=a.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&Oo(c.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,ap(c.method)).catch(h=>{throw n.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:a}),h}).then(h=>{const g=self.performance.now();return n.trigger(b.FRAG_DECRYPTED,{frag:a,payload:h,stats:{tstart:f,tdecrypt:g}}),i.payload=h,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===lt.STOPPED||this.state===lt.ERROR||(this.warn(i),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const i=t.frag.stats;this.state!==lt.STOPPED&&(this.state=lt.IDLE),t.frag.data=new Uint8Array(t.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)} > buffer:${i?I1.toString(Pt.getBuffered(i)):"(detached)"})`),ai(t)){var n;if(t.type!==Rt.SUBTITLE){const l=t.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=lt.IDLE;return}}const a=(n=this.levels)==null?void 0:n[t.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=lt.IDLE}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:n,partsLoaded:a}=t,l=!a||a.length===0||a.some(f=>!f),c=new rp(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!l);e.flush(c)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,n){var a;this.fragCurrent=t;const l=e?.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;t.encrypted&&!((a=t.decryptdata)!=null&&a.key)?(this.log(`Loading key for ${t.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${t.level}`),this.state=lt.KEY_LOADING,this.fragCurrent=t,c=this.keyLoader.load(t).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(b.KEY_LOADED,p),this.state===lt.KEY_LOADING&&(this.state=lt.IDLE),p}),this.hls.trigger(b.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):t.encrypted||(c=this.keyLoader.loadClear(t,l.encryptedFragments),c&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(ai(t)&&(!f||t.sn!==f.sn)){const p=this.shouldLoadParts(e.details,t.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${f?.sn}->${t.sn}`),this.loadingParts=p)}if(i=Math.max(t.start,i||0),this.loadingParts&&ai(t)){const p=l.partList;if(p&&n){i>t.end&&l.fragmentHint&&(t=l.fragmentHint);const E=this.getNextPart(p,t,i);if(E>-1){const T=p[E];t=this.fragCurrent=T.fragment,this.log(`Loading ${t.type} sn: ${t.sn} part: ${T.index} (${E}/${p.length-1}) of ${this.fragInfo(t,!1,T)}) cc: ${t.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=T.start+T.duration,this.state=lt.FRAG_LOADING;let S;return c?S=c.then(R=>!R||this.fragContextChanged(R.frag)?null:this.doFragPartsLoad(t,T,e,n)).catch(R=>this.handleFragLoadError(R)):S=this.doFragPartsLoad(t,T,e,n).catch(R=>this.handleFragLoadError(R)),this.hls.trigger(b.FRAG_LOADING,{frag:t,part:T,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!t.url||this.loadedEndOfParts(p,i))return Promise.resolve(null)}}if(ai(t)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log(`Loading ${t.type} sn: ${t.sn} of ${this.fragInfo(t,!1)}) cc: ${t.cc} ${l?"["+l.startSN+"-"+l.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),vt(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=lt.FRAG_LOADING;const h=this.config.progressive;let g;return h&&c?g=c.then(p=>!p||this.fragContextChanged(p?.frag)?null:this.fragmentLoader.load(t,n)).catch(p=>this.handleFragLoadError(p)):g=Promise.all([this.fragmentLoader.load(t,h?n:void 0),c]).then(([p])=>(!h&&p&&n&&n(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(b.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(t,e,i,n){return new Promise((a,l)=>{var c;const f=[],h=(c=i.details)==null?void 0:c.partList,g=p=>{this.fragmentLoader.loadPart(t,p,n).then(E=>{f[p.index]=E;const T=E.part;this.hls.trigger(b.FRAG_LOADED,E);const S=rT(i.details,t.sn,p.index+1)||wA(h,t.sn,p.index+1);if(S)g(S);else return a({frag:t,part:T,partsLoaded:f})}).catch(l)};g(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;t.data&&e.details===W.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(b.ERROR,e)}else this.hls.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==lt.PARSING){!this.fragCurrent&&this.state!==lt.STOPPED&&this.state!==lt.ERROR&&(this.state=lt.IDLE);return}const{frag:i,part:n,level:a}=e,l=self.performance.now();i.stats.parsing.end=l,n&&(n.stats.parsing.end=l);const c=this.getLevelDetails(),h=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(i,n,a,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t!=null&&t.partList){var i;const a=t.partList[0],l=a.end+(((i=t.fragmentHint)==null?void 0:i.duration)||0);if(e>=l){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:n,sn:a,part:l}=t;if(!(e!=null&&e[n]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const c=e[n],f=c.details,h=l>-1?rT(f,a,l):null,g=h?h.fragment:CA(f,a,i);return g?(i&&i!==g&&(g.stats=i.stats),{frag:g,part:h,level:c}):null}bufferFragmentData(t,e,i,n,a){var l;if(!t||this.state!==lt.PARSING)return;const{data1:c,data2:f}=t;let h=c;if(c&&f&&(h=fn(c,f)),!((l=h)!=null&&l.length))return;const g={type:t.type,frag:e,part:i,chunkMeta:n,parent:e.type,data:h};if(this.hls.trigger(b.BUFFER_APPENDING,g),t.dropped&&t.independent&&!i){if(a)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!Pt.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const i=e.currentTime,n=Pt.bufferInfo(e,i,0),a=t.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),c=Math.max(Math.min(t.start-l,n.end-l),i+l);t.start-c>l&&this.flushMainBuffer(c,t.start)}getFwdBufferInfo(t,e){var i;const n=this.getLoadPosition();if(!vt(n))return null;const l=this.lastCurrentTime>n||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,n,e,l)}getFwdBufferInfoAtPos(t,e,i,n){const a=Pt.bufferInfo(t,e,n);if(a.len===0&&a.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(e,i);if(l&&(a.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(a.nextStart,l.end)-e,n);return Pt.bufferInfo(t,e,c)}}return a}getMaxBufferLength(t){const{config:e}=this;let i;return t?i=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):i=e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const i=this.config,n=Math.max(Math.min(t-e,i.maxBufferLength),e),a=Math.max(t-e*3,i.maxMaxBufferLength/2,n);return a>=n?(i.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(t,e=Rt.MAIN){var i;const n=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(t,e);return n&&"fragment"in n?n.fragment:n}getNextFragment(t,e){const i=e.fragments,n=i.length;if(!n)return null;const{config:a}=this,l=i[0].start,c=a.lowLatencyMode&&!!e.partList;let f=null;if(e.live){const p=a.initialLiveManifestSize;if(n<p)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${p})`),null;if(!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<l){var h;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(e);const E=this.hls.startPosition,T=this.hls.liveSyncPosition,S=f?(E!==-1&&E>=l?E:T)||f.start:t;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${E} liveSyncPosition: ${T} frag.start: ${(h=f)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=S}}else t<=l&&(f=i[0]);if(!f){const p=this.loadingParts?e.partEnd:e.fragmentEnd;f=this.getFragmentAtPosition(t,p,e)}let g=this.filterReplacedPrimary(f,e);if(!g&&f){const p=f.sn-e.startSN;g=this.filterReplacedPrimary(i[p+1]||null,e)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return(i===Qe.OK||i===Qe.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,n,a){let l=null;if(t.gap&&(l=this.getNextFragment(this.nextLoadPosition,e),l&&!l.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n,0);if(c!==null&&i.len+c.len>=a){const f=l.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(oT(this.hls.config)){var t,e;if((t=this.hls.interstitialsManager)==null||(e=t.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(t,e){if(!t)return t;if(oT(this.hls.config)&&t.type!==Rt.SUBTITLE){const i=this.hls.interstitialsManager,n=i?.bufferingItem;if(n){const l=n.event;if(l){if(l.appendInPlace||Math.abs(t.start-n.start)>1||n.start===0)return null}else if(t.end<=n.start&&e?.live===!1||t.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||t.start-n.end>1))return null}const a=i?.playerQueue;if(a)for(let l=a.length;l--;){const c=a[l].interstitial;if(c.appendInPlace&&t.start>=c.startTime&&t.end<=c.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!(t!=null&&t.initSegment.data)&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,i){let n=-1,a=!1,l=!0;for(let c=0,f=t.length;c<f;c++){const h=t[c];if(l=l&&!h.independent,n>-1&&i<h.start)break;const g=h.loaded;g?n=-1:(a||h.independent||l)&&h.fragment===e&&(n=c),a=g}return n}loadedEndOfParts(t,e){const i=t[t.length-1];return i&&e>i.start&&i.loaded}getInitialLiveFragment(t){const e=t.fragments,i=this.fragPrevious;let n=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),n=HI(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const a=i.sn+1;if(a>=t.startSN&&a<=t.endSN){const l=e[a-t.startSN];i.cc===l.cc&&(n=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=TA(t,i.cc,i.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(n=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return n}getFragmentAtPosition(t,e,i){const{config:n}=this;let{fragPrevious:a}=this,{fragments:l,endSN:c}=i;const{fragmentHint:f}=i,{maxFragLookUpTolerance:h}=n,g=i.partList,p=!!(this.loadingParts&&g!=null&&g.length&&f);p&&f&&!this.bitrateTest&&g[g.length-1].fragment.sn===f.sn&&(l=l.concat(f),c=f.sn);let E;if(t<e){var T;const R=t<this.lastCurrentTime||t>e-h||(T=this.media)!=null&&T.paused||!this.startFragRequested?0:h;E=Sa(a,l,t,R)}else E=l[l.length-1];if(E){const S=E.sn-i.startSN,R=this.fragmentTracker.getState(E);if((R===Qe.OK||R===Qe.PARTIAL&&E.gap)&&(a=E),a&&E.sn===a.sn&&(!p||g[0].fragment.sn>E.sn||!i.live&&!p)&&a&&E.level===a.level){const D=l[S+1];E.sn<c&&this.fragmentTracker.getState(D)!==Qe.OK?E=D:E=null}}return E}alignPlaylists(t,e,i){const n=t.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const a=t.fragmentStart,l=!e,c=t.alignedSliding&&vt(a);if(l||!c&&!a){x1(i,t);const f=t.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} fragments: ${n}`),f}return a}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let i=this.startPosition;i<e&&(i=-1);const n=this.timelineOffset;if(i===-1){const a=this.startTimeOffset!==null,l=a?this.startTimeOffset:t.startTimeOffset;l!==null&&vt(l)?(i=e+l,l<0&&(i+=t.edge),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${l} found in ${a?"multivariant":"media"} playlist`),this.startPosition=i):t.live?(i=this.hls.liveSyncPosition||e,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+n}this.nextLoadPosition=i+n}getLoadPosition(){var t;const{media:e}=this;let i=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&e?i=e.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&ai(t)&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of ${this.playlistLabel()} ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==lt.FRAG_LOADING_WAITING_RETRY)&&(this.state=lt.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const S=this.getCurrentContext(e.chunkMeta);S&&(e.frag=S.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;if(this.fragContextChanged(i)){var n;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const a=e.details===W.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const l=e.errorAction,{action:c,flags:f,retryCount:h=0,retryConfig:g}=l||{},p=!!l&&!!g,E=p&&c===Ti.RetryRequest,T=p&&!l.resolved&&f===bn.MoveAllAlternatesMatchingHost;if(!E&&T&&ai(i)&&!i.endList)this.resetFragmentErrors(t),this.treatAsGap(i),l.resolved=!0;else if((E||T)&&h<g.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const S=np(g,h);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${h+1}/${g.maxNumRetry} in ${S}ms`),l.resolved=!0,this.retryDate=self.performance.now()+S,this.state=lt.FRAG_LOADING_WAITING_RETRY}else if(g&&l)if(this.resetFragmentErrors(t),h<g.maxNumRetry)!a&&c!==Ti.RemoveAlternatePermanently&&(l.resolved=!0);else{this.warn(`${e.details} reached or exceeded max retry (${h})`);return}else c===Ti.SendAlternateToPenaltyBox?this.state=lt.WAITING_LEVEL:this.state=lt.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===lt.PARSING||this.state===lt.PARSED){const e=t.frag,i=t.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),a=n&&n.len>.5;a&&this.reduceMaxBufferLength(n.len,e?.duration||10);const l=!a;return l&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(t){t===Rt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==lt.STOPPED&&(this.state=lt.IDLE)}afterBufferFlushed(t,e,i){if(!t)return;const n=Pt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,n,i),this.state===lt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==lt.STOPPED&&(this.state=lt.IDLE)}resetStartWhenNotLoaded(t){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=t?t.details:null;e!=null&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of ${this.playlistLabel()} ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,n){const a=i.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(t.elementaryStreams).reduce((f,h)=>{const g=t.elementaryStreams[h];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${t.sn} ${h} duration reliably (${p})`),f||!1;const E=n?0:IA(a,t,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:a,level:i,drift:E,type:h,frag:t,start:g.startPTS,end:g.endPTS}),!0}return f},!1)){var c;if(i.fragmentError===0&&this.treatAsGap(t,i),((c=this.transmuxer)==null?void 0:c.error)===null){const f=new Error(`Found no media in fragment ${t.sn} of ${this.playlistLabel()} ${t.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:t,reason:`Found no media in msn ${t.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=lt.PARSED,this.log(`Parsed ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)})`),this.hls.trigger(b.FRAG_PARSED,{frag:t,part:e})}playlistLabel(){return this.playlistType===Rt.MAIN?"level":"track"}fragInfo(t,e=!0,i){var n,a;return`${this.playlistLabel()} ${t.level} (${i?"part":"frag"}:[${((n=e&&!i?t.startPTS:(i||t).start)!=null?n:NaN).toFixed(3)}-${((a=e&&!i?t.endPTS:(i||t).end)!=null?a:NaN).toFixed(3)}]${i&&t.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;(t=this.transmuxer)==null||t.reset()}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function oT(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class kA{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;if(t.length)t.length===1?i=t[0]:i=L1(t,e);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function L1(r,t){const e=new Uint8Array(t);let i=0;for(let n=0;n<r.length;n++){const a=r[n];e.set(a,i),i+=a.length}return e}var Kg={exports:{}},lT;function D1(){return lT||(lT=1,function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(f,h,g){this.fn=f,this.context=h,this.once=g||!1}function a(f,h,g,p,E){if(typeof g!="function")throw new TypeError("The listener must be a function");var T=new n(g,p||f,E),S=e?e+h:h;return f._events[S]?f._events[S].fn?f._events[S]=[f._events[S],T]:f._events[S].push(T):(f._events[S]=T,f._eventsCount++),f}function l(f,h){--f._eventsCount===0?f._events=new i:delete f._events[h]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],g,p;if(this._eventsCount===0)return h;for(p in g=this._events)t.call(g,p)&&h.push(e?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(g)):h},c.prototype.listeners=function(h){var g=e?e+h:h,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var E=0,T=p.length,S=new Array(T);E<T;E++)S[E]=p[E].fn;return S},c.prototype.listenerCount=function(h){var g=e?e+h:h,p=this._events[g];return p?p.fn?1:p.length:0},c.prototype.emit=function(h,g,p,E,T,S){var R=e?e+h:h;if(!this._events[R])return!1;var _=this._events[R],D=arguments.length,N,M;if(_.fn){switch(_.once&&this.removeListener(h,_.fn,void 0,!0),D){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,g),!0;case 3:return _.fn.call(_.context,g,p),!0;case 4:return _.fn.call(_.context,g,p,E),!0;case 5:return _.fn.call(_.context,g,p,E,T),!0;case 6:return _.fn.call(_.context,g,p,E,T,S),!0}for(M=1,N=new Array(D-1);M<D;M++)N[M-1]=arguments[M];_.fn.apply(_.context,N)}else{var G=_.length,$;for(M=0;M<G;M++)switch(_[M].once&&this.removeListener(h,_[M].fn,void 0,!0),D){case 1:_[M].fn.call(_[M].context);break;case 2:_[M].fn.call(_[M].context,g);break;case 3:_[M].fn.call(_[M].context,g,p);break;case 4:_[M].fn.call(_[M].context,g,p,E);break;default:if(!N)for($=1,N=new Array(D-1);$<D;$++)N[$-1]=arguments[$];_[M].fn.apply(_[M].context,N)}}return!0},c.prototype.on=function(h,g,p){return a(this,h,g,p,!1)},c.prototype.once=function(h,g,p){return a(this,h,g,p,!0)},c.prototype.removeListener=function(h,g,p,E){var T=e?e+h:h;if(!this._events[T])return this;if(!g)return l(this,T),this;var S=this._events[T];if(S.fn)S.fn===g&&(!E||S.once)&&(!p||S.context===p)&&l(this,T);else{for(var R=0,_=[],D=S.length;R<D;R++)(S[R].fn!==g||E&&!S[R].once||p&&S[R].context!==p)&&_.push(S[R]);_.length?this._events[T]=_.length===1?_[0]:_:l(this,T)}return this},c.prototype.removeAllListeners=function(h){var g;return h?(g=e?e+h:h,this._events[g]&&l(this,g)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=e,c.EventEmitter=c,r.exports=c}(Kg)),Kg.exports}var C1=D1(),up=aI(C1);const bu="1.6.5",Bo={};function w1(){return typeof __HLS_WORKER_BUNDLE__=="function"}function O1(){const r=Bo[bu];if(r)return r.clientCount++,r;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t),n={worker:new self.Worker(e),objectURL:e,clientCount:1};return Bo[bu]=n,n}function P1(r){const t=Bo[r];if(t)return t.clientCount++,t;const e=new self.URL(r,self.location.href).href,n={worker:new self.Worker(e),scriptURL:e,clientCount:1};return Bo[r]=n,n}function M1(r){const t=Bo[r||bu];if(t&&t.clientCount--===1){const{worker:i,objectURL:n}=t;delete Bo[r||bu],n&&self.URL.revokeObjectURL(n),i.terminate()}}function NA(r,t){return t+10<=r.length&&r[t]===51&&r[t+1]===68&&r[t+2]===73&&r[t+3]<255&&r[t+4]<255&&r[t+6]<128&&r[t+7]<128&&r[t+8]<128&&r[t+9]<128}function cp(r,t){return t+10<=r.length&&r[t]===73&&r[t+1]===68&&r[t+2]===51&&r[t+3]<255&&r[t+4]<255&&r[t+6]<128&&r[t+7]<128&&r[t+8]<128&&r[t+9]<128}function vf(r,t){let e=0;return e=(r[t]&127)<<21,e|=(r[t+1]&127)<<14,e|=(r[t+2]&127)<<7,e|=r[t+3]&127,e}function xu(r,t){const e=t;let i=0;for(;cp(r,t);){i+=10;const n=vf(r,t+6);i+=n,NA(r,t+10)&&(i+=10),t+=i}if(i>0)return r.subarray(e,e+i)}function k1(r,t,e,i){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=t[e+2],l=a>>2&15;if(l>12){const T=new Error(`invalid ADTS sampling index:${l}`);r.emit(b.ERROR,b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!0,error:T,reason:T.message});return}const c=(a>>6&3)+1,f=t[e+3]>>6&3|(a&1)<<2,h="mp4a.40."+c,g=n[l];let p=l;(c===5||c===29)&&(p-=3);const E=[c<<3|(p&14)>>1,(p&1)<<7|f<<3];return ie.log(`manifest codec:${i}, parsed codec:${h}, channels:${f}, rate:${g} (ADTS object type:${c} sampling index:${l})`),{config:E,samplerate:g,channelCount:f,codec:h,parsedCodec:h,manifestCodec:i}}function FA(r,t){return r[t]===255&&(r[t+1]&246)===240}function UA(r,t){return r[t+1]&1?7:9}function hp(r,t){return(r[t+3]&3)<<11|r[t+4]<<3|(r[t+5]&224)>>>5}function N1(r,t){return t+5<r.length}function tf(r,t){return t+1<r.length&&FA(r,t)}function F1(r,t){return N1(r,t)&&FA(r,t)&&hp(r,t)<=r.length-t}function U1(r,t){if(tf(r,t)){const e=UA(r,t);if(t+e>=r.length)return!1;const i=hp(r,t);if(i<=e)return!1;const n=t+i;return n===r.length||tf(r,n)}return!1}function BA(r,t,e,i,n){if(!r.samplerate){const a=k1(t,e,i,n);if(!a)return;he(r,a)}}function VA(r){return 1024*9e4/r}function B1(r,t){const e=UA(r,t);if(t+e<=r.length){const i=hp(r,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}function GA(r,t,e,i,n){const a=VA(r.samplerate),l=i+n*a,c=B1(t,e);let f;if(c){const{frameLength:p,headerLength:E}=c,T=E+p,S=Math.max(0,e+T-t.length);S?(f=new Uint8Array(T-E),f.set(t.subarray(e+E,t.length),0)):f=t.subarray(e+E,e+T);const R={unit:f,pts:l};return S||r.samples.push(R),{sample:R,length:T,missing:S}}const h=t.length-e;return f=new Uint8Array(h),f.set(t.subarray(e,t.length),0),{sample:{unit:f,pts:l},length:h,missing:-1}}function V1(r,t){return cp(r,t)&&vf(r,t+6)+10<=r.length-t}function G1(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function zg(r,t=0,e=1/0){return $1(r,t,e,Uint8Array)}function $1(r,t,e,i){const n=H1(r);let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const l=K1(r)?r.byteOffset:0,c=(l+r.byteLength)/a,f=(l+t)/a,h=Math.floor(Math.max(0,Math.min(f,c))),g=Math.floor(Math.min(h+Math.max(e,0),c));return new i(n,h,g-h)}function H1(r){return r instanceof ArrayBuffer?r:r.buffer}function K1(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function z1(r){const t={key:r.type,description:"",data:"",mimeType:null,pictureType:null},e=3;if(r.size<2)return;if(r.data[0]!==e){console.log("Ignore frame with unrecognized character encoding");return}const i=r.data.subarray(1).indexOf(0);if(i===-1)return;const n=qi(zg(r.data,1,i)),a=r.data[2+i],l=r.data.subarray(3+i).indexOf(0);if(l===-1)return;const c=qi(zg(r.data,3+i,l));let f;return n==="-->"?f=qi(zg(r.data,4+i+l)):f=G1(r.data.subarray(4+i+l)),t.mimeType=n,t.pictureType=a,t.description=c,t.data=f,t}function q1(r){if(r.size<2)return;const t=qi(r.data,!0),e=new Uint8Array(r.data.subarray(t.length+1));return{key:r.type,info:t,data:e.buffer}}function j1(r){if(r.size<2)return;if(r.type==="TXXX"){let e=1;const i=qi(r.data.subarray(e),!0);e+=i.length+1;const n=qi(r.data.subarray(e));return{key:r.type,info:i,data:n}}const t=qi(r.data.subarray(1));return{key:r.type,info:"",data:t}}function Y1(r){if(r.type==="WXXX"){if(r.size<2)return;let e=1;const i=qi(r.data.subarray(e),!0);e+=i.length+1;const n=qi(r.data.subarray(e));return{key:r.type,info:i,data:n}}const t=qi(r.data);return{key:r.type,info:"",data:t}}function Q1(r){return r.type==="PRIV"?q1(r):r.type[0]==="W"?Y1(r):r.type==="APIC"?z1(r):j1(r)}function X1(r){const t=String.fromCharCode(r[0],r[1],r[2],r[3]),e=vf(r,4),i=10;return{type:t,size:e,data:r.subarray(i,i+e)}}const Eh=10,W1=10;function $A(r){let t=0;const e=[];for(;cp(r,t);){const i=vf(r,t+6);r[t+5]>>6&1&&(t+=Eh),t+=Eh;const n=t+i;for(;t+W1<n;){const a=X1(r.subarray(t)),l=Q1(a);l&&e.push(l),t+=a.size+Eh}NA(r,t)&&(t+=Eh)}return e}function HA(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function Z1(r){if(r.data.byteLength===8){const t=new Uint8Array(r.data),e=t[3]&1;let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,e&&(i+=4772185884e-2),Math.round(i)}}function fp(r){const t=$A(r);for(let e=0;e<t.length;e++){const i=t[e];if(HA(i))return Z1(i)}}let Ki=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Qn(r="",t=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class dp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=fn(this.cachedData,t),this.cachedData=null);let i=xu(t,0),n=i?i.length:0,a;const l=this._audioTrack,c=this._id3Track,f=i?fp(i):void 0,h=t.length;for((this.basePTS===null||this.frameIndex===0&&vt(f))&&(this.basePTS=J1(f,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ki.audioId3,duration:Number.POSITIVE_INFINITY});n<h;){if(this.canParse(t,n)){const g=this.appendFrame(l,t,n);g?(this.frameIndex++,this.lastPTS=g.sample.pts,n+=g.length,a=n):n=h}else V1(t,n)?(i=xu(t,n),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ki.audioId3,duration:Number.POSITIVE_INFINITY}),n+=i.length,a=n):n++;if(n===h&&a!==h){const g=t.slice(a);this.cachedData?this.cachedData=fn(this.cachedData,g):this.cachedData=g}}return{audioTrack:l,videoTrack:Qn(),id3Track:c,textTrack:Qn()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Qn(),id3Track:this._id3Track,textTrack:Qn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const J1=(r,t,e)=>{if(vt(r))return r*90;const i=e?e.baseTime*9e4/e.timescale:0;return t*9e4+i};let vh=null;const tL=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],eL=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],iL=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],nL=[0,1,1,4];function KA(r,t,e,i,n){if(e+24>t.length)return;const a=zA(t,e);if(a&&e+a.frameLength<=t.length){const l=a.samplesPerFrame*9e4/a.sampleRate,c=i+n*l,f={unit:t.subarray(e,e+a.frameLength),pts:c,dts:c};return r.config=[],r.channelCount=a.channelCount,r.samplerate=a.sampleRate,r.samples.push(f),{sample:f,length:a.frameLength,missing:0}}}function zA(r,t){const e=r[t+1]>>3&3,i=r[t+1]>>1&3,n=r[t+2]>>4&15,a=r[t+2]>>2&3;if(e!==1&&n!==0&&n!==15&&a!==3){const l=r[t+2]>>1&1,c=r[t+3]>>6,f=e===3?3-i:i===3?3:4,h=tL[f*14+n-1]*1e3,p=eL[(e===3?0:e===2?1:2)*3+a],E=c===3?1:2,T=iL[e][i],S=nL[i],R=T*8*S,_=Math.floor(T*h/p+l)*S;if(vh===null){const M=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vh=M?parseInt(M[1]):0}return!!vh&&vh<=87&&i===2&&h>=224e3&&c===0&&(r[t+3]=r[t+3]|128),{sampleRate:p,channelCount:E,frameLength:_,samplesPerFrame:R}}}function gp(r,t){return r[t]===255&&(r[t+1]&224)===224&&(r[t+1]&6)!==0}function qA(r,t){return t+1<r.length&&gp(r,t)}function sL(r,t){return gp(r,t)&&4<=r.length-t}function jA(r,t){if(t+1<r.length&&gp(r,t)){const i=zA(r,t);let n=4;i!=null&&i.frameLength&&(n=i.frameLength);const a=t+n;return a===r.length||qA(r,a)}return!1}class rL extends dp{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,n){super.resetInitSegment(t,e,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const i=xu(t,0);let n=i?.length||0;if(jA(t,n))return!1;for(let a=t.length;n<a;n++)if(U1(t,n))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return F1(t,e)}appendFrame(t,e,i){BA(t,this.observer,e,i,t.manifestCodec);const n=GA(t,e,i,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const YA=(r,t)=>{let e=0,i=5;t+=i;const n=new Uint32Array(1),a=new Uint32Array(1),l=new Uint8Array(1);for(;i>0;){l[0]=r[t];const c=Math.min(i,8),f=8-c;a[0]=4278190080>>>24+f<<f,n[0]=(l[0]&a[0])>>f,e=e?e<<c|n[0]:n[0],t+=1,i-=c}return e};class aL extends dp{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,i,n){super.resetInitSegment(t,e,i,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,i){const n=QA(t,e,i,this.basePTS,this.frameIndex);if(n!==-1)return{sample:t.samples[t.samples.length-1],length:n,missing:0}}static probe(t){if(!t)return!1;const e=xu(t,0);if(!e)return!1;const i=e.length;return t[i]===11&&t[i+1]===119&&fp(e)!==void 0&&YA(t,i)<16}}function QA(r,t,e,i,n){if(e+8>t.length||t[e]!==11||t[e+1]!==119)return-1;const a=t[e+4]>>6;if(a>=3)return-1;const c=[48e3,44100,32e3][a],f=t[e+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+a]*2;if(e+g>t.length)return-1;const p=t[e+6]>>5;let E=0;p===2?E+=2:(p&1&&p!==1&&(E+=2),p&4&&(E+=2));const T=(t[e+6]<<8|t[e+7])>>12-E&1,R=[2,1,2,3,3,4,4,5][p]+T,_=t[e+5]>>3,D=t[e+5]&7,N=new Uint8Array([a<<6|_<<1|D>>2,(D&3)<<6|p<<3|T<<2|f>>4,f<<4&224]),M=1536/c*9e4,G=i+n*M,$=t.subarray(e,e+g);return r.config=N,r.channelCount=R,r.samplerate=c,r.samples.push({unit:$,pts:G}),g}class oL extends dp{resetInitSegment(t,e,i,n){super.resetInitSegment(t,e,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=xu(t,0);let i=e?.length||0;if(e&&t[i]===11&&t[i+1]===119&&fp(e)!==void 0&&YA(t,i)<=16)return!1;for(let n=t.length;i<n;i++)if(jA(t,i))return ie.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return sL(t,e)}appendFrame(t,e,i){if(this.basePTS!==null)return KA(t,e,i,this.basePTS,this.frameIndex)}}const lL=/\/emsg[-/]ID3/i;class uL{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,n){const a=this.videoTrack=Qn("video",1),l=this.audioTrack=Qn("audio",1),c=this.txtTrack=Qn("text",1);if(this.id3Track=Qn("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const f=lA(t);if(f.video){const{id:h,timescale:g,codec:p,supplemental:E}=f.video;a.id=h,a.timescale=c.timescale=g,a.codec=p,a.supplemental=E}if(f.audio){const{id:h,timescale:g,codec:p}=f.audio;l.id=h,l.timescale=g,l.codec=p}c.id=rA.text,a.sampleDuration=0,a.duration=l.duration=n}resetContiguity(){this.remainderData=null}static probe(t){return hI(t)}demux(t,e){this.timeOffset=e;let i=t;const n=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=fn(this.remainderData,t));const c=EI(i);this.remainderData=c.remainder,n.samples=c.valid||new Uint8Array}else n.samples=i;const l=this.extractID3Track(n,e);return a.samples=Dv(e,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(e,this.timeOffset);return i.samples=Dv(t,e),{videoTrack:e,audioTrack:Qn(),id3Track:n,textTrack:Qn()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const n=Ft(t.samples,["emsg"]);n&&n.forEach(a=>{const l=TI(a);if(lL.test(l.schemeIdUri)){const c=uT(l,e);let f=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const h=l.payload;i.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:Ki.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=uT(l,e);i.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:Ki.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function uT(r,t){return vt(r.presentationTime)?r.presentationTime/r.timeScale:t+r.presentationTimeDelta/r.timeScale}class cL{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new sp(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,br.cbc)}decryptAacSample(t,e,i){const n=t[e].unit;if(n.length<=16)return;const a=n.subarray(16,n.length-n.length%16),l=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(l).then(c=>{const f=new Uint8Array(c);n.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)})}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length){i();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,i=new Int8Array(e);let n=0;for(let a=32;a<t.length-16;a+=160,n+=16)i.set(t.subarray(a,a+16),n);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let n=0;for(let a=32;a<t.length-16;a+=160,n+=16)t.set(i.subarray(n,n+16),a);return t}decryptAvcSample(t,e,i,n,a){const l=cA(a.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(f=>{a.data=this.getAvcDecryptedUnit(l,f),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,n)})}decryptAvcSamples(t,e,i,n){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length){n();return}const a=t[e].units;for(;!(i>=a.length);i++){const l=a[i];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(t,e,i,n,l),!this.decrypter.isSync()))return}}}}class XA{constructor(){this.VideoSample=null}createVideoSample(t,e,i){return{key:t,frame:!1,pts:e,dts:i,units:[],length:0}}getLastNalUnit(t){var e;let i=this.VideoSample,n;if((!i||i.units.length===0)&&(i=t[t.length-1]),(e=i)!=null&&e.units){const a=i.units;n=a[a.length-1]}return n}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){const i=e.samples,n=i.length;if(n){const a=i[n-1];t.pts=a.pts,t.dts=a.dts}else{e.dropped++;return}}e.samples.push(t)}}parseNALu(t,e,i){const n=e.byteLength;let a=t.naluState||0;const l=a,c=[];let f=0,h,g,p,E=-1,T=0;for(a===-1&&(E=0,T=this.getNALuType(e,0),a=0,f=1);f<n;){if(h=e[f++],!a){a=h?0:1;continue}if(a===1){a=h?0:2;continue}if(!h)a=3;else if(h===1){if(g=f-a-1,E>=0){const S={data:e.subarray(E,g),type:T};c.push(S)}else{const S=this.getLastNalUnit(t.samples);S&&(l&&f<=4-l&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-l)),g>0&&(S.data=fn(S.data,e.subarray(0,g)),S.state=0))}f<n?(p=this.getNALuType(e,f),E=f,T=p,a=0):a=-1}else a=0}if(E>=0&&a>=0){const S={data:e.subarray(E,n),type:T,state:a};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(t.samples);S&&(S.data=fn(S.data,e))}return t.naluState=a,c}}class du{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,n=new Uint8Array(4),a=Math.min(4,e);if(a===0)throw new Error("no bytes available");n.set(t.subarray(i,i+a)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&ie.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class cT extends XA{parsePES(t,e,i,n){const a=this.parseNALu(t,i.data,n);let l=this.VideoSample,c,f=!1;i.data=null,l&&a.length&&!t.audFound&&(this.pushAccessUnit(l,t),l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.forEach(h=>{var g,p;switch(h.type){case 1:{let R=!1;c=!0;const _=h.data;if(f&&_.length>4){const D=this.readSliceType(_);(D===2||D===4||D===7||D===9)&&(R=!0)}if(R){var E;(E=l)!=null&&E.frame&&!l.key&&(this.pushAccessUnit(l,t),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.frame=!0,l.key=R;break}case 5:c=!0,(g=l)!=null&&g.frame&&!l.key&&(this.pushAccessUnit(l,t),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,ip(h.data,1,i.pts,e.samples);break}case 7:{var T,S;c=!0,f=!0;const R=h.data,_=this.readSPS(R);if(!t.sps||t.width!==_.width||t.height!==_.height||((T=t.pixelRatio)==null?void 0:T[0])!==_.pixelRatio[0]||((S=t.pixelRatio)==null?void 0:S[1])!==_.pixelRatio[1]){t.width=_.width,t.height=_.height,t.pixelRatio=_.pixelRatio,t.sps=[R];const D=R.subarray(1,4);let N="avc1.";for(let M=0;M<3;M++){let G=D[M].toString(16);G.length<2&&(G="0"+G),N+=G}t.codec=N}break}case 8:c=!0,t.pps=[h.data];break;case 9:c=!0,t.audFound=!0,(p=l)!=null&&p.frame&&(this.pushAccessUnit(l,t),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(h)}),n&&l&&(this.pushAccessUnit(l,t),this.VideoSample=null)}getNALuType(t,e){return t[e]&31}readSliceType(t){const e=new du(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let i=8,n=8,a;for(let l=0;l<t;l++)n!==0&&(a=e.readEG(),n=(i+a+256)%256),i=n===0?i:n}readSPS(t){const e=new du(t);let i=0,n=0,a=0,l=0,c,f,h;const g=e.readUByte.bind(e),p=e.readBits.bind(e),E=e.readUEG.bind(e),T=e.readBoolean.bind(e),S=e.skipBits.bind(e),R=e.skipEG.bind(e),_=e.skipUEG.bind(e),D=this.skipScalingList.bind(this);g();const N=g();if(p(5),S(3),g(),_(),N===100||N===110||N===122||N===244||N===44||N===83||N===86||N===118||N===128){const L=E();if(L===3&&S(1),_(),_(),S(1),T())for(f=L!==3?8:12,h=0;h<f;h++)T()&&(h<6?D(16,e):D(64,e))}_();const M=E();if(M===0)E();else if(M===1)for(S(1),R(),R(),c=E(),h=0;h<c;h++)R();_(),S(1);const G=E(),$=E(),q=p(1);q===0&&S(1),S(1),T()&&(i=E(),n=E(),a=E(),l=E());let w=[1,1];if(T()&&T())switch(g()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((G+1)*16-i*2-n*2),height:(2-q)*($+1)*16-(q?2:4)*(a+l),pixelRatio:w}}}class hT extends XA{constructor(...t){super(...t),this.initVPS=null}parsePES(t,e,i,n){const a=this.parseNALu(t,i.data,n);let l=this.VideoSample,c,f=!1;i.data=null,l&&a.length&&!t.audFound&&(this.pushAccessUnit(l,t),l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.forEach(h=>{var g,p;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,f){var E;(E=l)!=null&&E.frame&&!l.key&&(this.pushAccessUnit(l,t),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(g=l)!=null&&g.frame&&!l.key&&(this.pushAccessUnit(l,t),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,ip(h.data,2,i.pts,e.samples);break;case 32:c=!0,t.vps||(typeof t.params!="object"&&(t.params={}),t.params=he(t.params,this.readVPS(h.data)),this.initVPS=h.data),t.vps=[h.data];break;case 33:if(c=!0,f=!0,t.vps!==void 0&&t.vps[0]!==this.initVPS&&t.sps!==void 0&&!this.matchSPS(t.sps[0],h.data)&&(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const T=this.readSPS(h.data);t.width=T.width,t.height=T.height,t.pixelRatio=T.pixelRatio,t.codec=T.codecString,t.sps=[],typeof t.params!="object"&&(t.params={});for(const S in T.params)t.params[S]=T.params[S]}this.pushParameterSet(t.sps,h.data,t.vps),l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0;break;case 34:if(c=!0,typeof t.params=="object"){if(!t.pps){t.pps=[];const T=this.readPPS(h.data);for(const S in T)t.params[S]=T[S]}this.pushParameterSet(t.pps,h.data,t.vps)}break;case 35:c=!0,t.audFound=!0,(p=l)!=null&&p.frame&&(this.pushAccessUnit(l,t),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}l&&c&&l.units.push(h)}),n&&l&&(this.pushAccessUnit(l,t),this.VideoSample=null)}pushParameterSet(t,e,i){(i&&i[0]===this.initVPS||!i&&!t.length)&&t.push(e)}getNALuType(t,e){return(t[e]&126)>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let i=0;for(let n=0;n<t.byteLength;n++)n>=2&&t[n]===3&&t[n-1]===0&&t[n-2]===0||(e[i]=t[n],i++);return new Uint8Array(e.buffer,0,i)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new du(t);e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6);const i=e.readBits(3),n=e.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:n}}readSPS(t){const e=new du(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const i=e.readBits(3);e.readBoolean();const n=e.readBits(2),a=e.readBoolean(),l=e.readBits(5),c=e.readUByte(),f=e.readUByte(),h=e.readUByte(),g=e.readUByte(),p=e.readUByte(),E=e.readUByte(),T=e.readUByte(),S=e.readUByte(),R=e.readUByte(),_=e.readUByte(),D=e.readUByte(),N=[],M=[];for(let Kt=0;Kt<i;Kt++)N.push(e.readBoolean()),M.push(e.readBoolean());if(i>0)for(let Kt=i;Kt<8;Kt++)e.readBits(2);for(let Kt=0;Kt<i;Kt++)N[Kt]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),M[Kt]&&e.readUByte();e.readUEG();const G=e.readUEG();G==3&&e.skipBits(1);const $=e.readUEG(),q=e.readUEG(),w=e.readBoolean();let L=0,O=0,C=0,U=0;w&&(L+=e.readUEG(),O+=e.readUEG(),C+=e.readUEG(),U+=e.readUEG());const V=e.readUEG(),B=e.readUEG(),pt=e.readUEG(),gt=e.readBoolean();for(let Kt=gt?0:i;Kt<=i;Kt++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(let le=0;le<4;le++)for(let pi=0;pi<(le===3?2:6);pi++)if(!e.readBoolean())e.readUEG();else{const Ze=Math.min(64,1<<4+(le<<1));le>1&&e.readEG();for(let Li=0;Li<Ze;Li++)e.readEG()}e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const ct=e.readUEG();let rt=0;for(let Kt=0;Kt<ct;Kt++){let le=!1;if(Kt!==0&&(le=e.readBoolean()),le){Kt===ct&&e.readUEG(),e.readBoolean(),e.readUEG();let pi=0;for(let ki=0;ki<=rt;ki++){const Ze=e.readBoolean();let Li=!1;Ze||(Li=e.readBoolean()),(Ze||Li)&&pi++}rt=pi}else{const pi=e.readUEG(),ki=e.readUEG();rt=pi+ki;for(let Ze=0;Ze<pi;Ze++)e.readUEG(),e.readBoolean();for(let Ze=0;Ze<ki;Ze++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const Kt=e.readUEG();for(let le=0;le<Kt;le++){for(let pi=0;pi<pt+4;pi++)e.readBits(1);e.readBits(1)}}let tt=0,at=1,st=1,mt=!0,Tt=1,Et=0;e.readBoolean(),e.readBoolean();let Yt=!1;if(e.readBoolean()){if(e.readBoolean()){const yn=e.readUByte(),rs=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ln=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];yn>0&&yn<16?(at=rs[yn-1],st=Ln[yn-1]):yn===255&&(at=e.readBits(16),st=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),Yt=e.readBoolean(),Yt&&(L+=e.readUEG(),O+=e.readUEG(),C+=e.readUEG(),U+=e.readUEG()),e.readBoolean()&&(Tt=e.readBits(32),Et=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){const Ln=e.readBoolean(),Pr=e.readBoolean();let fe=!1;(Ln||Pr)&&(fe=e.readBoolean(),fe&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),fe&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let te=0;te<=i;te++){mt=e.readBoolean();const _i=mt||e.readBoolean();let $e=!1;_i?e.readEG():$e=e.readBoolean();const Mr=$e?1:e.readUEG()+1;if(Ln)for(let as=0;as<Mr;as++)e.readUEG(),e.readUEG(),fe&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(Pr)for(let as=0;as<Mr;as++)e.readUEG(),e.readUEG(),fe&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),tt=e.readUEG())}let Ge=$,dn=q;if(w||Yt){let Kt=1,le=1;G===1?Kt=le=2:G==2&&(Kt=2),Ge=$-Kt*O-Kt*L,dn=q-le*U-le*C}const gn=n?["A","B","C"][n]:"",ss=c<<24|f<<16|h<<8|g;let mn=0;for(let Kt=0;Kt<32;Kt++)mn=(mn|(ss>>Kt&1)<<31-Kt)>>>0;let pn=mn.toString(16);return l===1&&pn==="2"&&(pn="6"),{codecString:`hvc1.${gn}${l}.${pn}.${a?"H":"L"}${D}.B0`,params:{general_tier_flag:a,general_profile_idc:l,general_profile_space:n,general_profile_compatibility_flags:[c,f,h,g],general_constraint_indicator_flags:[p,E,T,S,R,_],general_level_idc:D,bit_depth:V+8,bit_depth_luma_minus8:V,bit_depth_chroma_minus8:B,min_spatial_segmentation_idc:tt,chroma_format_idc:G,frame_rate:{fixed:mt,fps:Et/Tt}},width:Ge,height:dn,pixelRatio:[at,st]}}readPPS(t){const e=new du(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const n=e.readBoolean(),a=e.readBoolean();let l=1;return a&&n?l=0:a?l=3:n&&(l=2),{parallelismType:l}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const si=188;class Er{constructor(t,e,i,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=i,this.logger=n,this.videoParser=null}static probe(t,e){const i=Er.syncOffset(t);return i>0&&e.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(t){const e=t.length;let i=Math.min(si*5,e-si)+1,n=0;for(;n<i;){let a=!1,l=-1,c=0;for(let f=n;f<e;f+=si)if(t[f]===71&&(e-f===si||t[f+si]===71)){if(c++,l===-1&&(l=f,l!==0&&(i=Math.min(l+si*99,t.length-si)+1)),a||(a=Am(t,f)===0),a&&c>1&&(l===0&&c>2||f+si>i))return l}else{if(c)return-1;break}n++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:rA[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,i,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Er.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Er.createTrack("audio",n),this._id3Track=Er.createTrack("id3"),this._txtTrack=Er.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,i=!1,n=!1){i||(this.sampleAes=null);let a;const l=this._videoTrack,c=this._audioTrack,f=this._id3Track,h=this._txtTrack;let g=l.pid,p=l.pesData,E=c.pid,T=f.pid,S=c.pesData,R=f.pesData,_=null,D=this.pmtParsed,N=this._pmtId,M=t.length;if(this.remainderData&&(t=fn(this.remainderData,t),M=t.length,this.remainderData=null),M<si&&!n)return this.remainderData=t,{audioTrack:c,videoTrack:l,id3Track:f,textTrack:h};const G=Math.max(0,Er.syncOffset(t));M-=(M-G)%si,M<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,M,t.buffer.byteLength-M));let $=0;for(let w=G;w<M;w+=si)if(t[w]===71){const L=!!(t[w+1]&64),O=Am(t,w),C=(t[w+3]&48)>>4;let U;if(C>1){if(U=w+5+t[w+4],U===w+si)continue}else U=w+4;switch(O){case g:if(L){if(p&&(a=Ro(p,this.logger))){if(this.videoParser===null)switch(l.segmentCodec){case"avc":this.videoParser=new cT;break;case"hevc":this.videoParser=new hT;break}this.videoParser!==null&&this.videoParser.parsePES(l,h,a,!1)}p={data:[],size:0}}p&&(p.data.push(t.subarray(U,w+si)),p.size+=w+si-U);break;case E:if(L){if(S&&(a=Ro(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,a);break;case"mp3":this.parseMPEGPES(c,a);break;case"ac3":this.parseAC3PES(c,a);break}S={data:[],size:0}}S&&(S.data.push(t.subarray(U,w+si)),S.size+=w+si-U);break;case T:L&&(R&&(a=Ro(R,this.logger))&&this.parseID3PES(f,a),R={data:[],size:0}),R&&(R.data.push(t.subarray(U,w+si)),R.size+=w+si-U);break;case 0:L&&(U+=t[U]+1),N=this._pmtId=hL(t,U);break;case N:{L&&(U+=t[U]+1);const V=fL(t,U,this.typeSupported,i,this.observer,this.logger);g=V.videoPid,g>0&&(l.pid=g,l.segmentCodec=V.segmentVideoCodec),E=V.audioPid,E>0&&(c.pid=E,c.segmentCodec=V.segmentAudioCodec),T=V.id3Pid,T>0&&(f.pid=T),_!==null&&!D&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${_}'. Backtracking to sync byte @${G} to parse all TS packets.`),_=null,w=G-188),D=this.pmtParsed=!0;break}case 17:case 8191:break;default:_=O;break}}else $++;$>0&&_m(this.observer,new Error(`Found ${$} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=p,c.pesData=S,f.pesData=R;const q={audioTrack:c,videoTrack:l,id3Track:f,textTrack:h};return n&&this.extractRemainingSamples(q),q}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:n,textTrack:a}=t,l=i.pesData,c=e.pesData,f=n.pesData;let h;if(l&&(h=Ro(l,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new cT;break;case"hevc":this.videoParser=new hT;break}this.videoParser!==null&&(this.videoParser.parsePES(i,a,h,!0),i.pesData=null)}else i.pesData=l;if(c&&(h=Ro(c,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,h);break;case"mp3":this.parseMPEGPES(e,h);break;case"ac3":this.parseAC3PES(e,h);break}e.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=c;f&&(h=Ro(f,this.logger))?(this.parseID3PES(n,h),n.pesData=null):n.pesData=f}demuxSampleAes(t,e,i){const n=this.demux(t,i,!0,!this.config.progressive),a=this.sampleAes=new cL(this.observer,this.config,e);return this.decrypt(n,a)}decrypt(t,e){return new Promise(i=>{const{audioTrack:n,videoTrack:a}=t;n.samples&&n.segmentCodec==="aac"?e.decryptAacSamples(n.samples,0,()=>{a.samples?e.decryptAvcSamples(a.samples,0,0,()=>{i(t)}):i(t)}):a.samples&&e.decryptAvcSamples(a.samples,0,0,()=>{i(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let i=0;const n=this.aacOverFlow;let a=e.data;if(n){this.aacOverFlow=null;const p=n.missing,E=n.sample.unit.byteLength;if(p===-1)a=fn(n.sample.unit,a);else{const T=E-p;n.sample.unit.set(a.subarray(0,p),T),t.samples.push(n.sample),i=n.missing}}let l,c;for(l=i,c=a.length;l<c-1&&!tf(a,l);l++);if(l!==i){let p;const E=l<c-1;if(E?p=`AAC PES did not start with ADTS header,offset:${l}`:p="No ADTS header found in AAC PES",_m(this.observer,new Error(p),E,this.logger),!E)return}BA(t,this.observer,a,l,this.audioCodec);let f;if(e.pts!==void 0)f=e.pts;else if(n){const p=VA(t.samplerate);f=n.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,g;for(;l<c;)if(g=GA(t,a,l,f,h),l+=g.length,g.missing){this.aacOverFlow=g;break}else for(h++;l<c-1&&!tf(a,l);l++);}parseMPEGPES(t,e){const i=e.data,n=i.length;let a=0,l=0;const c=e.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<n;)if(qA(i,l)){const f=KA(t,i,l,c,a);if(f)l+=f.length,a++;else break}else l++}parseAC3PES(t,e){{const i=e.data,n=e.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=i.length;let l=0,c=0,f;for(;c<a&&(f=QA(t,i,c,n,l++))>0;)c+=f}}parseID3PES(t,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=he({},e,{type:this._videoTrack?Ki.emsg:Ki.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function Am(r,t){return((r[t+1]&31)<<8)+r[t+2]}function hL(r,t){return(r[t+10]&31)<<8|r[t+11]}function fL(r,t,e,i,n,a){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(r[t+1]&15)<<8|r[t+2],f=t+3+c-4,h=(r[t+10]&15)<<8|r[t+11];for(t+=12+h;t<f;){const g=Am(r,t),p=(r[t+3]&15)<<8|r[t+4];switch(r[t]){case 207:if(!i){qg("ADTS AAC",a);break}case 15:l.audioPid===-1&&(l.audioPid=g);break;case 21:l.id3Pid===-1&&(l.id3Pid=g);break;case 219:if(!i){qg("H.264",a);break}case 27:l.videoPid===-1&&(l.videoPid=g);break;case 3:case 4:!e.mpeg&&!e.mp3?a.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=g,l.segmentAudioCodec="mp3");break;case 193:if(!i){qg("AC-3",a);break}case 129:e.ac3?l.audioPid===-1&&(l.audioPid=g,l.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&p>0){let E=t+5,T=p;for(;T>2;){switch(r[E]){case 106:e.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=g,l.segmentAudioCodec="ac3");break}const R=r[E+1]+2;E+=R,T-=R}}break;case 194:case 135:return _m(n,new Error("Unsupported EC-3 in M2TS found"),void 0,a),l;case 36:l.videoPid===-1&&(l.videoPid=g,l.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}t+=p+5}return l}function _m(r,t,e,i){i.warn(`parsing error: ${t.message}`),r.emit(b.ERROR,b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:t,reason:t.message})}function qg(r,t){t.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function Ro(r,t){let e=0,i,n,a,l,c;const f=r.data;if(!r||r.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=fn(f[0],f[1]),f.splice(1,1);if(i=f[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(n=(i[4]<<8)+i[5],n&&n>r.size-6)return null;const g=i[7];g&192&&(l=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,g&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,l-c>60*9e4&&(t.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),a=i[8];let p=a+9;if(r.size<=p)return null;r.size-=p;const E=new Uint8Array(r.size);for(let T=0,S=f.length;T<S;T++){i=f[T];let R=i.byteLength;if(p)if(p>R){p-=R;continue}else i=i.subarray(p),R-=p,p=0;E.set(i,e),e+=R}return n&&(n-=a+3),{data:E,pts:l,dts:c,len:n}}return null}class dL{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const mr=Math.pow(2,32)-1;class Y{static init(){Y.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in Y.types)Y.types.hasOwnProperty(t)&&(Y.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Y.HDLR_TYPES={video:e,audio:i};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);Y.STTS=Y.STSC=Y.STCO=a,Y.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Y.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Y.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Y.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);Y.FTYP=Y.box(Y.types.ftyp,l,f,l,c),Y.DINF=Y.box(Y.types.dinf,Y.box(Y.types.dref,n))}static box(t,...e){let i=8,n=e.length;const a=n;for(;n--;)i+=e[n].byteLength;const l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(t,4),n=0,i=8;n<a;n++)l.set(e[n],i),i+=e[n].byteLength;return l}static hdlr(t){return Y.box(Y.types.hdlr,Y.HDLR_TYPES[t])}static mdat(t){return Y.box(Y.types.mdat,t)}static mdhd(t,e){e*=t;const i=Math.floor(e/(mr+1)),n=Math.floor(e%(mr+1));return Y.box(Y.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(t){return Y.box(Y.types.mdia,Y.mdhd(t.timescale||0,t.duration||0),Y.hdlr(t.type),Y.minf(t))}static mfhd(t){return Y.box(Y.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?Y.box(Y.types.minf,Y.box(Y.types.smhd,Y.SMHD),Y.DINF,Y.stbl(t)):Y.box(Y.types.minf,Y.box(Y.types.vmhd,Y.VMHD),Y.DINF,Y.stbl(t))}static moof(t,e,i){return Y.box(Y.types.moof,Y.mfhd(t),Y.traf(i,e))}static moov(t){let e=t.length;const i=[];for(;e--;)i[e]=Y.trak(t[e]);return Y.box.apply(null,[Y.types.moov,Y.mvhd(t[0].timescale||0,t[0].duration||0)].concat(i).concat(Y.mvex(t)))}static mvex(t){let e=t.length;const i=[];for(;e--;)i[e]=Y.trex(t[e]);return Y.box.apply(null,[Y.types.mvex,...i])}static mvhd(t,e){e*=t;const i=Math.floor(e/(mr+1)),n=Math.floor(e%(mr+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Y.box(Y.types.mvhd,a)}static sdtp(t){const e=t.samples||[],i=new Uint8Array(4+e.length);let n,a;for(n=0;n<e.length;n++)a=e[n].flags,i[n+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return Y.box(Y.types.sdtp,i)}static stbl(t){return Y.box(Y.types.stbl,Y.stsd(t),Y.box(Y.types.stts,Y.STTS),Y.box(Y.types.stsc,Y.STSC),Y.box(Y.types.stsz,Y.STSZ),Y.box(Y.types.stco,Y.STCO))}static avc1(t){let e=[],i=[],n,a,l;for(n=0;n<t.sps.length;n++)a=t.sps[n],l=a.byteLength,e.push(l>>>8&255),e.push(l&255),e=e.concat(Array.prototype.slice.call(a));for(n=0;n<t.pps.length;n++)a=t.pps[n],l=a.byteLength,i.push(l>>>8&255),i.push(l&255),i=i.concat(Array.prototype.slice.call(a));const c=Y.box(Y.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i))),f=t.width,h=t.height,g=t.pixelRatio[0],p=t.pixelRatio[1];return Y.box(Y.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,Y.box(Y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Y.box(Y.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(t){const e=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e,6,1,2])}static audioStsd(t){const e=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,e>>8&255,e&255,0,0])}static mp4a(t){return Y.box(Y.types.mp4a,Y.audioStsd(t),Y.box(Y.types.esds,Y.esds(t)))}static mp3(t){return Y.box(Y.types[".mp3"],Y.audioStsd(t))}static ac3(t){return Y.box(Y.types["ac-3"],Y.audioStsd(t),Y.box(Y.types.dac3,t.config))}static stsd(t){const{segmentCodec:e}=t;if(t.type==="audio"){if(e==="aac")return Y.box(Y.types.stsd,Y.STSD,Y.mp4a(t));if(e==="ac3"&&t.config)return Y.box(Y.types.stsd,Y.STSD,Y.ac3(t));if(e==="mp3"&&t.codec==="mp3")return Y.box(Y.types.stsd,Y.STSD,Y.mp3(t))}else if(t.pps&&t.sps){if(e==="avc")return Y.box(Y.types.stsd,Y.STSD,Y.avc1(t));if(e==="hevc"&&t.vps)return Y.box(Y.types.stsd,Y.STSD,Y.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${e}/${t.codec})`)}static tkhd(t){const e=t.id,i=(t.duration||0)*(t.timescale||0),n=t.width||0,a=t.height||0,l=Math.floor(i/(mr+1)),c=Math.floor(i%(mr+1));return Y.box(Y.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,a>>8&255,a&255,0,0]))}static traf(t,e){const i=Y.sdtp(t),n=t.id,a=Math.floor(e/(mr+1)),l=Math.floor(e%(mr+1));return Y.box(Y.types.traf,Y.box(Y.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),Y.box(Y.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255])),Y.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,Y.box(Y.types.trak,Y.tkhd(t),Y.mdia(t))}static trex(t){const e=t.id;return Y.box(Y.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const i=t.samples||[],n=i.length,a=12+16*n,l=new Uint8Array(a);let c,f,h,g,p,E;for(e+=8+a,l.set([t.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),c=0;c<n;c++)f=i[c],h=f.duration,g=f.size,p=f.flags,E=f.cts,l.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,E>>>24&255,E>>>16&255,E>>>8&255,E&255],12+16*c);return Y.box(Y.types.trun,l)}static initSegment(t){Y.types||Y.init();const e=Y.moov(t);return fn(Y.FTYP,e)}static hvc1(t){const e=t.params,i=[t.vps,t.sps,t.pps],n=4,a=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),n-1|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),i.length]);let l=a.length;for(let S=0;S<i.length;S+=1){l+=3;for(let R=0;R<i[S].length;R+=1)l+=2+i[S][R].length}const c=new Uint8Array(l);c.set(a,0),l=a.length;const f=i.length-1;for(let S=0;S<i.length;S+=1){c.set(new Uint8Array([32+S|(S===f?128:0),0,i[S].length]),l),l+=3;for(let R=0;R<i[S].length;R+=1)c.set(new Uint8Array([i[S][R].length>>8,i[S][R].length&255]),l),l+=2,c.set(i[S][R],l),l+=i[S][R].length}const h=Y.box(Y.types.hvcC,c),g=t.width,p=t.height,E=t.pixelRatio[0],T=t.pixelRatio[1];return Y.box(Y.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,Y.box(Y.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Y.box(Y.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,T>>24,T>>16&255,T>>8&255,T&255])))}}Y.types=void 0;Y.HDLR_TYPES=void 0;Y.STTS=void 0;Y.STSC=void 0;Y.STCO=void 0;Y.STSZ=void 0;Y.VMHD=void 0;Y.SMHD=void 0;Y.STSD=void 0;Y.FTYP=void 0;Y.DINF=void 0;const WA=9e4;function mp(r,t,e=1,i=!1){const n=r*t*e;return i?Math.round(n):n}function gL(r,t,e=1,i=!1){return mp(r,t,1/e,i)}function ru(r,t=!1){return mp(r,1e3,1/WA,t)}function mL(r,t=1){return mp(r,WA,1/t)}const pL=10*1e3,yL=1024,EL=1152,vL=1536;let bo=null,jg=null;function fT(r,t,e,i){return{duration:t,size:e,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Mh{constructor(t,e,i,n){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=i,this.logger=n,this.ISGenerated=!1,bo===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);bo=l?parseInt(l[1]):0}if(jg===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);jg=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const i=t[0].pts,n=t.reduce((a,l)=>{let c=l.pts,f=c-a;return f<-4294967296&&(e=!0,c=on(c,i),f=c-a),f>0?a:c},i);return e&&this.logger.debug("PTS rollover detected"),n}remux(t,e,i,n,a,l,c,f){let h,g,p,E,T,S,R=a,_=a;const D=t.pid>-1,N=e.pid>-1,M=e.samples.length,G=t.samples.length>0,$=c&&M>0||M>1;if((!D||G)&&(!N||$)||this.ISGenerated||c){if(this.ISGenerated){var w,L,O,C;const pt=this.videoTrackConfig;(pt&&(e.width!==pt.width||e.height!==pt.height||((w=e.pixelRatio)==null?void 0:w[0])!==((L=pt.pixelRatio)==null?void 0:L[0])||((O=e.pixelRatio)==null?void 0:O[1])!==((C=pt.pixelRatio)==null?void 0:C[1]))||!pt&&$||this.nextAudioPts===null&&G)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(t,e,a,l));const U=this.isVideoContiguous;let V=-1,B;if($&&(V=TL(e.samples),!U&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,V>0){this.logger.warn(`[mp4-remuxer]: Dropped ${V} out of ${M} video samples due to a missing keyframe`);const pt=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(V),e.dropped+=V,_+=(e.samples[0].pts-pt)/e.inputTimeScale,B=_}else V===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${M} video samples`),S=!1);if(this.ISGenerated){if(G&&$){const pt=this.getVideoStartPts(e.samples),K=(on(t.samples[0].pts,pt)-pt)/e.inputTimeScale;R+=Math.max(0,K),_+=Math.max(0,-K)}if(G){if(t.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),p=this.generateIS(t,e,a,l)),g=this.remuxAudio(t,R,this.isAudioContiguous,l,N||$||f===Rt.AUDIO?_:void 0),$){const pt=g?g.endPTS-g.startPTS:0;e.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),p=this.generateIS(t,e,a,l)),h=this.remuxVideo(e,_,U,pt)}}else $&&(h=this.remuxVideo(e,_,U,0));h&&(h.firstKeyFrame=V,h.independent=V!==-1,h.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(T=ZA(i,a,this._initPTS,this._initDTS)),n.samples.length&&(E=JA(n,a,this._initPTS))),{audio:g,video:h,initSegment:p,independent:S,text:E,id3:T}}generateIS(t,e,i,n){const a=t.samples,l=e.samples,c=this.typeSupported,f={},h=this._initPTS;let g=!h||n,p="audio/mp4",E,T,S,R;if(g&&(E=T=1/0),t.config&&a.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3";break}f.audio={id:"audio",container:p,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):Y.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(R=t.id,S=t.inputTimeScale,!h||S!==h.timescale?E=T=a[0].pts-Math.round(S*i):g=!1)}if(e.sps&&e.pps&&l.length){if(e.timescale=e.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Y.initSegment([e]),metadata:{width:e.width,height:e.height}},g)if(R=e.id,S=e.inputTimeScale,!h||S!==h.timescale){const _=this.getVideoStartPts(l),D=Math.round(S*i);T=Math.min(T,on(l[0].dts,_)-D),E=Math.min(E,_-D)}else g=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:E,timescale:S},this._initDTS={baseTime:T,timescale:S}):E=S=void 0,{tracks:f,initPTS:E,timescale:S,trackId:R}}remuxVideo(t,e,i,n){const a=t.inputTimeScale,l=t.samples,c=[],f=l.length,h=this._initPTS;let g=this.nextAvcDts,p=8,E=this.videoSampleDuration,T,S,R=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,D=!1;if(!i||g===null){const rt=e*a,F=l[0].pts-on(l[0].dts,l[0].pts);bo&&g!==null&&Math.abs(rt-F-g)<15e3?i=!0:g=rt-F}const N=h.baseTime*a/h.timescale;for(let rt=0;rt<f;rt++){const F=l[rt];F.pts=on(F.pts-N,g),F.dts=on(F.dts-N,g),F.dts<l[rt>0?rt-1:rt].dts&&(D=!0)}D&&l.sort(function(rt,F){const tt=rt.dts-F.dts,at=rt.pts-F.pts;return tt||at}),T=l[0].dts,S=l[l.length-1].dts;const M=S-T,G=M?Math.round(M/(f-1)):E||t.inputTimeScale/30;if(i){const rt=T-g,F=rt>G,tt=rt<-1;if((F||tt)&&(F?this.logger.warn(`${(t.segmentCodec||"").toUpperCase()}: ${ru(rt,!0)} ms (${rt}dts) hole between fragments detected at ${e.toFixed(3)}`):this.logger.warn(`${(t.segmentCodec||"").toUpperCase()}: ${ru(-rt,!0)} ms (${rt}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!tt||g>=l[0].pts||bo)){T=g;const at=l[0].pts-rt;if(F)l[0].dts=T,l[0].pts=at;else{let st=!0;for(let mt=0;mt<l.length&&!(l[mt].dts>at&&st);mt++){const Tt=l[mt].pts;if(l[mt].dts-=rt,l[mt].pts-=rt,mt<l.length-1){const Et=l[mt+1].pts,Yt=l[mt].pts,Ut=Et<=Yt,Ge=Et<=Tt;st=Ut==Ge}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${ru(at,!0)}/${ru(T,!0)}, delta: ${ru(rt,!0)} ms`)}}T=Math.max(0,T);let $=0,q=0,w=T;for(let rt=0;rt<f;rt++){const F=l[rt],tt=F.units,at=tt.length;let st=0;for(let mt=0;mt<at;mt++)st+=tt[mt].data.length;q+=st,$+=at,F.length=st,F.dts<w?(F.dts=w,w+=G/4|0||1):w=F.dts,R=Math.min(F.pts,R),_=Math.max(F.pts,_)}S=l[f-1].dts;const L=q+4*$+8;let O;try{O=new Uint8Array(L)}catch(rt){this.observer.emit(b.ERROR,b.ERROR,{type:bt.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:rt,bytes:L,reason:`fail allocating video mdat ${L}`});return}const C=new DataView(O.buffer);C.setUint32(0,L),O.set(Y.types.mdat,4);let U=!1,V=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,pt=Number.NEGATIVE_INFINITY,gt=Number.NEGATIVE_INFINITY;for(let rt=0;rt<f;rt++){const F=l[rt],tt=F.units;let at=0;for(let Tt=0,Et=tt.length;Tt<Et;Tt++){const Yt=tt[Tt],Ut=Yt.data,Ge=Yt.data.byteLength;C.setUint32(p,Ge),p+=4,O.set(Ut,p),p+=Ge,at+=4+Ge}let st;if(rt<f-1)E=l[rt+1].dts-F.dts,st=l[rt+1].pts-F.pts;else{const Tt=this.config,Et=rt>0?F.dts-l[rt-1].dts:G;if(st=rt>0?F.pts-l[rt-1].pts:G,Tt.stretchShortVideoTrack&&this.nextAudioPts!==null){const Yt=Math.floor(Tt.maxBufferHole*a),Ut=(n?R+n*a:this.nextAudioPts)-F.pts;Ut>Yt?(E=Ut-Et,E<0?E=Et:U=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Ut/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=Et}else E=Et}const mt=Math.round(F.pts-F.dts);V=Math.min(V,E),pt=Math.max(pt,E),B=Math.min(B,st),gt=Math.max(gt,st),c.push(fT(F.key,E,at,mt))}if(c.length){if(bo){if(bo<70){const rt=c[0].flags;rt.dependsOn=2,rt.isNonSync=0}}else if(jg&&gt-B<pt-V&&G/pt<.025&&c[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let rt=T;for(let F=0,tt=c.length;F<tt;F++){const at=rt+c[F].duration,st=rt+c[F].cts;if(F<tt-1){const mt=at+c[F+1].cts;c[F].duration=mt-st}else c[F].duration=F?c[F-1].duration:G;c[F].cts=0,rt=at}}}E=U||!E?G:E,this.nextAvcDts=g=S+E,this.videoSampleDuration=E,this.isVideoContiguous=!0;const ct={data1:Y.moof(t.sequenceNumber++,T,he(t,{samples:c})),data2:O,startPTS:R/a,endPTS:(_+E)/a,startDTS:T/a,endDTS:g/a,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:t.dropped};return t.samples=[],t.dropped=0,ct}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return EL;case"ac3":return vL;default:return yL}}remuxAudio(t,e,i,n,a){const l=t.inputTimeScale,c=t.samplerate?t.samplerate:l,f=l/c,h=this.getSamplesPerFrame(t),g=h*f,p=this._initPTS,E=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,T=[],S=a!==void 0;let R=t.samples,_=E?0:8,D=this.nextAudioPts||-1;const N=e*l,M=p.baseTime*l/p.timescale;if(this.isAudioContiguous=i=i||R.length&&D>0&&(n&&Math.abs(N-D)<9e3||Math.abs(on(R[0].pts-M,N)-D)<20*g),R.forEach(function(K){K.pts=on(K.pts-M,N)}),!i||D<0){if(R=R.filter(K=>K.pts>=0),!R.length)return;a===0?D=0:n&&!S?D=Math.max(0,N):D=R[0].pts}if(t.segmentCodec==="aac"){const K=this.config.maxAudioFramesDrift;for(let it=0,ct=D;it<R.length;it++){const rt=R[it],F=rt.pts,tt=F-ct,at=Math.abs(1e3*tt/l);if(tt<=-K*g&&S)it===0&&(this.logger.warn(`Audio frame @ ${(F/l).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*tt/l)} ms.`),this.nextAudioPts=D=ct=F);else if(tt>=K*g&&at<pL&&S){let st=Math.round(tt/g);ct=F-st*g,ct<0&&(st--,ct+=g),it===0&&(this.nextAudioPts=D=ct),this.logger.warn(`[mp4-remuxer]: Injecting ${st} audio frame @ ${(ct/l).toFixed(3)}s due to ${Math.round(1e3*tt/l)} ms gap.`);for(let mt=0;mt<st;mt++){const Tt=Math.max(ct,0);let Et=dL.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);Et||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Et=rt.unit.subarray()),R.splice(it,0,{unit:Et,pts:Tt}),ct+=g,it++}}rt.pts=ct,ct+=g}}let G=null,$=null,q,w=0,L=R.length;for(;L--;)w+=R[L].unit.byteLength;for(let K=0,it=R.length;K<it;K++){const ct=R[K],rt=ct.unit;let F=ct.pts;if($!==null){const at=T[K-1];at.duration=Math.round((F-$)/f)}else if(i&&t.segmentCodec==="aac"&&(F=D),G=F,w>0){w+=_;try{q=new Uint8Array(w)}catch(at){this.observer.emit(b.ERROR,b.ERROR,{type:bt.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:at,bytes:w,reason:`fail allocating audio mdat ${w}`});return}E||(new DataView(q.buffer).setUint32(0,w),q.set(Y.types.mdat,4))}else return;q.set(rt,_);const tt=rt.byteLength;_+=tt,T.push(fT(!0,h,tt,0)),$=F}const O=T.length;if(!O)return;const C=T[T.length-1];this.nextAudioPts=D=$+f*C.duration;const U=E?new Uint8Array(0):Y.moof(t.sequenceNumber++,G/f,he({},t,{samples:T}));t.samples=[];const V=G/l,B=D/l,gt={data1:U,data2:q,startPTS:V,endPTS:B,startDTS:V,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,gt}}function on(r,t){let e;if(t===null)return r;for(t<r?e=-8589934592:e=8589934592;Math.abs(r-t)>4294967296;)r+=e;return r}function TL(r){for(let t=0;t<r.length;t++)if(r[t].key)return t;return-1}function ZA(r,t,e,i){const n=r.samples.length;if(!n)return;const a=r.inputTimeScale;for(let c=0;c<n;c++){const f=r.samples[c];f.pts=on(f.pts-e.baseTime*a/e.timescale,t*a)/a,f.dts=on(f.dts-i.baseTime*a/i.timescale,t*a)/a}const l=r.samples;return r.samples=[],{samples:l}}function JA(r,t,e){const i=r.samples.length;if(!i)return;const n=r.inputTimeScale;for(let l=0;l<i;l++){const c=r.samples[l];c.pts=on(c.pts-e.baseTime*n/e.timescale,t*n)/n}r.samples.sort((l,c)=>l.pts-c.pts);const a=r.samples;return r.samples=[],{samples:a}}class SL{constructor(t,e,i,n){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1,this.logger=n}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,i,n){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(mI(t,n)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:i}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const n=this.initData=lA(t);n.audio&&(e=dT(n.audio,Ee.AUDIO,this.logger)),n.video&&(i=dT(n.video,Ee.VIDEO,this.logger));const a={};n.audio&&n.video?a.audiovideo={container:"video/mp4",codec:e+","+i,supplemental:n.video.supplemental,initSegment:t,id:"main"}:n.audio?a.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:n.video?a.video={container:"video/mp4",codec:i,supplemental:n.video.supplemental,initSegment:t,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(t,e,i,n,a,l){var c,f;let{initPTS:h,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:n,id3:i,initSegment:void 0};vt(g)||(g=this.lastEndTime=a||0);const E=e.samples;if(!(E!=null&&E.length))return p;const T={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(E),S=this.initData),!((f=S)!=null&&f.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),p;this.emitInitSegment&&(T.tracks=this.initTracks,this.emitInitSegment=!1);const R=pI(E,S,this.logger),_=S.audio?R[S.audio.id]:null,D=S.video?R[S.video.id]:null,N=Th(D,1/0),M=Th(_,1/0),G=Th(D,0,!0),$=Th(_,0,!0);let q,w=a,L=0;if(_&&(!D||!h&&M<N||h&&h.trackId===S.audio.id)?(T.trackId=S.audio.id,q=_,L=$-M):D&&(T.trackId=S.video.id,q=D,L=G-N),q){const K=q.timescale;w=q.start/K,T.timescale=K,h||(T.initPTS=q.start-a*K,this.initPTS=h={baseTime:T.initPTS,timescale:K,trackId:T.trackId})}(l||!h)&&(AL(h,w,a,L)||T.timescale!==h.timescale)&&(T.initPTS=w-a,h&&h.timescale===1&&this.logger.warn(`Adjusting initPTS @${a} from ${h.baseTime/h.timescale} to ${T.initPTS}`),this.initPTS=h={baseTime:T.initPTS,timescale:1});const O=t?w-h.baseTime/h.timescale:g;yI(S,E,h.baseTime/h.timescale);const C=O+L;L>0?this.lastEndTime=C:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const U=!!S.audio,V=!!S.video;let B="";U&&(B+="audio"),V&&(B+="video");const pt={data1:E,startPTS:O,startDTS:O,endPTS:C,endDTS:C,type:B,hasAudio:U,hasVideo:V,nb:1,dropped:0};p.audio=U&&!V?pt:void 0,p.video=V?pt:void 0;const gt=D?.sampleCount;if(gt){const K=D.keyFrameIndex,it=K!==-1;pt.nb=gt,pt.dropped=K===0||this.isVideoContiguous?0:it?K:gt,pt.independent=it,pt.firstKeyFrame=K,it&&D.keyFrameStart&&(pt.firstKeyFramePTS=D.keyFrameStart-h.baseTime/h.timescale),this.isVideoContiguous||(p.independent=it),this.isVideoContiguous||(this.isVideoContiguous=it),pt.dropped&&this.logger.warn(`fmp4 does not start with IDR: firstIDR ${K}/${gt} dropped: ${pt.dropped} pts: ${pt.firstKeyFramePTS||"NA"}`)}return p.initSegment=T,p.id3=ZA(i,a,h,h),n.samples.length&&(p.text=JA(n,a,h)),p}}function Th(r,t,e=!1){return r?.start!==void 0?(r.start+(e?r.duration:0))/r.timescale:t}function AL(r,t,e,i){if(r===null)return!0;const n=Math.max(i,1),a=t-r.baseTime/r.timescale;return Math.abs(a-e)>n}function dT(r,t,e){const i=r?.codec;return i&&i.length>4?i:t===Ee.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?jh(i,!1):(e.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(e.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let ks;try{ks=self.performance.now.bind(self.performance)}catch{ks=Date.now}const kh=[{demux:uL,remux:SL},{demux:Er,remux:Mh},{demux:rL,remux:Mh},{demux:oL,remux:Mh}];kh.splice(2,0,{demux:aL,remux:Mh});class gT{constructor(t,e,i,n,a,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.id=a,this.logger=l}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,n){const a=i.transmuxing;a.executeStart=ks();let l=new Uint8Array(t);const{currentTransmuxState:c,transmuxConfig:f}=this;n&&(this.currentTransmuxState=n);const{contiguous:h,discontinuity:g,trackSwitch:p,accurateTimeOffset:E,timeOffset:T,initSegmentChange:S}=n||c,{audioCodec:R,videoCodec:_,defaultInitPts:D,duration:N,initSegmentData:M}=f,G=_L(l,e);if(G&&Oo(G.method)){const L=this.getDecrypter(),O=ap(G.method);if(L.isSync()){let C=L.softwareDecrypt(l,G.key.buffer,G.iv.buffer,O);if(i.part>-1){const V=L.flush();C=V&&V.buffer}if(!C)return a.executeEnd=ks(),Yg(i);l=new Uint8Array(C)}else return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(l,G.key.buffer,G.iv.buffer,O).then(C=>{const U=this.push(C,null,i);return this.decryptionPromise=null,U}),this.decryptionPromise}const $=this.needsProbing(g,p);if($){const L=this.configureTransmuxer(l);if(L)return this.logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),a.executeEnd=ks(),Yg(i)}(g||p||S||$)&&this.resetInitSegment(M,R,_,N,e),(g||S||$)&&this.resetInitialTimestamp(D),h||this.resetContiguity();const q=this.transmux(l,G,T,E,i);this.asyncResult=Iu(q);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,a.executeEnd=ks(),q}flush(t){const e=t.transmuxing;e.executeStart=ks();const{decrypter:i,currentTransmuxState:n,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(t));const l=[],{timeOffset:c}=n;if(i){const p=i.flush();p&&l.push(this.push(p.buffer,null,t))}const{demuxer:f,remuxer:h}=this;if(!f||!h){e.executeEnd=ks();const p=[Yg(t)];return this.asyncResult?Promise.resolve(p):p}const g=f.flush(c);return Iu(g)?(this.asyncResult=!0,g.then(p=>(this.flushRemux(l,p,t),l))):(this.flushRemux(l,g,t),this.asyncResult?Promise.resolve(l):l)}flushRemux(t,e,i){const{audioTrack:n,videoTrack:a,id3Track:l,textTrack:c}=e,{accurateTimeOffset:f,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Rt.MAIN?"level":"track"} ${i.level}`);const g=this.remuxer.remux(n,a,l,c,h,f,!0,this.id);t.push({remuxResult:g,chunkMeta:i}),i.transmuxing.executeEnd=ks()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,n,a){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(t,e,i,n),c.resetInitSegment(t,e,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,n,a){let l;return e&&e.method==="SAMPLE-AES"?l=this.transmuxSampleAes(t,e,i,n,a):l=this.transmuxUnencrypted(t,i,n,a),l}transmuxUnencrypted(t,e,i,n){const{audioTrack:a,videoTrack:l,id3Track:c,textTrack:f}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,l,c,f,e,i,!1,this.id),chunkMeta:n}}transmuxSampleAes(t,e,i,n,a){return this.demuxer.demuxSampleAes(t,e,i).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,i,n,!1,this.id),chunkMeta:a}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:n}=this;let a;for(let p=0,E=kh.length;p<E;p++){var l;if((l=kh[p].demux)!=null&&l.probe(t,this.logger)){a=kh[p];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,f=this.remuxer,h=a.remux,g=a.demux;(!f||!(f instanceof h))&&(this.remuxer=new h(i,e,n,this.logger)),(!c||!(c instanceof g))&&(this.demuxer=new g(i,e,n,this.logger),this.probe=g.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new sp(this.config)),t}}function _L(r,t){let e=null;return r.byteLength>0&&t?.key!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const Yg=r=>({remuxResult:{},chunkMeta:r});function Iu(r){return"then"in r&&r.then instanceof Function}class RL{constructor(t,e,i,n,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=n,this.defaultInitPts=a||null}}class bL{constructor(t,e,i,n,a,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=n,this.timeOffset=a,this.initSegmentChange=l}}let mT=0;class t_{constructor(t,e,i,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=mT++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const h=f.data,g=this.hls;if(!(!g||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var p;const E=(p=this.workerContext)==null?void 0:p.objectURL;E&&self.URL.revokeObjectURL(E);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{g.logger[h.data.logType]&&g.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,g.trigger(h.event,h.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const h=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const a=t.config;this.hls=t,this.id=e,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;const l=(f,h)=>{h=h||{},h.frag=this.frag||void 0,f===b.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(f,h)};this.observer=new up,this.observer.on(b.FRAG_DECRYPTED,l),this.observer.on(b.ERROR,l);const c=wv(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(a.workerPath||w1()){try{a.workerPath?(f.log(`loading Web Worker ${a.workerPath} for "${e}"`),this.workerContext=P1(a.workerPath)):(f.log(`injecting Web Worker for "${e}"`),this.workerContext=O1());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:e,config:Re(a)})}catch(g){f.warn(`Error setting up "${e}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new gT(this.observer,c,a,"",e,t.logger)}return}}this.transmuxer=new gT(this.observer,c,a,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=mT++;const e=this.hls.config,i=wv(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:i,id:this.id,config:Re(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),M1(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,i,n,a,l,c,f,h,g){var p,E;h.transmuxing.start=self.performance.now();const{instanceNo:T,transmuxer:S}=this,R=l?l.start:a.start,_=a.decryptdata,D=this.frag,N=!(D&&a.cc===D.cc),M=!(D&&h.level===D.level),G=D?h.sn-D.sn:-1,$=this.part?h.part-this.part.index:-1,q=G===0&&h.id>1&&h.id===D?.stats.chunkCount,w=!M&&(G===1||G===0&&($===1||q&&$<=0)),L=self.performance.now();(M||G||a.stats.parsing.start===0)&&(a.stats.parsing.start=L),l&&($||!w)&&(l.stats.parsing.start=L);const O=!(D&&((p=a.initSegment)==null?void 0:p.url)===((E=D.initSegment)==null?void 0:E.url)),C=new bL(N,w,f,M,R,O);if(!w||N||O){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===Rt.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${N}
        trackSwitch: ${M}
        contiguous: ${w}
        accurateTimeOffset: ${f}
        timeOffset: ${R}
        initSegmentChange: ${O}`);const U=new RL(i,n,e,c,g);this.configureTransmuxer(U)}if(this.frag=a,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:T,cmd:"demux",data:t,decryptdata:_,chunkMeta:h,state:C},t instanceof ArrayBuffer?[t]:[]);else if(S){const U=S.push(t,_,h,C);Iu(U)?U.then(V=>{this.handleTransmuxComplete(V)}).catch(V=>{this.transmuxerError(V,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(U)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(i){const n=i.flush(t);Iu(n)?n.then(a=>{this.handleFlushResult(a,t)}).catch(a=>{this.transmuxerError(a,t,"transmuxer-interface flush error")}):this.handleFlushResult(n,t)}}transmuxerError(t,e,i){this.hls&&(this.error=t,this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):i&&i.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const pT=100;class xL extends lp{constructor(t,e,i){super(t,e,i,"audio-stream-controller",Rt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.BUFFER_RESET,this.onBufferReset,this),t.on(b.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.FRAG_LOADING,this.onFragLoading,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.BUFFER_RESET,this.onBufferReset,this),t.off(b.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.FRAG_LOADING,this.onFragLoading,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,{frag:e,id:i,initPTS:n,timescale:a}){if(i===Rt.MAIN){const l=e.cc,c=this.fragCurrent;if(this.initPTS[l]={baseTime:n,timescale:a},this.log(`InitPTS for cc: ${l} found from main: ${n}/${a}`),this.mainAnchor=e,this.state===lt.WAITING_INIT_PTS){const f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==l)&&this.syncWithAnchor(e,f?.frag)}else!this.hls.hasEnoughToStart&&c&&c.cc!==l?(c.abortRequests(),this.syncWithAnchor(e,c)):this.state===lt.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var i;const n=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(e&&n?.cc===e.cc)return;const a=(n||t).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),f=TA(l,a,c);f&&(this.log(`Waiting fragment cc (${e?.cc}) cancelled because video is at cc ${t.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===lt.IDLE&&this.doTickIdle())}startLoad(t,e){if(!this.levels){this.startPosition=t,this.state=lt.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(pT),i>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),t=i,this.state=lt.IDLE):this.state=lt.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case lt.IDLE:this.doTickIdle();break;case lt.WAITING_TRACK:{const{levels:e,trackId:i}=this,n=e?.[i],a=n?.details;if(a&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(a))break;this.state=lt.WAITING_INIT_PTS}break}case lt.FRAG_LOADING_WAITING_RETRY:{var t;const e=performance.now(),i=this.retryDate;if(!i||e>=i||(t=this.media)!=null&&t.seeking){const{levels:n,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(n?.[a]||null),this.state=lt.IDLE}break}case lt.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:i,part:n,cache:a,complete:l}=e,c=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=lt.FRAG_LOADING;const f=a.flush().buffer,h={frag:i,part:n,payload:f,networkDetails:null};this._handleFragmentLoadProgress(h),l&&super._handleFragmentLoadComplete(h)}else c&&c.cc!==e.frag.cc&&this.syncWithAnchor(c,e.frag)}else this.state=lt.IDLE}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:i,media:n,trackId:a}=this,l=e.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(i!=null&&i[a]))return;const c=i[a],f=c.details;if(!f||this.waitForLive(c)||this.waitForCdnTuneIn(f)){this.state=lt.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,Ee.AUDIO,Rt.AUDIO));const g=this.getFwdBufferInfo(h,Rt.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,f)){e.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=lt.ENDED;return}const p=g.len,E=e.maxBufferLength,T=f.fragments,S=T[0].start,R=this.getLoadPosition(),_=this.flushing?R:g.end;if(this.switchingTrack&&n){const M=R;f.PTSKnown&&M<S&&(g.end>S||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=S+.05)}if(p>=E&&!this.switchingTrack&&_<T[T.length-1].start)return;let D=this.getNextFragment(_,f);if(D&&this.isLoopLoading(D,_)&&(D=this.getNextFragmentLoopLoading(D,f,g,Rt.MAIN,E)),!D){this.bufferFlushed=!0;return}let N=((t=this.mainFragLoading)==null?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&N&&ai(D)&&!D.endList&&(!f.live||!this.loadingParts&&_<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(N)===Qe.OK&&(this.mainFragLoading=N=null),N&&ai(N))){if(D.start>N.end){const G=this.fragmentTracker.getFragAtPos(_,Rt.MAIN);G&&G.end>N.end&&(N=G,this.mainFragLoading={frag:G,targetBufferTime:null})}if(D.start>N.end)return}this.loadFragment(D,c,_)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new Au(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),i?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==lt.STOPPED&&(this.setInterval(pT),this.state=lt.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(b.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(t,e){var i;const{levels:n}=this,{details:a,id:l,groupId:c,track:f}=e;if(!n){this.warn(`Audio tracks reset while loading track ${l} "${f.name}" of "${c}"`);return}const h=this.mainDetails;if(!h||a.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=e,this.state!==lt.STOPPED&&(this.state=lt.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${f.name}" of "${c}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const g=n[l];let p=0;if(a.live||(i=g.details)!=null&&i.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(g.details){var E;p=this.alignPlaylists(a,g.details,(E=this.levelLastLoaded)==null?void 0:E.details)}a.alignedSliding||(MA(a,h),a.alignedSliding||Jh(a,h),p=a.fragmentStart)}g.details=a,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(h,p),this.hls.trigger(b.AUDIO_TRACK_UPDATED,{details:a,id:l,groupId:e.groupId}),this.state===lt.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=lt.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const i=t.frag,{part:n,payload:a}=t,{config:l,trackId:c,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const h=f[c];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const g=h.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const p=l.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let E=this.transmuxer;E||(E=this.transmuxer=new t_(this.hls,Rt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const T=this.initPTS[i.cc],S=(e=i.initSegment)==null?void 0:e.data;if(T!==void 0){const _=n?n.index:-1,D=_!==-1,N=new rp(i.level,i.sn,i.stats.chunkCount,a.byteLength,_,D);E.push(a,S,p,"",i,n,g.totalduration,!1,N,T)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:R}=this.waitingData=this.waitingData||{frag:i,part:n,cache:new kA,complete:!1};R.push(new Uint8Array(a)),this.state!==lt.STOPPED&&(this.state=lt.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(t,e){!this.audioOnly&&e.frag.type===Rt.MAIN&&ai(e.frag)&&(this.mainFragLoading=e,this.state===lt.IDLE&&this.tick())}onFragBuffered(t,e){const{frag:i,part:n}=e;if(i.type!==Rt.AUDIO){!this.audioOnly&&i.type===Rt.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${n?" p: "+n.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ai(i)){this.fragPrevious=i;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,re({},a)))}this.fragBufferedComplete(i,n),this.media&&this.tick()}onError(t,e){var i;if(e.fatal){this.state=lt.ERROR;return}switch(e.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Rt.AUDIO,e);break;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===lt.WAITING_TRACK&&((i=e.context)==null?void 0:i.type)===Ht.AUDIO_TRACK&&(this.state=lt.IDLE);break;case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:if(e.parent!=="audio")return;this.resetLoadingState();break;case W.BUFFER_FULL_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushing(t,{type:e}){e!==Ee.VIDEO&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==Ee.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===lt.ENDED&&(this.state=lt.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,e,Rt.AUDIO),this.tick())}}_handleTransmuxComplete(t){var e;const i="audio",{hls:n}=this,{remuxResult:a,chunkMeta:l}=t,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:f,part:h,level:g}=c,{details:p}=g,{audio:E,text:T,id3:S,initSegment:R}=a;if(this.fragContextChanged(f)||!p){this.fragmentTracker.removeFragment(f);return}if(this.state=lt.PARSING,this.switchingTrack&&E&&this.completeAudioSwitch(this.switchingTrack),R!=null&&R.tracks){const _=f.initSegment||f;this._bufferInitSegment(g,R.tracks,_,l),n.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:i,tracks:R.tracks})}if(E){const{startPTS:_,endPTS:D,startDTS:N,endDTS:M}=E;h&&(h.elementaryStreams[Ee.AUDIO]={startPTS:_,endPTS:D,startDTS:N,endDTS:M}),f.setElementaryStreamInfo(Ee.AUDIO,_,D,N,M),this.bufferFragmentData(E,f,h,l)}if(S!=null&&(e=S.samples)!=null&&e.length){const _=he({id:i,frag:f,details:p},S);n.trigger(b.FRAG_PARSING_METADATA,_)}if(T){const _=he({id:i,frag:f,details:p},T);n.trigger(b.FRAG_PARSING_USERDATA,_)}}_bufferInitSegment(t,e,i,n){if(this.state!==lt.PARSING||(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio))return;const a=e.audio;a.id=Rt.AUDIO;const l=t.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${l}/${a.codec}]`),l&&l.split(",").length===1&&(a.levelCodec=l),this.hls.trigger(b.BUFFER_CODECS,e);const c=a.initSegment;if(c!=null&&c.byteLength){const f={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:c};this.hls.trigger(b.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(t,e,i){const n=this.fragmentTracker.getState(t);if(this.switchingTrack||n===Qe.NOT_LOADED||n===Qe.PARTIAL){var a;if(!ai(t))this._loadInitSegment(t,e);else if((a=e.details)!=null&&a.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=lt.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==e.details.fragmentStart&&Jh(e.details,l)}else super.loadFragment(t,e,i)}else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:i,assocLang:n,characteristics:a,audioCodec:l,channels:c}=this.bufferedTrack;Ea({name:e,lang:i,assocLang:n,characteristics:a,audioCodec:l,channels:c},t,ma)||(Qh(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(b.AUDIO_TRACK_SWITCHED,re({},t))}}class pp extends Vs{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,i){const n=e?.renditionReports;if(n){let a=-1;for(let l=0;l<n.length;l++){const c=n[l];let f;try{f=new self.URL(c.URI,e.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),f=c.URI||""}if(f===t){a=l;break}else f===t.substring(0,f.length)&&(a=l)}if(a!==-1){const l=n[a],c=parseInt(l["LAST-MSN"])||e?.lastPartSn;let f=parseInt(l["LAST-PART"])||e?.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(e.age-e.partTarget,e.targetduration);f>=0&&g>e.partTarget&&(f+=1)}const h=i&&Pv(i);return new Mv(c,f>=0?f:void 0,h)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return t}playlistLoaded(t,e,i){const{details:n,stats:a}=e,l=self.performance.now(),c=a.loading.first?Math.max(0,l-a.loading.first):0;n.advancedDateTime=Date.now()-c;const f=this.hls.config.timelineOffset;if(f!==n.appliedTimelineOffset){const g=Math.max(f||0,0);n.appliedTimelineOffset=g,n.fragments.forEach(p=>{p.start=p.playlistOffset+g})}if(n.live||i!=null&&i.live){const g="levelInfo"in e?e.levelInfo:e.track;if(n.reloaded(i),i&&n.fragments.length>0){S1(i,n);const N=n.playlistParsingError;if(N){this.warn(N);const M=this.hls;if(!M.config.ignorePlaylistParsingErrors){var h;const{networkDetails:G}=e;M.trigger(b.ERROR,{type:bt.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:N,reason:N.message,level:e.level||void 0,parent:(h=n.fragments[0])==null?void 0:h.type,networkDetails:G,stats:a});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=a.loading.start);const p=this.hls.mainForwardBufferInfo,E=p?p.end-p.len:0,T=(n.edge-E)*1e3,S=DA(n,T);if(n.requestScheduled+S<l?n.requestScheduled=l:n.requestScheduled+=S,this.log(`live playlist ${t} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let R,_,D;if(n.canBlockReload&&n.endSN&&n.advanced){const N=this.hls.config.lowLatencyMode,M=n.lastPartSn,G=n.endSN,$=n.lastPartIndex,q=$!==-1,w=M===G;q?w?(_=G+1,D=N?0:$):(_=M,D=N?$+1:n.maxPartIndex):_=G+1;const L=n.age,O=L+n.ageHeader;let C=Math.min(O-n.partTarget,n.targetduration*1.5);if(C>0){if(O>n.targetduration*3)this.log(`Playlist last advanced ${L.toFixed(2)}s ago. Omitting segment and part directives.`),_=void 0,D=void 0;else if(i!=null&&i.tuneInGoal&&O-n.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${C} with playlist age: ${n.age}`),C=0;else{const U=Math.floor(C/n.targetduration);if(_+=U,D!==void 0){const V=Math.round(C%n.targetduration/n.partTarget);D+=V}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${C} skip sn ${U} to part ${D}`)}n.tuneInGoal=C}if(R=this.getDeliveryDirectives(n,e.deliveryDirectives,_,D),N||!w){n.requestScheduled=l,this.loadingPlaylist(g,R);return}}else(n.canBlockReload||n.canSkipUntil)&&(R=this.getDeliveryDirectives(n,e.deliveryDirectives,_,D));R&&_!==void 0&&n.canBlockReload&&(n.requestScheduled=a.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(g,R,n)}else this.clearTimer()}scheduleLoading(t,e,i){const n=i||t.details;if(!n){this.loadingPlaylist(t,e);return}const a=self.performance.now(),l=n.requestScheduled;if(a>=l){this.loadingPlaylist(t,e);return}const c=l-a;this.log(`reload live playlist ${t.name||t.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),c)}getDeliveryDirectives(t,e,i,n){let a=Pv(t);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,n=e.part,a=Oh.No),new Mv(i,n,a)}checkRetry(t){const e=t.details,i=Xh(t),n=t.errorAction,{action:a,retryCount:l=0,retryConfig:c}=n||{},f=!!n&&!!c&&(a===Ti.RetryRequest||!n.resolved&&a===Ti.SendAlternateToPenaltyBox);if(f){var h;if(l>=c.maxNumRetry)return!1;if(i&&(h=t.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const g=np(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${e}" in ${g}ms`)}t.levelRetry=!0,n.resolved=!0}return f}}function e_(r,t){if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(!Lu(r[e].attrs,t[e].attrs))return!1;return!0}function Lu(r,t,e){const i=r["STABLE-RENDITION-ID"];return i&&!e?i===t["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>r[n]!==t[n])}function Rm(r,t){return t.label.toLowerCase()===r.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(r.lang||"").toLowerCase())}class IL extends pp{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:n,details:a}=e,l=this.tracksInGroup[i];if(!l||l.groupId!==n){this.warn(`Audio track with id:${i} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=e.details,this.log(`Audio track ${i} "${l.name}" lang:${l.lang} group:${n} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,c)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const i=e.audioGroups||null,n=this.groupIds;let a=this.currentTrack;if(!i||n?.length!==i?.length||i!=null&&i.some(c=>n?.indexOf(c)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(E=>!i||i.indexOf(E.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(E=>E.default)&&(this.selectDefaultTrack=!1),c.forEach((E,T)=>{E.id=T});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const f=this.hls.config.audioPreference;if(!a&&f){const E=Xn(f,c,ma);if(E>-1)a=c[E];else{const T=Xn(f,this.tracks);a=this.tracks[T]}}let h=this.findTrackId(a);h===-1&&a&&(h=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(c.length&&p===-1){var l;const E=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(E.message),this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:E})}}}onError(t,e){e.fatal||!e.context||e.context.type===Ht.AUDIO_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const n=this.currentTrack;if(n&&Ea(t,n,ma))return n;const a=Xn(t,this.tracksInGroup,ma);if(a>-1){const l=this.tracksInGroup[a];return this.setAudioTrack(a),l}else if(n){let l=e.loadLevel;l===-1&&(l=e.firstAutoLevel);const c=GI(t,e.levels,i,l,ma);if(c===-1)return null;e.nextLoadLevel=c}if(t.channels||t.audioCodec){const l=Xn(t,i);if(l>-1)return i[l]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn(`Invalid audio track id: ${t}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,n=e[t],a=n.details&&!n.details.live;if(t===this.trackId&&n===i&&a||(this.log(`Switching to audio-track ${t} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=t,this.currentTrack=n,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,re({},n)),a))return;const l=this.switchParams(n.url,i?.details,n.details);this.loadPlaylist(l)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const n=e[i];if(!(this.selectDefaultTrack&&!n.default)&&(!t||Ea(t,n,ma)))return i}if(t){const{name:i,lang:n,assocLang:a,characteristics:l,audioCodec:c,channels:f}=t;for(let h=0;h<e.length;h++){const g=e[h];if(Ea({name:i,lang:n,assocLang:a,characteristics:l,audioCodec:c,channels:f},g,ma))return h}for(let h=0;h<e.length;h++){const g=e[h];if(Lu(t.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<e.length;h++){const g=e[h];if(Lu(t.attrs,g.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&Qh(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=t.id,n=t.groupId,a=this.getUrlWithDirectives(t.url,e),l=t.details,c=l?.age;this.log(`Loading audio-track ${i} "${t.name}" lang:${t.lang} group:${n}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${a}`),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:n,deliveryDirectives:e||null,track:t})}}class LL{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,i){if(this.queues===null||this.tracks===null)return;const n=this.queues[e];n.push(t),n.length===1&&!i&&this.executeNext(e)}appendBlocker(t){return new Promise(e=>{const i={label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,t)})}prependBlocker(t){return new Promise(e=>{if(this.queues){const i={label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[t].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const i=(e=t[0])==null?void 0:e.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(t[0].execute(),t.splice(0,1))})}unblockAudio(t){if(this.queues===null)return;this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(this.queues===null||this.tracks===null)return;const e=this.queues[t];if(e.length){const n=e[0];try{n.execute()}catch(a){var i;if(n.onError(a),this.queues===null||this.tracks===null)return;const l=(i=this.tracks[t])==null?void 0:i.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){this.queues!==null&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return((e=this.queues)==null?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return t===null||e===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(t){var e,i;return(e=this.queues)!=null&&e[t]||(i=this.tracks)!=null&&i[t]?`${t}: (${this.listSbInfo(t)}) ${this.listOps(t)}`:""}listSbInfo(t){var e;const i=(e=this.tracks)==null?void 0:e[t],n=i?.buffer;return n?`SourceBuffer${n.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(t){var e;return((e=this.queues)==null?void 0:e[t].map(i=>i.label).join(", "))||""}}const yT=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,i_="HlsJsTrackRemovedError";class DL extends Error{constructor(t){super(t),this.name=i_}}class CL extends Vs{constructor(t,e){super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:n,mediaSource:a}=this;i&&this.log("Media source opened"),!(!n||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:n,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:n}=this;i!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${i})`)},this.hls=t,this.fragmentTracker=e,this.appendSource=rI(Rr(t.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.BUFFER_RESET,this.onBufferReset,this),t.on(b.BUFFER_APPENDING,this.onBufferAppending,this),t.on(b.BUFFER_CODECS,this.onBufferCodecs,this),t.on(b.BUFFER_EOS,this.onBufferEos,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(b.FRAG_PARSED,this.onFragParsed,this),t.on(b.FRAG_CHANGED,this.onFragChanged,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.BUFFER_RESET,this.onBufferReset,this),t.off(b.BUFFER_APPENDING,this.onBufferAppending,this),t.off(b.BUFFER_CODECS,this.onBufferCodecs,this),t.off(b.BUFFER_EOS,this.onBufferEos,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(b.FRAG_PARSED,this.onFragParsed,this),t.off(b.FRAG_CHANGED,this.onFragChanged,this),t.off(b.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const i={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const l=this.isQueued();(a||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===e?he(i,n.tracks):this.sourceBuffers.forEach(a=>{const[l]=a;l&&(i[l]=he({},this.tracks[l]),this.removeBuffer(l)),a[0]=a[1]=null}),{media:t,mediaSource:e,tracks:i}}initTracks(){const t={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=t,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var i;let n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(t,e){const i=this.media=e.media,n=Rr(this.appendSource);if(this.transferData=this.overrides=void 0,i&&n){const a=!!e.mediaSource;(a||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const l=this.mediaSource=e.mediaSource||new n;if(this.assignMediaSource(l),a)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{i.removeAttribute("src");const f=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||f&&l instanceof f,ET(i),wL(i,c),i.load()}catch{i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,i;this.log(`${((e=this.transferData)==null?void 0:e.mediaSource)===t?"transferred":"created"} media source: ${(i=t.constructor)==null?void 0:i.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const i=this.tracks,n=e.tracks,a=n?Object.keys(n):null,l=a?a.length:0,c=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(n&&a&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Re(i,(f,h)=>f==="initSegment"?void 0:h)};
transfer tracks: ${Re(n,(f,h)=>f==="initSegment"?void 0:h)}}`),!iA(n,i)){e.mediaSource=null,e.tracks=void 0;const f=t.currentTime,h=this.details,g=Math.max(f,h?.fragments[0].start||0);if(g-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(i)}") start time: ${g} currentTime: ${f}`),this.onMediaDetaching(b.MEDIA_DETACHING,{}),this.onMediaAttaching(b.MEDIA_ATTACHING,e),t.currentTime=g;return}this.transferData=void 0,a.forEach(f=>{const h=f,g=n[h];if(g){const p=g.buffer;if(p){const E=this.fragmentTracker,T=g.id;if(E.hasFragments(T)||E.hasParts(T)){const _=Pt.getBuffered(p);E.detectEvictedFragments(h,_,T,null,!0)}const S=Qg(h),R=[h,p];this.sourceBuffers[S]=R,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,g)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var t;const e=(t=this.mediaSource)==null?void 0:t.readyState;return e==="open"||e==="ended"}onMediaDetaching(t,e){const i=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:a,_objectUrl:l}=this;if(a){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=a.readyState==="open";try{const f=a.sourceBuffers;for(let h=f.length;h--;)c&&f[h].abort(),a.removeSourceBuffer(f[h]);c&&a.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),i||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(n.removeAttribute("src"),this.appendSource&&ET(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(b.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(([t])=>{t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(t){var e;const i=(e=this.tracks[t])==null?void 0:e.buffer;if(this.removeBuffer(t),i)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(a){this.warn(`onBufferReset ${t}`,a)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[Qg(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new LL(this.tracks)}onBufferCodecs(t,e){const i=this.tracks,n=Object.keys(e);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in e&&(i.audio||i.video)||i.audiovideo&&("audio"in e||"video"in e),l=!a&&this.sourceBufferCount&&this.media&&n.some(c=>!i[c]);if(a||l){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${n}" SourceBuffers`);return}n.forEach(c=>{var f,h,g;const p=e[c],{id:E,codec:T,levelCodec:S,container:R,metadata:_,supplemental:D}=p;let N=i[c];const M=(f=this.transferData)==null||(h=f.tracks)==null?void 0:h[c],G=M!=null&&M.buffer?M:N,$=G?.pendingCodec||G?.codec,q=G?.levelCodec;N||(N=i[c]={buffer:void 0,listeners:[],codec:T,supplemental:D,container:R,levelCodec:S,metadata:_,id:E});const w=wh($,q),L=w?.replace(yT,"$1");let O=wh(T,S);const C=(g=O)==null?void 0:g.replace(yT,"$1");O&&w&&L!==C&&(c.slice(0,5)==="audio"&&(O=jh(O,this.appendSource)),this.log(`switching codec ${$} to ${O}`),O!==(N.pendingCodec||N.codec)&&(N.pendingCodec=O),N.container=R,this.appendChangeType(c,R,O))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const i=this.tracks[e];return t[e]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},t},{})}appendChangeType(t,e,i){const n=`${e};codecs=${i}`,a={label:`change-type=${n}`,execute:()=>{const l=this.tracks[t];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${t} sourceBuffer type to ${n}`),c.changeType(n),l.codec=i,l.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${t} SourceBuffer type`,l)}};this.append(a,t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const i=t.start,n=i+t.duration*.05;if(((e=this.fragmentTracker.getAppendedFrag(i,Rt.MAIN))==null?void 0:e.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const f=this.tracks.video;(this.lastVideoAppendEnd>n||f!=null&&f.buffer&&Pt.isBuffered(f.buffer,n)||((c=this.fragmentTracker.getAppendedFrag(n,Rt.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:t},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:i}=this,{data:n,type:a,parent:l,frag:c,part:f,chunkMeta:h}=e,g=h.buffering[a],p=c.sn,E=self.performance.now();g.start=E;const T=c.stats.buffering,S=f?f.stats.buffering:null;T.start===0&&(T.start=E),S&&S.start===0&&(S.start=E);const R=i.audio;let _=!1;a==="audio"&&R?.container==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const D=this.tracks.video,N=D?.buffer;if(N&&p!=="initSegment"){const $=f||c,q=this.blockedAudioAppend;if(a==="audio"&&l!=="main"&&!this.blockedAudioAppend){const L=$.start+$.duration*.05,O=N.buffered,C=this.currentOp("video");!O.length&&!C?this.blockAudio($):!C&&!Pt.isBuffered(N,L)&&this.lastVideoAppendEnd<L&&this.blockAudio($)}else if(a==="video"){const w=$.end;if(q){const L=q.frag.start;(w>L||w<this.lastVideoAppendEnd||Pt.isBuffered(N,L))&&this.unblockAudio()}this.lastVideoAppendEnd=w}}const M=(f||c).start,G={label:`append-${a}`,execute:()=>{if(g.executeStart=self.performance.now(),_){const $=this.tracks[a];if($){const q=$.buffer;if(q){const w=M-q.timestampOffset;Math.abs(w)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${M} (delta: ${w}) sn: ${p})`),q.timestampOffset=M)}}}this.appendExecutor(n,a)},onStart:()=>{},onComplete:()=>{const $=self.performance.now();g.executeEnd=g.end=$,T.first===0&&(T.first=$),S&&S.first===0&&(S.first=$);const q={};this.sourceBuffers.forEach(([w,L])=>{w&&(q[w]=Pt.getBuffered(L))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:a,frag:c,part:f,chunkMeta:h,parent:c.type,timeRanges:q})},onError:$=>{var q;const w={type:bt.MEDIA_ERROR,parent:c.type,details:W.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:c,part:f,chunkMeta:h,error:$,err:$,fatal:!1},L=(q=this.media)==null?void 0:q.error;if($.code===DOMException.QUOTA_EXCEEDED_ERR)w.details=W.BUFFER_FULL_ERROR;else if($.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!L)w.errorAction=_u(!0);else if($.name===i_&&this.sourceBufferCount===0)w.errorAction=_u(!0);else{const O=++this.appendErrors[a];this.warn(`Failed ${O}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${L||"no media error"})`),(O>=this.hls.config.appendErrorMaxRetry||L)&&(w.fatal=!0)}this.hls.trigger(b.ERROR,w)}};this.append(G,a,this.isPending(this.tracks[a]))}getFlushOp(t,e,i){return this.log(`queuing "${t}" remove ${e}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(t,e,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:t})},onError:n=>{this.warn(`Failed to remove ${e}-${i} from "${t}" SourceBuffer`,n)}}}onBufferFlushing(t,e){const{type:i,startOffset:n,endOffset:a}=e;i?this.append(this.getFlushOp(i,n,a),i):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,n,a),l)})}onFragParsed(t,e){const{frag:i,part:n}=e,a=[],l=n?n.elementaryStreams:i.elementaryStreams;l[Ee.AUDIOVIDEO]?a.push("audiovideo"):(l[Ee.AUDIO]&&a.push("audio"),l[Ee.VIDEO]&&a.push("video"));const c=()=>{const f=self.performance.now();i.stats.buffering.end=f,n&&(n.stats.buffering.end=f);const h=n?n.stats:i.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:i,part:n,stats:h,id:i.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,a).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{var e,i;return t&&(!((e=this.tracks[t])!=null&&e.ended)||((i=this.tracks[t])==null?void 0:i.ending))})}onBufferEos(t,e){var i;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!e.type||e.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const n=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})&&(n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(b.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(b.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([t])=>{if(t!==null){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.updateDuration())}updateDuration(){const t=this.getDurationAndRange();t&&this.blockUntilOpen(()=>this.updateMediaSource(t))}onError(t,e){if(e.details===W.BUFFER_APPEND_ERROR&&e.frag){var i;const n=(i=e.errorAction)==null?void 0:i.nextAutoLevel;vt(n)&&n!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:i}=this;if(!i||e===null||!this.sourceBufferCount)return;const n=t.config,a=i.currentTime,l=e.levelTargetDuration,c=e.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(vt(c)&&c>=0){const f=Math.max(c,l),h=Math.floor(a/l)*l-f;this.flushBackBuffer(a,l,h)}if(vt(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){const f=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),h=Math.max(f,l),g=Math.floor(a/l)*l+h;this.flushFrontBuffer(a,l,g)}}flushBackBuffer(t,e,i){this.sourceBuffers.forEach(([n,a])=>{if(a){const c=Pt.getBuffered(a);if(c.length>0&&i>c.start(0)){var l;this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:i});const f=this.tracks[n];if((l=this.details)!=null&&l.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(f!=null&&f.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:n})}}})}flushFrontBuffer(t,e,i){this.sourceBuffers.forEach(([n,a])=>{if(a){const l=Pt.getBuffered(a),c=l.length;if(c<2)return;const f=l.start(c-1),h=l.end(c-1);if(i>f||t>=f&&t<=h)return;this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:n})}})}getDurationAndRange(){var t;const{details:e,mediaSource:i}=this;if(!e||!this.media||i?.readyState!=="open")return null;const n=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&e.live&&i.setLiveSeekableRange){const h=Math.max(0,e.fragmentStart),g=Math.max(h,n);return{duration:1/0,start:h,end:g}}return{duration:1/0}}const a=(t=this.overrides)==null?void 0:t.duration;if(a)return vt(a)?{duration:a}:null;const l=this.media.duration,c=vt(i.duration)?i.duration:0;return n>c&&n>l||!vt(l)?{duration:n}:null}updateMediaSource({duration:t,start:e,end:i}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==t&&(vt(t)&&this.log(`Updating MediaSource duration to ${t.toFixed(3)}`),n.duration=t),e!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${e}-${i}.`),n.setLiveSeekableRange(e,i)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${e} codec events expected: ${t}) ${Re(i)}`),this.tracksReady){var n;const a=(n=this.transferData)==null?void 0:n.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(([e,i])=>{if(e){const n=this.tracks[e];t[e]={buffer:i,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(b.BUFFER_CREATED,{tracks:t}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in t){const l=a,c=t[l];if(this.isPending(c)){const f=this.getTrackCodec(c,l),h=`${c.container};codecs=${f}`;c.codec=f,this.log(`creating sourceBuffer(${h})${this.currentOp(l)?" Queued":""} ${Re(c)}`);try{const g=i.addSourceBuffer(h),p=Qg(l),E=[l,g];e[p]=E,c.buffer=g}catch(g){var n;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(l),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[l],this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:l,mimeType:h,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(t,e){const i=t.supplemental;let n=t.codec;i&&(e==="video"||e==="audiovideo")&&pm(i,"video")&&(n=II(n,i));const a=wh(n,t.levelCodec);return a?e.slice(0,5)==="audio"?jh(a,this.appendSource):a:""}trackSourceBuffer(t,e){const i=e.buffer;if(!i)return;const n=this.getTrackCodec(e,t);this.tracks[t]={buffer:i,codec:n,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(a,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var t,e;const i=((t=this.media)==null||(e=t.querySelector)==null?void 0:e.call(t,"source"))||this.media;return i?.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)==="closed"){this.resetBuffer(t);return}const i=this.currentOp(t);i&&(i.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var i;const n=new Error(`${t} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${n}`,e),this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:n,fatal:!1});const a=this.currentOp(t);a&&a.onError(n)}removeExecutor(t,e,i){const{media:n,mediaSource:a}=this,l=this.tracks[t],c=l?.buffer;if(!n||!a||!c){this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(t);return}const f=vt(n.duration)?n.duration:1/0,h=vt(a.duration)?a.duration:1/0,g=Math.max(0,e),p=Math.min(i,f,h);p>g&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${g},${p}] from the ${t} SourceBuffer`),c.remove(g,p)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const i=this.tracks[e],n=i?.buffer;if(!n)throw new DL(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,n.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([t,e])=>t&&e.updating)}isQueued(){return this.sourceBuffers.some(([t])=>t&&!!this.currentOp(t))}isPending(t){return!!t&&!t.buffer}blockBuffers(t,e=this.sourceBufferTypes){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:i}=this,n=e.map(l=>this.appendBlocker(l));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(l=>{i===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(e=>{var i;const n=(i=this.tracks[e])==null?void 0:i.buffer;!n||n.updating||this.shiftAndExecuteNext(e)})}append(t,e,i){this.operationQueue&&this.operationQueue.append(t,e,i)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,[e])=>t+(e?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([t])=>t).filter(t=>!!t)}addBufferListener(t,e,i){const n=this.tracks[t];if(!n)return;const a=n.buffer;if(!a)return;const l=i.bind(this,t);n.listeners.push({event:e,listener:l}),a.addEventListener(e,l)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const i=e.buffer;i&&(e.listeners.forEach(n=>{i.removeEventListener(n.event,n.listener)}),e.listeners.length=0)}}function ET(r){const t=r.querySelectorAll("source");[].slice.call(t).forEach(e=>{r.removeChild(e)})}function wL(r,t){const e=self.document.createElement("source");e.type="video/mp4",e.src=t,r.appendChild(e)}function Qg(r){return r==="audio"?1:0}class yp{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.BUFFER_CODECS,this.onBufferCodecs,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.BUFFER_CODECS,this.onBufferCodecs,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&vt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const t=this.hls.levels;if(t.length){const e=this.hls,i=this.getMaxLevel(t.length-1);i!==this.autoLevelCapping&&e.logger.log(`Setting autoLevelCapping to ${i}: ${t[i].height}p@${t[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=i,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((n,a)=>this.isLevelAllowed(n)&&a<=t);return this.clientRect=null,yp.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(i=>t.bitrate===i.bitrate&&t.width===i.width&&t.height===i.height)}static getMaxLevelByMediaSize(t,e,i){if(!(t!=null&&t.length))return-1;const n=(c,f)=>f?c.width!==f.width||c.height!==f.height:!0;let a=t.length-1;const l=Math.max(e,i);for(let c=0;c<t.length;c+=1){const f=t[c];if((f.width>=l||f.height>=l)&&n(f,t[c+1])){a=c;break}}return a}}const OL={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Oi=OL,PL={HLS:"h"},ML=PL,kL="CMCD-Object",NL="CMCD-Request",FL="CMCD-Session",UL="CMCD-Status",ou={OBJECT:kL,REQUEST:NL,SESSION:FL,STATUS:UL},BL={[ou.OBJECT]:["br","d","ot","tb"],[ou.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[ou.SESSION]:["cid","pr","sf","sid","st","v"],[ou.STATUS]:["bs","rtp"]};class Vo{constructor(t,e){Array.isArray(t)&&(t=t.map(i=>i instanceof Vo?i:new Vo(i))),this.value=t,this.params=e}}const VL="Dict";function GL(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function $L(r,t,e,i){return new Error(`failed to ${r} "${GL(t)}" as ${e}`,{cause:i})}function is(r,t,e){return $L("serialize",r,t,e)}class n_{constructor(t){this.description=t}}const vT="Bare Item",HL="Boolean";function KL(r){if(typeof r!="boolean")throw is(r,HL);return r?"?1":"?0"}function zL(r){return btoa(String.fromCharCode(...r))}const qL="Byte Sequence";function jL(r){if(ArrayBuffer.isView(r)===!1)throw is(r,qL);return`:${zL(r)}:`}const YL="Integer";function QL(r){return r<-999999999999999||999999999999999<r}function s_(r){if(QL(r))throw is(r,YL);return r.toString()}function XL(r){return`@${s_(r.getTime()/1e3)}`}function r_(r,t){if(r<0)return-r_(-r,t);const e=Math.pow(10,t);if(Math.abs(r*e%1-.5)<Number.EPSILON){const n=Math.floor(r*e);return(n%2===0?n:n+1)/e}else return Math.round(r*e)/e}const WL="Decimal";function ZL(r){const t=r_(r,3);if(Math.floor(Math.abs(t)).toString().length>12)throw is(r,WL);const e=t.toString();return e.includes(".")?e:`${e}.0`}const JL="String",tD=/[\x00-\x1f\x7f]+/;function eD(r){if(tD.test(r))throw is(r,JL);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function iD(r){return r.description||r.toString().slice(7,-1)}const nD="Token";function TT(r){const t=iD(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t)===!1)throw is(t,nD);return t}function bm(r){switch(typeof r){case"number":if(!vt(r))throw is(r,vT);return Number.isInteger(r)?s_(r):ZL(r);case"string":return eD(r);case"symbol":return TT(r);case"boolean":return KL(r);case"object":if(r instanceof Date)return XL(r);if(r instanceof Uint8Array)return jL(r);if(r instanceof n_)return TT(r);default:throw is(r,vT)}}const sD="Key";function xm(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw is(r,sD);return r}function Ep(r){return r==null?"":Object.entries(r).map(([t,e])=>e===!0?`;${xm(t)}`:`;${xm(t)}=${bm(e)}`).join("")}function a_(r){return r instanceof Vo?`${bm(r.value)}${Ep(r.params)}`:bm(r)}function rD(r){return`(${r.value.map(a_).join(" ")})${Ep(r.params)}`}function aD(r,t={whitespace:!0}){if(typeof r!="object")throw is(r,VL);const e=r instanceof Map?r.entries():Object.entries(r),i=t?.whitespace?" ":"";return Array.from(e).map(([n,a])=>{a instanceof Vo||(a=new Vo(a));let l=xm(n);return a.value===!0?l+=Ep(a.params):(l+="=",Array.isArray(a.value)?l+=rD(a):l+=a_(a)),l}).join(`,${i}`)}function oD(r,t){return aD(r,t)}function lD(r){return r==="ot"||r==="sf"||r==="st"}function uD(r){return typeof r=="number"?vt(r):r!=null&&r!==""&&r!==!1}function cD(r,t){const e=new URL(r),i=new URL(t);if(e.origin!==i.origin)return r;const n=e.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;n[0]===a[0];)n.shift(),a.shift();for(;a.length;)a.shift(),n.unshift("..");return n.join("/")}const Nh=r=>Math.round(r),hD=(r,t)=>(t?.baseUrl&&(r=cD(r,t.baseUrl)),encodeURIComponent(r)),Sh=r=>Nh(r/100)*100,fD={br:Nh,d:Nh,bl:Sh,dl:Sh,mtp:Sh,nor:hD,rtp:Sh,tb:Nh};function dD(r,t){const e={};if(r==null||typeof r!="object")return e;const i=Object.keys(r).sort(),n=he({},fD,t?.formatters),a=t?.filter;return i.forEach(l=>{if(a?.(l))return;let c=r[l];const f=n[l];f&&(c=f(c,t)),!(l==="v"&&c===1)&&(l=="pr"&&c===1||uD(c)&&(lD(l)&&typeof c=="string"&&(c=new n_(c)),e[l]=c))}),e}function o_(r,t={}){return r?oD(dD(r,t),he({whitespace:!1},t)):""}function gD(r,t={}){const e={};if(!r)return e;const i=Object.entries(r),n=Object.entries(BL).concat(Object.entries(t?.customHeaderMap||{})),a=i.reduce((l,c)=>{var f,h;const[g,p]=c,E=((f=n.find(T=>T[1].includes(g)))===null||f===void 0?void 0:f[0])||ou.REQUEST;return(h=l[E])!==null&&h!==void 0||(l[E]={}),l[E][g]=p,l},{});return Object.entries(a).reduce((l,[c,f])=>(l[c]=o_(f,t),l),e)}function mD(r,t,e){return he(r,gD(t,e))}const pD="CMCD";function yD(r,t={}){if(!r)return"";const e=o_(r,t);return`${pD}=${encodeURIComponent(e)}`}const ST=/CMCD=[^&#]+/;function ED(r,t,e){const i=yD(t,e);if(!i)return r;if(ST.test(r))return r.replace(ST,i);const n=r.includes("?")?"&":"?";return`${r}${n}${i}`}class vD{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Oi.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=n=>{try{const{frag:a,part:l}=n,c=this.hls.levels[a.level],f=this.getObjectType(a),h={d:(l||a).duration*1e3,ot:f};(f===Oi.VIDEO||f===Oi.AUDIO||f==Oi.MUXED)&&(h.br=c.bitrate/1e3,h.tb=this.getTopBandwidth(f)/1e3,h.bl=this.getBufferLength(f));const g=l?this.getNextPart(l):this.getNextFrag(a);g!=null&&g.url&&g.url!==a.url&&(h.nor=g.url),this.apply(n,h)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||t.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHED,this.onMediaDetached,this),t.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHED,this.onMediaDetached,this),t.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,n;this.audioBuffer=(i=e.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(n=e.tracks.video)==null?void 0:n.buffer}createData(){var t;return{v:1,sf:ML.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){he(e,this.createData());const i=e.ot===Oi.INIT||e.ot===Oi.VIDEO||e.ot===Oi.MUXED;this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);const{includeKeys:n}=this;n&&(e=Object.keys(e).reduce((l,c)=>(n.includes(c)&&(l[c]=e[c]),l),{}));const a={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),mD(t.headers,e,a)):t.url=ED(t.url,e,a)}getNextFrag(t){var e;const i=(e=this.hls.levels[t.level])==null?void 0:e.details;if(i){const n=t.sn-i.startSN;return i.fragments[n+1]}}getNextPart(t){var e,i;const{index:n,fragment:a}=t,l=(e=this.hls.levels[a.level])==null||(i=e.details)==null?void 0:i.partList;if(l){const{sn:c}=a;for(let f=l.length-1;f>=0;f--){const h=l[f];if(h.index===n&&h.fragment.sn===c)return l[f+1]}}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return Oi.TIMED_TEXT;if(t.sn==="initSegment")return Oi.INIT;if(e==="audio")return Oi.AUDIO;if(e==="main")return this.hls.audioTracks.length?Oi.VIDEO:Oi.MUXED}getTopBandwidth(t){let e=0,i;const n=this.hls;if(t===Oi.AUDIO)i=n.audioTracks;else{const a=n.maxAutoLevel,l=a>-1?a+1:n.levels.length;i=n.levels.slice(0,l)}return i.forEach(a=>{a.bitrate>e&&(e=a.bitrate)}),e>0?e:NaN}getBufferLength(t){const e=this.media,i=t===Oi.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!e?NaN:Pt.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new i(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,l,c){e(a),this.loader.load(a,l,c)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new i(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,l,c){e(a),this.loader.load(a,l,c)}}}}const TD=3e5;class SD extends Vs{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(t.indexOf(e.pathwayId)===-1&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=this.timeToLoad*1e3-(performance.now()-this.updated);if(t>0){this.scheduleRefresh(this.uri,t);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if(i?.action===Ti.SendAlternateToPenaltyBox&&i.flags===bn.MoveAllAlternatesMatchingHost){const n=this.levels;let a=this._pathwayPriority,l=this.pathwayId;if(e.context){const{groupId:c,pathwayId:f,type:h}=e.context;c&&n?l=this.getPathwayForGroupId(c,h,l):f&&(l=f)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!a&&n&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),i.resolved=this.pathwayId!==l),i.resolved||this.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${l} levels: ${n&&n.length} priorities: ${Re(a)} penalized: ${Re(this.penalizedPathways)}`)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this._pathwayPriority=t;let e;const i=this.penalizedPathways,n=performance.now();Object.keys(i).forEach(a=>{n-i[a]>TD&&delete i[a]});for(let a=0;a<t.length;a++){const l=t[a];if(l in i)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,f=this.hls.levels[c];if(e=this.getLevelsForPathway(l),e.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,OA(e),this.hls.trigger(b.LEVELS_UPDATED,{levels:e});const h=this.hls.levels[c];f&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(t,e,i){const n=this.getLevelsForPathway(i).concat(this.levels||[]);for(let a=0;a<n.length;a++)if(e===Ht.AUDIO_TRACK&&n[a].hasAudioGroup(t)||e===Ht.SUBTITLE_TRACK&&n[a].hasSubtitleGroup(t))return n[a].pathwayId;return i}clonePathways(t){const e=this.levels;if(!e)return;const i={},n={};t.forEach(a=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":f}=a;if(e.some(g=>g.pathwayId===l))return;const h=this.getLevelsForPathway(c).map(g=>{const p=new xe(g.attrs);p["PATHWAY-ID"]=l;const E=p.AUDIO&&`${p.AUDIO}_clone_${l}`,T=p.SUBTITLES&&`${p.SUBTITLES}_clone_${l}`;E&&(i[p.AUDIO]=E,p.AUDIO=E),T&&(n[p.SUBTITLES]=T,p.SUBTITLES=T);const S=l_(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),R=new Au({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:S,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let _=1;_<g.audioGroups.length;_++)R.addGroupId("audio",`${g.audioGroups[_]}_clone_${l}`);if(g.subtitleGroups)for(let _=1;_<g.subtitleGroups.length;_++)R.addGroupId("text",`${g.subtitleGroups[_]}_clone_${l}`);return R});e.push(...h),AT(this.audioTracks,i,f,l),AT(this.subtitleTracks,n,f,l)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;this.loader&&this.loader.destroy(),this.loader=new i(e);let n;try{n=new self.URL(t)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(n.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+g)}const a={responseType:"json",url:n.href},l=e.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},f={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(g,p,E,T)=>{this.log(`Loaded steering manifest: "${n}"`);const S=g.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":R,"PATHWAY-CLONES":_,"PATHWAY-PRIORITY":D}=S;if(R)try{this.uri=new self.URL(R,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${R}`);return}this.scheduleRefresh(this.uri||E.url),_&&this.clonePathways(_);const N={steeringManifest:S,url:n.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,N),D&&this.updatePathwayPriority(D)},onError:(g,p,E,T)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let S=this.timeToLoad*1e3;if(g.code===429){const R=this.loader;if(typeof R?.getResponseHeader=="function"){const _=R.getResponseHeader("Retry-After");_&&(S=parseFloat(_)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,S)},onTimeout:(g,p,E)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(a,f,h)}scheduleRefresh(t,e=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const n=(i=this.hls)==null?void 0:i.media;if(n&&!n.ended){this.loadSteeringManifest(t);return}this.scheduleRefresh(t,this.timeToLoad*1e3)},e)}}function AT(r,t,e,i){r&&Object.keys(t).forEach(n=>{const a=r.filter(l=>l.groupId===n).map(l=>{const c=he({},l);return c.details=void 0,c.attrs=new xe(c.attrs),c.url=c.attrs.URI=l_(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),c.groupId=c.attrs["GROUP-ID"]=t[n],c.attrs["PATHWAY-ID"]=i,c});r.push(...a)})}function l_(r,t,e,i){const{HOST:n,PARAMS:a,[e]:l}=i;let c;t&&(c=l?.[t],c&&(r=c));const f=new self.URL(r);return n&&!c&&(f.host=n),a&&Object.keys(a).sort().forEach(h=>{h&&f.searchParams.set(h,a[h])}),f.href}function zi(r,t,e){hn(r,t,e),r.addEventListener(t,e)}function hn(r,t,e){r.removeEventListener(t,e)}class Po extends Vs{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Po.CDMCleanupPromise?[Po.CDMCleanupPromise]:[],this.onMediaEncrypted=e=>{const{initDataType:i,initData:n}=e,a=`"${e.type}" event: init data type: "${i}"`;if(this.debug(a),n!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=au(this.config));const c=l.map(ph).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=Ph(l);let f,h;if(i==="sinf"){if(c!==ae.FAIRPLAY){this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${i}" for selected key-system ${c}`);return}const S=Ye(new Uint8Array(n));try{const R=op(JSON.parse(S).sinf),_=uA(R);if(!_)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(_.subarray(8,24)),h=ae.FAIRPLAY}catch(R){this.warn(`${a} Failed to parse sinf: ${R}`);return}}else{if(c!==ae.WIDEVINE&&c!==ae.PLAYREADY){this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${i}" for selected key-system ${c}`);return}const S=_I(n),R=S.filter(D=>!!D.systemId&&Gg(D.systemId)===c);R.length>1&&this.warn(`${a} Using first of ${R.length} pssh found for selected key-system ${c}`);const _=R[0];if(!_){S.length===0||S.some(D=>!D.systemId)?this.warn(`${a} contains incomplete or invalid pssh data`):this.log(`ignoring ${a} for ${S.map(D=>Gg(D.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(h=Gg(_.systemId),_.version===0&&_.data)if(h===ae.WIDEVINE){const D=_.data.length-22;f=new Uint8Array(_.data.subarray(D,D+16))}else h===ae.PLAYREADY&&(f=bA(_.data))}if(!h||!f)return;const g=jn.hexDump(f),{keyIdToKeySessionPromise:p,mediaKeySessions:E}=this;let T=p[g];for(let S=0;S<E.length;S++){const R=E[S],_=R.decryptdata;if(!_.keyId)continue;const D=jn.hexDump(_.keyId);if(g===D||_.uri.replace(/-/g,"").indexOf(g)!==-1){if(T=p[D],_.pssh)break;delete p[D],_.pssh=new Uint8Array(n),_.keyId=f,T=p[g]=T.then(()=>this.generateRequestWithPreferredKeySession(R,i,n,"encrypted-event-key-match")),T.catch(N=>this.handleError(N));break}}if(!T){if(h!==c){this.log(`Ignoring "${e.type}" event with ${h} init data for selected key-system ${c}`);return}T=p[g]=this.getKeySystemSelectionPromise([h]).then(({keySystem:S,mediaKeys:R})=>{var _;this.throwIfDestroyed();const D=new Ru("ISO-23001-7",g,(_=ph(S))!=null?_:"");return D.pssh=new Uint8Array(n),D.keyId=f,this.attemptSetMediaKeys(S,R).then(()=>{this.throwIfDestroyed();const N=this.createMediaKeySessionContext({decryptdata:D,keySystem:S,mediaKeys:R});return this.generateRequestWithPreferredKeySession(N,i,n,"encrypted-event-no-match")})}),T.catch(S=>this.handleError(S))}})}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(b.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(b.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:i}=this.config,n=e[t];if(n)return n.licenseUrl;if(t===ae.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(t){const e=this.getLicenseServerUrl(t);if(e===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return e}getServerCertificateUrl(t){const{drmSystems:e}=this.config,i=e[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,i=(l,c,f)=>!!l&&f.indexOf(l)===c,n=e.map(l=>l.audioCodec).filter(i),a=e.map(l=>l.videoCodec).filter(i);return n.length+a.length===0&&a.push("avc1.42e01e"),new Promise((l,c)=>{const f=h=>{const g=h.shift();this.getMediaKeysPromise(g,n,a).then(p=>l({keySystem:g,mediaKeys:p})).catch(p=>{h.length?f(h):p instanceof an?c(p):c(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};f(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${i}`;return RA===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return i(t,e)}getMediaKeysPromise(t,e,i){const n=d1(t,e,i,this.config.drmSystemOptions),a=this.keySystemAccessPromises[t];let l=a?.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${t}" key-system access with config: ${Re(n)}`),l=this.requestMediaKeySystemAccess(t,n);const c=this.keySystemAccessPromises[t]={keySystemAccess:l};return l.catch(f=>{this.log(`Failed to obtain access to key-system "${t}": ${f}`)}),l.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const h=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),c.mediaKeys=f.createMediaKeys().then(g=>(this.log(`Media-keys created for "${t}"`),c.hasMediaKeys=!0,h.then(p=>p?this.setMediaKeysServerCertificate(g,t,p):g))),c.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${t}"}: ${g}`)}),c.mediaKeys})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:i}){this.log(`Creating key-system session "${e}" keyId: ${jn.hexDump(t.keyId||[])}`);const n=i.createSession(),a={decryptdata:t,keySystem:e,mediaKeys:i,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const i=this.createMediaKeySessionContext(t),n=this.getKeyIdString(e),a="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(i,a,e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return jn.hexDump(t.keyId)}updateKeySession(t,e){var i;const n=t.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${jn.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),n.update(e)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>ph(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:e,mediaKeys:i})=>this.attemptSetMediaKeys(e,i))}selectKeySystem(t){return new Promise((e,i)=>this.getKeySystemSelectionPromise(t).then(({keySystem:n})=>{const a=ph(n);a?e(a):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i))}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){const e=au(this.config),i=t.map(Ph).filter(n=>!!n&&e.indexOf(n)!==-1);return this.selectKeySystem(i)}loadKey(t){const e=t.keyInfo.decryptdata,i=this.getKeyIdString(e),n=`(keyId: ${i} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${n}`);let a=this.keyIdToKeySessionPromise[i];return a||(a=this.getKeySystemForKeyPromise(e).then(({keySystem:c,mediaKeys:f})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${n}`),this.attemptSetMediaKeys(c,f).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:f,decryptdata:e}))))),(this.keyIdToKeySessionPromise[i]=a.then(c=>{const f="cenc",h=e.pssh?e.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,f,h,"playlist-key")})).catch(c=>this.handleError(c))),a}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),t instanceof an?this.hls.trigger(b.ERROR,t.data):this.hls.trigger(b.ERROR,{type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[e];if(!i){const n=Ph(t.keyFormat),a=n?[n]:au(this.config);return this.attemptKeySystemAccess(a)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=au(this.config)),t.length===0)throw new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Re({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,e){if(this.mediaKeys===e)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const n=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.mediaKeys=e,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>i.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(t,e,i,n){var a,l;const c=(a=this.config.drmSystems)==null||(l=a[t.keySystem])==null?void 0:l.generateRequest;if(c)try{const S=c.call(this.hls,e,i,t);if(!S)throw new Error("Invalid response from configured generateRequest filter");e=S.initDataType,i=S.initData?S.initData:null,t.decryptdata.pssh=i?new Uint8Array(i):null}catch(S){var f;if(this.warn(S.message),(f=this.hls)!=null&&f.config.debug)throw S}if(i===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(t);const h=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${n}": ${h} (init data type: ${e} length: ${i?i.byteLength:null})`);const g=new up,p=t._onmessage=S=>{const R=t.mediaKeysSession;if(!R){g.emit("error",new Error("invalid state"));return}const{messageType:_,message:D}=S;this.log(`"${_}" message event for session "${R.sessionId}" message size: ${D.byteLength}`),_==="license-request"||_==="license-renewal"?this.renewLicense(t,D).catch(N=>{g.eventNames().length?g.emit("error",N):this.handleError(N)}):_==="license-release"?t.keySystem===ae.FAIRPLAY&&(this.updateKeySession(t,vm("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${_}"`)},E=t._onkeystatuseschange=S=>{if(!t.mediaKeysSession){g.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);const _=t.keyStatus;g.emit("keyStatus",_),_==="expired"&&(this.warn(`${t.keySystem} expired for key ${h}`),this.renewKeySession(t))};zi(t.mediaKeysSession,"message",p),zi(t.mediaKeysSession,"keystatuseschange",E);const T=new Promise((S,R)=>{g.on("error",R),g.on("keyStatus",_=>{_.startsWith("usable")?S():_==="output-restricted"?R(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):_==="internal-error"?R(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${_}"`)):_==="expired"?R(new Error("key expired while generating request")):this.warn(`unhandled key status change "${_}"`)})});return t.mediaKeysSession.generateRequest(e,i).then(()=>{var S;this.log(`Request generated for key-session "${(S=t.mediaKeysSession)==null?void 0:S.sessionId}" keyId: ${h}`)}).catch(S=>{throw new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_SESSION,error:S,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>T).catch(S=>{throw g.removeAllListeners(),this.removeSession(t),S}).then(()=>(g.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,i)=>{if(typeof i=="string"&&typeof e=="object"){const n=i;i=e,e=n}this.log(`key status change "${e}" for keyStatuses keyId: ${jn.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${jn.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,i=e.loader,n=new i(e),a=this.getServerCertificateUrl(t);return a?(this.log(`Fetching server certificate for "${t}"`),new Promise((l,c)=>{const f={responseType:"arraybuffer",url:a},h=e.certLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(E,T,S,R)=>{l(E.data)},onError:(E,T,S,R)=>{c(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:re({url:f.url,data:void 0},E)},`"${t}" certificate request failed (${a}). Status: ${E.code} (${E.text})`))},onTimeout:(E,T,S)=>{c(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:f.url,data:void 0}},`"${t}" certificate request timed out (${a})`))},onAbort:(E,T,S)=>{c(new Error("aborted"))}};n.load(f,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,i){return new Promise((n,a)=>{t.setServerCertificate(i).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${i?.byteLength}) on "${e}"`),n(t)}).catch(l=>{a(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(n=>{throw new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(t,e){const i=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!i.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const n=new DOMParser().parseFromString(i,"application/xml"),a=n.querySelectorAll("HttpHeader");if(a.length>0){let g;for(let p=0,E=a.length;p<E;p++){var l,c;g=a[p];const T=(l=g.querySelector("name"))==null?void 0:l.textContent,S=(c=g.querySelector("value"))==null?void 0:c.textContent;T&&S&&t.setRequestHeader(T,S)}}const f=n.querySelector("Challenge"),h=f?.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return vm(atob(h))}setupLicenseXHR(t,e,i,n){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return a.call(this.hls,t,e,i,n)}).catch(l=>{if(!i.decryptdata)throw l;return t.open("POST",e,!0),a.call(this.hls,t,e,i,n)}).then(l=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:l||n})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:n}))}requestLicense(t,e){const i=this.config.keyLoadPolicy.default;return new Promise((n,a)=>{const l=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return a(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let f=c.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const h=this.config.licenseResponseCallback;if(h)try{f=h.call(this.hls,c,l,t)}catch(g){this.error(g)}n(f)}else{const f=i.errorRetry,h=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||c.status>=400&&c.status<500)a(new an({type:bt.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const g=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(t,e).then(n,a)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=c,this.setupLicenseXHR(c,l,t,e).then(({xhr:f,licenseChallenge:h})=>{t.keySystem==ae.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(f,h)),f.send(h)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const i=e.media;this.media=i,zi(i,"encrypted",this.onMediaEncrypted),zi(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media;t&&(hn(t,"encrypted",this.onMediaEncrypted),hn(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const e=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ru.clearKeyUriToKeyIdMap();const n=i.length;Po.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(a=>{var l;this.log(`Could not clear media keys: ${a}`),(l=this.hls)==null||l.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))).catch(a=>{var l;this.log(`Could not close sessions and clear media keys: ${a}`),(l=this.hls)==null||l.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=e.reduce((n,a)=>(n.indexOf(a.keyFormat)===-1&&n.push(a.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:i}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(t);n>-1&&this.mediaKeySessions.splice(n,1);const{drmSystemOptions:a}=this.config;return(m1(a)?new Promise((c,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),e.remove().then(c)}):Promise.resolve()).catch(c=>{var f;this.log(`Could not remove session: ${c}`),(f=this.hls)==null||f.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>e.close()).catch(c=>{var f;this.log(`Could not close session: ${c}`),(f=this.hls)==null||f.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}}}Po.CDMCleanupPromise=void 0;class an extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}class AD{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const n=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,i){const n=performance.now();if(e){if(this.lastTime){const a=n-this.lastTime,l=i-this.lastDroppedFrames,c=e-this.lastDecodedFrames,f=1e3*l/a,h=this.hls;if(h.trigger(b.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:i}),f>0&&l>h.config.fpsDroppedMonitoringThreshold*c){let g=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=g)&&(g=g-1,h.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:h.currentLevel}),h.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}function u_(r,t){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=r,t.dispatchEvent(e)}function c_(r,t){const e=r.mode;if(e==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(t.id))try{if(r.addCue(t),!r.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){ie.debug(`[texttrack-utils]: ${i}`);try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,r.addCue(n)}catch(n){ie.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}e==="disabled"&&(r.mode=e)}function wo(r,t){const e=r.mode;if(e==="disabled"&&(r.mode="hidden"),r.cues)for(let i=r.cues.length;i--;)t&&r.cues[i].removeEventListener("enter",t),r.removeCue(r.cues[i]);e==="disabled"&&(r.mode=e)}function Im(r,t,e,i){const n=r.mode;if(n==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const a=RD(r.cues,t,e);for(let l=0;l<a.length;l++)(!i||i(a[l]))&&r.removeCue(a[l])}n==="disabled"&&(r.mode=n)}function _D(r,t){if(t<=r[0].startTime)return 0;const e=r.length-1;if(t>r[e].endTime)return-1;let i=0,n=e,a;for(;i<=n;)if(a=Math.floor((n+i)/2),t<r[a].startTime)n=a-1;else if(t>r[a].startTime&&i<e)i=a+1;else return a;return r[i].startTime-t<t-r[n].startTime?i:n}function RD(r,t,e){const i=[],n=_D(r,t);if(n>-1)for(let a=n,l=r.length;a<l;a++){const c=r[a];if(c.startTime>=t&&c.endTime<=e)i.push(c);else if(c.startTime>e)return i}return i}function Fh(r){const t=[];for(let e=0;e<r.length;e++){const i=r[e];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&t.push(r[e])}return t}class bD extends pp{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const i=Fh(this.media.textTracks);for(let a=0;a<i.length;a++)if(i[a].mode==="hidden")e=i[a];else if(i[a].mode==="showing"){e=i[a];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(b.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const i=this.media;if(!i)return;const n=!!e.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;Fh(i.textTracks).forEach(l=>{wo(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,groupId:n,details:a}=e,l=this.tracksInGroup[i];if(!l||l.groupId!==n){this.warn(`Subtitle track with id:${i} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=e.details,this.log(`Subtitle track ${i} "${l.name}" lang:${l.lang} group:${n} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,c)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const i=e.subtitleGroups||null,n=this.groupIds;let a=this.currentTrack;if(!i||n?.length!==i?.length||i!=null&&i.some(l=>n?.indexOf(l)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(g=>!i||i.indexOf(g.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(g=>g.default)&&(this.selectDefaultTrack=!1),l.forEach((g,p)=>{g.id=p});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!a&&c){this.selectDefaultTrack=!1;const g=Xn(c,l);if(g>-1)a=l[g];else{const p=Xn(c,this.tracks);a=this.tracks[p]}}let f=this.findTrackId(a);f===-1&&a&&(f=this.findTrackId(null));const h={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,h),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(t){const e=this.tracksInGroup,i=this.selectDefaultTrack;for(let n=0;n<e.length;n++){const a=e[n];if(!(i&&!a.default||!i&&!t)&&(!t||Ea(a,t)))return n}if(t){for(let n=0;n<e.length;n++){const a=e[n];if(Lu(t.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<e.length;n++){const a=e[n];if(Lu(t.attrs,a.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const n=e[i];if(Rm(n,t))return i}}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Ht.SUBTITLE_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(t.id===-1)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const i=this.currentTrack;if(i&&Ea(t,i))return i;const n=Xn(t,this.tracksInGroup);if(n>-1){const a=this.tracksInGroup[n];return this.setSubtitleTrack(n),a}else{if(i)return null;{const a=Xn(t,e);if(a>-1)return e[a]}}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=t.id,n=t.groupId,a=this.getUrlWithDirectives(t.url,e),l=t.details,c=l?.age;this.log(`Loading subtitle ${i} "${t.name}" lang:${t.lang} group:${n}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${a}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:n,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=Fh(t.textTracks),i=this.currentTrack;let n;if(i&&(n=e.filter(a=>Rm(i,a))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(e).forEach(a=>{a.mode!=="disabled"&&a!==n&&(a.mode="disabled")}),n){const a=this.subtitleDisplay?"showing":"hidden";n.mode!==a&&(n.mode=a)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(t<-1||t>=e.length||!vt(t)){this.warn(`Invalid subtitle track id: ${t}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,n=e[t]||null;if(this.trackId=t,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:t});return}const a=!!n.details&&!n.details.live;if(t===this.trackId&&n===i&&a)return;this.log(`Switching to subtitle-track ${t}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:l,groupId:c="",name:f,type:h,url:g}=n;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:f,type:h,url:g});const p=this.switchParams(n.url,i?.details,n.details);this.loadPlaylist(p)}}function xD(){try{return crypto.randomUUID()}catch{try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch{let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const a=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(n=="x"?a:a&3|8).toString(16)})}}}function gu(r){let t=5381,e=r.length;for(;e;)t=t*33^r.charCodeAt(--e);return(t>>>0).toString()}const Mo=.025;let ef=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function ID(r,t,e){return`${r.identifier}-${e+1}-${gu(t)}`}class LD{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,(t=this.assetListLoader)==null||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const i=this.playoutLimit;return t<=0||isNaN(i)?!1:i===0?!0:(((e=this.assetList[t])==null?void 0:e.startOffset)||0)>i}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return Xg(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime,i=Xg(e,t);return e-i<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=vt(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return Xg(t,e)}return t}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Mo))}set appendInPlace(t){if(this.appendInPlaceStarted){this.resetOnResume=!t;return}this.appendInPlaceDisabled=!t}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ef.Range:ef.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return DD(this)}}function Xg(r,t){return r-t.start<t.duration/2&&!(Math.abs(r-(t.start+t.duration))<Mo)?t.start:t.start+t.duration}function h_(r,t,e){const i=new self.URL(r,e);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",t),i}function Wg(r,t){for(;(e=r.assetList[++t])!=null&&e.error;)var e;return t}function DD(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function xo(r){const t=r.timelineStart,e=r.duration||0;return`["${r.identifier}" ${t.toFixed(2)}-${(t+e).toFixed(2)}]`}class CD{constructor(t,e,i,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(b.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new t(e);this.interstitial=i,this.assetItem=n;let l=n.uri;try{l=h_(l,e.primarySessionId).href}catch{}a.loadSource(l);const c=()=>{this.hasDetails=!0};a.once(b.LEVEL_LOADED,c),a.once(b.AUDIO_TRACK_LOADED,c),a.once(b.SUBTITLE_TRACK_LOADED,c),a.on(b.MEDIA_ATTACHING,(f,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(b.BUFFER_APPENDED,()=>{const p=this.bufferedEnd;this.reachedPlayout(p)&&(this._bufferedEosTime=p,a.trigger(b.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var t;return((t=this.interstitial)==null?void 0:t.appendInPlace)||!1}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!t||!this._bufferedEosTime)return!1;const i=this.timelineOffset,n=Pt.bufferInfo(t,i,0);return this.getAssetTime(n.end)>=this._bufferedEosTime-.02}reachedPlayout(t){const i=this.interstitial.playoutLimit;return this.startOffset+t>=i}get destroyed(){var t;return!((t=this.hls)!=null&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return((t=this.hls)==null?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=Pt.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;return t||0}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return((t=this.hls)==null?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e){const i=t-e;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}}getAssetTime(t){const e=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,t-e),i)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var t;(t=this.hls)!=null&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){this.hls.attachMedia(t)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const t=this.hls;if(this.hasDetails){t.stopLoad();const e=i=>delete i.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,i){this.hls.on(t,e)}once(t,e,i){this.hls.once(t,e)}off(t,e,i){this.hls.off(t,e)}toString(){var t;return`HlsAssetPlayer: ${xo(this.assetItem)} ${(t=this.hls)==null?void 0:t.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const _T=.033;class wD extends Vs{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((i,n)=>t<=n.startOffset&&e>n.startOffset?(delete n.error,i+1):i,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let i=-1;t.nextEvent?i=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(i=this.findEventIndex(t.previousEvent.identifier)+1);const n=this.items;if(n)for(n[i]||(e===void 0&&(e=t.start),i=this.findItemIndexAtTime(e));i>=0&&(a=n[i])!=null&&a.event;){var a;i--}return i}findItemIndexAtTime(t,e){const i=this.items;if(i)for(let n=0;n<i.length;n++){let a=i[n];if(e&&e!=="primary"&&(a=a[e]),t===a.start||t>a.start&&t<a.end)return n}return-1}findJumpRestrictedIndex(t,e){const i=this.items;if(i)for(let n=t;n<=e&&i[n];n++){const a=i[n].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return n}return-1}findEventIndex(t){const e=this.items;if(e)for(let n=e.length;n--;){var i;if(((i=e[n].event)==null?void 0:i.identifier)===t)return n}return-1}findAssetIndex(t,e){const i=t.assetList,n=i.length;if(n>1)for(let a=0;a<n;a++){const l=i[a];if(!l.error){const c=l.timelineStart;if(e===c||e>c&&e<c+(l.duration||0))return a}}return 0}get assetIdAtEnd(){var t,e;const i=(t=this.items)==null||(e=t[this.length-1])==null?void 0:e.event;if(i){const n=i.assetList,a=n[n.length-1];if(a)return a.identifier}return null}parseInterstitialDateRanges(t,e){const i=t.main.details,{dateRanges:n}=i,a=this.events,l=this.parseDateRanges(n,{url:i.url},e),c=Object.keys(n),f=a?a.filter(h=>!c.includes(h.identifier)):[];l.length&&l.sort((h,g)=>{const p=h.cue.pre,E=h.cue.post,T=g.cue.pre,S=g.cue.post;if(p&&!T)return-1;if(T&&!p||E&&!S)return 1;if(S&&!E)return-1;if(!p&&!T&&!E&&!S){const R=h.startTime,_=g.startTime;if(R!==_)return R-_}return h.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=l,f.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(t,f)}updateSchedule(t,e=[]){const i=this.events||[];if(i.length||e.length||this.length<2){const n=this.items,a=this.parseSchedule(i,t);(e.length||n?.length!==a.length||a.some((c,f)=>Math.abs(c.playout.start-n[f].playout.start)>.005||Math.abs(c.playout.end-n[f].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(e,n))}}parseDateRanges(t,e,i){const n=[],a=Object.keys(t);for(let l=0;l<a.length;l++){const c=a[l],f=t[c];if(f.isInterstitial){let h=this.eventMap[c];h?h.setDateRange(f):(h=new LD(f,e),this.eventMap[c]=h,i===!1&&(h.appendInPlace=i)),n.push(h)}}return n}parseSchedule(t,e){const i=[],n=e.main.details,a=n.live?1/0:n.edge;let l=0;if(t=t.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),t.length){this.resolveOffsets(t,e);let f=0,h=0;if(t.forEach((g,p)=>{const E=g.cue.pre,T=g.cue.post,S=t[p-1]||null,R=g.appendInPlace,_=T?a:g.startOffset,D=g.duration,N=g.timelineOccupancy===ef.Range?D:0,M=g.resumptionOffset,G=S?.startTime===_,$=_+g.cumulativeDuration;let q=R?$+D:_+M;if(E||!T&&_<=0){const L=h;h+=N,g.timelineStart=$;const O=l;l+=D,i.push({event:g,start:$,end:q,playout:{start:O,end:l},integrated:{start:L,end:h}})}else if(_<=a){if(!G){const C=_-f;if(C>_T){const U=f,V=h;h+=C;const B=l;l+=C;const pt={previousEvent:t[p-1]||null,nextEvent:g,start:U,end:U+C,playout:{start:B,end:l},integrated:{start:V,end:h}};i.push(pt)}else C>0&&S&&(S.cumulativeDuration+=C,i[i.length-1].end=_)}T&&(q=$),g.timelineStart=$;const L=h;h+=N;const O=l;l+=D,i.push({event:g,start:$,end:q,playout:{start:O,end:l},integrated:{start:L,end:h}})}else return;const w=g.resumeTime;T||w>a?f=a:f=w}),f<a){var c;const g=f,p=h,E=a-f;h+=E;const T=l;l+=E,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:f,end:g+E,playout:{start:T,end:l},integrated:{start:p,end:h}})}this.setDurations(a,l,h)}else i.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return i}setDurations(t,e,i){this.durations={primary:t,playout:e,integrated:i}}resolveOffsets(t,e){const i=e.main.details,n=i.live?1/0:i.edge;let a=0,l=-1;t.forEach((c,f)=>{const h=c.cue.pre,g=c.cue.post,p=h?0:g?n:c.startTime;this.updateAssetDurations(c),l===p?c.cumulativeDuration=a:(a=0,l=p),!g&&c.snapOptions.in&&(c.resumeAnchor=Sa(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,e)||(c.appendInPlace=!1)),!c.appendInPlace&&f+1<t.length&&t[f+1].startTime-t[f].resumeTime<_T&&(t[f+1].appendInPlace=!1,t[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const T=vt(c.resumeOffset)?c.resumeOffset:c.duration;a+=T})}primaryCanResumeInPlaceAt(t,e){const i=t.resumeTime,n=t.startTime+t.resumptionOffset;return Math.abs(i-n)>Mo?(this.log(`"${t.identifier}" resumption ${i} not aligned with estimated timeline end ${n}`),!1):e?!Object.keys(e).some(l=>{const c=e[l].details,f=c.edge;if(i>=f)return this.log(`"${t.identifier}" resumption ${i} past ${l} playlist end ${f}`),!1;const h=Sa(null,c.fragments,i);if(!h)return this.log(`"${t.identifier}" resumption ${i} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const g=l==="audio"?.175:0;return Math.abs(h.start-i)<Mo+g||Math.abs(h.end-i)<Mo+g?!1:(this.log(`"${t.identifier}" resumption ${i} not aligned with ${l} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)}):(this.log(`"${t.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let i=0,n=!1,a=!1;t.assetList.forEach((l,c)=>{const f=e+i;l.startOffset=i,l.timelineStart=f,n||(n=l.duration===null),a||(a=!!l.error);const h=l.error?0:l.duration||0;i+=h}),n&&!a?t.duration=Math.max(i,t.duration):t.duration=i}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function pr(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class OD{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const i=t.assetListUrl;let n;try{n=h_(i,this.hls.sessionId,t.baseUrl)}catch(E){const T=this.assignAssetListError(t,W.ASSET_LIST_LOAD_ERROR,E,i);this.hls.trigger(b.ERROR,T);return}e&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+e);const a=this.hls.config,l=a.loader,c=new l(a),f={responseType:"json",url:n.href},h=a.interstitialAssetListLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(E,T,S,R)=>{const _=E.data,D=_?.ASSETS;if(!Array.isArray(D)){const N=this.assignAssetListError(t,W.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,T,R);this.hls.trigger(b.ERROR,N);return}t.assetListResponse=_,this.hls.trigger(b.ASSET_LIST_LOADED,{event:t,assetListResponse:_,networkDetails:R})},onError:(E,T,S,R)=>{const _=this.assignAssetListError(t,W.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${E.code} ${E.text} (${T.url})`),T.url,R,S);this.hls.trigger(b.ERROR,_)},onTimeout:(E,T,S)=>{const R=this.assignAssetListError(t,W.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${T.url})`),T.url,E,S);this.hls.trigger(b.ERROR,R)}};return c.load(f,g,p),this.hls.trigger(b.ASSET_LIST_LOADING,{event:t}),c}assignAssetListError(t,e,i,n,a,l){return t.error=i,{type:bt.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:n,error:i,networkDetails:l,stats:a}}}function RT(r){r?.play().catch(()=>{})}class PD extends Vs{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const n=i-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const l=n<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(i,i-n)&&this.updateSchedule(),this.checkBuffer(),l&&i<c.start||i>=c.end){var f;const E=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(c)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!l){const T=this.findItemIndex(c);if(E>T){const S=this.schedule.findJumpRestrictedIndex(T+1,E);if(S>T){this.setSchedulePosition(S);return}}}this.setSchedulePosition(E);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(c)){const E=c.event.assetList[0];E&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,E))}return}const g=h.timelineStart,p=h.duration||0;(l&&i<g||i>=g+p)&&this.setScheduleToAssetAtTime(i,h)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(i>=n.end){this.timelinePos=n.end;const c=this.findItemIndex(n);this.setSchedulePosition(c+1)}const a=this.playingAsset;if(!a)return;const l=a.timelineStart+(a.duration||0);i>=l&&this.setScheduleToAssetAtTime(i,a)},this.onScheduleUpdate=(i,n)=>{const a=this.schedule,l=this.playingItem,c=a.events||[],f=a.items||[],h=a.durations,g=i.map(S=>S.identifier),p=!!(c.length||g.length);(p||n)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${f.map(S=>pr(S))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const R=S.assetItem.timelineStart,_=S.timelineOffset-R;if(_)try{S.timelineOffset=R}catch(D){Math.abs(_)>Mo&&this.warn(`${D} ("${S.assetId}" ${S.timelineOffset}->${R})`)}}});let E=null;if(l){const S=this.updateItem(l,this.timelinePos);this.itemsMatch(l,S)&&(this.playingItem=S,this.waitingItem=this.endedItem=null,E=()=>this.trimInPlace(S,l))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const T=this.bufferingItem;if(T){const S=this.updateItem(T,this.bufferedPos);this.itemsMatch(T,S)?(this.bufferingItem=S,E||(E=()=>this.trimInPlace(S,T))):T.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(T.event,null))}if(i.forEach(S=>{S.assetList.forEach(R=>{this.clearAssetPlayer(R.identifier,null)})}),p||n){if(this.hls.trigger(b.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:f.slice(0),durations:h,removedIds:g}),this.isInterstitial(l)&&g.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}E&&E(),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new OD(t),this.schedule=new wD(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(b.BUFFER_APPENDED,this.onBufferAppended,this),t.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(b.MEDIA_ENDED,this.onMediaEnded,this),t.on(b.ERROR,this.onError,this),t.on(b.DESTROYING,this.onDestroying,this)}unregisterListeners(){const t=this.hls;t&&(t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(b.BUFFER_CODECS,this.onBufferCodecs,this),t.off(b.BUFFER_APPENDED,this.onBufferAppended,this),t.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(b.MEDIA_ENDED,this.onMediaEnded,this),t.off(b.ERROR,this.onError,this),t.off(b.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;(t=this.getBufferingPlayer())==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.getBufferingPlayer())==null||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){hn(t,"play",this.onPlay),hn(t,"pause",this.onPause),hn(t,"seeking",this.onSeeking),hn(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const i=this.media=e.media;zi(i,"seeking",this.onSeeking),zi(i,"timeupdate",this.onTimeupdate),zi(i,"play",this.onPlay),zi(i,"pause",this.onPause)}onMediaAttached(t,e){const i=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!n){this.clearScheduleState();const a=this.findItemIndex(i);this.setSchedulePosition(a)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const i=!!e.transferMedia,n=this.media;if(this.media=null,!i&&(n&&this.removeMediaListeners(n),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const t=this,e=()=>t.bufferingItem||t.waitingItem,i=p=>p&&t.getAssetPlayer(p.identifier),n=(p,E,T,S,R)=>{if(p){let _=p[E].start;const D=p.event;if(D){if(E==="playout"||D.timelineOccupancy!==ef.Point){const N=i(T);N?.interstitial===D&&(_+=N.assetItem.startOffset+N[R])}}else{const N=S==="bufferedPos"?l():t[S];_+=N-p.start}return _}return 0},a=(p,E)=>{if(p!==0&&E!=="primary"&&t.schedule.length){var T;const S=t.schedule.findItemIndexAtTime(p),R=(T=t.schedule.items)==null?void 0:T[S];if(R){const _=R[E].start-R.start;return p+_}}return p},l=()=>{const p=t.bufferedPos;return p===Number.MAX_VALUE?c("primary"):Math.max(p,0)},c=p=>{var E;return(E=t.primaryDetails)!=null&&E.live?t.primaryDetails.edge:t.schedule.durations[p]},f=(p,E)=>{var T,S;const R=t.effectivePlayingItem;if(R!=null&&(T=R.event)!=null&&T.restrictions.skip)return;t.log(`seek to ${p} "${E}"`);const _=t.effectivePlayingItem,D=t.schedule.findItemIndexAtTime(p,E),N=(S=t.schedule.items)==null?void 0:S[D],M=t.getBufferingPlayer(),G=M?.interstitial,$=G?.appendInPlace,q=_&&t.itemsMatch(_,N);if(_&&($||q)){const L=i(t.playingAsset),O=L?.media||t.primaryMedia;if(O){const C=E==="primary"?O.currentTime:n(_,E,t.playingAsset,"timelinePos","currentTime"),U=p-C,V=($?C:O.currentTime)+U;if(V>=0&&(!L||$||V<=L.duration)){O.currentTime=V;return}}}if(N){let L=p;if(E!=="primary"){const C=N[E].start,U=p-C;L=N.start+U}const O=!t.isInterstitial(N);if((!t.isInterstitial(_)||_.event.appendInPlace)&&(O||N.event.appendInPlace)){const C=t.media||($?M?.media:null);C&&(C.currentTime=L)}else if(_){const C=t.findItemIndex(_);if(D>C){const V=t.schedule.findJumpRestrictedIndex(C+1,D);if(V>C){t.setSchedulePosition(V);return}}let U=0;if(O)t.timelinePos=L,t.checkBuffer();else{var w;const V=N==null||(w=N.event)==null?void 0:w.assetList;if(V){const B=p-(N[E]||N).start;for(let pt=V.length;pt--;){const gt=V[pt];if(gt.duration&&B>=gt.startOffset&&B<gt.startOffset+gt.duration){U=pt;break}}}}t.setSchedulePosition(D,U)}}},h=()=>{const p=t.effectivePlayingItem;if(t.isInterstitial(p))return p;const E=e();return t.isInterstitial(E)?E:null},g={get currentTime(){const p=h(),E=t.effectivePlayingItem;return E&&E===p?n(E,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-E.playout.start:0},set currentTime(p){const E=h(),T=t.effectivePlayingItem;T&&T===E&&f(p+T.playout.start,"playout")},get duration(){const p=h();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const E=(p=h())==null?void 0:p.event.assetList;return E?E.map(T=>t.getAssetPlayer(T.identifier)):[]},get playingIndex(){var p;const E=(p=h())==null?void 0:p.event;return E&&t.effectivePlayingAsset?E.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return h()}};this.manager={get events(){var p,E;return((p=t.schedule)==null||(E=p.events)==null?void 0:E.slice(0))||[]},get schedule(){var p,E;return((p=t.schedule)==null||(E=p.items)==null?void 0:E.slice(0))||[]},get interstitialPlayer(){return h()?g:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const p=e();return t.findItemIndex(p)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){const p=t.effectivePlayingItem;return t.findItemIndex(p)},primary:{get bufferedEnd(){return l()},get currentTime(){const p=t.timelinePos;return p>0?p:0},set currentTime(p){f(p,"primary")},get duration(){return c("primary")},get seekableStart(){var p;return((p=t.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){f(p,"integrated")},get duration(){return c("integrated")},get seekableStart(){var p;return a(((p=t.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=t.effectivePlayingItem,E=p?.event;if(E&&!E.restrictions.skip){const T=t.findItemIndex(p);if(E.appendInPlace){const S=p.playout.start+p.event.duration;f(S+.001,"playout")}else t.advanceAfterAssetEnded(E,T,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,i=(t=this.schedule)==null?void 0:t.items;return!this.playbackStarted||!e||!i?!1:this.findItemIndex(e)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var t,e,i;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let a=this.media;!a&&(t=this.bufferingItem)!=null&&(e=t.event)!=null&&e.appendInPlace&&(a=this.primaryMedia);const l=(i=a)==null?void 0:i.currentTime;if(!(l===void 0||!vt(l)))return l}get primaryMedia(){var t;return this.media||((t=this.detachedData)==null?void 0:t.media)||null}isInterstitial(t){return!!(t!=null&&t.event)}retreiveMediaSource(t,e){const i=this.getAssetPlayer(t);i&&this.transferMediaFromPlayer(i,e)}transferMediaFromPlayer(t,e){const i=t.interstitial.appendInPlace,n=t.media;if(i&&n===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&n){this.detachedData={media:n};return}const a=t.transferMedia();this.log(`transfer MediaSource from ${t} ${Re(a)}`),this.detachedData=a}else e&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(t,e){var i,n;if(t.media===e)return;let a=null;const l=this.hls,c=t!==l,f=c&&t.interstitial.appendInPlace,h=(i=this.detachedData)==null?void 0:i.mediaSource;let g;if(l.media)f&&(a=l.transferMedia(),this.detachedData=a),g="Primary";else if(h){const T=this.getBufferingPlayer();T?(a=T.transferMedia(),g=`${T}`):g="detached MediaSource"}else g="detached media";if(!a){if(h)a=this.detachedData,this.log(`using detachedData: MediaSource ${Re(a)}`);else if(!this.detachedData||l.media===e){const T=this.playerQueue;T.length>1&&T.forEach(S=>{if(c&&S.interstitial.appendInPlace!==f){const R=S.interstitial;this.clearInterstitial(S.interstitial,null),R.appendInPlace=!1,R.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${R}`)}}),this.hls.detachMedia(),this.detachedData={media:e}}}const p=a&&"mediaSource"in a&&((n=a.mediaSource)==null?void 0:n.readyState)!=="closed",E=p&&a?a:e;if(this.log(`${p?"transfering MediaSource":"attaching media"} to ${c?t:"Primary"} from ${g}`),E===a){const T=c&&t.assetId===this.schedule.assetIdAtEnd;E.overrides={duration:this.schedule.duration,endOfStream:!c||T,cueRemoval:!c}}t.attachMedia(E)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=t.events;if(!e||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,n=this.effectivePlayingItem;if(i===-1){const a=this.hls.startPosition;if(this.timelinePos=a,e.length&&e[0].cue.pre){const l=t.findEventIndex(e[0].identifier);this.setSchedulePosition(l)}else if(a>=0||!this.primaryLive){const l=this.timelinePos=a>0?a:0,c=t.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(n&&!this.playingItem){const a=t.findItemIndex(n);this.setSchedulePosition(a)}}advanceAfterAssetEnded(t,e,i){const n=Wg(t,i);if(!t.isAssetPastPlayoutLimit(n))this.setSchedulePosition(e,n);else{const a=this.schedule.items;if(a){const l=e+1,c=a.length;if(l>=c){this.setSchedulePosition(-1);return}const f=t.resumeTime;this.timelinePos<f&&(this.timelinePos=f,this.checkBuffer()),this.setSchedulePosition(l)}}}setScheduleToAssetAtTime(t,e){const i=this.schedule,n=e.parentIdentifier,a=i.getEvent(n);if(a){const l=i.findEventIndex(n),c=i.findAssetIndex(a,t);this.advanceAfterAssetEnded(a,l,c-1)}}setSchedulePosition(t,e){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${t}, ${e}`);const n=t>=0?i[t]:null,a=this.playingItem,l=this.playingLastItem;if(this.isInterstitial(a)){var c;const h=a.event,g=this.playingAsset,p=g?.identifier,E=p?this.getAssetPlayer(p):null;if(E&&p&&(!this.eventItemsMatch(a,n)||e!==void 0&&p!==((c=h.assetList)==null?void 0:c[e].identifier))){var f;const T=h.findAssetIndex(g);this.log(`INTERSTITIAL_ASSET_ENDED ${T+1}/${h.assetList.length} ${xo(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(b.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:T,event:h,schedule:i.slice(0),scheduleIndex:t,player:E}),this.retreiveMediaSource(p,n),E.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&E.detachMedia()}if(!this.eventItemsMatch(a,n)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${pr(a)}`),h.hasPlayed=!0,this.hls.trigger(b.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:t}),h.cue.once)){this.updateSchedule();const T=this.schedule.items;if(n&&T){const S=this.schedule.findItemIndex(n);this.advanceSchedule(S,T,e,a,l)}return}}this.advanceSchedule(t,i,e,a,l)}advanceSchedule(t,e,i,n,a){const l=t>=0?e[t]:null,c=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach(h=>{const g=h.interstitial,p=this.schedule.findEventIndex(g.identifier);(p<t||p>t+1)&&this.clearInterstitial(g,l)}),this.isInterstitial(l)){this.timelinePos=Math.min(Math.max(this.timelinePos,l.start),l.end);const h=l.event;if(i===void 0){i=this.schedule.findAssetIndex(h,this.timelinePos);const T=Wg(h,i-1);if(h.isAssetPastPlayoutLimit(T)){this.advanceAfterAssetEnded(h,t,i);return}i=T}const g=this.waitingItem;this.assetsBuffered(l,c)||this.setBufferingItem(l);let p=this.preloadAssets(h,i);if(this.eventItemsMatch(l,g||n)||(this.waitingItem=l,this.log(`INTERSTITIAL_STARTED ${pr(l)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(b.INTERSTITIAL_STARTED,{event:h,schedule:e.slice(0),scheduleIndex:t})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=l;const E=h.assetList[i];if(!E){const T=e[t+1],S=this.media;T&&S&&!this.isInterstitial(T)&&S.currentTime<T.start&&(S.currentTime=this.timelinePos=T.start),this.advanceAfterAssetEnded(h,t,i||0);return}if(p||(p=this.getAssetPlayer(E.identifier)),p===null||p.destroyed){const T=h.assetList.length;this.warn(`asset ${i+1}/${T} player destroyed ${h}`),p=this.createAssetPlayer(h,E,i)}if(!this.eventItemsMatch(l,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(E))return;this.startAssetPlayer(p,i,e,t,c),this.shouldPlay&&RT(p.media)}else l!==null?(this.resumePrimary(l,t,n),this.shouldPlay&&RT(this.hls.media)):a&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var t,e;return(t=this.mediaSelection)==null||(e=t.main)==null?void 0:e.details}get primaryLive(){var t;return!!((t=this.primaryDetails)!=null&&t.live)}resumePrimary(t,e,i){var n;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log(`resuming ${pr(t)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let l=this.timelinePos;(l<t.start||l>=t.end)&&(l=this.getPrimaryResumption(t,e),this.timelinePos=l),this.attachPrimary(l,t)}if(!i)return;const a=this.schedule.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${pr(t)}`),this.hls.trigger(b.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const i=t.start;if(this.primaryLive){const n=this.primaryDetails;if(e===0)return this.hls.startPosition;if(n&&(i<n.fragmentStart||i>n.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);return e!=null&&e.hls?e.hls.bufferedToEnd:Pt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,i){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,n),i&&this.startLoadingPrimaryAt(t,i)),i||(this.timelinePos=t,this.startLoadingPrimaryAt(t,i))}startLoadingPrimaryAt(t,e){var i;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((i=n.mainForwardBufferInfo)==null?void 0:i.start)||n.media.currentTime)-t)>.5?n.startLoad(t,e):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(b.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(b.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(e.level===-1)return;const i=this.hls.levels[e.level],n=re(re({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const i=this.hls.audioTracks[e.id],n=this.mediaSelection;if(!n){this.altSelection=re(re({},this.altSelection),{},{audio:i});return}const a=re(re({},n),{},{audio:i});this.mediaSelection=a}onSubtitleTrackUpdated(t,e){const i=this.hls.subtitleTracks[e.id],n=this.mediaSelection;if(!n){this.altSelection=re(re({},this.altSelection),{},{subtitles:i});return}const a=re(re({},n),{},{subtitles:i});this.mediaSelection=a}onAudioTrackSwitching(t,e){const i=Nv(e);this.playerQueue.forEach(n=>n.hls.setAudioOption(e)||n.hls.setAudioOption(i))}onSubtitleTrackSwitch(t,e){const i=Nv(e);this.playerQueue.forEach(n=>n.hls.setSubtitleOption(e)||e.id!==-1&&n.hls.setSubtitleOption(i))}onBufferCodecs(t,e){const i=e.tracks;i&&(this.requiredTracks=i)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(t){const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let n=0;n<e.length;n++){const a=e[n];if(a.cue.post){var i;const l=this.schedule.findEventIndex(a.identifier),c=(i=this.schedule.items)==null?void 0:i[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const i=this.findItemIndex(e);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(t,e){const i=this.schedule.items;if(t&&i){const n=this.findItemIndex(t,e);return i[n]||null}return null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((a,l)=>{t.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(a.identifier,null)});const i=t.end+.25,n=Pt.bufferInfo(this.primaryMedia,i,0);(n.end>i||(n.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var i;return!!e&&(t===e||t.event.identifier===((i=e.event)==null?void 0:i.identifier))}findItemIndex(t,e){return t?this.schedule.findItemIndex(t,e):-1}updateSchedule(){const t=this.mediaSelection;t&&this.schedule.updateSchedule(t,[])}checkBuffer(t){const e=this.schedule.items;if(!e)return;const i=Pt.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=i.len<1),this.updateBufferedPos(i.end,e,t)}updateBufferedPos(t,e,i){const n=this.schedule,a=this.bufferingItem;if(this.bufferedPos>t)return;if(e.length===1&&this.itemsMatch(e[0],a)){this.bufferedPos=t;return}const l=this.playingItem,c=this.findItemIndex(l);let f=n.findItemIndexAtTime(t);if(this.bufferedPos<t){var h,g;const p=this.findItemIndex(a),E=Math.min(p+1,e.length-1),T=e[E];if((f===-1&&a&&t>=a.end||(h=T.event)!=null&&h.appendInPlace&&t+.01>=T.start)&&(f=E),E-c>1&&(a==null||(g=a.event)==null?void 0:g.appendInPlace)===!1)return;if(this.bufferedPos=t,f>p&&f>c)this.bufferedToItem(T);else{const S=this.primaryDetails;this.primaryLive&&S&&t>S.edge-S.targetduration&&T.start<S.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(T)&&this.preloadAssets(T.event,0)}}else i&&l&&!this.itemsMatch(l,a)&&(f===c?this.bufferedToItem(l):f===c+1&&this.bufferedToItem(e[f]))}assetsBuffered(t,e){return t.event.assetList.length===0?!1:!t.event.assetList.some(n=>{const a=this.getAssetPlayer(n.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,i=this.schedule;if(this.itemsMatch(t,e))this.bufferingItem!==t&&(this.bufferingItem=t);else{const{items:n,events:a}=i;if(!n||!a)return e;const l=this.isInterstitial(t),c=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const f=c?c.remaining:e?e.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${pr(t)}`+(e?` (${f.toFixed(2)} remaining)`:"")),this.playbackDisabled||(l?t.event.assetList.forEach(h=>{const g=this.getAssetPlayer(h.identifier);g&&g.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering()))),this.hls.trigger(b.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}return e}bufferedToItem(t,e=0){const i=this.setBufferingItem(t);if(!this.playbackDisabled){if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(i!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t):this.preloadPrimary(t)}}}preloadPrimary(t){const e=this.findItemIndex(t),i=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(i)}bufferedToEvent(t,e){const i=t.event,n=i.assetList.length===0&&!i.assetListLoader,a=i.cue.once;if(n||!a){const l=this.preloadAssets(i,e);if(l!=null&&l.interstitial.appendInPlace){const c=i.assetList[e],f=this.primaryMedia;c&&f&&this.bufferAssetPlayer(l,f)}}}preloadAssets(t,e){const i=t.assetUrl,n=t.assetList.length,a=n===0&&!t.assetListLoader,l=t.cue.once;if(a){const f=t.timelineStart;if(t.appendInPlace){var c;const E=this.playingItem;!this.isInterstitial(E)&&(E==null||(c=E.nextEvent)==null?void 0:c.identifier)===t.identifier&&this.flushFrontBuffer(f+.25)}let h,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(t.cue.pre||t.cue.post)){const E=g-f;E>0&&(h=Math.round(E*1e3)/1e3)}if(this.log(`Load interstitial asset ${e+1}/${i?1:n} ${t}${h?` live-start: ${g} start-offset: ${h}`:""}`),i)return this.createAsset(t,0,0,f,t.duration,i);const p=this.assetListLoader.loadAssetList(t,h);p&&(t.assetListLoader=p)}else if(!l&&n){for(let f=e;f<n;f++){const h=t.assetList[f],g=this.getAssetPlayerQueueIndex(h.identifier);(g===-1||this.playerQueue[g].destroyed)&&!h.error&&this.createAssetPlayer(t,h,f)}return this.getAssetPlayer(t.assetList[e].identifier)}return null}flushFrontBuffer(t){const e=this.requiredTracks;if(!e)return;this.log(`Removing front buffer starting at ${t}`),Object.keys(e).forEach(n=>{this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let i=0;i<e.length;i++)if(t===e[i].assetId)return i;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e){for(let i=0;i<t.length;i++)if(t[i].media===e)return t[i]}return null}createAsset(t,e,i,n,a,l){const c={parentIdentifier:t.identifier,identifier:ID(t,l,e),duration:a,startOffset:i,timelineStart:n,uri:l};return this.createAssetPlayer(t,c,e)}createAssetPlayer(t,e,i){const n=this.hls,a=n.userConfig;let l=a.videoPreference;const c=n.loadLevelObj||n.levels[n.currentLevel];(l||c)&&(l=he({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const f=n.audioTracks[n.audioTrack],h=n.subtitleTracks[n.subtitleTrack];let g=0;if(this.primaryLive||t.appendInPlace){const M=this.timelinePos-e.timelineStart;if(M>1){const G=e.duration;G&&M<G&&(g=M)}}const p=e.identifier,E=re(re({},a),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:f||a.audioPreference,subtitlePreference:h||a.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(E.timelineOffset=e.timelineStart));const T=E.cmcd;T!=null&&T.sessionId&&T.contentId&&(E.cmcd=he({},T,{contentId:gu(e.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${t} and asset ${p}`);const S=new CD(this.HlsPlayerClass,E,t,e);this.playerQueue.push(S),t.assetList[i]=e;const R=M=>{if(M.live){const q=new Error(`Interstitials MUST be VOD assets ${t}`),w={fatal:!0,type:bt.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:q};this.handleAssetItemError(w,t,this.schedule.findEventIndex(t.identifier),i,q.message);return}const G=M.edge-M.fragmentStart,$=e.duration;($===null||G>$)&&(this.log(`Interstitial asset "${p}" duration change ${$} > ${G}`),e.duration=G,this.updateSchedule())};S.on(b.LEVEL_UPDATED,(M,{details:G})=>R(G)),S.on(b.LEVEL_PTS_UPDATED,(M,{details:G})=>R(G));const _=(M,G)=>{const $=this.getAssetPlayer(p);if($&&G.tracks){$.off(b.BUFFER_CODECS,_),$.tracks=G.tracks;const q=this.primaryMedia;this.bufferingAsset===$.assetItem&&q&&!$.media&&this.bufferAssetPlayer($,q)}};S.on(b.BUFFER_CODECS,_);const D=()=>{var M;const G=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${G}`),!G)return;const $=this.schedule.findEventIndex(t.identifier),q=(M=this.schedule.items)==null?void 0:M[$];if(this.isInterstitial(q)){const L=t.findAssetIndex(e),O=Wg(t,L);if(!t.isAssetPastPlayoutLimit(O))this.bufferedToItem(q,O);else{var w;const C=(w=this.schedule.items)==null?void 0:w[$+1];C&&this.bufferedToItem(C)}}};S.on(b.BUFFERED_TO_END,D);const N=M=>()=>{if(!this.getAssetPlayer(p))return;this.shouldPlay=!0;const $=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,$,M)};return S.once(b.MEDIA_ENDED,N(i)),S.once(b.PLAYOUT_LIMIT_REACHED,N(1/0)),S.on(b.ERROR,(M,G)=>{const $=this.getAssetPlayer(p);if(G.details===W.BUFFER_STALLED_ERROR){if($!=null&&$.media){const q=$.currentTime,w=$.duration-q;q&&t.appendInPlace&&w/$.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${p} ${t} at ${$.media.currentTime}`),D()):(this.warn(`Stalled at ${q} of ${q+w} in asset ${p} ${t}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(G,t,this.schedule.findEventIndex(t.identifier),i,`Asset player error ${G.error} ${t}`)}),S.on(b.DESTROYING,()=>{if(!this.getAssetPlayer(p))return;const G=new Error(`Asset player destroyed unexpectedly ${p}`),$={fatal:!0,type:bt.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:G};this.handleAssetItemError($,t,this.schedule.findEventIndex(t.identifier),i,G.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${xo(e)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:i,event:t,player:S}),S}clearInterstitial(t,e){t.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,e)}),t.reset()}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(e!==-1){this.log(`reset asset player "${t}" after error`);const i=this.playerQueue[e];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(t,e){const i=this.getAssetPlayerQueueIndex(t);if(i!==-1){this.log(`clear asset player "${t}" toSegment: ${e&&pr(e)}`);const n=this.playerQueue[i];this.transferMediaFromPlayer(n,e),this.playerQueue.splice(i,1),n.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,i,n,a){const{interstitial:l,assetItem:c,assetId:f}=t,h=l.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!g||g.identifier!==f)&&(g&&(this.clearAssetPlayer(g.identifier,i[n]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${e+1}/${h} ${xo(c)}`),this.hls.trigger(b.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:e,event:l,schedule:i.slice(0),scheduleIndex:n,player:t})),this.bufferAssetPlayer(t,a)}bufferAssetPlayer(t,e){var i,n;const{interstitial:a,assetItem:l}=t,c=this.schedule.findEventIndex(a.identifier),f=(i=this.schedule.items)==null?void 0:i[c];if(!f)return;this.setBufferingItem(f),this.bufferingAsset=l;const h=this.getBufferingPlayer();if(h===t)return;const g=a.appendInPlace;if(g&&h?.interstitial.appendInPlace===!1)return;const p=h?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(g&&l!==this.playingAsset){if(!t.tracks)return;if(p&&!iA(p,t.tracks)){const E=new Error(`Asset ${xo(l)} SourceBuffer tracks ('${Object.keys(t.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),T={fatal:!0,type:bt.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:E},S=a.findAssetIndex(l);this.handleAssetItemError(T,a,c,S,E.message);return}}this.transferMediaTo(t,e)}handleAssetItemError(t,e,i,n,a){if(t.details===W.BUFFER_STALLED_ERROR)return;const l=e.assetList[n];this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&xo(l)} ${t.error}`);const c=l?.identifier,f=this.getAssetPlayerQueueIndex(c),h=this.playerQueue[f]||null,g=this.schedule.items,p=he({},t,{fatal:!1,errorAction:_u(!0),asset:l,assetListIndex:n,event:e,schedule:g,scheduleIndex:i,player:h});if(this.hls.trigger(b.INTERSTITIAL_ASSET_ERROR,p),!t.fatal)return;const E=this.playingAsset,T=new Error(a);if(l&&(this.clearAssetPlayer(c,null),l.error=T),!e.assetList.some(S=>!S.error))e.error=T;else if(e.appendInPlace){for(let S=n;S<e.assetList.length;S++)this.resetAssetPlayer(e.assetList[S].identifier);this.updateSchedule()}e.error?this.primaryFallback(e):E&&E.identifier===c&&this.advanceAfterAssetEnded(e,i,n)}primaryFallback(t){const e=t.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${t.identifier}" start: ${e} pos: ${this.timelinePos} playing: ${i?pr(i):"<none>"} error: ${t.error}`);let n=this.timelinePos;n===-1&&(n=this.hls.startPosition);const a=this.updateItem(i,n);this.itemsMatch(i,a)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e));const l=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(l)}else this.checkStart()}onAssetListLoaded(t,e){var i;const n=e.event,a=n.identifier,l=e.assetListResponse.ASSETS;if(!this.schedule.hasEvent(a))return;const c=n.timelineStart,f=n.duration;let h=0;l.forEach((S,R)=>{const _=parseFloat(S.DURATION);this.createAsset(n,R,h,c+h,_,S.URI),h+=_}),n.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${f}) ${n}`);const g=this.waitingItem,p=g?.event.identifier===a;this.updateSchedule();const E=(i=this.bufferingItem)==null?void 0:i.event;if(p){var T;const S=this.schedule.findEventIndex(a),R=(T=this.schedule.items)==null?void 0:T[S];if(R){if(!this.playingItem&&this.timelinePos>R.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){n.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${n}`),this.primaryFallback(n);return}this.setBufferingItem(R)}this.setSchedulePosition(S)}else if(E?.identifier===a&&E.appendInPlace){const S=n.assetList[0],R=this.getAssetPlayer(S.identifier),_=this.primaryMedia;S&&R&&_&&this.bufferAssetPlayer(R,_)}}onError(t,e){switch(e.details){case W.ASSET_LIST_PARSING_ERROR:case W.ASSET_LIST_LOAD_ERROR:case W.ASSET_LIST_LOAD_TIMEOUT:{const i=e.interstitial;i&&this.primaryFallback(i);break}case W.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const bT=500;class MD extends lp{constructor(t,e,i){super(t,e,i,"subtitle-stream-controller",Rt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state=lt.IDLE,this.setInterval(bT),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:n}=e;if(ai(i)&&(this.fragPrevious=i),this.state=lt.IDLE,!n)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let l;const c=i.start;for(let h=0;h<a.length;h++)if(c>=a[h].start&&c<=a[h].end){l=a[h];break}const f=i.start+i.duration;l?l.end=f:(l={start:c,end:f},a.push(l)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:i,endOffset:n}=e;if(i===0&&n!==Number.POSITIVE_INFINITY){const a=n-1;if(a<=0)return;e.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=a){l.shift();continue}else if(l[c].start<a)l[c].start=a;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,a,Rt.SUBTITLE)}}onError(t,e){const i=e.frag;i?.type===Rt.SUBTITLE&&(e.details===W.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==lt.STOPPED&&(this.state=lt.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(this.levels&&e_(this.levels,e)){this.levels=e.map(i=>new Au(i));return}this.tracksBuffered=[],this.levels=e.map(i=>{const n=new Au(i);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Rt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){var i;if(this.currentTrackId=e.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==lt.STOPPED&&this.setInterval(bT)}onSubtitleTrackLoaded(t,e){var i;const{currentTrackId:n,levels:a}=this,{details:l,id:c}=e;if(!a){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const f=a[c];if(c>=a.length||!f)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(l.live||(i=f.details)!=null&&i.live){const p=this.mainDetails;if(l.deltaUpdateFailed||!p)return;const E=p.fragments[0];if(!f.details)l.hasProgramDateTime&&p.hasProgramDateTime?(Jh(l,p),h=l.fragmentStart):E&&(h=E.start,Sm(l,h));else{var g;h=this.alignPlaylists(l,f.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&E&&(h=E.start,Sm(l,h))}}f.details=l,this.levelLastLoaded=f,c===n&&(this.hls.trigger(b.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:e.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===lt.IDLE&&(Sa(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,n=e.decryptdata,a=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&n!=null&&n.key&&n.iv&&Oo(n.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer,ap(n.method)).catch(c=>{throw a.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:e}),c}).then(c=>{const f=performance.now();a.trigger(b.FRAG_DECRYPTED,{frag:e,payload:c,stats:{tstart:l,tdecrypt:f}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=lt.IDLE})}}doTick(){if(!this.media){this.state=lt.IDLE;return}if(this.state===lt.IDLE){const{currentTrackId:t,levels:e}=this,i=e?.[t];if(!i||!e.length||!i.details||this.waitForLive(i))return;const{config:n}=this,a=this.getLoadPosition(),l=Pt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,n.maxBufferHole),{end:c,len:f}=l,h=i.details,g=this.hls.maxBufferLength+h.levelTargetDuration;if(f>g)return;const p=h.fragments,E=p.length,T=h.edge;let S=null;const R=this.fragPrevious;if(c<T){const N=n.maxFragLookUpTolerance,M=c>T-N?0:N;S=Sa(R,p,Math.max(p[0].start,c),M),!S&&R&&R.start<p[0].start&&(S=p[0])}else S=p[E-1];if(S=this.filterReplacedPrimary(S,i.details),!S)return;const _=S.sn-h.startSN,D=p[_-1];if(D&&D.cc===S.cc&&this.fragmentTracker.getState(D)===Qe.NOT_LOADED&&(S=D),this.fragmentTracker.getState(S)===Qe.NOT_LOADED){const N=this.mapToInitFragWhenRequired(S);N&&this.loadFragment(N,i,c)}}}loadFragment(t,e,i){ai(t)?super.loadFragment(t,e,i):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new kD(this.tracksBuffered[this.currentTrackId]||[])}}class kD{constructor(t){this.buffered=void 0;const e=(i,n,a)=>{if(n=n>>>0,n>a-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${a})`);return t[n][i]};this.buffered={get length(){return t.length},end(i){return e("end",i,t.length)},start(i){return e("start",i,t.length)}}}}const ND={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},f_=r=>String.fromCharCode(ND[r]||r),Rn=15,Ps=100,FD={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},UD={17:2,18:4,21:6,22:8,23:10,19:13,20:15},BD={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},VD={25:2,26:4,29:6,30:8,31:10,27:13,28:15},GD=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class $D{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i=typeof e=="function"?e():e;ie.log(`${this.time} [${t}] ${i}`)}}}const ga=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].toString(16));return e};class d_{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const n=e[i];t.hasOwnProperty(n)&&(this[n]=t[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class HD{constructor(){this.uchar=" ",this.penState=new d_}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class KD{constructor(t){this.chars=[],this.pos=0,this.currPenState=new d_,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<Ps;e++)this.chars.push(new HD);this.logger=t}equals(t){for(let e=0;e<Ps;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<Ps;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Ps;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ps&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ps)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=f_(t);if(this.pos>=Ps){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<Ps;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<Ps;i++){const n=this.chars[i].uchar;n!==" "&&(e=!1),t.push(n)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class Zg{constructor(t){this.rows=[],this.currRow=Rn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<Rn;e++)this.rows.push(new KD(t));this.logger=t}reset(){for(let t=0;t<Rn;t++)this.rows[t].clear();this.currRow=Rn-1}equals(t){let e=!0;for(let i=0;i<Rn;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<Rn;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<Rn;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+Re(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let c=0;c<Rn;c++)this.rows[c].clear();const a=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[a].cueStartTime,f=this.logger.time;if(c!==null&&f!==null&&c<f)for(let h=0;h<this.nrRollUpRows;h++)this.rows[e-this.nrRollUpRows+h+1].copy(l.rows[a+h])}}this.currRow=e;const i=this.rows[this.currRow];if(t.indent!==null){const a=t.indent,l=Math.max(a-1,0);i.setCursor(t.indent),t.color=i.chars[l].penState.foreground}const n={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+Re(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",n=-1;for(let a=0;a<Rn;a++){const l=this.rows[a].getTextString();l&&(n=a+1,t?e.push("Row "+n+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(t?i="["+e.join(" | ")+"]":i=e.join(`
`)),i}getTextAndFormat(){return this.rows}}class xT{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Zg(i),this.nonDisplayedMemory=new Zg(i),this.lastOutputScreen=new Zg(i),this.currRollUpRow=this.displayedMemory.rows[Rn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Rn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=n[i]}this.logger.log(2,"MIDROW: "+Re(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class IT{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=qD(),this.logger=void 0;const n=this.logger=new $D;this.channels=[null,new xT(t,e,n),new xT(t+1,i,n)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let i=0;i<e.length;i+=2){const n=e[i]&127,a=e[i+1]&127;let l=!1,c=null;if(n===0&&a===0)continue;this.logger.log(3,()=>"["+ga([e[i],e[i+1]])+"] -> ("+ga([n,a])+")");const f=this.cmdHistory;if(n>=16&&n<=31){if(zD(n,a,f)){Ah(null,null,f),this.logger.log(3,()=>"Repeated command ("+ga([n,a])+") is dropped");continue}Ah(n,a,this.cmdHistory),l=this.parseCmd(n,a),l||(l=this.parseMidrow(n,a)),l||(l=this.parsePAC(n,a)),l||(l=this.parseBackgroundAttributes(n,a))}else Ah(null,null,f);if(!l&&(c=this.parseChars(n,a),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ga([n,a])+" orig: "+ga([e[i],e[i+1]]))}}parseCmd(t,e){const i=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,n=(t===23||t===31)&&e>=33&&e<=35;if(!(i||n))return!1;const a=t===20||t===21||t===23?1:2,l=this.channels[a];return t===20||t===21||t===28||t===29?e===32?l.ccRCL():e===33?l.ccBS():e===34?l.ccAOF():e===35?l.ccAON():e===36?l.ccDER():e===37?l.ccRU(2):e===38?l.ccRU(3):e===39?l.ccRU(4):e===40?l.ccFON():e===41?l.ccRDC():e===42?l.ccTR():e===43?l.ccRTD():e===44?l.ccEDM():e===45?l.ccCR():e===46?l.ccENM():e===47&&l.ccEOC():l.ccTO(e-32),this.currentChannel=a,!0}parseMidrow(t,e){let i=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[i];return n?(n.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+ga([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let i;const n=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,a=(t===16||t===24)&&e>=64&&e<=95;if(!(n||a))return!1;const l=t<=23?1:2;e>=64&&e<=95?i=l===1?FD[t]:BD[t]:i=l===1?UD[t]:VD[t];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(i,e)),this.currentChannel=l,!0):!1}interpretPAC(t,e){let i;const n={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?i=e-96:i=e-64,n.underline=(i&1)===1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((i-16)/2)*4,n}parseChars(t,e){let i,n=null,a=null;if(t>=25?(i=2,a=t-8):(i=1,a=t),a>=17&&a<=19){let l;a===17?l=e+80:a===18?l=e+112:l=e+144,this.logger.log(2,()=>"Special char '"+f_(l)+"' in channel "+i),n=[l]}else t>=32&&t<=127&&(n=e===0?[t]:[t,e]);return n&&this.logger.log(3,()=>"Char codes =  "+ga(n).join(",")),n}parseBackgroundAttributes(t,e){const i=(t===16||t===24)&&e>=32&&e<=47,n=(t===23||t===31)&&e>=45&&e<=47;if(!(i||n))return!1;let a;const l={};t===16||t===24?(a=Math.floor((e-32)/2),l.background=GD[a],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));const c=t<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}Ah(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function Ah(r,t,e){e.a=r,e.b=t}function zD(r,t,e){return e.a===r&&e.b===t}function qD(){return{a:null,b:null}}var vp=function(){if(Zh!=null&&Zh.VTTCue)return self.VTTCue;const r=["","lr","rl"],t=["start","middle","end","left","right"];function e(c,f){if(typeof f!="string"||!Array.isArray(c))return!1;const h=f.toLowerCase();return~c.indexOf(h)?h:!1}function i(c){return e(r,c)}function n(c){return e(t,c)}function a(c,...f){let h=1;for(;h<arguments.length;h++){const g=arguments[h];for(const p in g)c[p]=g[p]}return c}function l(c,f,h){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let E="",T=!1,S=c,R=f,_=h,D=null,N="",M=!0,G="auto",$="start",q=50,w="middle",L=50,O="middle";Object.defineProperty(g,"id",a({},p,{get:function(){return E},set:function(C){E=""+C}})),Object.defineProperty(g,"pauseOnExit",a({},p,{get:function(){return T},set:function(C){T=!!C}})),Object.defineProperty(g,"startTime",a({},p,{get:function(){return S},set:function(C){if(typeof C!="number")throw new TypeError("Start time must be set to a number.");S=C,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",a({},p,{get:function(){return R},set:function(C){if(typeof C!="number")throw new TypeError("End time must be set to a number.");R=C,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",a({},p,{get:function(){return _},set:function(C){_=""+C,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",a({},p,{get:function(){return D},set:function(C){D=C,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",a({},p,{get:function(){return N},set:function(C){const U=i(C);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");N=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",a({},p,{get:function(){return M},set:function(C){M=!!C,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",a({},p,{get:function(){return G},set:function(C){if(typeof C!="number"&&C!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");G=C,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",a({},p,{get:function(){return $},set:function(C){const U=n(C);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");$=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",a({},p,{get:function(){return q},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");q=C,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",a({},p,{get:function(){return w},set:function(C){const U=n(C);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");w=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",a({},p,{get:function(){return L},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");L=C,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",a({},p,{get:function(){return O},set:function(C){const U=n(C);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");O=U,this.hasBeenReset=!0}})),g.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l}();class jD{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function g_(r){function t(i,n,a,l){return(i|0)*3600+(n|0)*60+(a|0)+parseFloat(l||0)}const e=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class YD{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let n=0;n<i.length;++n)if(e===i[n]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function m_(r,t,e,i){const n=i?r.split(i):[r];for(const a in n){if(typeof n[a]!="string")continue;const l=n[a].split(e);if(l.length!==2)continue;const c=l[0],f=l[1];t(c,f)}}const Lm=new vp(0,0,""),_h=Lm.align==="middle"?"middle":"center";function QD(r,t,e){const i=r;function n(){const c=g_(r);if(c===null)throw new Error("Malformed timestamp: "+i);return r=r.replace(/^[^\sa-zA-Z-]+/,""),c}function a(c,f){const h=new YD;m_(c,function(E,T){let S;switch(E){case"region":for(let R=e.length-1;R>=0;R--)if(e[R].id===T){h.set(E,e[R].region);break}break;case"vertical":h.alt(E,T,["rl","lr"]);break;case"line":S=T.split(","),h.integer(E,S[0]),h.percent(E,S[0])&&h.set("snapToLines",!1),h.alt(E,S[0],["auto"]),S.length===2&&h.alt("lineAlign",S[1],["start",_h,"end"]);break;case"position":S=T.split(","),h.percent(E,S[0]),S.length===2&&h.alt("positionAlign",S[1],["start",_h,"end","line-left","line-right","auto"]);break;case"size":h.percent(E,T);break;case"align":h.alt(E,T,["start",_h,"end","left","right"]);break}},/:/,/\s/),f.region=h.get("region",null),f.vertical=h.get("vertical","");let g=h.get("line","auto");g==="auto"&&Lm.line===-1&&(g=-1),f.line=g,f.lineAlign=h.get("lineAlign","start"),f.snapToLines=h.get("snapToLines",!0),f.size=h.get("size",100),f.align=h.get("align",_h);let p=h.get("position","auto");p==="auto"&&Lm.position===50&&(p=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=p}function l(){r=r.replace(/^\s+/,"")}if(l(),t.startTime=n(),l(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);r=r.slice(3),l(),t.endTime=n(),l(),a(r,t)}function p_(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class XD{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new jD,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){let a=e.buffer,l=0;for(a=p_(a);l<a.length&&a[l]!=="\r"&&a[l]!==`
`;)++l;const c=a.slice(0,l);return a[l]==="\r"&&++l,a[l]===`
`&&++l,e.buffer=a.slice(l),c}function n(a){m_(a,function(l,c){},/:/)}try{let a="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=i();const c=a.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let l=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:a=i(),e.state){case"HEADER":/:/.test(a)?n(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;if(e.cue=new vp(0,0,""),e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{QD(a,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const c=a.indexOf("-->")!==-1;if(!a||c&&(l=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a}continue;case"BADCUE":a||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const WD=/\r\n|\n\r|\n|\r/g,Jg=function(t,e,i=0){return t.slice(i,i+e.length)===e},ZD=function(t){let e=parseInt(t.slice(-3));const i=parseInt(t.slice(-6,-4)),n=parseInt(t.slice(-9,-7)),a=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!vt(e)||!vt(i)||!vt(n)||!vt(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*i,e+=60*1e3*n,e+=60*60*1e3*a,e};function Tp(r,t,e){return gu(r.toString())+gu(t.toString())+gu(e)}const JD=function(t,e,i){let n=t[e],a=t[n.prevCC];if(!a||!a.new&&n.new){t.ccOffset=t.presentationOffset=n.start,n.new=!1;return}for(;(l=a)!=null&&l.new;){var l;t.ccOffset+=n.start-a.start,n.new=!1,n=a,a=t[n.prevCC]}t.presentationOffset=i};function tC(r,t,e,i,n,a,l){const c=new XD,f=qi(new Uint8Array(r)).trim().replace(WD,`
`).split(`
`),h=[],g=t?mL(t.baseTime,t.timescale):0;let p="00:00.000",E=0,T=0,S,R=!0;c.oncue=function(_){const D=e[i];let N=e.ccOffset;const M=(E-g)/9e4;if(D!=null&&D.new&&(T!==void 0?N=e.ccOffset=D.start:JD(e,i,M)),M){if(!t){S=new Error("Missing initPTS for VTT MPEGTS");return}N=M-e.presentationOffset}const G=_.endTime-_.startTime,$=on((_.startTime+N-T)*9e4,n*9e4)/9e4;_.startTime=Math.max($,0),_.endTime=Math.max($+G,0);const q=_.text.trim();_.text=decodeURIComponent(encodeURIComponent(q)),_.id||(_.id=Tp(_.startTime,_.endTime,q)),_.endTime>0&&h.push(_)},c.onparsingerror=function(_){S=_},c.onflush=function(){if(S){l(S);return}a(h)},f.forEach(_=>{if(R)if(Jg(_,"X-TIMESTAMP-MAP=")){R=!1,_.slice(16).split(",").forEach(D=>{Jg(D,"LOCAL:")?p=D.slice(6):Jg(D,"MPEGTS:")&&(E=parseInt(D.slice(7)))});try{T=ZD(p)/1e3}catch(D){S=D}return}else _===""&&(R=!1);c.parse(_+`
`)}),c.flush()}const tm="stpp.ttml.im1t",y_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,E_=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,eC={left:"start",center:"center",right:"end",start:"start",end:"end"};function LT(r,t,e,i){const n=Ft(new Uint8Array(r),["mdat"]);if(n.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const a=n.map(c=>qi(c)),l=gL(t.baseTime,1,t.timescale);try{a.forEach(c=>e(iC(c,l)))}catch(c){i(c)}}function iC(r,t){const n=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(a).reduce((p,E)=>(p[E]=n.getAttribute(`ttp:${E}`)||a[E],p),{}),c=n.getAttribute("xml:space")!=="preserve",f=DT(em(n,"styling","style")),h=DT(em(n,"layout","region")),g=em(n,"body","[begin]");return[].map.call(g,p=>{const E=v_(p,c);if(!E||!p.hasAttribute("begin"))return null;const T=nm(p.getAttribute("begin"),l),S=nm(p.getAttribute("dur"),l);let R=nm(p.getAttribute("end"),l);if(T===null)throw CT(p);if(R===null){if(S===null)throw CT(p);R=T+S}const _=new vp(T-t,R-t,E);_.id=Tp(_.startTime,_.endTime,_.text);const D=h[p.getAttribute("region")],N=f[p.getAttribute("style")],M=nC(D,N,f),{textAlign:G}=M;if(G){const $=eC[G];$&&(_.lineAlign=$),_.align=G}return he(_,M),_}).filter(p=>p!==null)}function em(r,t,e){const i=r.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function DT(r){return r.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function v_(r,t){return[].slice.call(r.childNodes).reduce((e,i,n)=>{var a;return i.nodeName==="br"&&n?e+`
`:(a=i.childNodes)!=null&&a.length?v_(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function nC(r,t,e){const i="http://www.w3.org/ns/ttml#styling";let n=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return l&&e.hasOwnProperty(l)&&(n=e[l]),a.reduce((c,f)=>{const h=im(t,i,f)||im(r,i,f)||im(n,i,f);return h&&(c[f]=h),c},{})}function im(r,t,e){return r&&r.hasAttributeNS(t,e)?r.getAttributeNS(t,e):null}function CT(r){return new Error(`Could not parse ttml timestamp ${r}`)}function nm(r,t){if(!r)return null;let e=g_(r);return e===null&&(y_.test(r)?e=sC(r,t):E_.test(r)&&(e=rC(r,t))),e}function sC(r,t){const e=y_.exec(r),i=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+i/t.frameRate}function rC(r,t){const e=E_.exec(r),i=Number(e[1]);switch(e[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Rh{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class aC{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=OT(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(b.FRAG_LOADING,this.onFragLoading,this),t.on(b.FRAG_LOADED,this.onFragLoaded,this),t.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(b.FRAG_LOADING,this.onFragLoading,this),t.off(b.FRAG_LOADED,this.onFragLoaded,this),t.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new Rh(this,"textTrack1"),e=new Rh(this,"textTrack2"),i=new Rh(this,"textTrack3"),n=new Rh(this,"textTrack4");this.cea608Parser1=new IT(1,t,e),this.cea608Parser2=new IT(3,i,n)}addCues(t,e,i,n,a){let l=!1;for(let c=a.length;c--;){const f=a[c],h=oC(f[0],f[1],e,i);if(h>=0&&(f[0]=Math.min(f[0],e),f[1]=Math.max(f[1],i),l=!0,h/(i-e)>.5))return}if(l||a.push([e,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[t];this.Cues.newCue(c,e,i,n)}else{const c=this.Cues.newCue(null,e,i,n);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:c,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:n,timescale:a}){const{unparsedVttFrags:l}=this;i===Rt.MAIN&&(this.initPTS[e.cc]={baseTime:n,timescale:a}),l.length&&(this.unparsedVttFrags=[],l.forEach(c=>{this.onFragLoaded(b.FRAG_LOADED,c)}))}getExistingTrack(t,e){const{media:i}=this;if(i)for(let n=0;n<i.textTracks.length;n++){const a=i.textTracks[n];if(wT(a,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:n}=this,{label:a,languageCode:l}=e[t],c=this.getExistingTrack(a,l);if(c)i[t]=c,wo(i[t]),u_(i[t],n);else{const f=this.createTextTrack("captions",a,l);f&&(f[t]=!0,i[t]=f)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const i=e.label,n={_id:t,label:i,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(t,e,i){const n=this.media;if(n)return n.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const i=!!e.transferMedia;if(this.media=null,i)return;const{captionsTracks:n}=this;Object.keys(n).forEach(a=>{wo(n[a]),delete n[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=OT(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)wo(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],n=i.some(a=>a.textCodec===tm);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(e_(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const l=this.media,c=l?Fh(l.textTracks):null;if(this.tracks.forEach((f,h)=>{let g;if(c){let p=null;for(let E=0;E<c.length;E++)if(c[E]&&wT(c[E],f)){p=c[E],c[E]=null;break}p&&(g=p)}if(g)wo(g);else{const p=T_(f);g=this.createTextTrack(p,f.name,f.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const f=c.filter(h=>h!==null).map(h=>h.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const n=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!n)return;const a=`textTrack${n[1]}`,l=this.captionsProperties[a];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e?.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===Rt.MAIN){var i,n;const{cea608Parser1:a,cea608Parser2:l,lastSn:c}=this,{cc:f,sn:h}=e.frag,g=(i=(n=e.part)==null?void 0:n.index)!=null?i:-1;a&&l&&(h!==c+1||h===c&&g!==this.lastPartIndex+1||f!==this.lastCc)&&(a.reset(),l.reset()),this.lastCc=f,this.lastSn=h,this.lastPartIndex=g}}onFragLoaded(t,e){const{frag:i,payload:n}=e;if(i.type===Rt.SUBTITLE)if(n.byteLength){const a=i.decryptdata,l="stats"in e;if(a==null||!a.encrypted||l){const c=this.tracks[i.level],f=this.vttCCs;f[i.cc]||(f[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===tm?this._parseIMSC1(i,n):this._parseVTTs(e)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;LT(e,this.initPTS[t.cc],n=>{this._appendCues(n,t.level),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},n=>{i.logger.log(`Failed to parse IMSC1: ${n}`),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})})}_parseVTTs(t){var e;const{frag:i,payload:n}=t,{initPTS:a,unparsedVttFrags:l}=this,c=a.length-1;if(!a[i.cc]&&c===-1){l.push(t);return}const f=this.hls,h=(e=i.initSegment)!=null&&e.data?fn(i.initSegment.data,new Uint8Array(n)).buffer:n;tC(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,g=>{this._appendCues(g,i.level),f.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?l.push(t):this._fallbackToIMSC1(i,n),f.logger.log(`Failed to parse VTT cue: ${g}`),!(p&&c>i.cc)&&f.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:g})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||LT(e,this.initPTS[t.cc],()=>{i.textCodec=tm,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[e];if(!n||n.mode==="disabled")return;t.forEach(a=>c_(n,a))}else{const n=this.tracks[e];if(!n)return;const a=n.default?"default":"subtitles"+e;i.trigger(b.CUES_PARSED,{type:"subtitles",cues:t,track:a})}}onFragDecrypted(t,e){const{frag:i}=e;i.type===Rt.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:n}=e;if(!(i.type===Rt.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let a=0;a<n.length;a++){const l=n[a].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(n[a].pts,c[0]),this.cea608Parser2.addData(n[a].pts,c[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:n,type:a}){const{media:l}=this;if(!(!l||l.currentTime<i)){if(!a||a==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(f=>Im(c[f],e,i))}if(this.config.renderTextTracksNatively&&e===0&&n!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(f=>Im(c[f],e,n))}}}extractCea608Data(t){const e=[[],[]],i=t[0]&31;let n=2;for(let a=0;a<i;a++){const l=t[n++],c=127&t[n++],f=127&t[n++];if(c===0&&f===0)continue;if((4&l)!==0){const g=3&l;(g===0||g===1)&&(e[g].push(c),e[g].push(f))}}return e}}function T_(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function wT(r,t){return!!r&&r.kind===T_(t)&&Rm(t,r)}function oC(r,t,e,i){return Math.min(t,i)-Math.max(r,e)}function OT(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const lC=/\s/,uC={newCue(r,t,e,i){const n=[];let a,l,c,f,h;const g=self.VTTCue||self.TextTrackCue;for(let E=0;E<i.rows.length;E++)if(a=i.rows[E],c=!0,f=0,h="",!a.isEmpty()){var p;for(let R=0;R<a.chars.length;R++)lC.test(a.chars[R].uchar)&&c?f++:(h+=a.chars[R].uchar,c=!1);a.cueStartTime=t,t===e&&(e+=1e-4),f>=16?f--:f++;const T=p_(h.trim()),S=Tp(t,e,T);r!=null&&(p=r.cues)!=null&&p.getCueById(S)||(l=new g(t,e,T),l.id=S,l.line=E+1,l.align="left",l.position=10+Math.min(80,Math.floor(f*8/32)*10),n.push(l))}return r&&n.length&&(n.sort((E,T)=>E.line==="auto"||T.line==="auto"?0:E.line>8&&T.line>8?T.line-E.line:E.line-T.line),n.forEach(E=>c_(r,E))),n}};function cC(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const hC=/(\d+)-(\d+)\/(\d+)/;class PT{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||mC,this.controller=new self.AbortController,this.stats=new ep}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const a=fC(t,this.controller.signal),l=t.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:h}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,a),self.clearTimeout(this.requestTimeout),e.timeout=f&&vt(f)?f:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,t,this.response))},e.timeout),(Iu(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var E;this.response=this.loader=p;const T=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,t,this.response))},h-(T-n.loading.start)),!p.ok){const{status:R,statusText:_}=p;throw new pC(_||"fetch, bad network response",R,p)}n.loading.first=T,n.total=gC(p.headers)||n.total;const S=(E=this.callbacks)==null?void 0:E.onProgress;return S&&vt(e.highWaterMark)?this.loadProgressively(p,n,t,e.highWaterMark,S):l?p.arrayBuffer():t.responseType==="json"?p.json():p.text()}).then(p=>{var E,T;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const R=p[c];R&&(n.loaded=n.total=R);const _={url:S.url,data:p,code:S.status},D=(E=this.callbacks)==null?void 0:E.onProgress;D&&!vt(e.highWaterMark)&&D(n,t,p,S),(T=this.callbacks)==null||T.onSuccess(_,n,t,S)}).catch(p=>{var E;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const T=p&&p.code||0,S=p?p.message:null;(E=this.callbacks)==null||E.onError({code:T,text:S},t,p?p.details:null,n)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,n=0,a){const l=new kA,c=t.body.getReader(),f=()=>c.read().then(h=>{if(h.done)return l.dataLength&&a(e,i,l.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const g=h.value,p=g.length;return e.loaded+=p,p<n||l.dataLength?(l.push(g),l.dataLength>=n&&a(e,i,l.flush().buffer,t)):a(e,i,g.buffer,t),f()}).catch(()=>Promise.reject());return f()}}function fC(r,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(he({},r.headers))};return r.rangeEnd&&e.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),e}function dC(r){const t=hC.exec(r);if(t)return parseInt(t[2])-parseInt(t[1])+1}function gC(r){const t=r.get("Content-Range");if(t){const i=dC(t);if(vt(i))return i}const e=r.get("Content-Length");if(e)return parseInt(e)}function mC(r,t){return new self.Request(r.url,t)}class pC extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const yC=/^age:\s*[\d.]+\s*$/im;class S_{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new ep,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return a(i,e.url)}).catch(l=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",e.url,!0),a(i,e.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:l.message},e,i,n)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const n=e.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:l}=i.loadPolicy;if(n)for(const c in n)t.setRequestHeader(c,n[c]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&vt(a)?a:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const n=e.readyState,a=this.config;if(!i.aborted&&n>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const h=e.status,g=e.responseType==="text"?e.responseText:null;if(h>=200&&h<300){const S=g??e.response;if(S!=null){var l,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const R=e.responseType==="arraybuffer"?S.byteLength:S.length;i.loaded=i.total=R,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const _=(l=this.callbacks)==null?void 0:l.onProgress;_&&_(i,t,S,e);const D={url:e.responseURL,data:S,code:h};(c=this.callbacks)==null||c.onSuccess(D,i,t,e);return}}const p=a.loadPolicy.errorRetry,E=i.retry,T={url:t.url,data:void 0,code:h};if(Wh(p,E,!1,T))this.retry(p);else{var f;ie.error(`${h} while loading ${t.url}`),(f=this.callbacks)==null||f.onError({code:h,text:e.statusText},t,e,i)}}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(Wh(t,e,!0))this.retry(t);else{var i;ie.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=np(t,i.retry),i.retry++,ie.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e?.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&yC.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const EC={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},vC=re(re({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:S_,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:$I,bufferController:CL,capLevelController:yp,errorController:jI,fpsController:AD,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:RA,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:EC},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},TC()),{},{subtitleStreamController:MD,subtitleTrackController:bD,timelineController:aC,audioStreamController:xL,audioTrackController:IL,emeController:Po,cmcdController:vD,contentSteeringController:SD,interstitialsController:PD});function TC(){return{cueHandler:uC,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function SC(r,t,e){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Dm(r),n=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,f=t[c]===void 0,h=[];a.forEach(g=>{const p=`${l}Loading${g}`,E=t[p];if(E!==void 0&&f){h.push(p);const T=i[c].default;switch(t[c]={default:T},g){case"TimeOut":T.maxLoadTimeMs=E,T.maxTimeToFirstByteMs=E;break;case"MaxRetry":T.errorRetry.maxNumRetry=E,T.timeoutRetry.maxNumRetry=E;break;case"RetryDelay":T.errorRetry.retryDelayMs=E,T.timeoutRetry.retryDelayMs=E;break;case"MaxRetryTimeout":T.errorRetry.maxRetryDelayMs=E,T.timeoutRetry.maxRetryDelayMs=E;break}}}),h.length&&e.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${c}": ${Re(t[c])}`)}),re(re({},i),t)}function Dm(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Dm):Object.keys(r).reduce((t,e)=>(t[e]=Dm(r[e]),t),{}):r}function AC(r,t){const e=r.loader;e!==PT&&e!==S_?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):cC()&&(r.loader=PT,r.progressive=!0,r.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Uh=2,_C=.1,RC=.05,bC=100;class xC extends SA{constructor(t,e){super("gap-controller",t.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1})}},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(bC),this.mediaSource=e.mediaSource;const i=this.media=e.media;zi(i,"playing",this.onMediaPlaying),zi(i,"waiting",this.onMediaWaiting),zi(i,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:i}=this;i&&(hn(i,"playing",this.onMediaPlaying),hn(i,"waiting",this.onMediaWaiting),hn(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(!((t=this.media)!=null&&t.readyState)||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var i,n;const a=(i=this.hls)==null?void 0:i.config;if(!a)return;const l=this.media;if(!l)return;const{seeking:c}=l,f=this.seeking&&!c,h=!this.seeking&&c,g=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,t!==e){e&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!g&&t>e&&this.nudgeOnVideoHole(t,e)),this.waiting===0&&this.stallResolved(t);return}if(h||f){f&&this.stallResolved(t);return}if(g){this.nudgeRetry=0,this.stallResolved(t),!this.ended&&l.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1}));return}if(!Pt.getBuffered(l).length){this.nudgeRetry=0;return}const p=Pt.bufferInfo(l,t,0),E=p.nextStart||0,T=this.fragmentTracker;if(c&&T&&this.hls){const q=MT(this.hls.inFlightFragments,t),w=p.len>Uh,L=!E||q||E-t>Uh&&!T.getPartialFragment(t);if(w||L)return;this.moved=!1}const S=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&T){if(!(p.len>0)&&!E)return;const w=Math.max(E,p.start||0)-t,O=!!(S!=null&&S.live)?S.targetduration*2:Uh,C=T.getPartialFragment(t);if(w>0&&(w<=O||C)){l.paused||this._trySkipBufferHole(C);return}}const R=a.detectStallWithCurrentTimeMs,_=self.performance.now(),D=this.waiting;let N=this.stalled;if(N===null)if(D>0&&_-D<R)N=this.stalled=D;else{this.stalled=_;return}const M=_-N;if(!c&&(M>=R||D)&&this.hls){var G;if(((G=this.mediaSource)==null?void 0:G.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(t-(S?.edge||0))<1){if(this.ended)return;this.ended=t||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const $=Pt.bufferInfo(l,t,a.maxBufferHole);this._tryFixBufferStall($,M,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-e;this.log(`playback not stuck anymore @${t}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(b.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var i;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&n&&n.length>1&&t>n.end(0)){const a=Pt.bufferedInfo(Pt.timeRangesToArray(this.buffered.audio),t,0);if(a.len>1&&e>=a.start){const l=Pt.timeRangesToArray(n),c=Pt.bufferedInfo(l,e,0).bufferedIndex;if(c>-1&&c<l.length-1){const f=Pt.bufferedInfo(l,t,0).bufferedIndex,h=l[c].end,g=l[c+1].start;if((f===-1||f>c)&&g-h<1&&t-h<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${t} hole: ${h} -> ${g} buffered index: ${f}`);this.warn(p.message),this.media.currentTime+=1e-6;const E=this.fragmentTracker.getPartialFragment(t)||void 0,T=Pt.bufferInfo(this.media,t,0);this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:E,buffer:T.len,bufferInfo:T})}}}}}_tryFixBufferStall(t,e,i){var n,a;const{fragmentTracker:l,media:c}=this,f=(n=this.hls)==null?void 0:n.config;if(!c||!l||!f)return;const h=(a=this.hls)==null?void 0:a.latestLevelDetails,g=l.getPartialFragment(i);if((g||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const p=t.buffered,E=this.adjacentTraversal(t,i);(p&&p.length>1&&t.len>f.maxBufferHole||t.nextStart&&(t.nextStart-i<f.maxBufferHole||E))&&(e>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const i=this.fragmentTracker,n=t.nextStart;if(i&&n){const a=i.getFragAtPos(e,Rt.MAIN),l=i.getFragAtPos(n,Rt.MAIN);if(a&&l)return l.sn-a.sn<2}return!1}_reportStall(t){const{hls:e,media:i,stallReported:n,stalled:a}=this;if(!n&&a!==null&&i&&e){this.stallReported=!0;const l=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Re(t)})`);this.warn(l.message),e.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:t.len,bufferInfo:t,stalled:{start:a}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:i,media:n}=this,a=(e=this.hls)==null?void 0:e.config;if(!n||!i||!a)return 0;const l=n.currentTime,c=Pt.bufferInfo(n,l,0),f=l<c.start?c.start:c.nextStart;if(f&&this.hls){const g=c.len<=a.maxBufferHole,p=c.len>0&&c.len<1&&n.readyState<3,E=f-l;if(E>0&&(g||p)){if(E>a.maxBufferHole){let S=!1;if(l===0){const R=i.getAppendedFrag(0,Rt.MAIN);R&&f<R.end&&(S=!0)}if(!S){const R=t||i.getAppendedFrag(l,Rt.MAIN);if(R){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||MT(this.hls.inFlightFragments,f))return 0;let D=!1,N=R.end;for(;N<f;){const M=i.getPartialFragment(N);if(M)N+=M.duration;else{D=!0;break}}if(D)return 0}}}const T=Math.max(f+RC,l+_C);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${T}`),this.moved=!0,n.currentTime=T,!(t!=null&&t.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${T}`);this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,frag:t||void 0,buffer:c.len,bufferInfo:c})}return T}}return 0}_tryNudgeBuffer(t){const{hls:e,media:i,nudgeRetry:n}=this,a=e?.config;if(!i||!a)return 0;const l=i.currentTime;if(this.nudgeRetry++,n<a.nudgeMaxRetry){const c=l+(n+1)*a.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(f.message),i.currentTime=c,e.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:t.len,bufferInfo:t})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${a.nudgeMaxRetry} nudges`);this.error(c.message),e.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:t.len,bufferInfo:t})}}}function MT(r,t){const e=kT(r.main);if(e&&e.start<=t)return e;const i=kT(r.audio);return i&&i.start<=t?i:null}function kT(r){if(!r)return null;switch(r.state){case lt.IDLE:case lt.STOPPED:case lt.ENDED:case lt.ERROR:return null}return r.frag}const IC=.25;function Cm(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function NT(r,t,e,i,n){let a=new r(t,e,"");try{a.value=i,n&&(a.type=n)}catch{a=new r(t,e,Re(n?re({type:n},i):i))}return a}const bh=(()=>{const r=Cm();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function LC(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class DC{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(b.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(t,e){var i;this.media=e.media,((i=e.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const t=this.hls.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(t,e){this.media=null,!e.transferMedia&&(this.id3Track&&(this.removeCues&&wo(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const i=t[e];if(i.kind==="metadata"&&i.label==="id3")return u_(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:n}}}=this;if(!i&&!n)return;const{samples:a}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Cm();if(l)for(let c=0;c<a.length;c++){const f=a[c].type;if(f===Ki.emsg&&!i||!n)continue;const h=$A(a[c].data);if(h){const g=a[c].pts;let p=g+a[c].duration;p>bh&&(p=bh),p-g<=0&&(p=g+IC);for(let T=0;T<h.length;T++){const S=h[T];if(!HA(S)){this.updateId3CueEnds(g,f);const R=NT(l,g,p,S,f);R&&this.id3Track.addCue(R)}}}}}updateId3CueEnds(t,e){var i;const n=(i=this.id3Track)==null?void 0:i.cues;if(n)for(let a=n.length;a--;){const l=n[a];l.type===e&&l.startTime<t&&l.endTime===bh&&(l.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:n}){const{id3Track:a,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:f}}=l;if(a&&(c||f)){let h;n==="audio"?h=g=>g.type===Ki.audioId3&&f:n==="video"?h=g=>g.type===Ki.emsg&&c:h=g=>g.type===Ki.audioId3&&f||g.type===Ki.emsg&&c,Im(a,e,i,h)}}onLevelUpdated(t,{details:e}){this.updateDateRangeCues(e,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:n}=t,a=Object.keys(n);let l=this.dateRangeCuesAppended;if(i&&e){var c;if((c=i.cues)!=null&&c.length){const g=Object.keys(l).filter(p=>!a.includes(p));for(let p=g.length;p--;){const E=g[p],T=l[E].cues;delete l[E],Object.keys(T).forEach(S=>{try{const R=T[S];R.removeEventListener("enter",this.onEventCueEnter),i.removeCue(R)}catch{}})}}else l=this.dateRangeCuesAppended={}}const f=t.fragments[t.fragments.length-1];if(a.length===0||!vt(f?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const h=Cm();for(let g=0;g<a.length;g++){const p=a[g],E=n[p],T=E.startTime,S=l[p],R=S?.cues||{};let _=S?.durationKnown||!1,D=bh;const{duration:N,endDate:M}=E;if(M&&N!==null)D=T+N,_=!0;else if(E.endOnNext&&!_){const $=a.reduce((q,w)=>{if(w!==E.id){const L=n[w];if(L.class===E.class&&L.startDate>E.startDate&&(!q||E.startDate<q.startDate))return L}return q},null);$&&(D=$.startTime,_=!0)}const G=Object.keys(E.attr);for(let $=0;$<G.length;$++){const q=G[$];if(!a1(q))continue;const w=R[q];if(w)_&&!S.durationKnown?w.endTime=D:Math.abs(w.startTime-T)>.01&&(w.startTime=T,w.endTime=D);else if(h){let L=E.attr[q];o1(q)&&(L=LC(L));const C=NT(h,T,D,{key:q,data:L},Ki.dateRange);C&&(C.id=p,this.id3Track.addCue(C),R[q]=C,this.hls.config.interstitialsController&&(q==="X-ASSET-LIST"||q==="X-ASSET-URL")&&C.addEventListener("enter",this.onEventCueEnter))}}l[p]={cues:R,dateRange:E,durationKnown:_}}}}class CC{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,i=this.levelDetails;if(!e||!i)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:l}=this.config;if(!a||l===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const f=n-c,h=Math.min(this.maxLatency,c+i.targetduration);if(f<h&&f>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,l)),E=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,T=Math.min(p,Math.max(1,E));this.changeMediaPlaybackRate(e,T)}else e.playbackRate!==1&&e.playbackRate!==0&&this.changeMediaPlaybackRate(e,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return((t=this.hls)==null?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(t.liveMaxLatencyDuration!==void 0)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(t===null||this.hls===null)return null;const{holdBack:e,partHoldBack:i,targetduration:n}=t,{liveSyncDuration:a,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,f=this.hls.userConfig;let h=c&&i||e;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||h===0)&&(h=a!==void 0?a:l*n);const g=n;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(t===null||e===null)return null;const i=this.levelDetails;if(i===null)return null;const n=i.edge,a=t-e-this.edgeStalled,l=n-i.totalduration,c=n-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(l,a),c)}get drift(){const t=this.levelDetails;return t===null?1:t.drift}get edgeStalled(){const t=this.levelDetails;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(b.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(b.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var i;e.details===W.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var i,n;t.playbackRate!==e&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${t.playbackRate} to ${e}`),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}class wC extends pp{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this),t.on(b.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this),t.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=this.hls.config.preferManagedMediaSource,n=[],a={},l={};let c=!1,f=!1,h=!1;e.levels.forEach(g=>{const p=g.attrs;let{audioCodec:E,videoCodec:T}=g;E&&(g.audioCodec=E=jh(E,i)||void 0),T&&(T=g.videoCodec=LI(T));const{width:S,height:R,unknownCodecs:_}=g;let D=_?_.length:0;if(_)for(let C=D;C--;){const U=_[C];this.isAudioSupported(U)?(g.audioCodec=E=E?`${E},${U}`:U,D--,Uo.audio[E.substring(0,4)]=2):this.isVideoSupported(U)&&(g.videoCodec=T=T?`${T},${U}`:U,D--,Uo.video[T.substring(0,4)]=2)}if(c||(c=!!(S&&R)),f||(f=!!T),h||(h=!!E),D||E&&!this.isAudioSupported(E)||T&&!this.isVideoSupported(T)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:N,"FRAME-RATE":M,"HDCP-LEVEL":G,"PATHWAY-ID":$,RESOLUTION:q,"VIDEO-RANGE":w}=p,O=`${`${$||"."}-`}${g.bitrate}-${q}-${M}-${N}-${w}-${G}`;if(a[O])if(a[O].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const C=l[O]+=1;g.attrs["PATHWAY-ID"]=new Array(C+1).join(".");const U=this.createLevel(g);a[O]=U,n.push(U)}else a[O].addGroupId("audio",p.AUDIO),a[O].addGroupId("text",p.SUBTITLES);else{const C=this.createLevel(g);a[O]=C,l[O]=1,n.push(C)}}),this.filterAndSortMediaOptions(n,e,c,f,h)}createLevel(t){const e=new Au(t),i=t.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(n.message),e.supportedResult=pA(n,[])}return e}isAudioSupported(t){return pm(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return pm(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,i,n,a){let l=[],c=[],f=t;if((i||n)&&a&&(f=f.filter(({videoCodec:_,videoRange:D,width:N,height:M})=>(!!_||!!(N&&M))&&PI(D))),f.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",D=_;e.levels.length&&(D=`one or more CODECS in variant not supported: ${Re(e.levels.map(M=>M.attrs.CODECS).filter((M,G,$)=>$.indexOf(M)===G))}`,this.warn(D),_+=` (${D})`);const N=new Error(_);this.hls.trigger(b.ERROR,{type:bt.MEDIA_ERROR,details:W.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:N,reason:D})}});return}e.audioTracks&&(l=e.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),FT(l)),e.subtitles&&(c=e.subtitles,FT(c));const h=f.slice(0);f.sort((_,D)=>{if(_.attrs["HDCP-LEVEL"]!==D.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(D.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&_.height!==D.height)return _.height-D.height;if(_.frameRate!==D.frameRate)return _.frameRate-D.frameRate;if(_.videoRange!==D.videoRange)return Yh.indexOf(_.videoRange)-Yh.indexOf(D.videoRange);if(_.videoCodec!==D.videoCodec){const N=Cv(_.videoCodec),M=Cv(D.videoCodec);if(N!==M)return M-N}if(_.uri===D.uri&&_.codecSet!==D.codecSet){const N=qh(_.codecSet),M=qh(D.codecSet);if(N!==M)return M-N}return _.averageBitrate!==D.averageBitrate?_.averageBitrate-D.averageBitrate:0});let g=h[0];if(this.steering&&(f=this.steering.filterParsedLevels(f),f.length!==h.length)){for(let _=0;_<h.length;_++)if(h[_].pathwayId===f[0].pathwayId){g=h[_];break}}this._levels=f;for(let _=0;_<f.length;_++)if(f[_]===g){var p;this._firstLevel=_;const D=g.bitrate,N=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${f.length} level(s) found, first bitrate: ${D}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const M=Math.min(D,this.hls.config.abrEwmaDefaultEstimateMax);M>N&&N===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=M)}break}const E=a&&!n,T=this.hls.config,S=!!(T.audioStreamController&&T.audioTrackController),R={levels:f,audioTracks:l,subtitleTracks:c,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:a,video:n,altAudio:S&&!E&&l.some(_=>!!_.url)};this.hls.trigger(b.MANIFEST_PARSED,R)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const g=new Error("invalid level idx"),p=t<0;if(this.hls.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.LEVEL_SWITCH_ERROR,level:t,fatal:p,error:g,reason:g.message}),p)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,n=this.currentLevel,a=n?n.attrs["PATHWAY-ID"]:void 0,l=e[t],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=l,i===t&&n&&a===c)return;this.log(`Switching to level ${t} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${i}${a?" with Pathway "+a:""}`);const f={level:t,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,f);const h=l.details;if(!h||h.live){const g=this.switchParams(l.uri,n?.details,h);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),i=t.filter(n=>e.indexOf(n)!==-1);if(t.length<1){this.warn(`pathwayPriority ${t} should contain at least one pathway from list: ${e}`);return}this.steering.pathwayPriority=i}}onError(t,e){e.fatal||!e.context||e.context.type===Ht.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(e!==void 0&&e.type===Rt.MAIN){const i=e.elementaryStreams;if(!Object.keys(i).some(a=>!!i[a]))return;const n=this._levels[e.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(t,e){var i;const{level:n,details:a}=e,l=e.levelInfo;if(!l){var c;this.warn(`Invalid level index ${n}`),(c=e.deliveryDirectives)!=null&&c.skip&&(a.deltaUpdateFailed=!0);return}if(l===this.currentLevel||e.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let f=l.details;f===e.details&&f.advanced&&(f=void 0),this.playlistLoaded(n,e,f)}else(i=e.deliveryDirectives)!=null&&i.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const i=this.getUrlWithDirectives(t.uri,e),n=this.currentLevelIndex,a=t.attrs["PATHWAY-ID"],l=t.details,c=l?.age;this.log(`Loading level index ${n}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""}${a?" Pathway "+a:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${i}`),this.hls.trigger(b.LEVEL_LOADING,{url:i,level:n,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(this._levels.length===1)return;const i=this._levels.filter((a,l)=>l!==t?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(c=>c.level=-1)),!1));OA(i),this._levels=i,this.currentLevelIndex>-1&&(e=this.currentLevel)!=null&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=i.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(b.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function FT(r){const t={};r.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}function A_(){return self.SourceBuffer||self.WebKitSourceBuffer}function __(){if(!Rr())return!1;const t=A_();return!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function"}function OC(){if(!__())return!1;const r=Rr();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>r.isTypeSupported(Su(t,"video")))||["mp4a.40.2","fLaC"].some(t=>r.isTypeSupported(Su(t,"audio"))))}function PC(){var r;const t=A_();return typeof(t==null||(r=t.prototype)==null?void 0:r.changeType)=="function"}const MC=100;class kC extends lp{constructor(t,e,i){super(t,e,i,"stream-controller",Rt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,a=n?n.currentTime:null;if(a===null||!vt(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const l=this.getFwdBufferInfoAtPos(n,a,Rt.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(b.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(b.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:i,hls:n}=this;if(this.stopLoad(),this.setInterval(MC),this.level=-1,!this.startFragRequested){let a=n.startLevel;a===-1&&(n.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=n.firstAutoLevel),n.nextLoadLevel=a,this.level=n.loadLevel,this._hasEnoughToStart=!!e}i>0&&t===-1&&!e&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),t=i),this.state=lt.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=lt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case lt.WAITING_LEVEL:{const{levels:e,level:i}=this,n=e?.[i],a=n?.details;if(a&&(!a.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(a))break;this.state=lt.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=lt.IDLE;break}break}case lt.FRAG_LOADING_WAITING_RETRY:{var t;const e=self.performance.now(),i=this.retryDate;if(!i||e>=i||(t=this.media)!=null&&t.seeking){const{levels:n,level:a}=this,l=n?.[a];this.resetStartWhenNotLoaded(l||null),this.state=lt.IDLE}}break}this.state===lt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:n}=this;if(e===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?t.nextLoadLevel:t.loadLevel;if(!(i!=null&&i[a]))return;const l=i[a],c=this.getMainFwdBufferInfo();if(c===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(c,f)){const R={};this.altAudio===2&&(R.type="video"),this.hls.trigger(b.BUFFER_EOS,R),this.state=lt.ENDED;return}if(!this.buffering)return;t.loadLevel!==a&&t.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=t.nextLoadLevel=a;const h=l.details;if(!h||this.state===lt.WAITING_LEVEL||this.waitForLive(l)){this.level=a,this.state=lt.WAITING_LEVEL,this.startFragRequested=!1;return}const g=c.len,p=this.getMaxBufferLength(l.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const E=this.backtrackFragment?this.backtrackFragment.start:c.end;let T=this.getNextFragment(E,h);if(this.couldBacktrack&&!this.fragPrevious&&T&&ai(T)&&this.fragmentTracker.getState(T)!==Qe.OK){var S;const _=((S=this.backtrackFragment)!=null?S:T).sn-h.startSN,D=h.fragments[_-1];D&&T.cc===D.cc&&(T=D,this.fragmentTracker.removeFragment(D))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(T&&this.isLoopLoading(T,E)){if(!T.gap){const _=this.audioOnly&&!this.altAudio?Ee.AUDIO:Ee.VIDEO,D=(_===Ee.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;D&&this.afterBufferFlushed(D,_,Rt.MAIN)}T=this.getNextFragmentLoopLoading(T,h,c,Rt.MAIN,p)}T&&(T.initSegment&&!T.initSegment.data&&!this.bitrateTest&&(T=T.initSegment),this.loadFragment(T,l,E))}loadFragment(t,e,i){const n=this.fragmentTracker.getState(t);n===Qe.NOT_LOADED||n===Qe.PARTIAL?ai(t)?this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,i):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,Rt.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let i;const n=this.getAppendedFrag(e.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<a.targetduration*2)return}if(!e.paused&&t){const c=this.hls.nextLoadLevel,f=t[c],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*f.maxBitrate/(1e3*h)+1:i=0}else i=0;const l=this.getBufferedFrag(e.currentTime+i);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const f=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,g=Math.max(l.end,f+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case lt.KEY_LOADING:case lt.FRAG_LOADING:case lt.FRAG_LOADING_WAITING_RETRY:case lt.PARSING:case lt.PARSED:this.state=lt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio===2?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;zi(i,"playing",this.onMediaPlaying),zi(i,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:i}=this;i&&(hn(i,"playing",this.onMediaPlaying),hn(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e),!e.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let i=!1,n=!1;e.levels.forEach(a=>{const l=a.audioCodec;l&&(i=i||l.indexOf("mp4a.40.2")!==-1,n=n||l.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&n&&!PC(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||this.state!==lt.IDLE)return;const n=e.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=lt.WAITING_LEVEL)}onLevelLoaded(t,e){var i;const{levels:n,startFragRequested:a}=this,l=e.level,c=e.details,f=c.totalduration;if(!n){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${f}`);const h=e.levelInfo,g=this.fragCurrent;g&&(this.state===lt.FRAG_LOADING||this.state===lt.FRAG_LOADING_WAITING_RETRY)&&g.level!==e.level&&g.loader&&this.abortCurrentFrag();let p=0;if(c.live||(i=h.details)!=null&&i.live){var E;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;p=this.alignPlaylists(c,h.details,(E=this.levelLastLoaded)==null?void 0:E.details)}if(h.details=c,this.levelLastLoaded=h,a||this.setStartPosition(c,p),this.hls.trigger(b.LEVEL_UPDATED,{details:c,level:l}),this.state===lt.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=lt.IDLE}a&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const n=this.hls.liveSyncPosition,a=this.getLoadPosition(),l=t.fragmentStart,c=t.edge,f=a>=l-e.maxFragLookUpTolerance&&a<=c;if(n!==null&&i.duration>n&&(a<n||!f)){const g=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!f&&i.readyState<4||a<c-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),i.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const p=Pt.bufferInfo(i,n,0);if(!(p!=null&&(h=p.buffered)!=null&&h.length)){i.currentTime=n;return}if(p.start<=a){i.currentTime=n;return}const{nextStart:T}=Pt.bufferedInfo(p.buffered,a,0);T&&(i.currentTime=T)}else i.currentTime=n}}_handleFragmentLoadProgress(t){var e;const i=t.frag,{part:n,payload:a}=t,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=l[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const f=c.details;if(!f){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const h=c.videoCodec,g=f.PTSKnown||!f.live,p=(e=i.initSegment)==null?void 0:e.data,E=this._getAudioCodec(c),T=this.transmuxer=this.transmuxer||new t_(this.hls,Rt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=n?n.index:-1,R=S!==-1,_=new rp(i.level,i.sn,i.stats.chunkCount,a.byteLength,S,R),D=this.initPTS[i.cc];T.push(a,p,E,h,i,n,f.totalduration,g,_,D)}onAudioTrackSwitching(t,e){const i=this.hls,n=this.altAudio===2;if(Qh(e.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.fragmentTracker.removeAllFragments(),i.once(b.BUFFER_FLUSHED,()=>{var l;(l=this.hls)==null||l.trigger(b.AUDIO_TRACK_SWITCHED,e)}),i.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(b.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=Qh(e.url,this.hls);if(i){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i?2:0,this.tick()}onBufferCreated(t,e){const i=e.tracks;let n,a,l=!1;for(const c in i){const f=i[c];if(f.id==="main"){if(a=c,n=f,c==="video"){const h=i[c];h&&(this.videoBuffer=h.buffer)}}else l=!0}l&&n?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:n}=e,a=i.type===Rt.MAIN;if(a){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${n?" p: "+n.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===lt.PARSED&&(this.state=lt.IDLE);return}const c=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),ai(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}const l=this.media;l&&(!this._hasEnoughToStart&&Pt.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var i;if(e.fatal){this.state=lt.ERROR;return}switch(e.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Rt.MAIN,e);break;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===lt.WAITING_LEVEL&&((i=e.context)==null?void 0:i.type)===Ht.LEVEL&&(this.state=lt.IDLE);break;case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:if(e.parent!=="main")return;this.resetLoadingState();break;case W.BUFFER_FULL_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onFragLoadEmergencyAborted(){this.state=lt.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Ee.AUDIO||!this.altAudio){const i=(e===Ee.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,e,Rt.MAIN),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking){this.log(`could not seek to ${i}, already seeking at ${e}`);return}const n=this.timelineOffset;n&&i&&(i+=n);const a=this.getLevelDetails(),l=Pt.getBuffered(t),c=l.length?l.start(0):0,f=c-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<h||this.loadingParts&&f<2*(a?.partTarget||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),i+=f,this.startPosition=i),e<i&&(this.log(`seek to target start position ${i} from current time ${e} buffer start ${c}`),t.currentTime=i)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:n}=this,a=i?.frag;if(!a||this.fragContextChanged(a))return;e.fragmentError=0,this.state=lt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=a.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),n.trigger(b.FRAG_LOADED,i),a.bitrateTest=!1})}_handleTransmuxComplete(t){var e;const i=this.playlistType,{hls:n}=this,{remuxResult:a,chunkMeta:l}=t,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:f,part:h,level:g}=c,{video:p,text:E,id3:T,initSegment:S}=a,{details:R}=g,_=this.altAudio?void 0:a.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=lt.PARSING,S){if(S!=null&&S.tracks){const M=f.initSegment||f;this._bufferInitSegment(g,S.tracks,M,l),n.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:i,tracks:S.tracks})}const D=S.initPTS,N=S.timescale;vt(D)&&(this.initPTS[f.cc]={baseTime:D,timescale:N},n.trigger(b.INIT_PTS_FOUND,{frag:f,id:i,initPTS:D,timescale:N}))}if(p&&R){_&&p.type==="audiovideo"&&this.logMuxedErr(f);const D=R.fragments[f.sn-1-R.startSN],N=f.sn===R.startSN,M=!D||f.cc>D.cc;if(a.independent!==!1){const{startPTS:G,endPTS:$,startDTS:q,endDTS:w}=p;if(h)h.elementaryStreams[p.type]={startPTS:G,endPTS:$,startDTS:q,endDTS:w};else if(p.firstKeyFrame&&p.independent&&l.id===1&&!M&&(this.couldBacktrack=!0),p.dropped&&p.independent){const L=this.getMainFwdBufferInfo(),O=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,C=p.firstKeyFramePTS?p.firstKeyFramePTS:G;if(!N&&O<C-this.config.maxBufferHole&&!M){this.backtrack(f);return}else M&&(f.gap=!0);f.setElementaryStreamInfo(p.type,f.start,$,f.start,w,!0)}else N&&G-(R.appliedTimelineOffset||0)>Uh&&(f.gap=!0);f.setElementaryStreamInfo(p.type,G,$,q,w),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(p,f,h,l,N||M)}else if(N||M)f.gap=!0;else{this.backtrack(f);return}}if(_){const{startPTS:D,endPTS:N,startDTS:M,endDTS:G}=_;h&&(h.elementaryStreams[Ee.AUDIO]={startPTS:D,endPTS:N,startDTS:M,endDTS:G}),f.setElementaryStreamInfo(Ee.AUDIO,D,N,M,G),this.bufferFragmentData(_,f,h,l)}if(R&&T!=null&&(e=T.samples)!=null&&e.length){const D={id:i,frag:f,details:R,samples:T.samples};n.trigger(b.FRAG_PARSING_METADATA,D)}if(R&&E){const D={id:i,frag:f,details:R,samples:E.samples};n.trigger(b.FRAG_PARSING_USERDATA,D)}}logMuxedErr(t){this.warn(`${ai(t)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${t.url}`)}_bufferInitSegment(t,e,i,n){if(this.state!==lt.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(i));const{audio:a,video:l,audiovideo:c}=e;if(a){let h=wh(a.codec,t.audioCodec);h==="mp4a"&&(h="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const p=a.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),t.audioCodec&&t.audioCodec!==h&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${h}"`),a.levelCodec=h,a.id=Rt.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${h||""}/${t.audioCodec||""}/${a.codec}]`),delete e.audiovideo}if(l){l.levelCodec=t.videoCodec,l.id=Rt.MAIN;const h=l.codec;if(h?.length===4)switch(h){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${t.videoCodec||""}/${h}]${l.codec!==h?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete e.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${t.codecs}/${c.codec}]`),delete e.video,delete e.audio);const f=Object.keys(e);if(f.length){if(this.hls.trigger(b.BUFFER_CODECS,e),!this.hls)return;f.forEach(h=>{const p=e[h].initSegment;p!=null&&p.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:h,data:p,frag:i,part:null,chunkMeta:n,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,Rt.MAIN)}get maxBufferLength(){const{levels:t,level:e}=this,i=t?.[e];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=lt.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const i=t.currentTime;if(Pt.isBuffered(t,i)?e=this.getAppendedFrag(i):Pt.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const n=this.fragPlaying,a=e.level;(!n||e.sn!==n.sn||n.level!==a)&&(this.fragPlaying=e,this.hls.trigger(b.FRAG_CHANGED,{frag:e}),(!n||n.level!==a)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return vt(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(vt(e)){const i=this.getLevelDetails(),n=this.currentFrag||(i?Sa(null,i.fragments,e):null);if(n){const a=n.programDateTime;if(a!==null){const l=a+(e-n.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class NC{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const i in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[i].loader;if(n){var e;if(t&&t!==((e=n.context)==null?void 0:e.frag.type))return;n.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=W.KEY_LOAD_ERROR,i,n,a){return new Ms({type:bt.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:a,error:i,networkDetails:n})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length){const{sn:i,cc:n}=t;for(let a=0;a<e.length;a++){const l=e[a];if(n<=l.cc&&(i==="initSegment"||l.sn==="initSegment"||i<l.sn))return this.emeController.selectKeySystemFormat(l).then(c=>{if(l.setKeyFormat(c),this.emeController&&this.config.requireKeySystemAccessOnStart){const f=Ph(c);if(f)return this.emeController.getKeySystemAccess([f])}})}}else if(this.config.requireKeySystemAccessOnStart){const i=au(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,n;e&&t.setKeyFormat(e);const a=t.decryptdata;if(!a){const h=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,W.KEY_LOAD_ERROR,h))}const l=a.uri;if(!l)return Promise.reject(this.createKeyLoadError(t,W.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));let c=this.keyUriToKeyInfo[l];if((i=c)!=null&&i.decryptdata.key)return a.key=c.decryptdata.key,Promise.resolve({frag:t,keyInfo:c});if((n=c)!=null&&n.keyLoadPromise){var f;switch((f=c.mediaKeySessionContext)==null?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(h=>(a.key=h.keyInfo.decryptdata.key,{frag:t,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[l]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(c,t):this.loadKeyEME(c,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,t);default:return Promise.reject(this.createKeyLoadError(t,W.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const n=this.emeController.loadKey(i);if(n)return(t.keyLoadPromise=n.then(a=>(t.mediaKeySessionContext=a,i))).catch(a=>{throw t.keyLoadPromise=null,a})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,n=i.loader,a=new n(i);return e.keyLoader=t.loader=a,t.keyLoadPromise=new Promise((l,c)=>{const f={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},h=i.keyLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(E,T,S,R)=>{const{frag:_,keyInfo:D,url:N}=S;if(!_.decryptdata||D!==this.keyUriToKeyInfo[N])return c(this.createKeyLoadError(_,W.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),R));D.decryptdata.key=_.decryptdata.key=new Uint8Array(E.data),_.keyLoader=null,D.loader=null,l({frag:_,keyInfo:D})},onError:(E,T,S,R)=>{this.resetLoader(T),c(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error(`HTTP Error ${E.code} loading key ${E.text}`),S,re({url:f.url,data:void 0},E)))},onTimeout:(E,T,S)=>{this.resetLoader(T),c(this.createKeyLoadError(e,W.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(E,T,S)=>{this.resetLoader(T),c(this.createKeyLoadError(e,W.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};a.load(f,g,p)})}resetLoader(t){const{frag:e,keyInfo:i,url:n}=t,a=i.loader;e.keyLoader===a&&(e.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[n],a&&a.destroy()}}function UT(r){const{type:t}=r;switch(t){case Ht.AUDIO_TRACK:return Rt.AUDIO;case Ht.SUBTITLE_TRACK:return Rt.SUBTITLE;default:return Rt.MAIN}}function sm(r,t){let e=r.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class FC{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,i=e.pLoader,n=e.loader,a=i||n,l=new a(e);return this.loaders[t.type]=l,l}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ht.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:i,level:n,pathwayId:a,url:l,deliveryDirectives:c,levelInfo:f}=e;this.load({id:i,level:n,pathwayId:a,responseType:"text",type:Ht.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:f})}onAudioTrackLoading(t,e){const{id:i,groupId:n,url:a,deliveryDirectives:l,track:c}=e;this.load({id:i,groupId:n,level:null,responseType:"text",type:Ht.AUDIO_TRACK,url:a,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(t,e){const{id:i,groupId:n,url:a,deliveryDirectives:l,track:c}=e;this.load({id:i,groupId:n,level:null,responseType:"text",type:Ht.SUBTITLE_TRACK,url:a,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(t,e){const i=this.loaders[Ht.LEVEL];if(i){const n=i.context;n&&!e.levels.some(a=>a===n.levelOrTrack)&&(i.abort(),delete this.loaders[Ht.LEVEL])}}load(t){var e;const i=this.hls.config;let n=this.getInternalLoader(t);if(n){const h=this.hls.logger,g=n.context;if(g&&g.levelOrTrack===t.levelOrTrack&&(g.url===t.url||g.deliveryDirectives&&!t.deliveryDirectives)){g.url===t.url?h.log(`[playlist-loader]: ignore ${t.url} ongoing request`):h.log(`[playlist-loader]: ignore ${t.url} in favor of ${g.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),n.abort()}let a;if(t.type===Ht.MANIFEST?a=i.manifestLoadPolicy.default:a=he({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(t),vt((e=t.deliveryDirectives)==null?void 0:e.part)){let h;if(t.type===Ht.LEVEL&&t.level!==null?h=this.hls.levels[t.level].details:t.type===Ht.AUDIO_TRACK&&t.id!==null?h=this.hls.audioTracks[t.id].details:t.type===Ht.SUBTITLE_TRACK&&t.id!==null&&(h=this.hls.subtitleTracks[t.id].details),h){const g=h.partTarget,p=h.targetduration;if(g&&p){const E=Math.max(g*3,p*.8)*1e3;a=he({},a,{maxTimeToFirstByteMs:Math.min(E,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(E,a.maxTimeToFirstByteMs)})}}}const l=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},f={onSuccess:(h,g,p,E)=>{const T=this.getInternalLoader(p);this.resetInternalLoader(p.type);const S=h.data;if(S.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(h,p,new Error("no EXTM3U delimiter"),E||null,g);return}g.parsing.start=performance.now(),Wn.isMediaPlaylist(S)||p.type!==Ht.MANIFEST?this.handleTrackOrLevelPlaylist(h,g,p,E||null,T):this.handleMasterPlaylist(h,g,p,E)},onError:(h,g,p,E)=>{this.handleNetworkError(g,p,!1,h,E)},onTimeout:(h,g,p)=>{this.handleNetworkError(g,p,!0,void 0,h)}};n.load(t,c,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:i}=this.hls;(t||i)&&(this.hls.logger.log(`${t?"auto":"force"} startLoad with configured startPosition ${e}`),this.hls.startLoad(e))}handleMasterPlaylist(t,e,i,n){const a=this.hls,l=t.data,c=sm(t,i),f=Wn.parseMasterPlaylist(l,c);if(f.playlistParsingError){this.handleManifestParsingError(t,i,f.playlistParsingError,n,e);return}const{contentSteering:h,levels:g,sessionData:p,sessionKeys:E,startTimeOffset:T,variableList:S}=f;this.variableList=S;const{AUDIO:R=[],SUBTITLES:_,"CLOSED-CAPTIONS":D}=Wn.parseMasterPlaylistMedia(l,c,f);R.length&&!R.some(M=>!M.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),R.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new xe({}),bitrate:0,url:""})),a.trigger(b.MANIFEST_LOADED,{levels:g,audioTracks:R,subtitles:_,captions:D,contentSteering:h,url:c,stats:e,networkDetails:n,sessionData:p,sessionKeys:E,startTimeOffset:T,variableList:S})}handleTrackOrLevelPlaylist(t,e,i,n,a){const l=this.hls,{id:c,level:f,type:h}=i,g=sm(t,i),p=vt(f)?f:vt(c)?c:0,E=UT(i),T=Wn.parseLevelPlaylist(t.data,g,p,E,0,this.variableList);if(h===Ht.MANIFEST){const S={attrs:new xe({}),bitrate:0,details:T,name:"",url:g};T.requestScheduled=e.loading.start+DA(T,0),l.trigger(b.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:g,stats:e,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=T,this.handlePlaylistLoaded(T,t,e,i,n,a)}handleManifestParsingError(t,e,i,n,a){this.hls.trigger(b.ERROR,{type:bt.NETWORK_ERROR,details:W.MANIFEST_PARSING_ERROR,fatal:e.type===Ht.MANIFEST,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:n,stats:a})}handleNetworkError(t,e,i=!1,n,a){let l=`A network ${i?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${t.type}`;t.type===Ht.LEVEL?l+=`: ${t.level} id: ${t.id}`:(t.type===Ht.AUDIO_TRACK||t.type===Ht.SUBTITLE_TRACK)&&(l+=` id: ${t.id} group-id: "${t.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let f=W.UNKNOWN,h=!1;const g=this.getInternalLoader(t);switch(t.type){case Ht.MANIFEST:f=i?W.MANIFEST_LOAD_TIMEOUT:W.MANIFEST_LOAD_ERROR,h=!0;break;case Ht.LEVEL:f=i?W.LEVEL_LOAD_TIMEOUT:W.LEVEL_LOAD_ERROR,h=!1;break;case Ht.AUDIO_TRACK:f=i?W.AUDIO_TRACK_LOAD_TIMEOUT:W.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Ht.SUBTITLE_TRACK:f=i?W.SUBTITLE_TRACK_LOAD_TIMEOUT:W.SUBTITLE_LOAD_ERROR,h=!1;break}g&&this.resetInternalLoader(t.type);const p={type:bt.NETWORK_ERROR,details:f,fatal:h,url:t.url,loader:g,context:t,error:c,networkDetails:e,stats:a};if(n){const E=e?.url||t.url;p.response=re({url:E,data:void 0},n)}this.hls.trigger(b.ERROR,p)}handlePlaylistLoaded(t,e,i,n,a,l){const c=this.hls,{type:f,level:h,id:g,groupId:p,deliveryDirectives:E}=n,T=sm(e,n),S=UT(n),R=typeof n.level=="number"&&S===Rt.MAIN?h:void 0;if(!t.fragments.length){const D=t.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(b.ERROR,{type:bt.NETWORK_ERROR,details:W.LEVEL_EMPTY_ERROR,fatal:!1,url:T,error:D,reason:D.message,response:e,context:n,level:R,parent:S,networkDetails:a,stats:i});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const _=t.playlistParsingError;if(_){if(this.hls.logger.warn(_),!c.config.ignorePlaylistParsingErrors){c.trigger(b.ERROR,{type:bt.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:T,error:_,reason:_.message,response:e,context:n,level:R,parent:S,networkDetails:a,stats:i});return}t.playlistParsingError=null}switch(t.live&&l&&(l.getCacheAge&&(t.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),f){case Ht.MANIFEST:case Ht.LEVEL:c.trigger(b.LEVEL_LOADED,{details:t,levelInfo:n.levelOrTrack||c.levels[0],level:R||0,id:g||0,stats:i,networkDetails:a,deliveryDirectives:E,withoutMultiVariant:f===Ht.MANIFEST});break;case Ht.AUDIO_TRACK:c.trigger(b.AUDIO_TRACK_LOADED,{details:t,track:n.levelOrTrack,id:g||0,groupId:p||"",stats:i,networkDetails:a,deliveryDirectives:E});break;case Ht.SUBTITLE_TRACK:c.trigger(b.SUBTITLE_TRACK_LOADED,{details:t,track:n.levelOrTrack,id:g||0,groupId:p||"",stats:i,networkDetails:a,deliveryDirectives:E});break}}}class ln{static get version(){return bu}static isMSESupported(){return __()}static isSupported(){return OC()}static getMediaSource(){return Rr()}static get Events(){return b}static get MetadataSchema(){return Ki}static get ErrorTypes(){return bt}static get ErrorDetails(){return W}static get DefaultConfig(){return ln.defaultConfig?ln.defaultConfig:vC}static set DefaultConfig(t){ln.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new up,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const e=this.logger=sI(t.debug||!1,"Hls instance",t.assetPlayerId),i=this.config=SC(ln.DefaultConfig,t,e);this.userConfig=t,i.progressive&&AC(i,e);const{abrController:n,bufferController:a,capLevelController:l,errorController:c,fpsController:f}=i,h=new c(this),g=this.abrController=new n(this),p=new YI(this),E=i.interstitialsController,T=E?this.interstitialsController=new E(this,ln):null,S=this.bufferController=new a(this,p),R=this.capLevelController=new l(this),_=new f(this),D=new FC(this),N=i.contentSteeringController,M=N?new N(this):null,G=this.levelController=new wC(this,M),$=new DC(this),q=new NC(this.config),w=this.streamController=new kC(this,p,q),L=this.gapController=new xC(this,p);R.setStreamController(w),_.setStreamController(w);const O=[D,G,w];T&&O.splice(1,0,T),M&&O.splice(1,0,M),this.networkControllers=O;const C=[g,S,L,R,_,$,p];this.audioTrackController=this.createController(i.audioTrackController,O);const U=i.audioStreamController;U&&O.push(this.audioStreamController=new U(this,p,q)),this.subtitleTrackController=this.createController(i.subtitleTrackController,O);const V=i.subtitleStreamController;V&&O.push(this.subtititleStreamController=new V(this,p,q)),this.createController(i.timelineController,C),q.emeController=this.emeController=this.createController(i.emeController,C),this.cmcdController=this.createController(i.cmcdController,C),this.latencyController=this.createController(CC,C),this.coreComponents=C,O.push(h);const B=h.onErrorOut;typeof B=="function"&&this.on(b.ERROR,B,h),this.on(b.MANIFEST_LOADED,D.onManifestLoaded,D)}createController(t,e){if(t){const i=new t(this);return e&&e.push(i),i}return null}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,n){this._emitter.off(t,e,i,n)}listeners(t){return this._emitter.listeners(t)}emit(t,e,i){return this._emitter.emit(t,e,i)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const n=t===b.ERROR;this.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:n,event:t,error:i}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){const a=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(b.ERROR,{type:bt.OTHER_ERROR,details:W.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const e="media"in t,i=e?t.media:t,n=e?t:{media:i};this._media=i,this.trigger(b.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const t=this.bufferController.transferMedia();return this.trigger(b.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();const e=this.media,i=this._url,n=this._url=tp.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),e&&i&&(i!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(b.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,e){this.logger.log(`startLoad(${t+(e?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(t,e),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){const t={[Rt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[Rt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[Rt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const t=this._media,e=t?.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=xD()),t}get levels(){const t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){const{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){OI(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const i=t.length;for(let n=0;n<i;n++)if(t[n].maxBitrate>=e)return n;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:i}=this;let n;if(e===-1&&t!=null&&t.length?n=t.length-1:n=e,i)for(let a=n;a--;){const l=t[a].attrs["HDCP-LEVEL"];if(l&&l<=i)return a}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(t))||null}setSubtitleOption(t){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(t))||null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,e=this.allAudioTracks){const i=EA(e);return yA(t,i,navigator.mediaCapabilities)}}ln.defaultConfig=void 0;const UC="/live-streaming/assets/bedc-B-Ui6rnh.png",BC="/live-streaming/assets/dstv-B8Z9V11q.png",VC="/live-streaming/assets/ikeja-DPcIypQu.png",GC="/live-streaming/assets/klarna-Ch_xMeFX.png",$C="/live-streaming/assets/mastercard-FyOClcKl.png",HC="/live-streaming/assets/mobile-BjHl3flr.png",KC="/live-streaming/assets/mtn-CEDNTC6c.png",zC="/live-streaming/assets/payoneer-BmPNNwdX.png",qC="/live-streaming/assets/paypal-tghhrfNN.png",jC="/live-streaming/assets/stripe-CVWrKqvZ.png",YC="/live-streaming/assets/visa-BSA3QA2V.png",QC="/live-streaming/assets/SKYSPORTS-D9UHUvNO.png",BT=[{url:QC,link:"https://www.skysports.com/"},{url:UC,link:"https://www.premierleague.com/en"},{url:BC,link:"https://www.dstv.com/en-tz/home"},{url:VC,link:"https://ikeja-electric.com"},{url:GC,link:"https://klarma.com"},{url:$C,link:"https://mastercard.com"},{url:HC,link:"https://mobile.com"},{url:KC,link:"https://mtn.com"},{url:zC,link:"https://uefa.com"},{url:qC,link:"https://paypal.com"},{url:jC,link:"https://stripe.com"},{url:YC,link:"https://visa.com"}],XC=[...BT,...BT];function WC(){return kt.jsx("footer",{className:"footer",children:kt.jsx("div",{className:"marquee",children:kt.jsx("div",{className:"marquee-content",children:XC.map((r,t)=>kt.jsx("a",{href:r.link,target:"_blank",rel:"noopener noreferrer",className:"logo-link",children:kt.jsx("img",{src:r.url,alt:`Bank ${t}`,className:"logo"})},t))})})})}const ZC=()=>{};var VT={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R_=function(r){const t=[];let e=0;for(let i=0;i<r.length;i++){let n=r.charCodeAt(i);n<128?t[e++]=n:n<2048?(t[e++]=n>>6|192,t[e++]=n&63|128):(n&64512)===55296&&i+1<r.length&&(r.charCodeAt(i+1)&64512)===56320?(n=65536+((n&1023)<<10)+(r.charCodeAt(++i)&1023),t[e++]=n>>18|240,t[e++]=n>>12&63|128,t[e++]=n>>6&63|128,t[e++]=n&63|128):(t[e++]=n>>12|224,t[e++]=n>>6&63|128,t[e++]=n&63|128)}return t},JC=function(r){const t=[];let e=0,i=0;for(;e<r.length;){const n=r[e++];if(n<128)t[i++]=String.fromCharCode(n);else if(n>191&&n<224){const a=r[e++];t[i++]=String.fromCharCode((n&31)<<6|a&63)}else if(n>239&&n<365){const a=r[e++],l=r[e++],c=r[e++],f=((n&7)<<18|(a&63)<<12|(l&63)<<6|c&63)-65536;t[i++]=String.fromCharCode(55296+(f>>10)),t[i++]=String.fromCharCode(56320+(f&1023))}else{const a=r[e++],l=r[e++];t[i++]=String.fromCharCode((n&15)<<12|(a&63)<<6|l&63)}}return t.join("")},b_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<r.length;n+=3){const a=r[n],l=n+1<r.length,c=l?r[n+1]:0,f=n+2<r.length,h=f?r[n+2]:0,g=a>>2,p=(a&3)<<4|c>>4;let E=(c&15)<<2|h>>6,T=h&63;f||(T=64,l||(E=64)),i.push(e[g],e[p],e[E],e[T])}return i.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(R_(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):JC(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<r.length;){const a=e[r.charAt(n++)],c=n<r.length?e[r.charAt(n)]:0;++n;const h=n<r.length?e[r.charAt(n)]:64;++n;const p=n<r.length?e[r.charAt(n)]:64;if(++n,a==null||c==null||h==null||p==null)throw new tw;const E=a<<2|c>>4;if(i.push(E),h!==64){const T=c<<4&240|h>>2;if(i.push(T),p!==64){const S=h<<6&192|p;i.push(S)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class tw extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ew=function(r){const t=R_(r);return b_.encodeByteArray(t,!0)},nf=function(r){return ew(r).replace(/\./g,"")},iw=function(r){try{return b_.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sw=()=>nw().__FIREBASE_DEFAULTS__,rw=()=>{if(typeof process>"u"||typeof VT>"u")return;const r=VT.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},aw=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&iw(r[1]);return t&&JSON.parse(t)},Sp=()=>{try{return ZC()||sw()||rw()||aw()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},ow=r=>{var t,e;return(e=(t=Sp())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[r]},lw=r=>{const t=ow(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},x_=()=>{var r;return(r=Sp())===null||r===void 0?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function cw(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hw(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},i=t||"demo-project",n=r.iat||0,a=r.sub||r.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},r);return[nf(JSON.stringify(e)),nf(JSON.stringify(l)),""].join(".")}const mu={};function fw(){const r={prod:[],emulator:[]};for(const t of Object.keys(mu))mu[t]?r.emulator.push(t):r.prod.push(t);return r}function dw(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let GT=!1;function gw(r,t){if(typeof window>"u"||typeof document>"u"||!Ap(window.location.host)||mu[r]===t||mu[r]||GT)return;mu[r]=t;function e(E){return`__firebase__banner__${E}`}const i="__firebase__banner",a=fw().prod.length>0;function l(){const E=document.getElementById(i);E&&E.remove()}function c(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function f(E,T){E.setAttribute("width","24"),E.setAttribute("id",T),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function h(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{GT=!0,l()},E}function g(E,T){E.setAttribute("id",T),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function p(){const E=dw(i),T=e("text"),S=document.getElementById(T)||document.createElement("span"),R=e("learnmore"),_=document.getElementById(R)||document.createElement("a"),D=e("preprendIcon"),N=document.getElementById(D)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const M=E.element;c(M),g(_,R);const G=h();f(N,D),M.append(N,S,_,G),document.body.appendChild(M)}a?(S.innerText="Preview backend disconnected.",N.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(N.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function pw(){var r;const t=(r=Sp())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function yw(){return!pw()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ew(){try{return typeof indexedDB=="object"}catch{return!1}}function vw(){return new Promise((r,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),e||self.indexedDB.deleteDatabase(i),r(!0)},n.onupgradeneeded=()=>{e=!1},n.onerror=()=>{var a;t(((a=n.error)===null||a===void 0?void 0:a.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tw="FirebaseError";class qo extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Tw,Object.setPrototypeOf(this,qo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,I_.prototype.create)}}class I_{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},n=`${this.service}/${t}`,a=this.errors[t],l=a?Sw(a,i):"Error",c=`${this.serviceName}: ${l} (${n}).`;return new qo(n,c,i)}}function Sw(r,t){return r.replace(Aw,(e,i)=>{const n=t[i];return n!=null?String(n):`<${i}?>`})}const Aw=/\{\$([^}]+)}/g;function sf(r,t){if(r===t)return!0;const e=Object.keys(r),i=Object.keys(t);for(const n of e){if(!i.includes(n))return!1;const a=r[n],l=t[n];if($T(a)&&$T(l)){if(!sf(a,l))return!1}else if(a!==l)return!1}for(const n of i)if(!e.includes(n))return!1;return!0}function $T(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aa(r){return r&&r._delegate?r._delegate:r}class Du{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pa="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const i=new uw;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&i.resolve(n)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(t?.identifier),n=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(a){if(n)return null;throw a}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(bw(t))try{this.getOrInitializeService({instanceIdentifier:pa})}catch{}for(const[e,i]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const a=this.getOrInitializeService({instanceIdentifier:n});i.resolve(a)}catch{}}}}clearInstance(t=pa){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=pa){return this.instances.has(t)}getOptions(t=pa){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[a,l]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);i===c&&l.resolve(n)}return n}onInit(t,e){var i;const n=this.normalizeInstanceIdentifier(e),a=(i=this.onInitCallbacks.get(n))!==null&&i!==void 0?i:new Set;a.add(t),this.onInitCallbacks.set(n,a);const l=this.instances.get(n);return l&&t(l,n),()=>{a.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const n of i)try{n(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Rw(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=pa){return this.component?this.component.multipleInstances?t:pa:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Rw(r){return r===pa?void 0:r}function bw(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new _w(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jt;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Jt||(Jt={}));const Iw={debug:Jt.DEBUG,verbose:Jt.VERBOSE,info:Jt.INFO,warn:Jt.WARN,error:Jt.ERROR,silent:Jt.SILENT},Lw=Jt.INFO,Dw={[Jt.DEBUG]:"log",[Jt.VERBOSE]:"log",[Jt.INFO]:"info",[Jt.WARN]:"warn",[Jt.ERROR]:"error"},Cw=(r,t,...e)=>{if(t<r.logLevel)return;const i=new Date().toISOString(),n=Dw[t];if(n)console[n](`[${i}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class L_{constructor(t){this.name=t,this._logLevel=Lw,this._logHandler=Cw,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Jt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Iw[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Jt.DEBUG,...t),this._logHandler(this,Jt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Jt.VERBOSE,...t),this._logHandler(this,Jt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Jt.INFO,...t),this._logHandler(this,Jt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Jt.WARN,...t),this._logHandler(this,Jt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Jt.ERROR,...t),this._logHandler(this,Jt.ERROR,...t)}}const ww=(r,t)=>t.some(e=>r instanceof e);let HT,KT;function Ow(){return HT||(HT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Pw(){return KT||(KT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D_=new WeakMap,wm=new WeakMap,C_=new WeakMap,rm=new WeakMap,_p=new WeakMap;function Mw(r){const t=new Promise((e,i)=>{const n=()=>{r.removeEventListener("success",a),r.removeEventListener("error",l)},a=()=>{e(Tr(r.result)),n()},l=()=>{i(r.error),n()};r.addEventListener("success",a),r.addEventListener("error",l)});return t.then(e=>{e instanceof IDBCursor&&D_.set(e,r)}).catch(()=>{}),_p.set(t,r),t}function kw(r){if(wm.has(r))return;const t=new Promise((e,i)=>{const n=()=>{r.removeEventListener("complete",a),r.removeEventListener("error",l),r.removeEventListener("abort",l)},a=()=>{e(),n()},l=()=>{i(r.error||new DOMException("AbortError","AbortError")),n()};r.addEventListener("complete",a),r.addEventListener("error",l),r.addEventListener("abort",l)});wm.set(r,t)}let Om={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return wm.get(r);if(t==="objectStoreNames")return r.objectStoreNames||C_.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Tr(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Nw(r){Om=r(Om)}function Fw(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=r.call(am(this),t,...e);return C_.set(i,t.sort?t.sort():[t]),Tr(i)}:Pw().includes(r)?function(...t){return r.apply(am(this),t),Tr(D_.get(this))}:function(...t){return Tr(r.apply(am(this),t))}}function Uw(r){return typeof r=="function"?Fw(r):(r instanceof IDBTransaction&&kw(r),ww(r,Ow())?new Proxy(r,Om):r)}function Tr(r){if(r instanceof IDBRequest)return Mw(r);if(rm.has(r))return rm.get(r);const t=Uw(r);return t!==r&&(rm.set(r,t),_p.set(t,r)),t}const am=r=>_p.get(r);function Bw(r,t,{blocked:e,upgrade:i,blocking:n,terminated:a}={}){const l=indexedDB.open(r,t),c=Tr(l);return i&&l.addEventListener("upgradeneeded",f=>{i(Tr(l.result),f.oldVersion,f.newVersion,Tr(l.transaction),f)}),e&&l.addEventListener("blocked",f=>e(f.oldVersion,f.newVersion,f)),c.then(f=>{a&&f.addEventListener("close",()=>a()),n&&f.addEventListener("versionchange",h=>n(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Vw=["get","getKey","getAll","getAllKeys","count"],Gw=["put","add","delete","clear"],om=new Map;function zT(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(om.get(t))return om.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,n=Gw.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(n||Vw.includes(e)))return;const a=async function(l,...c){const f=this.transaction(l,n?"readwrite":"readonly");let h=f.store;return i&&(h=h.index(c.shift())),(await Promise.all([h[e](...c),n&&f.done]))[0]};return om.set(t,a),a}Nw(r=>({...r,get:(t,e,i)=>zT(t,e)||r.get(t,e,i),has:(t,e)=>!!zT(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Hw(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function Hw(r){const t=r.getComponent();return t?.type==="VERSION"}const Pm="@firebase/app",qT="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs=new L_("@firebase/app"),Kw="@firebase/app-compat",zw="@firebase/analytics-compat",qw="@firebase/analytics",jw="@firebase/app-check-compat",Yw="@firebase/app-check",Qw="@firebase/auth",Xw="@firebase/auth-compat",Ww="@firebase/database",Zw="@firebase/data-connect",Jw="@firebase/database-compat",tO="@firebase/functions",eO="@firebase/functions-compat",iO="@firebase/installations",nO="@firebase/installations-compat",sO="@firebase/messaging",rO="@firebase/messaging-compat",aO="@firebase/performance",oO="@firebase/performance-compat",lO="@firebase/remote-config",uO="@firebase/remote-config-compat",cO="@firebase/storage",hO="@firebase/storage-compat",fO="@firebase/firestore",dO="@firebase/ai",gO="@firebase/firestore-compat",mO="firebase",pO="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mm="[DEFAULT]",yO={[Pm]:"fire-core",[Kw]:"fire-core-compat",[qw]:"fire-analytics",[zw]:"fire-analytics-compat",[Yw]:"fire-app-check",[jw]:"fire-app-check-compat",[Qw]:"fire-auth",[Xw]:"fire-auth-compat",[Ww]:"fire-rtdb",[Zw]:"fire-data-connect",[Jw]:"fire-rtdb-compat",[tO]:"fire-fn",[eO]:"fire-fn-compat",[iO]:"fire-iid",[nO]:"fire-iid-compat",[sO]:"fire-fcm",[rO]:"fire-fcm-compat",[aO]:"fire-perf",[oO]:"fire-perf-compat",[lO]:"fire-rc",[uO]:"fire-rc-compat",[cO]:"fire-gcs",[hO]:"fire-gcs-compat",[fO]:"fire-fst",[gO]:"fire-fst-compat",[dO]:"fire-vertex","fire-js":"fire-js",[mO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rf=new Map,EO=new Map,km=new Map;function jT(r,t){try{r.container.addComponent(t)}catch(e){Fs.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function af(r){const t=r.name;if(km.has(t))return Fs.debug(`There were multiple attempts to register component ${t}.`),!1;km.set(t,r);for(const e of rf.values())jT(e,r);for(const e of EO.values())jT(e,r);return!0}function vO(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function TO(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SO={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Sr=new I_("app","Firebase",SO);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Du("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Sr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O=pO;function w_(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const i=Object.assign({name:Mm,automaticDataCollectionEnabled:!0},t),n=i.name;if(typeof n!="string"||!n)throw Sr.create("bad-app-name",{appName:String(n)});if(e||(e=x_()),!e)throw Sr.create("no-options");const a=rf.get(n);if(a){if(sf(e,a.options)&&sf(i,a.config))return a;throw Sr.create("duplicate-app",{appName:n})}const l=new xw(n);for(const f of km.values())l.addComponent(f);const c=new AO(e,i,l);return rf.set(n,c),c}function RO(r=Mm){const t=rf.get(r);if(!t&&r===Mm&&x_())return w_();if(!t)throw Sr.create("no-app",{appName:r});return t}function ko(r,t,e){var i;let n=(i=yO[r])!==null&&i!==void 0?i:r;e&&(n+=`-${e}`);const a=n.match(/\s|\//),l=t.match(/\s|\//);if(a||l){const c=[`Unable to register library "${n}" with version "${t}":`];a&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&l&&c.push("and"),l&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Fs.warn(c.join(" "));return}af(new Du(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bO="firebase-heartbeat-database",xO=1,Cu="firebase-heartbeat-store";let lm=null;function O_(){return lm||(lm=Bw(bO,xO,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Cu)}catch(e){console.warn(e)}}}}).catch(r=>{throw Sr.create("idb-open",{originalErrorMessage:r.message})})),lm}async function IO(r){try{const e=(await O_()).transaction(Cu),i=await e.objectStore(Cu).get(P_(r));return await e.done,i}catch(t){if(t instanceof qo)Fs.warn(t.message);else{const e=Sr.create("idb-get",{originalErrorMessage:t?.message});Fs.warn(e.message)}}}async function YT(r,t){try{const i=(await O_()).transaction(Cu,"readwrite");await i.objectStore(Cu).put(t,P_(r)),await i.done}catch(e){if(e instanceof qo)Fs.warn(e.message);else{const i=Sr.create("idb-set",{originalErrorMessage:e?.message});Fs.warn(i.message)}}}function P_(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LO=1024,DO=30;class CO{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new OO(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=QT();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(l=>l.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:n}),this._heartbeatsCache.heartbeats.length>DO){const l=PO(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Fs.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=QT(),{heartbeatsToSend:i,unsentEntries:n}=wO(this._heartbeatsCache.heartbeats),a=nf(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return Fs.warn(e),""}}}function QT(){return new Date().toISOString().substring(0,10)}function wO(r,t=LO){const e=[];let i=r.slice();for(const n of r){const a=e.find(l=>l.agent===n.agent);if(a){if(a.dates.push(n.date),XT(e)>t){a.dates.pop();break}}else if(e.push({agent:n.agent,dates:[n.date]}),XT(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class OO{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ew()?vw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await IO(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return YT(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return YT(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function XT(r){return nf(JSON.stringify({version:2,heartbeats:r})).length}function PO(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let i=1;i<r.length;i++)r[i].date<e&&(e=r[i].date,t=i);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MO(r){af(new Du("platform-logger",t=>new $w(t),"PRIVATE")),af(new Du("heartbeat",t=>new CO(t),"PRIVATE")),ko(Pm,qT,r),ko(Pm,qT,"esm2017"),ko("fire-js","")}MO("");var kO="firebase",NO="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ko(kO,NO,"app");var WT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ar,M_;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(w,L){function O(){}O.prototype=L.prototype,w.D=L.prototype,w.prototype=new O,w.prototype.constructor=w,w.C=function(C,U,V){for(var B=Array(arguments.length-2),pt=2;pt<arguments.length;pt++)B[pt-2]=arguments[pt];return L.prototype[U].apply(C,B)}}function e(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(i,e),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function n(w,L,O){O||(O=0);var C=Array(16);if(typeof L=="string")for(var U=0;16>U;++U)C[U]=L.charCodeAt(O++)|L.charCodeAt(O++)<<8|L.charCodeAt(O++)<<16|L.charCodeAt(O++)<<24;else for(U=0;16>U;++U)C[U]=L[O++]|L[O++]<<8|L[O++]<<16|L[O++]<<24;L=w.g[0],O=w.g[1],U=w.g[2];var V=w.g[3],B=L+(V^O&(U^V))+C[0]+3614090360&4294967295;L=O+(B<<7&4294967295|B>>>25),B=V+(U^L&(O^U))+C[1]+3905402710&4294967295,V=L+(B<<12&4294967295|B>>>20),B=U+(O^V&(L^O))+C[2]+606105819&4294967295,U=V+(B<<17&4294967295|B>>>15),B=O+(L^U&(V^L))+C[3]+3250441966&4294967295,O=U+(B<<22&4294967295|B>>>10),B=L+(V^O&(U^V))+C[4]+4118548399&4294967295,L=O+(B<<7&4294967295|B>>>25),B=V+(U^L&(O^U))+C[5]+1200080426&4294967295,V=L+(B<<12&4294967295|B>>>20),B=U+(O^V&(L^O))+C[6]+2821735955&4294967295,U=V+(B<<17&4294967295|B>>>15),B=O+(L^U&(V^L))+C[7]+4249261313&4294967295,O=U+(B<<22&4294967295|B>>>10),B=L+(V^O&(U^V))+C[8]+1770035416&4294967295,L=O+(B<<7&4294967295|B>>>25),B=V+(U^L&(O^U))+C[9]+2336552879&4294967295,V=L+(B<<12&4294967295|B>>>20),B=U+(O^V&(L^O))+C[10]+4294925233&4294967295,U=V+(B<<17&4294967295|B>>>15),B=O+(L^U&(V^L))+C[11]+2304563134&4294967295,O=U+(B<<22&4294967295|B>>>10),B=L+(V^O&(U^V))+C[12]+1804603682&4294967295,L=O+(B<<7&4294967295|B>>>25),B=V+(U^L&(O^U))+C[13]+4254626195&4294967295,V=L+(B<<12&4294967295|B>>>20),B=U+(O^V&(L^O))+C[14]+2792965006&4294967295,U=V+(B<<17&4294967295|B>>>15),B=O+(L^U&(V^L))+C[15]+1236535329&4294967295,O=U+(B<<22&4294967295|B>>>10),B=L+(U^V&(O^U))+C[1]+4129170786&4294967295,L=O+(B<<5&4294967295|B>>>27),B=V+(O^U&(L^O))+C[6]+3225465664&4294967295,V=L+(B<<9&4294967295|B>>>23),B=U+(L^O&(V^L))+C[11]+643717713&4294967295,U=V+(B<<14&4294967295|B>>>18),B=O+(V^L&(U^V))+C[0]+3921069994&4294967295,O=U+(B<<20&4294967295|B>>>12),B=L+(U^V&(O^U))+C[5]+3593408605&4294967295,L=O+(B<<5&4294967295|B>>>27),B=V+(O^U&(L^O))+C[10]+38016083&4294967295,V=L+(B<<9&4294967295|B>>>23),B=U+(L^O&(V^L))+C[15]+3634488961&4294967295,U=V+(B<<14&4294967295|B>>>18),B=O+(V^L&(U^V))+C[4]+3889429448&4294967295,O=U+(B<<20&4294967295|B>>>12),B=L+(U^V&(O^U))+C[9]+568446438&4294967295,L=O+(B<<5&4294967295|B>>>27),B=V+(O^U&(L^O))+C[14]+3275163606&4294967295,V=L+(B<<9&4294967295|B>>>23),B=U+(L^O&(V^L))+C[3]+4107603335&4294967295,U=V+(B<<14&4294967295|B>>>18),B=O+(V^L&(U^V))+C[8]+1163531501&4294967295,O=U+(B<<20&4294967295|B>>>12),B=L+(U^V&(O^U))+C[13]+2850285829&4294967295,L=O+(B<<5&4294967295|B>>>27),B=V+(O^U&(L^O))+C[2]+4243563512&4294967295,V=L+(B<<9&4294967295|B>>>23),B=U+(L^O&(V^L))+C[7]+1735328473&4294967295,U=V+(B<<14&4294967295|B>>>18),B=O+(V^L&(U^V))+C[12]+2368359562&4294967295,O=U+(B<<20&4294967295|B>>>12),B=L+(O^U^V)+C[5]+4294588738&4294967295,L=O+(B<<4&4294967295|B>>>28),B=V+(L^O^U)+C[8]+2272392833&4294967295,V=L+(B<<11&4294967295|B>>>21),B=U+(V^L^O)+C[11]+1839030562&4294967295,U=V+(B<<16&4294967295|B>>>16),B=O+(U^V^L)+C[14]+4259657740&4294967295,O=U+(B<<23&4294967295|B>>>9),B=L+(O^U^V)+C[1]+2763975236&4294967295,L=O+(B<<4&4294967295|B>>>28),B=V+(L^O^U)+C[4]+1272893353&4294967295,V=L+(B<<11&4294967295|B>>>21),B=U+(V^L^O)+C[7]+4139469664&4294967295,U=V+(B<<16&4294967295|B>>>16),B=O+(U^V^L)+C[10]+3200236656&4294967295,O=U+(B<<23&4294967295|B>>>9),B=L+(O^U^V)+C[13]+681279174&4294967295,L=O+(B<<4&4294967295|B>>>28),B=V+(L^O^U)+C[0]+3936430074&4294967295,V=L+(B<<11&4294967295|B>>>21),B=U+(V^L^O)+C[3]+3572445317&4294967295,U=V+(B<<16&4294967295|B>>>16),B=O+(U^V^L)+C[6]+76029189&4294967295,O=U+(B<<23&4294967295|B>>>9),B=L+(O^U^V)+C[9]+3654602809&4294967295,L=O+(B<<4&4294967295|B>>>28),B=V+(L^O^U)+C[12]+3873151461&4294967295,V=L+(B<<11&4294967295|B>>>21),B=U+(V^L^O)+C[15]+530742520&4294967295,U=V+(B<<16&4294967295|B>>>16),B=O+(U^V^L)+C[2]+3299628645&4294967295,O=U+(B<<23&4294967295|B>>>9),B=L+(U^(O|~V))+C[0]+4096336452&4294967295,L=O+(B<<6&4294967295|B>>>26),B=V+(O^(L|~U))+C[7]+1126891415&4294967295,V=L+(B<<10&4294967295|B>>>22),B=U+(L^(V|~O))+C[14]+2878612391&4294967295,U=V+(B<<15&4294967295|B>>>17),B=O+(V^(U|~L))+C[5]+4237533241&4294967295,O=U+(B<<21&4294967295|B>>>11),B=L+(U^(O|~V))+C[12]+1700485571&4294967295,L=O+(B<<6&4294967295|B>>>26),B=V+(O^(L|~U))+C[3]+2399980690&4294967295,V=L+(B<<10&4294967295|B>>>22),B=U+(L^(V|~O))+C[10]+4293915773&4294967295,U=V+(B<<15&4294967295|B>>>17),B=O+(V^(U|~L))+C[1]+2240044497&4294967295,O=U+(B<<21&4294967295|B>>>11),B=L+(U^(O|~V))+C[8]+1873313359&4294967295,L=O+(B<<6&4294967295|B>>>26),B=V+(O^(L|~U))+C[15]+4264355552&4294967295,V=L+(B<<10&4294967295|B>>>22),B=U+(L^(V|~O))+C[6]+2734768916&4294967295,U=V+(B<<15&4294967295|B>>>17),B=O+(V^(U|~L))+C[13]+1309151649&4294967295,O=U+(B<<21&4294967295|B>>>11),B=L+(U^(O|~V))+C[4]+4149444226&4294967295,L=O+(B<<6&4294967295|B>>>26),B=V+(O^(L|~U))+C[11]+3174756917&4294967295,V=L+(B<<10&4294967295|B>>>22),B=U+(L^(V|~O))+C[2]+718787259&4294967295,U=V+(B<<15&4294967295|B>>>17),B=O+(V^(U|~L))+C[9]+3951481745&4294967295,w.g[0]=w.g[0]+L&4294967295,w.g[1]=w.g[1]+(U+(B<<21&4294967295|B>>>11))&4294967295,w.g[2]=w.g[2]+U&4294967295,w.g[3]=w.g[3]+V&4294967295}i.prototype.u=function(w,L){L===void 0&&(L=w.length);for(var O=L-this.blockSize,C=this.B,U=this.h,V=0;V<L;){if(U==0)for(;V<=O;)n(this,w,V),V+=this.blockSize;if(typeof w=="string"){for(;V<L;)if(C[U++]=w.charCodeAt(V++),U==this.blockSize){n(this,C),U=0;break}}else for(;V<L;)if(C[U++]=w[V++],U==this.blockSize){n(this,C),U=0;break}}this.h=U,this.o+=L},i.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var L=1;L<w.length-8;++L)w[L]=0;var O=8*this.o;for(L=w.length-8;L<w.length;++L)w[L]=O&255,O/=256;for(this.u(w),w=Array(16),L=O=0;4>L;++L)for(var C=0;32>C;C+=8)w[O++]=this.g[L]>>>C&255;return w};function a(w,L){var O=c;return Object.prototype.hasOwnProperty.call(O,w)?O[w]:O[w]=L(w)}function l(w,L){this.h=L;for(var O=[],C=!0,U=w.length-1;0<=U;U--){var V=w[U]|0;C&&V==L||(O[U]=V,C=!1)}this.g=O}var c={};function f(w){return-128<=w&&128>w?a(w,function(L){return new l([L|0],0>L?-1:0)}):new l([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return _(h(-w));for(var L=[],O=1,C=0;w>=O;C++)L[C]=w/O|0,O*=4294967296;return new l(L,0)}function g(w,L){if(w.length==0)throw Error("number format error: empty string");if(L=L||10,2>L||36<L)throw Error("radix out of range: "+L);if(w.charAt(0)=="-")return _(g(w.substring(1),L));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var O=h(Math.pow(L,8)),C=p,U=0;U<w.length;U+=8){var V=Math.min(8,w.length-U),B=parseInt(w.substring(U,U+V),L);8>V?(V=h(Math.pow(L,V)),C=C.j(V).add(h(B))):(C=C.j(O),C=C.add(h(B)))}return C}var p=f(0),E=f(1),T=f(16777216);r=l.prototype,r.m=function(){if(R(this))return-_(this).m();for(var w=0,L=1,O=0;O<this.g.length;O++){var C=this.i(O);w+=(0<=C?C:4294967296+C)*L,L*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(S(this))return"0";if(R(this))return"-"+_(this).toString(w);for(var L=h(Math.pow(w,6)),O=this,C="";;){var U=G(O,L).g;O=D(O,U.j(L));var V=((0<O.g.length?O.g[0]:O.h)>>>0).toString(w);if(O=U,S(O))return V+C;for(;6>V.length;)V="0"+V;C=V+C}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function S(w){if(w.h!=0)return!1;for(var L=0;L<w.g.length;L++)if(w.g[L]!=0)return!1;return!0}function R(w){return w.h==-1}r.l=function(w){return w=D(this,w),R(w)?-1:S(w)?0:1};function _(w){for(var L=w.g.length,O=[],C=0;C<L;C++)O[C]=~w.g[C];return new l(O,~w.h).add(E)}r.abs=function(){return R(this)?_(this):this},r.add=function(w){for(var L=Math.max(this.g.length,w.g.length),O=[],C=0,U=0;U<=L;U++){var V=C+(this.i(U)&65535)+(w.i(U)&65535),B=(V>>>16)+(this.i(U)>>>16)+(w.i(U)>>>16);C=B>>>16,V&=65535,B&=65535,O[U]=B<<16|V}return new l(O,O[O.length-1]&-2147483648?-1:0)};function D(w,L){return w.add(_(L))}r.j=function(w){if(S(this)||S(w))return p;if(R(this))return R(w)?_(this).j(_(w)):_(_(this).j(w));if(R(w))return _(this.j(_(w)));if(0>this.l(T)&&0>w.l(T))return h(this.m()*w.m());for(var L=this.g.length+w.g.length,O=[],C=0;C<2*L;C++)O[C]=0;for(C=0;C<this.g.length;C++)for(var U=0;U<w.g.length;U++){var V=this.i(C)>>>16,B=this.i(C)&65535,pt=w.i(U)>>>16,gt=w.i(U)&65535;O[2*C+2*U]+=B*gt,N(O,2*C+2*U),O[2*C+2*U+1]+=V*gt,N(O,2*C+2*U+1),O[2*C+2*U+1]+=B*pt,N(O,2*C+2*U+1),O[2*C+2*U+2]+=V*pt,N(O,2*C+2*U+2)}for(C=0;C<L;C++)O[C]=O[2*C+1]<<16|O[2*C];for(C=L;C<2*L;C++)O[C]=0;return new l(O,0)};function N(w,L){for(;(w[L]&65535)!=w[L];)w[L+1]+=w[L]>>>16,w[L]&=65535,L++}function M(w,L){this.g=w,this.h=L}function G(w,L){if(S(L))throw Error("division by zero");if(S(w))return new M(p,p);if(R(w))return L=G(_(w),L),new M(_(L.g),_(L.h));if(R(L))return L=G(w,_(L)),new M(_(L.g),L.h);if(30<w.g.length){if(R(w)||R(L))throw Error("slowDivide_ only works with positive integers.");for(var O=E,C=L;0>=C.l(w);)O=$(O),C=$(C);var U=q(O,1),V=q(C,1);for(C=q(C,2),O=q(O,2);!S(C);){var B=V.add(C);0>=B.l(w)&&(U=U.add(O),V=B),C=q(C,1),O=q(O,1)}return L=D(w,U.j(L)),new M(U,L)}for(U=p;0<=w.l(L);){for(O=Math.max(1,Math.floor(w.m()/L.m())),C=Math.ceil(Math.log(O)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),V=h(O),B=V.j(L);R(B)||0<B.l(w);)O-=C,V=h(O),B=V.j(L);S(V)&&(V=E),U=U.add(V),w=D(w,B)}return new M(U,w)}r.A=function(w){return G(this,w).h},r.and=function(w){for(var L=Math.max(this.g.length,w.g.length),O=[],C=0;C<L;C++)O[C]=this.i(C)&w.i(C);return new l(O,this.h&w.h)},r.or=function(w){for(var L=Math.max(this.g.length,w.g.length),O=[],C=0;C<L;C++)O[C]=this.i(C)|w.i(C);return new l(O,this.h|w.h)},r.xor=function(w){for(var L=Math.max(this.g.length,w.g.length),O=[],C=0;C<L;C++)O[C]=this.i(C)^w.i(C);return new l(O,this.h^w.h)};function $(w){for(var L=w.g.length+1,O=[],C=0;C<L;C++)O[C]=w.i(C)<<1|w.i(C-1)>>>31;return new l(O,w.h)}function q(w,L){var O=L>>5;L%=32;for(var C=w.g.length-O,U=[],V=0;V<C;V++)U[V]=0<L?w.i(V+O)>>>L|w.i(V+O+1)<<32-L:w.i(V+O);return new l(U,w.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,M_=i,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.A,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=h,l.fromString=g,Ar=l}).apply(typeof WT<"u"?WT:typeof self<"u"?self:typeof window<"u"?window:{});var xh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var k_,lu,N_,Bh,Nm,F_,U_,B_;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(m,A,x){return m==Array.prototype||m==Object.prototype||(m[A]=x.value),m};function e(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof xh=="object"&&xh];for(var A=0;A<m.length;++A){var x=m[A];if(x&&x.Math==Math)return x}throw Error("Cannot find global object")}var i=e(this);function n(m,A){if(A)t:{var x=i;m=m.split(".");for(var k=0;k<m.length-1;k++){var Q=m[k];if(!(Q in x))break t;x=x[Q]}m=m[m.length-1],k=x[m],A=A(k),A!=k&&A!=null&&t(x,m,{configurable:!0,writable:!0,value:A})}}function a(m,A){m instanceof String&&(m+="");var x=0,k=!1,Q={next:function(){if(!k&&x<m.length){var nt=x++;return{value:A(nt,m[nt]),done:!1}}return k=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}n("Array.prototype.values",function(m){return m||function(){return a(this,function(A,x){return x})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var l=l||{},c=this||self;function f(m){var A=typeof m;return A=A!="object"?A:m?Array.isArray(m)?"array":A:"null",A=="array"||A=="object"&&typeof m.length=="number"}function h(m){var A=typeof m;return A=="object"&&m!=null||A=="function"}function g(m,A,x){return m.call.apply(m.bind,arguments)}function p(m,A,x){if(!m)throw Error();if(2<arguments.length){var k=Array.prototype.slice.call(arguments,2);return function(){var Q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Q,k),m.apply(A,Q)}}return function(){return m.apply(A,arguments)}}function E(m,A,x){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:p,E.apply(null,arguments)}function T(m,A){var x=Array.prototype.slice.call(arguments,1);return function(){var k=x.slice();return k.push.apply(k,arguments),m.apply(this,k)}}function S(m,A){function x(){}x.prototype=A.prototype,m.aa=A.prototype,m.prototype=new x,m.prototype.constructor=m,m.Qb=function(k,Q,nt){for(var yt=Array(arguments.length-2),Qt=2;Qt<arguments.length;Qt++)yt[Qt-2]=arguments[Qt];return A.prototype[Q].apply(k,yt)}}function R(m){const A=m.length;if(0<A){const x=Array(A);for(let k=0;k<A;k++)x[k]=m[k];return x}return[]}function _(m,A){for(let x=1;x<arguments.length;x++){const k=arguments[x];if(f(k)){const Q=m.length||0,nt=k.length||0;m.length=Q+nt;for(let yt=0;yt<nt;yt++)m[Q+yt]=k[yt]}else m.push(k)}}class D{constructor(A,x){this.i=A,this.j=x,this.h=0,this.g=null}get(){let A;return 0<this.h?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function N(m){return/^[\s\xa0]*$/.test(m)}function M(){var m=c.navigator;return m&&(m=m.userAgent)?m:""}function G(m){return G[" "](m),m}G[" "]=function(){};var $=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function q(m,A,x){for(const k in m)A.call(x,m[k],k,m)}function w(m,A){for(const x in m)A.call(void 0,m[x],x,m)}function L(m){const A={};for(const x in m)A[x]=m[x];return A}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(m,A){let x,k;for(let Q=1;Q<arguments.length;Q++){k=arguments[Q];for(x in k)m[x]=k[x];for(let nt=0;nt<O.length;nt++)x=O[nt],Object.prototype.hasOwnProperty.call(k,x)&&(m[x]=k[x])}}function U(m){var A=1;m=m.split(":");const x=[];for(;0<A&&m.length;)x.push(m.shift()),A--;return m.length&&x.push(m.join(":")),x}function V(m){c.setTimeout(()=>{throw m},0)}function B(){var m=rt;let A=null;return m.g&&(A=m.g,m.g=m.g.next,m.g||(m.h=null),A.next=null),A}class pt{constructor(){this.h=this.g=null}add(A,x){const k=gt.get();k.set(A,x),this.h?this.h.next=k:this.g=k,this.h=k}}var gt=new D(()=>new K,m=>m.reset());class K{constructor(){this.next=this.g=this.h=null}set(A,x){this.h=A,this.g=x,this.next=null}reset(){this.next=this.g=this.h=null}}let it,ct=!1,rt=new pt,F=()=>{const m=c.Promise.resolve(void 0);it=()=>{m.then(tt)}};var tt=()=>{for(var m;m=B();){try{m.h.call(m.g)}catch(x){V(x)}var A=gt;A.j(m),100>A.h&&(A.h++,m.next=A.g,A.g=m)}ct=!1};function at(){this.s=this.s,this.C=this.C}at.prototype.s=!1,at.prototype.ma=function(){this.s||(this.s=!0,this.N())},at.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function st(m,A){this.type=m,this.g=this.target=A,this.defaultPrevented=!1}st.prototype.h=function(){this.defaultPrevented=!0};var mt=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var m=!1,A=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const x=()=>{};c.addEventListener("test",x,A),c.removeEventListener("test",x,A)}catch{}return m}();function Tt(m,A){if(st.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m){var x=this.type=m.type,k=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;if(this.target=m.target||m.srcElement,this.g=A,A=m.relatedTarget){if($){t:{try{G(A.nodeName);var Q=!0;break t}catch{}Q=!1}Q||(A=null)}}else x=="mouseover"?A=m.fromElement:x=="mouseout"&&(A=m.toElement);this.relatedTarget=A,k?(this.clientX=k.clientX!==void 0?k.clientX:k.pageX,this.clientY=k.clientY!==void 0?k.clientY:k.pageY,this.screenX=k.screenX||0,this.screenY=k.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=typeof m.pointerType=="string"?m.pointerType:Et[m.pointerType]||"",this.state=m.state,this.i=m,m.defaultPrevented&&Tt.aa.h.call(this)}}S(Tt,st);var Et={2:"touch",3:"pen",4:"mouse"};Tt.prototype.h=function(){Tt.aa.h.call(this);var m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var Yt="closure_listenable_"+(1e6*Math.random()|0),Ut=0;function Ge(m,A,x,k,Q){this.listener=m,this.proxy=null,this.src=A,this.type=x,this.capture=!!k,this.ha=Q,this.key=++Ut,this.da=this.fa=!1}function dn(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function gn(m){this.src=m,this.g={},this.h=0}gn.prototype.add=function(m,A,x,k,Q){var nt=m.toString();m=this.g[nt],m||(m=this.g[nt]=[],this.h++);var yt=mn(m,A,k,Q);return-1<yt?(A=m[yt],x||(A.fa=!1)):(A=new Ge(A,this.src,nt,!!k,Q),A.fa=x,m.push(A)),A};function ss(m,A){var x=A.type;if(x in m.g){var k=m.g[x],Q=Array.prototype.indexOf.call(k,A,void 0),nt;(nt=0<=Q)&&Array.prototype.splice.call(k,Q,1),nt&&(dn(A),m.g[x].length==0&&(delete m.g[x],m.h--))}}function mn(m,A,x,k){for(var Q=0;Q<m.length;++Q){var nt=m[Q];if(!nt.da&&nt.listener==A&&nt.capture==!!x&&nt.ha==k)return Q}return-1}var pn="closure_lm_"+(1e6*Math.random()|0),Ca={};function Kt(m,A,x,k,Q){if(Array.isArray(A)){for(var nt=0;nt<A.length;nt++)Kt(m,A[nt],x,k,Q);return null}return x=Pr(x),m&&m[Yt]?m.K(A,x,h(k)?!!k.capture:!1,Q):le(m,A,x,!1,k,Q)}function le(m,A,x,k,Q,nt){if(!A)throw Error("Invalid event type");var yt=h(Q)?!!Q.capture:!!Q,Qt=rs(m);if(Qt||(m[pn]=Qt=new gn(m)),x=Qt.add(A,x,k,yt,nt),x.proxy)return x;if(k=pi(),x.proxy=k,k.src=m,k.listener=x,m.addEventListener)mt||(Q=yt),Q===void 0&&(Q=!1),m.addEventListener(A.toString(),k,Q);else if(m.attachEvent)m.attachEvent(Li(A.toString()),k);else if(m.addListener&&m.removeListener)m.addListener(k);else throw Error("addEventListener and attachEvent are unavailable.");return x}function pi(){function m(x){return A.call(m.src,m.listener,x)}const A=yn;return m}function ki(m,A,x,k,Q){if(Array.isArray(A))for(var nt=0;nt<A.length;nt++)ki(m,A[nt],x,k,Q);else k=h(k)?!!k.capture:!!k,x=Pr(x),m&&m[Yt]?(m=m.i,A=String(A).toString(),A in m.g&&(nt=m.g[A],x=mn(nt,x,k,Q),-1<x&&(dn(nt[x]),Array.prototype.splice.call(nt,x,1),nt.length==0&&(delete m.g[A],m.h--)))):m&&(m=rs(m))&&(A=m.g[A.toString()],m=-1,A&&(m=mn(A,x,k,Q)),(x=-1<m?A[m]:null)&&Ze(x))}function Ze(m){if(typeof m!="number"&&m&&!m.da){var A=m.src;if(A&&A[Yt])ss(A.i,m);else{var x=m.type,k=m.proxy;A.removeEventListener?A.removeEventListener(x,k,m.capture):A.detachEvent?A.detachEvent(Li(x),k):A.addListener&&A.removeListener&&A.removeListener(k),(x=rs(A))?(ss(x,m),x.h==0&&(x.src=null,A[pn]=null)):dn(m)}}}function Li(m){return m in Ca?Ca[m]:Ca[m]="on"+m}function yn(m,A){if(m.da)m=!0;else{A=new Tt(A,this);var x=m.listener,k=m.ha||m.src;m.fa&&Ze(m),m=x.call(k,A)}return m}function rs(m){return m=m[pn],m instanceof gn?m:null}var Ln="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pr(m){return typeof m=="function"?m:(m[Ln]||(m[Ln]=function(A){return m.handleEvent(A)}),m[Ln])}function fe(){at.call(this),this.i=new gn(this),this.M=this,this.F=null}S(fe,at),fe.prototype[Yt]=!0,fe.prototype.removeEventListener=function(m,A,x,k){ki(this,m,A,x,k)};function te(m,A){var x,k=m.F;if(k)for(x=[];k;k=k.F)x.push(k);if(m=m.M,k=A.type||A,typeof A=="string")A=new st(A,m);else if(A instanceof st)A.target=A.target||m;else{var Q=A;A=new st(k,m),C(A,Q)}if(Q=!0,x)for(var nt=x.length-1;0<=nt;nt--){var yt=A.g=x[nt];Q=_i(yt,k,!0,A)&&Q}if(yt=A.g=m,Q=_i(yt,k,!0,A)&&Q,Q=_i(yt,k,!1,A)&&Q,x)for(nt=0;nt<x.length;nt++)yt=A.g=x[nt],Q=_i(yt,k,!1,A)&&Q}fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var m=this.i,A;for(A in m.g){for(var x=m.g[A],k=0;k<x.length;k++)dn(x[k]);delete m.g[A],m.h--}}this.F=null},fe.prototype.K=function(m,A,x,k){return this.i.add(String(m),A,!1,x,k)},fe.prototype.L=function(m,A,x,k){return this.i.add(String(m),A,!0,x,k)};function _i(m,A,x,k){if(A=m.i.g[String(A)],!A)return!0;A=A.concat();for(var Q=!0,nt=0;nt<A.length;++nt){var yt=A[nt];if(yt&&!yt.da&&yt.capture==x){var Qt=yt.listener,Ke=yt.ha||yt.src;yt.fa&&ss(m.i,yt),Q=Qt.call(Ke,k)!==!1&&Q}}return Q&&!k.defaultPrevented}function $e(m,A,x){if(typeof m=="function")x&&(m=E(m,x));else if(m&&typeof m.handleEvent=="function")m=E(m.handleEvent,m);else throw Error("Invalid listener argument");return 2147483647<Number(A)?-1:c.setTimeout(m,A||0)}function Mr(m){m.g=$e(()=>{m.g=null,m.i&&(m.i=!1,Mr(m))},m.l);const A=m.h;m.h=null,m.m.apply(null,A)}class as extends at{constructor(A,x){super(),this.m=A,this.l=x,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Mr(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kr(m){at.call(this),this.h=m,this.g={}}S(kr,at);var Nr=[];function Fr(m){q(m.g,function(A,x){this.g.hasOwnProperty(x)&&Ze(A)},m),m.g={}}kr.prototype.N=function(){kr.aa.N.call(this),Fr(this)},kr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var En=c.JSON.stringify,wa=c.JSON.parse,Ur=class{stringify(m){return c.JSON.stringify(m,void 0)}parse(m){return c.JSON.parse(m,void 0)}};function Zo(){}Zo.prototype.h=null;function Jo(m){return m.h||(m.h=m.i())}function tl(){}var os={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ls(){st.call(this,"d")}S(ls,st);function el(){st.call(this,"c")}S(el,st);var Dn={},il=null;function Gs(){return il=il||new fe}Dn.La="serverreachability";function Oa(m){st.call(this,Dn.La,m)}S(Oa,st);function $s(m){const A=Gs();te(A,new Oa(A))}Dn.STAT_EVENT="statevent";function Ku(m,A){st.call(this,Dn.STAT_EVENT,m),this.stat=A}S(Ku,st);function Ae(m){const A=Gs();te(A,new Ku(A,m))}Dn.Ma="timingevent";function He(m,A){st.call(this,Dn.Ma,m),this.size=A}S(He,st);function Me(m,A){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){m()},A)}function ji(){this.g=!0}ji.prototype.xa=function(){this.g=!1};function nl(m,A,x,k,Q,nt){m.info(function(){if(m.g)if(nt)for(var yt="",Qt=nt.split("&"),Ke=0;Ke<Qt.length;Ke++){var Xt=Qt[Ke].split("=");if(1<Xt.length){var ti=Xt[0];Xt=Xt[1];var ze=ti.split("_");yt=2<=ze.length&&ze[1]=="type"?yt+(ti+"="+Xt+"&"):yt+(ti+"=redacted&")}}else yt=null;else yt=nt;return"XMLHTTP REQ ("+k+") [attempt "+Q+"]: "+A+`
`+x+`
`+yt})}function Pf(m,A,x,k,Q,nt,yt){m.info(function(){return"XMLHTTP RESP ("+k+") [ attempt "+Q+"]: "+A+`
`+x+`
`+nt+" "+yt})}function Hs(m,A,x,k){m.info(function(){return"XMLHTTP TEXT ("+A+"): "+Br(m,x)+(k?" "+k:"")})}function zu(m,A){m.info(function(){return"TIMEOUT: "+A})}ji.prototype.info=function(){};function Br(m,A){if(!m.g)return A;if(!A)return null;try{var x=JSON.parse(A);if(x){for(m=0;m<x.length;m++)if(Array.isArray(x[m])){var k=x[m];if(!(2>k.length)){var Q=k[1];if(Array.isArray(Q)&&!(1>Q.length)){var nt=Q[0];if(nt!="noop"&&nt!="stop"&&nt!="close")for(var yt=1;yt<Q.length;yt++)Q[yt]=""}}}}return En(x)}catch{return A}}var Ks={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},us={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Cn;function wn(){}S(wn,Zo),wn.prototype.g=function(){return new XMLHttpRequest},wn.prototype.i=function(){return{}},Cn=new wn;function Ri(m,A,x,k){this.j=m,this.i=A,this.l=x,this.R=k||1,this.U=new kr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ce}function Ce(){this.i=null,this.g="",this.h=!1}var sl={},Pa={};function vn(m,A,x){m.L=1,m.v=Kr(Ni(A)),m.m=x,m.P=!0,cs(m,null)}function cs(m,A){m.F=Date.now(),Vr(m),m.A=Ni(m.v);var x=m.A,k=m.R;Array.isArray(k)||(k=[String(k)]),cl(x.i,"t",k),m.C=0,x=m.j.J,m.h=new Ce,m.g=oc(m.j,x?A:null,!m.m),0<m.O&&(m.M=new as(E(m.Y,m,m.g),m.O)),A=m.U,x=m.g,k=m.ca;var Q="readystatechange";Array.isArray(Q)||(Q&&(Nr[0]=Q.toString()),Q=Nr);for(var nt=0;nt<Q.length;nt++){var yt=Kt(x,Q[nt],k||A.handleEvent,!1,A.h||A);if(!yt)break;A.g[yt.key]=yt}A=m.H?L(m.H):{},m.m?(m.u||(m.u="POST"),A["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.A,m.u,m.m,A)):(m.u="GET",m.g.ea(m.A,m.u,null,A)),$s(),nl(m.i,m.u,m.A,m.l,m.R,m.m)}Ri.prototype.ca=function(m){m=m.target;const A=this.M;A&&Wi(m)==3?A.j():this.Y(m)},Ri.prototype.Y=function(m){try{if(m==this.g)t:{const ze=Wi(this.g);var A=this.g.Ba();const Es=this.g.Z();if(!(3>ze)&&(ze!=3||this.g&&(this.h.h||this.g.oa()||Ju(this.g)))){this.J||ze!=4||A==7||(A==8||0>=Es?$s(3):$s(2)),zs(this);var x=this.g.Z();this.X=x;e:if(qu(this)){var k=Ju(this.g);m="";var Q=k.length,nt=Wi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){oi(this),On(this);var yt="";break e}this.h.i=new c.TextDecoder}for(A=0;A<Q;A++)this.h.h=!0,m+=this.h.i.decode(k[A],{stream:!(nt&&A==Q-1)});k.length=0,this.h.g+=m,this.C=0,yt=this.h.g}else yt=this.g.oa();if(this.o=x==200,Pf(this.i,this.u,this.A,this.l,this.R,ze,x),this.o){if(this.T&&!this.K){e:{if(this.g){var Qt,Ke=this.g;if((Qt=Ke.g?Ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(Qt)){var Xt=Qt;break e}}Xt=null}if(x=Xt)Hs(this.i,this.l,x,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Gr(this,x);else{this.o=!1,this.s=3,Ae(12),oi(this),On(this);break t}}if(this.P){x=!0;let li;for(;!this.J&&this.C<yt.length;)if(li=ju(this,yt),li==Pa){ze==4&&(this.s=4,Ae(14),x=!1),Hs(this.i,this.l,null,"[Incomplete Response]");break}else if(li==sl){this.s=4,Ae(15),Hs(this.i,this.l,yt,"[Invalid Chunk]"),x=!1;break}else Hs(this.i,this.l,li,null),Gr(this,li);if(qu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ze!=4||yt.length!=0||this.h.h||(this.s=1,Ae(16),x=!1),this.o=this.o&&x,!x)Hs(this.i,this.l,yt,"[Invalid Chunked Response]"),oi(this),On(this);else if(0<yt.length&&!this.W){this.W=!0;var ti=this.j;ti.g==this&&ti.ba&&!ti.M&&(ti.j.info("Great, no buffering proxy detected. Bytes received: "+yt.length),Zr(ti),ti.M=!0,Ae(11))}}else Hs(this.i,this.l,yt,null),Gr(this,yt);ze==4&&oi(this),this.o&&!this.J&&(ze==4?sc(this.j,this):(this.o=!1,Vr(this)))}else Uf(this.g),x==400&&0<yt.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),oi(this),On(this)}}}catch{}finally{}};function qu(m){return m.g?m.u=="GET"&&m.L!=2&&m.j.Ca:!1}function ju(m,A){var x=m.C,k=A.indexOf(`
`,x);return k==-1?Pa:(x=Number(A.substring(x,k)),isNaN(x)?sl:(k+=1,k+x>A.length?Pa:(A=A.slice(k,k+x),m.C=k+x,A)))}Ri.prototype.cancel=function(){this.J=!0,oi(this)};function Vr(m){m.S=Date.now()+m.I,Yu(m,m.I)}function Yu(m,A){if(m.B!=null)throw Error("WatchDog timer not null");m.B=Me(E(m.ba,m),A)}function zs(m){m.B&&(c.clearTimeout(m.B),m.B=null)}Ri.prototype.ba=function(){this.B=null;const m=Date.now();0<=m-this.S?(zu(this.i,this.A),this.L!=2&&($s(),Ae(17)),oi(this),this.s=2,On(this)):Yu(this,this.S-m)};function On(m){m.j.G==0||m.J||sc(m.j,m)}function oi(m){zs(m);var A=m.M;A&&typeof A.ma=="function"&&A.ma(),m.M=null,Fr(m.U),m.g&&(A=m.g,m.g=null,A.abort(),A.ma())}function Gr(m,A){try{var x=m.j;if(x.G!=0&&(x.g==m||rl(x.h,m))){if(!m.K&&rl(x.h,m)&&x.G==3){try{var k=x.Da.g.parse(A)}catch{k=null}if(Array.isArray(k)&&k.length==3){var Q=k;if(Q[0]==0){t:if(!x.u){if(x.g)if(x.g.F+3e3<m.F)za(x),Ha(x);else break t;ml(x),Ae(18)}}else x.za=Q[1],0<x.za-x.T&&37500>Q[2]&&x.F&&x.v==0&&!x.C&&(x.C=Me(E(x.Za,x),6e3));if(1>=ka(x.h)&&x.ca){try{x.ca()}catch{}x.ca=void 0}}else ys(x,11)}else if((m.K||x.g==m)&&za(x),!N(A))for(Q=x.Da.g.parse(A),A=0;A<Q.length;A++){let Xt=Q[A];if(x.T=Xt[0],Xt=Xt[1],x.G==2)if(Xt[0]=="c"){x.K=Xt[1],x.ia=Xt[2];const ti=Xt[3];ti!=null&&(x.la=ti,x.j.info("VER="+x.la));const ze=Xt[4];ze!=null&&(x.Aa=ze,x.j.info("SVER="+x.Aa));const Es=Xt[5];Es!=null&&typeof Es=="number"&&0<Es&&(k=1.5*Es,x.L=k,x.j.info("backChannelRequestTimeoutMs_="+k)),k=x;const li=m.g;if(li){const Bn=li.g?li.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bn){var nt=k.h;nt.g||Bn.indexOf("spdy")==-1&&Bn.indexOf("quic")==-1&&Bn.indexOf("h2")==-1||(nt.j=nt.l,nt.g=new Set,nt.h&&(Na(nt,nt.h),nt.h=null))}if(k.D){const yl=li.g?li.g.getResponseHeader("X-HTTP-Session-Id"):null;yl&&(k.ya=yl,de(k.I,k.D,yl))}}x.G=3,x.l&&x.l.ua(),x.ba&&(x.R=Date.now()-m.F,x.j.info("Handshake RTT: "+x.R+"ms")),k=x;var yt=m;if(k.qa=ac(k,k.J?k.ia:null,k.W),yt.K){bi(k.h,yt);var Qt=yt,Ke=k.L;Ke&&(Qt.I=Ke),Qt.B&&(zs(Qt),Vr(Qt)),k.g=yt}else ic(k);0<x.i.length&&Ka(x)}else Xt[0]!="stop"&&Xt[0]!="close"||ys(x,7);else x.G==3&&(Xt[0]=="stop"||Xt[0]=="close"?Xt[0]=="stop"?ys(x,7):dl(x):Xt[0]!="noop"&&x.l&&x.l.ta(Xt),x.v=0)}}$s(4)}catch{}}var Qu=class{constructor(m,A){this.g=m,this.map=A}};function hs(m){this.l=m||10,c.PerformanceNavigationTiming?(m=c.performance.getEntriesByType("navigation"),m=0<m.length&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ma(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function ka(m){return m.h?1:m.g?m.g.size:0}function rl(m,A){return m.h?m.h==A:m.g?m.g.has(A):!1}function Na(m,A){m.g?m.g.add(A):m.h=A}function bi(m,A){m.h&&m.h==A?m.h=null:m.g&&m.g.has(A)&&m.g.delete(A)}hs.prototype.cancel=function(){if(this.i=al(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function al(m){if(m.h!=null)return m.i.concat(m.h.D);if(m.g!=null&&m.g.size!==0){let A=m.i;for(const x of m.g.values())A=A.concat(x.D);return A}return R(m.i)}function Mf(m){if(m.V&&typeof m.V=="function")return m.V();if(typeof Map<"u"&&m instanceof Map||typeof Set<"u"&&m instanceof Set)return Array.from(m.values());if(typeof m=="string")return m.split("");if(f(m)){for(var A=[],x=m.length,k=0;k<x;k++)A.push(m[k]);return A}A=[],x=0;for(k in m)A[x++]=m[k];return A}function Fa(m){if(m.na&&typeof m.na=="function")return m.na();if(!m.V||typeof m.V!="function"){if(typeof Map<"u"&&m instanceof Map)return Array.from(m.keys());if(!(typeof Set<"u"&&m instanceof Set)){if(f(m)||typeof m=="string"){var A=[];m=m.length;for(var x=0;x<m;x++)A.push(x);return A}A=[],x=0;for(const k in m)A[x++]=k;return A}}}function ol(m,A){if(m.forEach&&typeof m.forEach=="function")m.forEach(A,void 0);else if(f(m)||typeof m=="string")Array.prototype.forEach.call(m,A,void 0);else for(var x=Fa(m),k=Mf(m),Q=k.length,nt=0;nt<Q;nt++)A.call(void 0,k[nt],x&&x[nt],m)}var $r=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kf(m,A){if(m){m=m.split("&");for(var x=0;x<m.length;x++){var k=m[x].indexOf("="),Q=null;if(0<=k){var nt=m[x].substring(0,k);Q=m[x].substring(k+1)}else nt=m[x];A(nt,Q?decodeURIComponent(Q.replace(/\+/g," ")):"")}}}function ke(m){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,m instanceof ke){this.h=m.h,Hr(this,m.j),this.o=m.o,this.g=m.g,qs(this,m.s),this.l=m.l;var A=m.i,x=new ds;x.i=A.i,A.g&&(x.g=new Map(A.g),x.h=A.h),fs(this,x),this.m=m.m}else m&&(A=String(m).match($r))?(this.h=!1,Hr(this,A[1]||"",!0),this.o=Yi(A[2]||""),this.g=Yi(A[3]||"",!0),qs(this,A[4]),this.l=Yi(A[5]||"",!0),fs(this,A[6]||"",!0),this.m=Yi(A[7]||"")):(this.h=!1,this.i=new ds(null,this.h))}ke.prototype.toString=function(){var m=[],A=this.j;A&&m.push(zr(A,ll,!0),":");var x=this.g;return(x||A=="file")&&(m.push("//"),(A=this.o)&&m.push(zr(A,ll,!0),"@"),m.push(encodeURIComponent(String(x)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x=this.s,x!=null&&m.push(":",String(x))),(x=this.l)&&(this.g&&x.charAt(0)!="/"&&m.push("/"),m.push(zr(x,x.charAt(0)=="/"?Nf:ul,!0))),(x=this.i.toString())&&m.push("?",x),(x=this.m)&&m.push("#",zr(x,Ua)),m.join("")};function Ni(m){return new ke(m)}function Hr(m,A,x){m.j=x?Yi(A,!0):A,m.j&&(m.j=m.j.replace(/:$/,""))}function qs(m,A){if(A){if(A=Number(A),isNaN(A)||0>A)throw Error("Bad port number "+A);m.s=A}else m.s=null}function fs(m,A,x){A instanceof ds?(m.i=A,Wu(m.i,m.h)):(x||(A=zr(A,Ff)),m.i=new ds(A,m.h))}function de(m,A,x){m.i.set(A,x)}function Kr(m){return de(m,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),m}function Yi(m,A){return m?A?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function zr(m,A,x){return typeof m=="string"?(m=encodeURI(m).replace(A,Xu),x&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Xu(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var ll=/[#\/\?@]/g,ul=/[#\?:]/g,Nf=/[#\?]/g,Ff=/[#\?@]/g,Ua=/#/g;function ds(m,A){this.h=this.g=null,this.i=m||null,this.j=!!A}function Qi(m){m.g||(m.g=new Map,m.h=0,m.i&&kf(m.i,function(A,x){m.add(decodeURIComponent(A.replace(/\+/g," ")),x)}))}r=ds.prototype,r.add=function(m,A){Qi(this),this.i=null,m=Pn(this,m);var x=this.g.get(m);return x||this.g.set(m,x=[]),x.push(A),this.h+=1,this};function gs(m,A){Qi(m),A=Pn(m,A),m.g.has(A)&&(m.i=null,m.h-=m.g.get(A).length,m.g.delete(A))}function ms(m,A){return Qi(m),A=Pn(m,A),m.g.has(A)}r.forEach=function(m,A){Qi(this),this.g.forEach(function(x,k){x.forEach(function(Q){m.call(A,Q,k,this)},this)},this)},r.na=function(){Qi(this);const m=Array.from(this.g.values()),A=Array.from(this.g.keys()),x=[];for(let k=0;k<A.length;k++){const Q=m[k];for(let nt=0;nt<Q.length;nt++)x.push(A[k])}return x},r.V=function(m){Qi(this);let A=[];if(typeof m=="string")ms(this,m)&&(A=A.concat(this.g.get(Pn(this,m))));else{m=Array.from(this.g.values());for(let x=0;x<m.length;x++)A=A.concat(m[x])}return A},r.set=function(m,A){return Qi(this),this.i=null,m=Pn(this,m),ms(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[A]),this.h+=1,this},r.get=function(m,A){return m?(m=this.V(m),0<m.length?String(m[0]):A):A};function cl(m,A,x){gs(m,A),0<x.length&&(m.i=null,m.g.set(Pn(m,A),R(x)),m.h+=x.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],A=Array.from(this.g.keys());for(var x=0;x<A.length;x++){var k=A[x];const nt=encodeURIComponent(String(k)),yt=this.V(k);for(k=0;k<yt.length;k++){var Q=nt;yt[k]!==""&&(Q+="="+encodeURIComponent(String(yt[k]))),m.push(Q)}}return this.i=m.join("&")};function Pn(m,A){return A=String(A),m.j&&(A=A.toLowerCase()),A}function Wu(m,A){A&&!m.j&&(Qi(m),m.i=null,m.g.forEach(function(x,k){var Q=k.toLowerCase();k!=Q&&(gs(this,k),cl(this,Q,x))},m)),m.j=A}function qr(m,A){const x=new ji;if(c.Image){const k=new Image;k.onload=T(Xi,x,"TestLoadImage: loaded",!0,A,k),k.onerror=T(Xi,x,"TestLoadImage: error",!1,A,k),k.onabort=T(Xi,x,"TestLoadImage: abort",!1,A,k),k.ontimeout=T(Xi,x,"TestLoadImage: timeout",!1,A,k),c.setTimeout(function(){k.ontimeout&&k.ontimeout()},1e4),k.src=m}else A(!1)}function Tn(m,A){const x=new ji,k=new AbortController,Q=setTimeout(()=>{k.abort(),Xi(x,"TestPingServer: timeout",!1,A)},1e4);fetch(m,{signal:k.signal}).then(nt=>{clearTimeout(Q),nt.ok?Xi(x,"TestPingServer: ok",!0,A):Xi(x,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(Q),Xi(x,"TestPingServer: error",!1,A)})}function Xi(m,A,x,k,Q){try{Q&&(Q.onload=null,Q.onerror=null,Q.onabort=null,Q.ontimeout=null),k(x)}catch{}}function jr(){this.g=new Ur}function Mn(m,A,x){const k=x||"";try{ol(m,function(Q,nt){let yt=Q;h(Q)&&(yt=En(Q)),A.push(k+nt+"="+encodeURIComponent(yt))})}catch(Q){throw A.push(k+"type="+encodeURIComponent("_badmap")),Q}}function js(m){this.l=m.Ub||null,this.j=m.eb||!1}S(js,Zo),js.prototype.g=function(){return new ps(this.l,this.j)},js.prototype.i=function(m){return function(){return m}}({});function ps(m,A){fe.call(this),this.D=m,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(ps,fe),r=ps.prototype,r.open=function(m,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=m,this.A=A,this.readyState=1,Nn(this)},r.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const A={headers:this.u,method:this.B,credentials:this.m,cache:void 0};m&&(A.body=m),(this.D||c).fetch(new Request(this.A,A)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,kn(this)),this.readyState=0},r.Sa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,Nn(this)),this.g&&(this.readyState=3,Nn(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;hl(this)}else m.text().then(this.Ra.bind(this),this.ga.bind(this))};function hl(m){m.j.read().then(m.Pa.bind(m)).catch(m.ga.bind(m))}r.Pa=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var A=m.value?m.value:new Uint8Array(0);(A=this.v.decode(A,{stream:!m.done}))&&(this.response=this.responseText+=A)}m.done?kn(this):Nn(this),this.readyState==3&&hl(this)}},r.Ra=function(m){this.g&&(this.response=this.responseText=m,kn(this))},r.Qa=function(m){this.g&&(this.response=m,kn(this))},r.ga=function(){this.g&&kn(this)};function kn(m){m.readyState=4,m.l=null,m.j=null,m.v=null,Nn(m)}r.setRequestHeader=function(m,A){this.u.append(m,A)},r.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],A=this.h.entries();for(var x=A.next();!x.done;)x=x.value,m.push(x[0]+": "+x[1]),x=A.next();return m.join(`\r
`)};function Nn(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(ps.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function fl(m){let A="";return q(m,function(x,k){A+=k,A+=":",A+=x,A+=`\r
`}),A}function Je(m,A,x){t:{for(k in x){var k=!1;break t}k=!0}k||(x=fl(x),typeof m=="string"?x!=null&&encodeURIComponent(String(x)):de(m,A,x))}function se(m){fe.call(this),this.headers=new Map,this.o=m||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(se,fe);var Ba=/^https?$/i,Yr=["POST","PUT"];r=se.prototype,r.Ha=function(m){this.J=m},r.ea=function(m,A,x,k){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);A=A?A.toUpperCase():"GET",this.D=m,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Cn.g(),this.v=this.o?Jo(this.o):Jo(Cn),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(A,String(m),!0),this.B=!1}catch(nt){Zu(this,nt);return}if(m=x||"",x=new Map(this.headers),k)if(Object.getPrototypeOf(k)===Object.prototype)for(var Q in k)x.set(Q,k[Q]);else if(typeof k.keys=="function"&&typeof k.get=="function")for(const nt of k.keys())x.set(nt,k.get(nt));else throw Error("Unknown input type for opt_headers: "+String(k));k=Array.from(x.keys()).find(nt=>nt.toLowerCase()=="content-type"),Q=c.FormData&&m instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Yr,A,void 0))||k||Q||x.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[nt,yt]of x)this.g.setRequestHeader(nt,yt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Qr(this),this.u=!0,this.g.send(m),this.u=!1}catch(nt){Zu(this,nt)}};function Zu(m,A){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=A,m.m=5,Va(m),Fn(m)}function Va(m){m.A||(m.A=!0,te(m,"complete"),te(m,"error"))}r.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=m||7,te(this,"complete"),te(this,"abort"),Fn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Fn(this,!0)),se.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ga(this):this.bb())},r.bb=function(){Ga(this)};function Ga(m){if(m.h&&typeof l<"u"&&(!m.v[1]||Wi(m)!=4||m.Z()!=2)){if(m.u&&Wi(m)==4)$e(m.Ea,0,m);else if(te(m,"readystatechange"),Wi(m)==4){m.h=!1;try{const yt=m.Z();t:switch(yt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break t;default:A=!1}var x;if(!(x=A)){var k;if(k=yt===0){var Q=String(m.D).match($r)[1]||null;!Q&&c.self&&c.self.location&&(Q=c.self.location.protocol.slice(0,-1)),k=!Ba.test(Q?Q.toLowerCase():"")}x=k}if(x)te(m,"complete"),te(m,"success");else{m.m=6;try{var nt=2<Wi(m)?m.g.statusText:""}catch{nt=""}m.l=nt+" ["+m.Z()+"]",Va(m)}}finally{Fn(m)}}}}function Fn(m,A){if(m.g){Qr(m);const x=m.g,k=m.v[0]?()=>{}:null;m.g=null,m.v=null,A||te(m,"ready");try{x.onreadystatechange=k}catch{}}}function Qr(m){m.I&&(c.clearTimeout(m.I),m.I=null)}r.isActive=function(){return!!this.g};function Wi(m){return m.g?m.g.readyState:0}r.Z=function(){try{return 2<Wi(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(m){if(this.g){var A=this.g.responseText;return m&&A.indexOf(m)==0&&(A=A.substring(m.length)),wa(A)}};function Ju(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.H){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Uf(m){const A={};m=(m.g&&2<=Wi(m)&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let k=0;k<m.length;k++){if(N(m[k]))continue;var x=U(m[k]);const Q=x[0];if(x=x[1],typeof x!="string")continue;x=x.trim();const nt=A[Q]||[];A[Q]=nt,nt.push(x)}w(A,function(k){return k.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xr(m,A,x){return x&&x.internalChannelParams&&x.internalChannelParams[m]||A}function $a(m){this.Aa=0,this.i=[],this.j=new ji,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xr("failFast",!1,m),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xr("baseRetryDelayMs",5e3,m),this.cb=Xr("retryDelaySeedMs",1e4,m),this.Wa=Xr("forwardChannelMaxRetries",2,m),this.wa=Xr("forwardChannelRequestTimeoutMs",2e4,m),this.pa=m&&m.xmlHttpFactory||void 0,this.Xa=m&&m.Tb||void 0,this.Ca=m&&m.useFetchStreams||!1,this.L=void 0,this.J=m&&m.supportsCrossDomainXhr||!1,this.K="",this.h=new hs(m&&m.concurrentRequestLimit),this.Da=new jr,this.P=m&&m.fastHandshake||!1,this.O=m&&m.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=m&&m.Rb||!1,m&&m.xa&&this.j.xa(),m&&m.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&m&&m.detectBufferingProxy||!1,this.ja=void 0,m&&m.longPollingTimeout&&0<m.longPollingTimeout&&(this.ja=m.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=$a.prototype,r.la=8,r.G=1,r.connect=function(m,A,x,k){Ae(0),this.W=m,this.H=A||{},x&&k!==void 0&&(this.H.OSID=x,this.H.OAID=k),this.F=this.X,this.I=ac(this,null,this.W),Ka(this)};function dl(m){if(tc(m),m.G==3){var A=m.U++,x=Ni(m.I);if(de(x,"SID",m.K),de(x,"RID",A),de(x,"TYPE","terminate"),Wr(m,x),A=new Ri(m,m.j,A),A.L=2,A.v=Kr(Ni(x)),x=!1,c.navigator&&c.navigator.sendBeacon)try{x=c.navigator.sendBeacon(A.v.toString(),"")}catch{}!x&&c.Image&&(new Image().src=A.v,x=!0),x||(A.g=oc(A.j,null),A.g.ea(A.v)),A.F=Date.now(),Vr(A)}rc(m)}function Ha(m){m.g&&(Zr(m),m.g.cancel(),m.g=null)}function tc(m){Ha(m),m.u&&(c.clearTimeout(m.u),m.u=null),za(m),m.h.cancel(),m.s&&(typeof m.s=="number"&&c.clearTimeout(m.s),m.s=null)}function Ka(m){if(!Ma(m.h)&&!m.s){m.s=!0;var A=m.Ga;it||F(),ct||(it(),ct=!0),rt.add(A,m),m.B=0}}function Bf(m,A){return ka(m.h)>=m.h.j-(m.s?1:0)?!1:m.s?(m.i=A.D.concat(m.i),!0):m.G==1||m.G==2||m.B>=(m.Va?0:m.Wa)?!1:(m.s=Me(E(m.Ga,m,A),pl(m,m.B)),m.B++,!0)}r.Ga=function(m){if(this.s)if(this.s=null,this.G==1){if(!m){this.U=Math.floor(1e5*Math.random()),m=this.U++;const Q=new Ri(this,this.j,m);let nt=this.o;if(this.S&&(nt?(nt=L(nt),C(nt,this.S)):nt=this.S),this.m!==null||this.O||(Q.H=nt,nt=null),this.P)t:{for(var A=0,x=0;x<this.i.length;x++){e:{var k=this.i[x];if("__data__"in k.map&&(k=k.map.__data__,typeof k=="string")){k=k.length;break e}k=void 0}if(k===void 0)break;if(A+=k,4096<A){A=x;break t}if(A===4096||x===this.i.length-1){A=x+1;break t}}A=1e3}else A=1e3;A=ec(this,Q,A),x=Ni(this.I),de(x,"RID",m),de(x,"CVER",22),this.D&&de(x,"X-HTTP-Session-Id",this.D),Wr(this,x),nt&&(this.O?A="headers="+encodeURIComponent(String(fl(nt)))+"&"+A:this.m&&Je(x,this.m,nt)),Na(this.h,Q),this.Ua&&de(x,"TYPE","init"),this.P?(de(x,"$req",A),de(x,"SID","null"),Q.T=!0,vn(Q,x,null)):vn(Q,x,A),this.G=2}}else this.G==3&&(m?gl(this,m):this.i.length==0||Ma(this.h)||gl(this))};function gl(m,A){var x;A?x=A.l:x=m.U++;const k=Ni(m.I);de(k,"SID",m.K),de(k,"RID",x),de(k,"AID",m.T),Wr(m,k),m.m&&m.o&&Je(k,m.m,m.o),x=new Ri(m,m.j,x,m.B+1),m.m===null&&(x.H=m.o),A&&(m.i=A.D.concat(m.i)),A=ec(m,x,1e3),x.I=Math.round(.5*m.wa)+Math.round(.5*m.wa*Math.random()),Na(m.h,x),vn(x,k,A)}function Wr(m,A){m.H&&q(m.H,function(x,k){de(A,k,x)}),m.l&&ol({},function(x,k){de(A,k,x)})}function ec(m,A,x){x=Math.min(m.i.length,x);var k=m.l?E(m.l.Na,m.l,m):null;t:{var Q=m.i;let nt=-1;for(;;){const yt=["count="+x];nt==-1?0<x?(nt=Q[0].g,yt.push("ofs="+nt)):nt=0:yt.push("ofs="+nt);let Qt=!0;for(let Ke=0;Ke<x;Ke++){let Xt=Q[Ke].g;const ti=Q[Ke].map;if(Xt-=nt,0>Xt)nt=Math.max(0,Q[Ke].g-100),Qt=!1;else try{Mn(ti,yt,"req"+Xt+"_")}catch{k&&k(ti)}}if(Qt){k=yt.join("&");break t}}}return m=m.i.splice(0,x),A.D=m,k}function ic(m){if(!m.g&&!m.u){m.Y=1;var A=m.Fa;it||F(),ct||(it(),ct=!0),rt.add(A,m),m.v=0}}function ml(m){return m.g||m.u||3<=m.v?!1:(m.Y++,m.u=Me(E(m.Fa,m),pl(m,m.v)),m.v++,!0)}r.Fa=function(){if(this.u=null,nc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var m=2*this.R;this.j.info("BP detection timer enabled: "+m),this.A=Me(E(this.ab,this),m)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Ha(this),nc(this))};function Zr(m){m.A!=null&&(c.clearTimeout(m.A),m.A=null)}function nc(m){m.g=new Ri(m,m.j,"rpc",m.Y),m.m===null&&(m.g.H=m.o),m.g.O=0;var A=Ni(m.qa);de(A,"RID","rpc"),de(A,"SID",m.K),de(A,"AID",m.T),de(A,"CI",m.F?"0":"1"),!m.F&&m.ja&&de(A,"TO",m.ja),de(A,"TYPE","xmlhttp"),Wr(m,A),m.m&&m.o&&Je(A,m.m,m.o),m.L&&(m.g.I=m.L);var x=m.g;m=m.ia,x.L=1,x.v=Kr(Ni(A)),x.m=null,x.P=!0,cs(x,m)}r.Za=function(){this.C!=null&&(this.C=null,Ha(this),ml(this),Ae(19))};function za(m){m.C!=null&&(c.clearTimeout(m.C),m.C=null)}function sc(m,A){var x=null;if(m.g==A){za(m),Zr(m),m.g=null;var k=2}else if(rl(m.h,A))x=A.D,bi(m.h,A),k=1;else return;if(m.G!=0){if(A.o)if(k==1){x=A.m?A.m.length:0,A=Date.now()-A.F;var Q=m.B;k=Gs(),te(k,new He(k,x)),Ka(m)}else ic(m);else if(Q=A.s,Q==3||Q==0&&0<A.X||!(k==1&&Bf(m,A)||k==2&&ml(m)))switch(x&&0<x.length&&(A=m.h,A.i=A.i.concat(x)),Q){case 1:ys(m,5);break;case 4:ys(m,10);break;case 3:ys(m,6);break;default:ys(m,2)}}}function pl(m,A){let x=m.Ta+Math.floor(Math.random()*m.cb);return m.isActive()||(x*=2),x*A}function ys(m,A){if(m.j.info("Error code "+A),A==2){var x=E(m.fb,m),k=m.Xa;const Q=!k;k=new ke(k||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Hr(k,"https"),Kr(k),Q?qr(k.toString(),x):Tn(k.toString(),x)}else Ae(2);m.G=0,m.l&&m.l.sa(A),rc(m),tc(m)}r.fb=function(m){m?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))};function rc(m){if(m.G=0,m.ka=[],m.l){const A=al(m.h);(A.length!=0||m.i.length!=0)&&(_(m.ka,A),_(m.ka,m.i),m.h.i.length=0,R(m.i),m.i.length=0),m.l.ra()}}function ac(m,A,x){var k=x instanceof ke?Ni(x):new ke(x);if(k.g!="")A&&(k.g=A+"."+k.g),qs(k,k.s);else{var Q=c.location;k=Q.protocol,A=A?A+"."+Q.hostname:Q.hostname,Q=+Q.port;var nt=new ke(null);k&&Hr(nt,k),A&&(nt.g=A),Q&&qs(nt,Q),x&&(nt.l=x),k=nt}return x=m.D,A=m.ya,x&&A&&de(k,x,A),de(k,"VER",m.la),Wr(m,k),k}function oc(m,A,x){if(A&&!m.J)throw Error("Can't create secondary domain capable XhrIo object.");return A=m.Ca&&!m.pa?new se(new js({eb:x})):new se(m.pa),A.Ha(m.J),A}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function lc(){}r=lc.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function qa(){}qa.prototype.g=function(m,A){return new xi(m,A)};function xi(m,A){fe.call(this),this.g=new $a(A),this.l=m,this.h=A&&A.messageUrlParams||null,m=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(m?m["X-WebChannel-Content-Type"]=A.messageContentType:m={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.va&&(m?m["X-WebChannel-Client-Profile"]=A.va:m={"X-WebChannel-Client-Profile":A.va}),this.g.S=m,(m=A&&A.Sb)&&!N(m)&&(this.g.m=m),this.v=A&&A.supportsCrossDomainXhr||!1,this.u=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!N(A)&&(this.g.D=A,m=this.h,m!==null&&A in m&&(m=this.h,A in m&&delete m[A])),this.j=new Un(this)}S(xi,fe),xi.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},xi.prototype.close=function(){dl(this.g)},xi.prototype.o=function(m){var A=this.g;if(typeof m=="string"){var x={};x.__data__=m,m=x}else this.u&&(x={},x.__data__=En(m),m=x);A.i.push(new Qu(A.Ya++,m)),A.G==3&&Ka(A)},xi.prototype.N=function(){this.g.l=null,delete this.j,dl(this.g),delete this.g,xi.aa.N.call(this)};function uc(m){ls.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var A=m.__sm__;if(A){t:{for(const x in A){m=x;break t}m=void 0}(this.i=m)&&(m=this.i,A=A!==null&&m in A?A[m]:void 0),this.data=A}else this.data=m}S(uc,ls);function cc(){el.call(this),this.status=1}S(cc,el);function Un(m){this.g=m}S(Un,lc),Un.prototype.ua=function(){te(this.g,"a")},Un.prototype.ta=function(m){te(this.g,new uc(m))},Un.prototype.sa=function(m){te(this.g,new cc)},Un.prototype.ra=function(){te(this.g,"b")},qa.prototype.createWebChannel=qa.prototype.g,xi.prototype.send=xi.prototype.o,xi.prototype.open=xi.prototype.m,xi.prototype.close=xi.prototype.close,B_=function(){return new qa},U_=function(){return Gs()},F_=Dn,Nm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ks.NO_ERROR=0,Ks.TIMEOUT=8,Ks.HTTP_ERROR=6,Bh=Ks,us.COMPLETE="complete",N_=us,tl.EventType=os,os.OPEN="a",os.CLOSE="b",os.ERROR="c",os.MESSAGE="d",fe.prototype.listen=fe.prototype.K,lu=tl,se.prototype.listenOnce=se.prototype.L,se.prototype.getLastError=se.prototype.Ka,se.prototype.getLastErrorCode=se.prototype.Ba,se.prototype.getStatus=se.prototype.Z,se.prototype.getResponseJson=se.prototype.Oa,se.prototype.getResponseText=se.prototype.oa,se.prototype.send=se.prototype.ea,se.prototype.setWithCredentials=se.prototype.Ha,k_=se}).apply(typeof xh<"u"?xh:typeof self<"u"?self:typeof window<"u"?window:{});const ZT="@firebase/firestore",JT="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Si.UNAUTHENTICATED=new Si(null),Si.GOOGLE_CREDENTIALS=new Si("google-credentials-uid"),Si.FIRST_PARTY=new Si("first-party-uid"),Si.MOCK_USER=new Si("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jo="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a=new L_("@firebase/firestore");function Io(){return _a.logLevel}function St(r,...t){if(_a.logLevel<=Jt.DEBUG){const e=t.map(Rp);_a.debug(`Firestore (${jo}): ${r}`,...e)}}function Us(r,...t){if(_a.logLevel<=Jt.ERROR){const e=t.map(Rp);_a.error(`Firestore (${jo}): ${r}`,...e)}}function xr(r,...t){if(_a.logLevel<=Jt.WARN){const e=t.map(Rp);_a.warn(`Firestore (${jo}): ${r}`,...e)}}function Rp(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(e){return JSON.stringify(e)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wt(r,t,e){let i="Unexpected state";typeof t=="string"?i=t:e=t,V_(r,i,e)}function V_(r,t,e){let i=`FIRESTORE (${jo}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{i+=" CONTEXT: "+JSON.stringify(e)}catch{i+=" CONTEXT: "+e}throw Us(i),new Error(i)}function oe(r,t,e,i){let n="Unexpected state";typeof e=="string"?n=e:i=e,r||V_(t,n,i)}function Nt(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ht={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class At extends qo{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class FO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Si.UNAUTHENTICATED))}shutdown(){}}class UO{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class BO{constructor(t){this.t=t,this.currentUser=Si.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){oe(this.o===void 0,42304);let i=this.i;const n=f=>this.i!==i?(i=this.i,e(f)):Promise.resolve();let a=new va;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new va,t.enqueueRetryable(()=>n(this.currentUser))};const l=()=>{const f=a;t.enqueueRetryable(async()=>{await f.promise,await n(this.currentUser)})},c=f=>{St("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit(f=>c(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?c(f):(St("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new va)}},0),l()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(St("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(oe(typeof i.accessToken=="string",31837,{l:i}),new G_(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return oe(t===null||typeof t=="string",2055,{h:t}),new Si(t)}}class VO{constructor(t,e,i){this.P=t,this.T=e,this.I=i,this.type="FirstParty",this.user=Si.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class GO{constructor(t,e,i){this.P=t,this.T=e,this.I=i}getToken(){return Promise.resolve(new VO(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(Si.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tS{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $O{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,TO(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){oe(this.o===void 0,3512);const i=a=>{a.error!=null&&St("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const l=a.token!==this.m;return this.m=a.token,St("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?e(a.token):Promise.resolve()};this.o=a=>{t.enqueueRetryable(()=>i(a))};const n=a=>{St("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(a=>n(a)),setTimeout(()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?n(a):St("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tS(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(oe(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new tS(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HO(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<r;i++)e[i]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $_(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const n=HO(40);for(let a=0;a<n.length;++a)i.length<20&&n[a]<e&&(i+=t.charAt(n[a]%62))}return i}}function Gt(r,t){return r<t?-1:r>t?1:0}function Fm(r,t){let e=0;for(;e<r.length&&e<t.length;){const i=r.codePointAt(e),n=t.codePointAt(e);if(i!==n){if(i<128&&n<128)return Gt(i,n);{const a=$_(),l=KO(a.encode(eS(r,e)),a.encode(eS(t,e)));return l!==0?l:Gt(i,n)}}e+=i>65535?2:1}return Gt(r.length,t.length)}function eS(r,t){return r.codePointAt(t)>65535?r.substring(t,t+2):r.substring(t,t+1)}function KO(r,t){for(let e=0;e<r.length&&e<t.length;++e)if(r[e]!==t[e])return Gt(r[e],t[e]);return Gt(r.length,t.length)}function Go(r,t,e){return r.length===t.length&&r.every((i,n)=>e(i,t[n]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iS="__name__";class Yn{constructor(t,e,i){e===void 0?e=0:e>t.length&&wt(637,{offset:e,range:t.length}),i===void 0?i=t.length-e:i>t.length-e&&wt(1746,{length:i,range:t.length-e}),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return Yn.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Yn?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let n=0;n<i;n++){const a=Yn.compareSegments(t.get(n),e.get(n));if(a!==0)return a}return Gt(t.length,e.length)}static compareSegments(t,e){const i=Yn.isNumericId(t),n=Yn.isNumericId(e);return i&&!n?-1:!i&&n?1:i&&n?Yn.extractNumericId(t).compare(Yn.extractNumericId(e)):Fm(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ar.fromString(t.substring(4,t.length-2))}}class Te extends Yn{construct(t,e,i){return new Te(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new At(ht.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(n=>n.length>0))}return new Te(e)}static emptyPath(){return new Te([])}}const zO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gi extends Yn{construct(t,e,i){return new gi(t,e,i)}static isValidIdentifier(t){return zO.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gi.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===iS}static keyField(){return new gi([iS])}static fromServerFormat(t){const e=[];let i="",n=0;const a=()=>{if(i.length===0)throw new At(ht.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let l=!1;for(;n<t.length;){const c=t[n];if(c==="\\"){if(n+1===t.length)throw new At(ht.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const f=t[n+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new At(ht.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=f,n+=2}else c==="`"?(l=!l,n++):c!=="."||l?(i+=c,n++):(a(),n++)}if(a(),l)throw new At(ht.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new gi(e)}static emptyPath(){return new gi([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(t){this.path=t}static fromPath(t){return new It(Te.fromString(t))}static fromName(t){return new It(Te.fromString(t).popFirst(5))}static empty(){return new It(Te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Te.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Te.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new It(new Te(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H_(r,t,e){if(!e)throw new At(ht.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function qO(r,t,e,i){if(t===!0&&i===!0)throw new At(ht.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function nS(r){if(!It.isDocumentKey(r))throw new At(ht.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function sS(r){if(It.isDocumentKey(r))throw new At(ht.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function K_(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Tf(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(i){return i.constructor?i.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":wt(12329,{type:typeof r})}function pu(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new At(ht.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Tf(r);throw new At(ht.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(r,t){const e={typeString:r};return t&&(e.value=t),e}function Bu(r,t){if(!K_(r))throw new At(ht.INVALID_ARGUMENT,"JSON must be an object");let e;for(const i in t)if(t[i]){const n=t[i].typeString,a="value"in t[i]?{value:t[i].value}:void 0;if(!(i in r)){e=`JSON missing required field: '${i}'`;break}const l=r[i];if(n&&typeof l!==n){e=`JSON field '${i}' must be a ${n}.`;break}if(a!==void 0&&l!==a.value){e=`Expected '${i}' field to equal '${a.value}'`;break}}if(e)throw new At(ht.INVALID_ARGUMENT,e);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rS=-62135596800,aS=1e6;class Se{static now(){return Se.fromMillis(Date.now())}static fromDate(t){return Se.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor((t-1e3*e)*aS);return new Se(e,i)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new At(ht.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new At(ht.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<rS)throw new At(ht.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new At(ht.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/aS}_compareTo(t){return this.seconds===t.seconds?Gt(this.nanoseconds,t.nanoseconds):Gt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Se._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Bu(t,Se._jsonSchema))return new Se(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-rS;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Se._jsonSchemaVersion="firestore/timestamp/1.0",Se._jsonSchema={type:Ve("string",Se._jsonSchemaVersion),seconds:Ve("number"),nanoseconds:Ve("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{static fromTimestamp(t){return new Mt(t)}static min(){return new Mt(new Se(0,0))}static max(){return new Mt(new Se(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu=-1;function jO(r,t){const e=r.toTimestamp().seconds,i=r.toTimestamp().nanoseconds+1,n=Mt.fromTimestamp(i===1e9?new Se(e+1,0):new Se(e,i));return new Ir(n,It.empty(),t)}function YO(r){return new Ir(r.readTime,r.key,wu)}class Ir{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new Ir(Mt.min(),It.empty(),wu)}static max(){return new Ir(Mt.max(),It.empty(),wu)}}function QO(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=It.comparator(r.documentKey,t.documentKey),e!==0?e:Gt(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class WO{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yo(r){if(r.code!==ht.FAILED_PRECONDITION||r.message!==XO)throw r;St("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&wt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new dt((i,n)=>{this.nextCallback=a=>{this.wrapSuccess(t,a).next(i,n)},this.catchCallback=a=>{this.wrapFailure(e,a).next(i,n)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof dt?e:dt.resolve(e)}catch(e){return dt.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):dt.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):dt.reject(e)}static resolve(t){return new dt((e,i)=>{e(t)})}static reject(t){return new dt((e,i)=>{i(t)})}static waitFor(t){return new dt((e,i)=>{let n=0,a=0,l=!1;t.forEach(c=>{++n,c.next(()=>{++a,l&&a===n&&e()},f=>i(f))}),l=!0,a===n&&e()})}static or(t){let e=dt.resolve(!1);for(const i of t)e=e.next(n=>n?dt.resolve(n):i());return e}static forEach(t,e){const i=[];return t.forEach((n,a)=>{i.push(e.call(this,n,a))}),this.waitFor(i)}static mapArray(t,e){return new dt((i,n)=>{const a=t.length,l=new Array(a);let c=0;for(let f=0;f<a;f++){const h=f;e(t[h]).next(g=>{l[h]=g,++c,c===a&&i(l)},g=>n(g))}})}static doWhile(t,e){return new dt((i,n)=>{const a=()=>{t()===!0?e().next(()=>{a()},n):i()};a()})}}function ZO(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Qo(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=i=>this._e(i),this.ae=i=>e.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ae&&this.ae(t),t}}Sf.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp=-1;function Af(r){return r==null}function of(r){return r===0&&1/r==-1/0}function JO(r){return typeof r=="number"&&Number.isInteger(r)&&!of(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z_="";function tP(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=oS(t)),t=eP(r.get(e),t);return oS(t)}function eP(r,t){let e=t;const i=r.length;for(let n=0;n<i;n++){const a=r.charAt(n);switch(a){case"\0":e+="";break;case z_:e+="";break;default:e+=a}}return e}function oS(r){return r+z_+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lS(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function ba(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function q_(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(t,e){this.comparator=t,this.root=e||di.EMPTY}insert(t,e){return new Ie(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,di.BLACK,null,null))}remove(t){return new Ie(this.comparator,this.root.remove(t,this.comparator).copy(null,null,di.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const n=this.comparator(t,i.key);if(n===0)return e+i.left.size;n<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){const t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ih(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ih(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ih(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ih(this.root,t,this.comparator,!0)}}class Ih{constructor(t,e,i,n){this.isReverse=n,this.nodeStack=[];let a=1;for(;!t.isEmpty();)if(a=e?i(t.key,e):1,e&&n&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(a===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class di{constructor(t,e,i,n,a){this.key=t,this.value=e,this.color=i??di.RED,this.left=n??di.EMPTY,this.right=a??di.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,n,a){return new di(t??this.key,e??this.value,i??this.color,n??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let n=this;const a=i(t,n.key);return n=a<0?n.copy(null,null,null,n.left.insert(t,e,i),null):a===0?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,i)),n.fixUp()}removeMin(){if(this.left.isEmpty())return di.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,n=this;if(e(t,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),e(t,n.key)===0){if(n.right.isEmpty())return di.EMPTY;i=n.right.min(),n=n.copy(i.key,i.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,di.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,di.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw wt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw wt(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw wt(27949);return t+(this.isRed()?0:1)}}di.EMPTY=null,di.RED=!0,di.BLACK=!1;di.EMPTY=new class{constructor(){this.size=0}get key(){throw wt(57766)}get value(){throw wt(16141)}get color(){throw wt(16727)}get left(){throw wt(29726)}get right(){throw wt(36894)}copy(t,e,i,n,a){return this}insert(t,e,i){return new di(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(t){this.comparator=t,this.data=new Ie(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const n=i.getNext();if(this.comparator(n.key,t[1])>=0)return;e(n.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new uS(this.data.getIterator())}getIteratorFrom(t){return new uS(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof We)||this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const n=e.getNext().key,a=i.getNext().key;if(this.comparator(n,a)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new We(this.comparator);return e.data=t,e}}class uS{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(t){this.fields=t,t.sort(gi.comparator)}static empty(){return new xn([])}unionWith(t){let e=new We(gi.comparator);for(const i of this.fields)e=e.add(i);for(const i of t)e=e.add(i);return new xn(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Go(this.fields,t.fields,(e,i)=>e.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(n){try{return atob(n)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new j_("Invalid base64 string: "+a):a}}(t);return new mi(e)}static fromUint8Array(t){const e=function(n){let a="";for(let l=0;l<n.length;++l)a+=String.fromCharCode(n[l]);return a}(t);return new mi(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const i=new Uint8Array(e.length);for(let n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Gt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}mi.EMPTY_BYTE_STRING=new mi("");const iP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lr(r){if(oe(!!r,39018),typeof r=="string"){let t=0;const e=iP.exec(r);if(oe(!!e,46558,{timestamp:r}),e[1]){let n=e[1];n=(n+"000000000").substr(0,9),t=Number(n)}const i=new Date(r);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Pe(r.seconds),nanos:Pe(r.nanos)}}function Pe(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Dr(r){return typeof r=="string"?mi.fromBase64String(r):mi.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y_="server_timestamp",Q_="__type__",X_="__previous_value__",W_="__local_write_time__";function Ip(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Q_])===null||e===void 0?void 0:e.stringValue)===Y_}function _f(r){const t=r.mapValue.fields[X_];return Ip(t)?_f(t):t}function Ou(r){const t=Lr(r.mapValue.fields[W_].timestampValue);return new Se(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP{constructor(t,e,i,n,a,l,c,f,h,g){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=n,this.ssl=a,this.forceLongPolling=l,this.autoDetectLongPolling=c,this.longPollingOptions=f,this.useFetchStreams=h,this.isUsingEmulator=g}}const lf="(default)";class Pu{constructor(t,e){this.projectId=t,this.database=e||lf}static empty(){return new Pu("","")}get isDefaultDatabase(){return this.database===lf}isEqual(t){return t instanceof Pu&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z_="__type__",sP="__max__",Lh={mapValue:{}},J_="__vector__",uf="value";function Cr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ip(r)?4:aP(r)?9007199254740991:rP(r)?10:11:wt(28295,{value:r})}function ns(r,t){if(r===t)return!0;const e=Cr(r);if(e!==Cr(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Ou(r).isEqual(Ou(t));case 3:return function(n,a){if(typeof n.timestampValue=="string"&&typeof a.timestampValue=="string"&&n.timestampValue.length===a.timestampValue.length)return n.timestampValue===a.timestampValue;const l=Lr(n.timestampValue),c=Lr(a.timestampValue);return l.seconds===c.seconds&&l.nanos===c.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(n,a){return Dr(n.bytesValue).isEqual(Dr(a.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(n,a){return Pe(n.geoPointValue.latitude)===Pe(a.geoPointValue.latitude)&&Pe(n.geoPointValue.longitude)===Pe(a.geoPointValue.longitude)}(r,t);case 2:return function(n,a){if("integerValue"in n&&"integerValue"in a)return Pe(n.integerValue)===Pe(a.integerValue);if("doubleValue"in n&&"doubleValue"in a){const l=Pe(n.doubleValue),c=Pe(a.doubleValue);return l===c?of(l)===of(c):isNaN(l)&&isNaN(c)}return!1}(r,t);case 9:return Go(r.arrayValue.values||[],t.arrayValue.values||[],ns);case 10:case 11:return function(n,a){const l=n.mapValue.fields||{},c=a.mapValue.fields||{};if(lS(l)!==lS(c))return!1;for(const f in l)if(l.hasOwnProperty(f)&&(c[f]===void 0||!ns(l[f],c[f])))return!1;return!0}(r,t);default:return wt(52216,{left:r})}}function Mu(r,t){return(r.values||[]).find(e=>ns(e,t))!==void 0}function $o(r,t){if(r===t)return 0;const e=Cr(r),i=Cr(t);if(e!==i)return Gt(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return Gt(r.booleanValue,t.booleanValue);case 2:return function(a,l){const c=Pe(a.integerValue||a.doubleValue),f=Pe(l.integerValue||l.doubleValue);return c<f?-1:c>f?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1}(r,t);case 3:return cS(r.timestampValue,t.timestampValue);case 4:return cS(Ou(r),Ou(t));case 5:return Fm(r.stringValue,t.stringValue);case 6:return function(a,l){const c=Dr(a),f=Dr(l);return c.compareTo(f)}(r.bytesValue,t.bytesValue);case 7:return function(a,l){const c=a.split("/"),f=l.split("/");for(let h=0;h<c.length&&h<f.length;h++){const g=Gt(c[h],f[h]);if(g!==0)return g}return Gt(c.length,f.length)}(r.referenceValue,t.referenceValue);case 8:return function(a,l){const c=Gt(Pe(a.latitude),Pe(l.latitude));return c!==0?c:Gt(Pe(a.longitude),Pe(l.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return hS(r.arrayValue,t.arrayValue);case 10:return function(a,l){var c,f,h,g;const p=a.fields||{},E=l.fields||{},T=(c=p[uf])===null||c===void 0?void 0:c.arrayValue,S=(f=E[uf])===null||f===void 0?void 0:f.arrayValue,R=Gt(((h=T?.values)===null||h===void 0?void 0:h.length)||0,((g=S?.values)===null||g===void 0?void 0:g.length)||0);return R!==0?R:hS(T,S)}(r.mapValue,t.mapValue);case 11:return function(a,l){if(a===Lh.mapValue&&l===Lh.mapValue)return 0;if(a===Lh.mapValue)return 1;if(l===Lh.mapValue)return-1;const c=a.fields||{},f=Object.keys(c),h=l.fields||{},g=Object.keys(h);f.sort(),g.sort();for(let p=0;p<f.length&&p<g.length;++p){const E=Fm(f[p],g[p]);if(E!==0)return E;const T=$o(c[f[p]],h[g[p]]);if(T!==0)return T}return Gt(f.length,g.length)}(r.mapValue,t.mapValue);default:throw wt(23264,{le:e})}}function cS(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return Gt(r,t);const e=Lr(r),i=Lr(t),n=Gt(e.seconds,i.seconds);return n!==0?n:Gt(e.nanos,i.nanos)}function hS(r,t){const e=r.values||[],i=t.values||[];for(let n=0;n<e.length&&n<i.length;++n){const a=$o(e[n],i[n]);if(a)return a}return Gt(e.length,i.length)}function Ho(r){return Um(r)}function Um(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){const i=Lr(e);return`time(${i.seconds},${i.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Dr(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return It.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let i="[",n=!0;for(const a of e.values||[])n?n=!1:i+=",",i+=Um(a);return i+"]"}(r.arrayValue):"mapValue"in r?function(e){const i=Object.keys(e.fields||{}).sort();let n="{",a=!0;for(const l of i)a?a=!1:n+=",",n+=`${l}:${Um(e.fields[l])}`;return n+"}"}(r.mapValue):wt(61005,{value:r})}function Vh(r){switch(Cr(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=_f(r);return t?16+Vh(t):16;case 5:return 2*r.stringValue.length;case 6:return Dr(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((n,a)=>n+Vh(a),0)}(r.arrayValue);case 10:case 11:return function(i){let n=0;return ba(i.fields,(a,l)=>{n+=a.length+Vh(l)}),n}(r.mapValue);default:throw wt(13486,{value:r})}}function fS(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Bm(r){return!!r&&"integerValue"in r}function Lp(r){return!!r&&"arrayValue"in r}function dS(r){return!!r&&"nullValue"in r}function gS(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Gh(r){return!!r&&"mapValue"in r}function rP(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Z_])===null||e===void 0?void 0:e.stringValue)===J_}function yu(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return ba(r.mapValue.fields,(e,i)=>t.mapValue.fields[e]=yu(i)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=yu(r.arrayValue.values[e]);return t}return Object.assign({},r)}function aP(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===sP}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(t){this.value=t}static empty(){return new un({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!Gh(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=yu(e)}setAll(t){let e=gi.emptyPath(),i={},n=[];t.forEach((l,c)=>{if(!e.isImmediateParentOf(c)){const f=this.getFieldsMap(e);this.applyChanges(f,i,n),i={},n=[],e=c.popLast()}l?i[c.lastSegment()]=yu(l):n.push(c.lastSegment())});const a=this.getFieldsMap(e);this.applyChanges(a,i,n)}delete(t){const e=this.field(t.popLast());Gh(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ns(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let n=e.mapValue.fields[t.get(i)];Gh(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=n),e=n}return e.mapValue.fields}applyChanges(t,e,i){ba(e,(n,a)=>t[n]=a);for(const n of i)delete t[n]}clone(){return new un(yu(this.value))}}function tR(r){const t=[];return ba(r.fields,(e,i)=>{const n=new gi([e]);if(Gh(i)){const a=tR(i.mapValue).fields;if(a.length===0)t.push(n);else for(const l of a)t.push(n.child(l))}else t.push(n)}),new xn(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(t,e,i,n,a,l,c){this.key=t,this.documentType=e,this.version=i,this.readTime=n,this.createTime=a,this.data=l,this.documentState=c}static newInvalidDocument(t){return new Ai(t,0,Mt.min(),Mt.min(),Mt.min(),un.empty(),0)}static newFoundDocument(t,e,i,n){return new Ai(t,1,e,Mt.min(),i,n,0)}static newNoDocument(t,e){return new Ai(t,2,e,Mt.min(),Mt.min(),un.empty(),0)}static newUnknownDocument(t,e){return new Ai(t,3,e,Mt.min(),Mt.min(),un.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Mt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=un.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=un.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Mt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Ai&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ai(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(t,e){this.position=t,this.inclusive=e}}function mS(r,t,e){let i=0;for(let n=0;n<r.position.length;n++){const a=t[n],l=r.position[n];if(a.field.isKeyField()?i=It.comparator(It.fromName(l.referenceValue),e.key):i=$o(l,e.data.field(a.field)),a.dir==="desc"&&(i*=-1),i!==0)break}return i}function pS(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!ns(r.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(t,e="asc"){this.field=t,this.dir=e}}function oP(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{}class Be extends eR{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new uP(t,e,i):e==="array-contains"?new fP(t,i):e==="in"?new dP(t,i):e==="not-in"?new gP(t,i):e==="array-contains-any"?new mP(t,i):new Be(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new cP(t,i):new hP(t,i)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison($o(e,this.value)):e!==null&&Cr(this.value)===Cr(e)&&this.matchesComparison($o(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return wt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class In extends eR{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new In(t,e)}matches(t){return iR(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function iR(r){return r.op==="and"}function nR(r){return lP(r)&&iR(r)}function lP(r){for(const t of r.filters)if(t instanceof In)return!1;return!0}function Vm(r){if(r instanceof Be)return r.field.canonicalString()+r.op.toString()+Ho(r.value);if(nR(r))return r.filters.map(t=>Vm(t)).join(",");{const t=r.filters.map(e=>Vm(e)).join(",");return`${r.op}(${t})`}}function sR(r,t){return r instanceof Be?function(i,n){return n instanceof Be&&i.op===n.op&&i.field.isEqual(n.field)&&ns(i.value,n.value)}(r,t):r instanceof In?function(i,n){return n instanceof In&&i.op===n.op&&i.filters.length===n.filters.length?i.filters.reduce((a,l,c)=>a&&sR(l,n.filters[c]),!0):!1}(r,t):void wt(19439)}function rR(r){return r instanceof Be?function(e){return`${e.field.canonicalString()} ${e.op} ${Ho(e.value)}`}(r):r instanceof In?function(e){return e.op.toString()+" {"+e.getFilters().map(rR).join(" ,")+"}"}(r):"Filter"}class uP extends Be{constructor(t,e,i){super(t,e,i),this.key=It.fromName(i.referenceValue)}matches(t){const e=It.comparator(t.key,this.key);return this.matchesComparison(e)}}class cP extends Be{constructor(t,e){super(t,"in",e),this.keys=aR("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class hP extends Be{constructor(t,e){super(t,"not-in",e),this.keys=aR("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function aR(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(i=>It.fromName(i.referenceValue))}class fP extends Be{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Lp(e)&&Mu(e.arrayValue,this.value)}}class dP extends Be{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Mu(this.value.arrayValue,e)}}class gP extends Be{constructor(t,e){super(t,"not-in",e)}matches(t){if(Mu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Mu(this.value.arrayValue,e)}}class mP extends Be{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Lp(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>Mu(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(t,e=null,i=[],n=[],a=null,l=null,c=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=n,this.limit=a,this.startAt=l,this.endAt=c,this.Pe=null}}function yS(r,t=null,e=[],i=[],n=null,a=null,l=null){return new pP(r,t,e,i,n,a,l)}function Dp(r){const t=Nt(r);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>Vm(i)).join(","),e+="|ob:",e+=t.orderBy.map(i=>function(a){return a.field.canonicalString()+a.dir}(i)).join(","),Af(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>Ho(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>Ho(i)).join(",")),t.Pe=e}return t.Pe}function Cp(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!oP(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!sR(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!pS(r.startAt,t.startAt)&&pS(r.endAt,t.endAt)}function Gm(r){return It.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(t,e=null,i=[],n=[],a=null,l="F",c=null,f=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=n,this.limit=a,this.limitType=l,this.startAt=c,this.endAt=f,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function yP(r,t,e,i,n,a,l,c){return new Xo(r,t,e,i,n,a,l,c)}function wp(r){return new Xo(r)}function ES(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function oR(r){return r.collectionGroup!==null}function Eu(r){const t=Nt(r);if(t.Te===null){t.Te=[];const e=new Set;for(const a of t.explicitOrderBy)t.Te.push(a),e.add(a.field.canonicalString());const i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(l){let c=new We(gi.comparator);return l.filters.forEach(f=>{f.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(t).forEach(a=>{e.has(a.canonicalString())||a.isKeyField()||t.Te.push(new ku(a,i))}),e.has(gi.keyField().canonicalString())||t.Te.push(new ku(gi.keyField(),i))}return t.Te}function Zn(r){const t=Nt(r);return t.Ie||(t.Ie=EP(t,Eu(r))),t.Ie}function EP(r,t){if(r.limitType==="F")return yS(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(n=>{const a=n.dir==="desc"?"asc":"desc";return new ku(n.field,a)});const e=r.endAt?new cf(r.endAt.position,r.endAt.inclusive):null,i=r.startAt?new cf(r.startAt.position,r.startAt.inclusive):null;return yS(r.path,r.collectionGroup,t,r.filters,r.limit,e,i)}}function $m(r,t){const e=r.filters.concat([t]);return new Xo(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Hm(r,t,e){return new Xo(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Rf(r,t){return Cp(Zn(r),Zn(t))&&r.limitType===t.limitType}function lR(r){return`${Dp(Zn(r))}|lt:${r.limitType}`}function Lo(r){return`Query(target=${function(e){let i=e.path.canonicalString();return e.collectionGroup!==null&&(i+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(i+=`, filters: [${e.filters.map(n=>rR(n)).join(", ")}]`),Af(e.limit)||(i+=", limit: "+e.limit),e.orderBy.length>0&&(i+=`, orderBy: [${e.orderBy.map(n=>function(l){return`${l.field.canonicalString()} (${l.dir})`}(n)).join(", ")}]`),e.startAt&&(i+=", startAt: ",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(n=>Ho(n)).join(",")),e.endAt&&(i+=", endAt: ",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(n=>Ho(n)).join(",")),`Target(${i})`}(Zn(r))}; limitType=${r.limitType})`}function bf(r,t){return t.isFoundDocument()&&function(i,n){const a=n.key.path;return i.collectionGroup!==null?n.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):It.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a)}(r,t)&&function(i,n){for(const a of Eu(i))if(!a.field.isKeyField()&&n.data.field(a.field)===null)return!1;return!0}(r,t)&&function(i,n){for(const a of i.filters)if(!a.matches(n))return!1;return!0}(r,t)&&function(i,n){return!(i.startAt&&!function(l,c,f){const h=mS(l,c,f);return l.inclusive?h<=0:h<0}(i.startAt,Eu(i),n)||i.endAt&&!function(l,c,f){const h=mS(l,c,f);return l.inclusive?h>=0:h>0}(i.endAt,Eu(i),n))}(r,t)}function vP(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function uR(r){return(t,e)=>{let i=!1;for(const n of Eu(r)){const a=TP(n,t,e);if(a!==0)return a;i=i||n.field.isKeyField()}return 0}}function TP(r,t,e){const i=r.field.isKeyField()?It.comparator(t.key,e.key):function(a,l,c){const f=l.data.field(a),h=c.data.field(a);return f!==null&&h!==null?$o(f,h):wt(42886)}(r.field,t,e);switch(r.dir){case"asc":return i;case"desc":return-1*i;default:return wt(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(const[n,a]of i)if(this.equalsFn(n,t))return a}}has(t){return this.get(t)!==void 0}set(t,e){const i=this.mapKeyFn(t),n=this.inner[i];if(n===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let a=0;a<n.length;a++)if(this.equalsFn(n[a][0],t))return void(n[a]=[t,e]);n.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return i.length===1?delete this.inner[e]:i.splice(n,1),this.innerSize--,!0;return!1}forEach(t){ba(this.inner,(e,i)=>{for(const[n,a]of i)t(n,a)})}isEmpty(){return q_(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP=new Ie(It.comparator);function Bs(){return SP}const cR=new Ie(It.comparator);function uu(...r){let t=cR;for(const e of r)t=t.insert(e.key,e);return t}function hR(r){let t=cR;return r.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function ya(){return vu()}function fR(){return vu()}function vu(){return new xa(r=>r.toString(),(r,t)=>r.isEqual(t))}const AP=new Ie(It.comparator),_P=new We(It.comparator);function jt(...r){let t=_P;for(const e of r)t=t.add(e);return t}const RP=new We(Gt);function bP(){return RP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Op(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:of(t)?"-0":t}}function dR(r){return{integerValue:""+r}}function xP(r,t){return JO(t)?dR(t):Op(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(){this._=void 0}}function IP(r,t,e){return r instanceof Nu?function(n,a){const l={fields:{[Q_]:{stringValue:Y_},[W_]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return a&&Ip(a)&&(a=_f(a)),a&&(l.fields[X_]=a),{mapValue:l}}(e,t):r instanceof Fu?mR(r,t):r instanceof Uu?pR(r,t):function(n,a){const l=gR(n,a),c=vS(l)+vS(n.Ee);return Bm(l)&&Bm(n.Ee)?dR(c):Op(n.serializer,c)}(r,t)}function LP(r,t,e){return r instanceof Fu?mR(r,t):r instanceof Uu?pR(r,t):e}function gR(r,t){return r instanceof hf?function(i){return Bm(i)||function(a){return!!a&&"doubleValue"in a}(i)}(t)?t:{integerValue:0}:null}class Nu extends xf{}class Fu extends xf{constructor(t){super(),this.elements=t}}function mR(r,t){const e=yR(t);for(const i of r.elements)e.some(n=>ns(n,i))||e.push(i);return{arrayValue:{values:e}}}class Uu extends xf{constructor(t){super(),this.elements=t}}function pR(r,t){let e=yR(t);for(const i of r.elements)e=e.filter(n=>!ns(n,i));return{arrayValue:{values:e}}}class hf extends xf{constructor(t,e){super(),this.serializer=t,this.Ee=e}}function vS(r){return Pe(r.integerValue||r.doubleValue)}function yR(r){return Lp(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(t,e){this.field=t,this.transform=e}}function CP(r,t){return r.field.isEqual(t.field)&&function(i,n){return i instanceof Fu&&n instanceof Fu||i instanceof Uu&&n instanceof Uu?Go(i.elements,n.elements,ns):i instanceof hf&&n instanceof hf?ns(i.Ee,n.Ee):i instanceof Nu&&n instanceof Nu}(r.transform,t.transform)}class wP{constructor(t,e){this.version=t,this.transformResults=e}}class Ns{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ns}static exists(t){return new Ns(void 0,t)}static updateTime(t){return new Ns(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function $h(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class If{}function ER(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new TR(r.key,Ns.none()):new Vu(r.key,r.data,Ns.none());{const e=r.data,i=un.empty();let n=new We(gi.comparator);for(let a of t.fields)if(!n.has(a)){let l=e.field(a);l===null&&a.length>1&&(a=a.popLast(),l=e.field(a)),l===null?i.delete(a):i.set(a,l),n=n.add(a)}return new Ia(r.key,i,new xn(n.toArray()),Ns.none())}}function OP(r,t,e){r instanceof Vu?function(n,a,l){const c=n.value.clone(),f=SS(n.fieldTransforms,a,l.transformResults);c.setAll(f),a.convertToFoundDocument(l.version,c).setHasCommittedMutations()}(r,t,e):r instanceof Ia?function(n,a,l){if(!$h(n.precondition,a))return void a.convertToUnknownDocument(l.version);const c=SS(n.fieldTransforms,a,l.transformResults),f=a.data;f.setAll(vR(n)),f.setAll(c),a.convertToFoundDocument(l.version,f).setHasCommittedMutations()}(r,t,e):function(n,a,l){a.convertToNoDocument(l.version).setHasCommittedMutations()}(0,t,e)}function Tu(r,t,e,i){return r instanceof Vu?function(a,l,c,f){if(!$h(a.precondition,l))return c;const h=a.value.clone(),g=AS(a.fieldTransforms,f,l);return h.setAll(g),l.convertToFoundDocument(l.version,h).setHasLocalMutations(),null}(r,t,e,i):r instanceof Ia?function(a,l,c,f){if(!$h(a.precondition,l))return c;const h=AS(a.fieldTransforms,f,l),g=l.data;return g.setAll(vR(a)),g.setAll(h),l.convertToFoundDocument(l.version,g).setHasLocalMutations(),c===null?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(p=>p.field))}(r,t,e,i):function(a,l,c){return $h(a.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):c}(r,t,e)}function PP(r,t){let e=null;for(const i of r.fieldTransforms){const n=t.data.field(i.field),a=gR(i.transform,n||null);a!=null&&(e===null&&(e=un.empty()),e.set(i.field,a))}return e||null}function TS(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(i,n){return i===void 0&&n===void 0||!(!i||!n)&&Go(i,n,(a,l)=>CP(a,l))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class Vu extends If{constructor(t,e,i,n=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Ia extends If{constructor(t,e,i,n,a=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=n,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function vR(r){const t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const i=r.data.field(e);t.set(e,i)}}),t}function SS(r,t,e){const i=new Map;oe(r.length===e.length,32656,{Ae:e.length,Re:r.length});for(let n=0;n<e.length;n++){const a=r[n],l=a.transform,c=t.data.field(a.field);i.set(a.field,LP(l,c,e[n]))}return i}function AS(r,t,e){const i=new Map;for(const n of r){const a=n.transform,l=e.data.field(n.field);i.set(n.field,IP(a,l,t))}return i}class TR extends If{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class MP extends If{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(t,e,i,n){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=n}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let n=0;n<this.mutations.length;n++){const a=this.mutations[n];a.key.isEqual(t.key)&&OP(a,t,i[n])}}applyToLocalView(t,e){for(const i of this.baseMutations)i.key.isEqual(t.key)&&(e=Tu(i,t,e,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(t.key)&&(e=Tu(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const i=fR();return this.mutations.forEach(n=>{const a=t.get(n.key),l=a.overlayedDocument;let c=this.applyToLocalView(l,a.mutatedFields);c=e.has(n.key)?null:c;const f=ER(l,c);f!==null&&i.set(n.key,f),l.isValidDocument()||l.convertToNoDocument(Mt.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),jt())}isEqual(t){return this.batchId===t.batchId&&Go(this.mutations,t.mutations,(e,i)=>TS(e,i))&&Go(this.baseMutations,t.baseMutations,(e,i)=>TS(e,i))}}class Pp{constructor(t,e,i,n){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=n}static from(t,e,i){oe(t.mutations.length===i.length,58842,{Ve:t.mutations.length,me:i.length});let n=function(){return AP}();const a=t.mutations;for(let l=0;l<a.length;l++)n=n.insert(a[l].key,i[l].version);return new Pp(t,e,i,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FP{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ue,Zt;function UP(r){switch(r){case ht.OK:return wt(64938);case ht.CANCELLED:case ht.UNKNOWN:case ht.DEADLINE_EXCEEDED:case ht.RESOURCE_EXHAUSTED:case ht.INTERNAL:case ht.UNAVAILABLE:case ht.UNAUTHENTICATED:return!1;case ht.INVALID_ARGUMENT:case ht.NOT_FOUND:case ht.ALREADY_EXISTS:case ht.PERMISSION_DENIED:case ht.FAILED_PRECONDITION:case ht.ABORTED:case ht.OUT_OF_RANGE:case ht.UNIMPLEMENTED:case ht.DATA_LOSS:return!0;default:return wt(15467,{code:r})}}function SR(r){if(r===void 0)return Us("GRPC error has no .code"),ht.UNKNOWN;switch(r){case Ue.OK:return ht.OK;case Ue.CANCELLED:return ht.CANCELLED;case Ue.UNKNOWN:return ht.UNKNOWN;case Ue.DEADLINE_EXCEEDED:return ht.DEADLINE_EXCEEDED;case Ue.RESOURCE_EXHAUSTED:return ht.RESOURCE_EXHAUSTED;case Ue.INTERNAL:return ht.INTERNAL;case Ue.UNAVAILABLE:return ht.UNAVAILABLE;case Ue.UNAUTHENTICATED:return ht.UNAUTHENTICATED;case Ue.INVALID_ARGUMENT:return ht.INVALID_ARGUMENT;case Ue.NOT_FOUND:return ht.NOT_FOUND;case Ue.ALREADY_EXISTS:return ht.ALREADY_EXISTS;case Ue.PERMISSION_DENIED:return ht.PERMISSION_DENIED;case Ue.FAILED_PRECONDITION:return ht.FAILED_PRECONDITION;case Ue.ABORTED:return ht.ABORTED;case Ue.OUT_OF_RANGE:return ht.OUT_OF_RANGE;case Ue.UNIMPLEMENTED:return ht.UNIMPLEMENTED;case Ue.DATA_LOSS:return ht.DATA_LOSS;default:return wt(39323,{code:r})}}(Zt=Ue||(Ue={}))[Zt.OK=0]="OK",Zt[Zt.CANCELLED=1]="CANCELLED",Zt[Zt.UNKNOWN=2]="UNKNOWN",Zt[Zt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zt[Zt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zt[Zt.NOT_FOUND=5]="NOT_FOUND",Zt[Zt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zt[Zt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zt[Zt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zt[Zt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zt[Zt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zt[Zt.ABORTED=10]="ABORTED",Zt[Zt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zt[Zt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zt[Zt.INTERNAL=13]="INTERNAL",Zt[Zt.UNAVAILABLE=14]="UNAVAILABLE",Zt[Zt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BP=new Ar([4294967295,4294967295],0);function _S(r){const t=$_().encode(r),e=new M_;return e.update(t),new Uint8Array(e.digest())}function RS(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),i=t.getUint32(4,!0),n=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new Ar([e,i],0),new Ar([n,a],0)]}class Mp{constructor(t,e,i){if(this.bitmap=t,this.padding=e,this.hashCount=i,e<0||e>=8)throw new cu(`Invalid padding: ${e}`);if(i<0)throw new cu(`Invalid hash count: ${i}`);if(t.length>0&&this.hashCount===0)throw new cu(`Invalid hash count: ${i}`);if(t.length===0&&e!==0)throw new cu(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=Ar.fromNumber(this.fe)}pe(t,e,i){let n=t.add(e.multiply(Ar.fromNumber(i)));return n.compare(BP)===1&&(n=new Ar([n.getBits(0),n.getBits(1)],0)),n.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;const e=_S(t),[i,n]=RS(e);for(let a=0;a<this.hashCount;a++){const l=this.pe(i,n,a);if(!this.ye(l))return!1}return!0}static create(t,e,i){const n=t%8==0?0:8-t%8,a=new Uint8Array(Math.ceil(t/8)),l=new Mp(a,n,e);return i.forEach(c=>l.insert(c)),l}insert(t){if(this.fe===0)return;const e=_S(t),[i,n]=RS(e);for(let a=0;a<this.hashCount;a++){const l=this.pe(i,n,a);this.we(l)}}we(t){const e=Math.floor(t/8),i=t%8;this.bitmap[e]|=1<<i}}class cu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(t,e,i,n,a){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=n,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(t,e,i){const n=new Map;return n.set(t,Gu.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new Lf(Mt.min(),n,new Ie(Gt),Bs(),jt())}}class Gu{constructor(t,e,i,n,a){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=n,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new Gu(i,e,jt(),jt(),jt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{constructor(t,e,i,n){this.Se=t,this.removedTargetIds=e,this.key=i,this.be=n}}class AR{constructor(t,e){this.targetId=t,this.De=e}}class _R{constructor(t,e,i=mi.EMPTY_BYTE_STRING,n=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=n}}class bS{constructor(){this.ve=0,this.Ce=xS(),this.Fe=mi.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=jt(),e=jt(),i=jt();return this.Ce.forEach((n,a)=>{switch(a){case 0:t=t.add(n);break;case 2:e=e.add(n);break;case 1:i=i.add(n);break;default:wt(38017,{changeType:a})}}),new Gu(this.Fe,this.Me,t,e,i)}ke(){this.xe=!1,this.Ce=xS()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,oe(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class VP{constructor(t){this.We=t,this.Ge=new Map,this.ze=Bs(),this.je=Dh(),this.Je=Dh(),this.He=new Ie(Gt)}Ye(t){for(const e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(const e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{const i=this.tt(e);switch(t.state){case 0:this.nt(e)&&i.Be(t.resumeToken);break;case 1:i.Ue(),i.Oe||i.ke(),i.Be(t.resumeToken);break;case 2:i.Ue(),i.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(i.Ke(),i.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),i.Be(t.resumeToken));break;default:wt(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((i,n)=>{this.nt(n)&&e(n)})}it(t){const e=t.targetId,i=t.De.count,n=this.st(e);if(n){const a=n.target;if(Gm(a))if(i===0){const l=new It(a.path);this.Xe(e,l,Ai.newNoDocument(l,Mt.min()))}else oe(i===1,20013,{expectedCount:i});else{const l=this.ot(e);if(l!==i){const c=this._t(t),f=c?this.ut(c,t,l):1;if(f!==0){this.rt(e);const h=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,h)}}}}}_t(t){const e=t.De.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:i="",padding:n=0},hashCount:a=0}=e;let l,c;try{l=Dr(i).toUint8Array()}catch(f){if(f instanceof j_)return xr("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{c=new Mp(l,n,a)}catch(f){return xr(f instanceof cu?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return c.fe===0?null:c}ut(t,e,i){return e.De.count===i-this.ht(t,e.targetId)?0:2}ht(t,e){const i=this.We.getRemoteKeysForTarget(e);let n=0;return i.forEach(a=>{const l=this.We.lt(),c=`projects/${l.projectId}/databases/${l.database}/documents/${a.path.canonicalString()}`;t.mightContain(c)||(this.Xe(e,a,null),n++)}),n}Pt(t){const e=new Map;this.Ge.forEach((a,l)=>{const c=this.st(l);if(c){if(a.current&&Gm(c.target)){const f=new It(c.target.path);this.Tt(f).has(l)||this.It(l,f)||this.Xe(l,f,Ai.newNoDocument(f,t))}a.Ne&&(e.set(l,a.Le()),a.ke())}});let i=jt();this.Je.forEach((a,l)=>{let c=!0;l.forEachWhile(f=>{const h=this.st(f);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(i=i.add(a))}),this.ze.forEach((a,l)=>l.setReadTime(t));const n=new Lf(t,e,this.He,this.ze,i);return this.ze=Bs(),this.je=Dh(),this.Je=Dh(),this.He=new Ie(Gt),n}Ze(t,e){if(!this.nt(t))return;const i=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,i),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,i){if(!this.nt(t))return;const n=this.tt(t);this.It(t,e)?n.qe(e,1):n.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),i&&(this.ze=this.ze.insert(e,i))}removeTarget(t){this.Ge.delete(t)}ot(t){const e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new bS,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new We(Gt),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new We(Gt),this.je=this.je.insert(t,e)),e}nt(t){const e=this.st(t)!==null;return e||St("WatchChangeAggregator","Detected inactive target",t),e}st(t){const e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new bS),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}}function Dh(){return new Ie(It.comparator)}function xS(){return new Ie(It.comparator)}const GP={asc:"ASCENDING",desc:"DESCENDING"},$P={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},HP={and:"AND",or:"OR"};class KP{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Km(r,t){return r.useProto3Json||Af(t)?t:{value:t}}function ff(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function RR(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function zP(r,t){return ff(r,t.toTimestamp())}function Jn(r){return oe(!!r,49232),Mt.fromTimestamp(function(e){const i=Lr(e);return new Se(i.seconds,i.nanos)}(r))}function kp(r,t){return zm(r,t).canonicalString()}function zm(r,t){const e=function(n){return new Te(["projects",n.projectId,"databases",n.database])}(r).child("documents");return t===void 0?e:e.child(t)}function bR(r){const t=Te.fromString(r);return oe(CR(t),10190,{key:t.toString()}),t}function qm(r,t){return kp(r.databaseId,t.path)}function um(r,t){const e=bR(t);if(e.get(1)!==r.databaseId.projectId)throw new At(ht.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new At(ht.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new It(IR(e))}function xR(r,t){return kp(r.databaseId,t)}function qP(r){const t=bR(r);return t.length===4?Te.emptyPath():IR(t)}function jm(r){return new Te(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function IR(r){return oe(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function IS(r,t,e){return{name:qm(r,t),fields:e.value.mapValue.fields}}function jP(r,t){let e;if("targetChange"in t){t.targetChange;const i=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:wt(39313,{state:h})}(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],a=function(h,g){return h.useProto3Json?(oe(g===void 0||typeof g=="string",58123),mi.fromBase64String(g||"")):(oe(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),mi.fromUint8Array(g||new Uint8Array))}(r,t.targetChange.resumeToken),l=t.targetChange.cause,c=l&&function(h){const g=h.code===void 0?ht.UNKNOWN:SR(h.code);return new At(g,h.message||"")}(l);e=new _R(i,n,a,c||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const n=um(r,i.document.name),a=Jn(i.document.updateTime),l=i.document.createTime?Jn(i.document.createTime):Mt.min(),c=new un({mapValue:{fields:i.document.fields}}),f=Ai.newFoundDocument(n,a,l,c),h=i.targetIds||[],g=i.removedTargetIds||[];e=new Hh(h,g,f.key,f)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const n=um(r,i.document),a=i.readTime?Jn(i.readTime):Mt.min(),l=Ai.newNoDocument(n,a),c=i.removedTargetIds||[];e=new Hh([],c,l.key,l)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const n=um(r,i.document),a=i.removedTargetIds||[];e=new Hh([],a,n,null)}else{if(!("filter"in t))return wt(11601,{At:t});{t.filter;const i=t.filter;i.targetId;const{count:n=0,unchangedNames:a}=i,l=new FP(n,a),c=i.targetId;e=new AR(c,l)}}return e}function YP(r,t){let e;if(t instanceof Vu)e={update:IS(r,t.key,t.value)};else if(t instanceof TR)e={delete:qm(r,t.key)};else if(t instanceof Ia)e={update:IS(r,t.key,t.data),updateMask:nM(t.fieldMask)};else{if(!(t instanceof MP))return wt(16599,{Rt:t.type});e={verify:qm(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(a,l){const c=l.transform;if(c instanceof Nu)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Fu)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Uu)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof hf)return{fieldPath:l.field.canonicalString(),increment:c.Ee};throw wt(20930,{transform:l.transform})}(0,i))),t.precondition.isNone||(e.currentDocument=function(n,a){return a.updateTime!==void 0?{updateTime:zP(n,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:wt(27497)}(r,t.precondition)),e}function QP(r,t){return r&&r.length>0?(oe(t!==void 0,14353),r.map(e=>function(n,a){let l=n.updateTime?Jn(n.updateTime):Jn(a);return l.isEqual(Mt.min())&&(l=Jn(a)),new wP(l,n.transformResults||[])}(e,t))):[]}function XP(r,t){return{documents:[xR(r,t.path)]}}function WP(r,t){const e={structuredQuery:{}},i=t.path;let n;t.collectionGroup!==null?(n=i,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=i.popLast(),e.structuredQuery.from=[{collectionId:i.lastSegment()}]),e.parent=xR(r,n);const a=function(h){if(h.length!==0)return DR(In.create(h,"and"))}(t.filters);a&&(e.structuredQuery.where=a);const l=function(h){if(h.length!==0)return h.map(g=>function(E){return{field:Do(E.field),direction:tM(E.dir)}}(g))}(t.orderBy);l&&(e.structuredQuery.orderBy=l);const c=Km(r,t.limit);return c!==null&&(e.structuredQuery.limit=c),t.startAt&&(e.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(t.endAt)),{Vt:e,parent:n}}function ZP(r){let t=qP(r.parent);const e=r.structuredQuery,i=e.from?e.from.length:0;let n=null;if(i>0){oe(i===1,65062);const g=e.from[0];g.allDescendants?n=g.collectionId:t=t.child(g.collectionId)}let a=[];e.where&&(a=function(p){const E=LR(p);return E instanceof In&&nR(E)?E.getFilters():[E]}(e.where));let l=[];e.orderBy&&(l=function(p){return p.map(E=>function(S){return new ku(Co(S.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(E))}(e.orderBy));let c=null;e.limit&&(c=function(p){let E;return E=typeof p=="object"?p.value:p,Af(E)?null:E}(e.limit));let f=null;e.startAt&&(f=function(p){const E=!!p.before,T=p.values||[];return new cf(T,E)}(e.startAt));let h=null;return e.endAt&&(h=function(p){const E=!p.before,T=p.values||[];return new cf(T,E)}(e.endAt)),yP(t,n,l,a,c,"F",f,h)}function JP(r,t){const e=function(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return wt(28987,{purpose:n})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function LR(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const i=Co(e.unaryFilter.field);return Be.create(i,"==",{doubleValue:NaN});case"IS_NULL":const n=Co(e.unaryFilter.field);return Be.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Co(e.unaryFilter.field);return Be.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Co(e.unaryFilter.field);return Be.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return wt(61313);default:return wt(60726)}}(r):r.fieldFilter!==void 0?function(e){return Be.create(Co(e.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return wt(58110);default:return wt(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return In.create(e.compositeFilter.filters.map(i=>LR(i)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return wt(1026)}}(e.compositeFilter.op))}(r):wt(30097,{filter:r})}function tM(r){return GP[r]}function eM(r){return $P[r]}function iM(r){return HP[r]}function Do(r){return{fieldPath:r.canonicalString()}}function Co(r){return gi.fromServerFormat(r.fieldPath)}function DR(r){return r instanceof Be?function(e){if(e.op==="=="){if(gS(e.value))return{unaryFilter:{field:Do(e.field),op:"IS_NAN"}};if(dS(e.value))return{unaryFilter:{field:Do(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(gS(e.value))return{unaryFilter:{field:Do(e.field),op:"IS_NOT_NAN"}};if(dS(e.value))return{unaryFilter:{field:Do(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Do(e.field),op:eM(e.op),value:e.value}}}(r):r instanceof In?function(e){const i=e.getFilters().map(n=>DR(n));return i.length===1?i[0]:{compositeFilter:{op:iM(e.op),filters:i}}}(r):wt(54877,{filter:r})}function nM(r){const t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function CR(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(t,e,i,n,a=Mt.min(),l=Mt.min(),c=mi.EMPTY_BYTE_STRING,f=null){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=n,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=c,this.expectedCount=f}withSequenceNumber(t){return new vr(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new vr(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new vr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new vr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(t){this.gt=t}}function rM(r){const t=ZP({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Hm(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(){this.Dn=new oM}addToCollectionParentIndex(t,e){return this.Dn.add(e),dt.resolve()}getCollectionParents(t,e){return dt.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return dt.resolve()}deleteFieldIndex(t,e){return dt.resolve()}deleteAllFieldIndexes(t){return dt.resolve()}createTargetIndexes(t,e){return dt.resolve()}getDocumentsMatchingTarget(t,e){return dt.resolve(null)}getIndexType(t,e){return dt.resolve(0)}getFieldIndexes(t,e){return dt.resolve([])}getNextCollectionGroupToUpdate(t){return dt.resolve(null)}getMinOffset(t,e){return dt.resolve(Ir.min())}getMinOffsetFromCollectionGroup(t,e){return dt.resolve(Ir.min())}updateCollectionGroup(t,e,i){return dt.resolve()}updateIndexEntries(t,e){return dt.resolve()}}class oM{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),n=this.index[e]||new We(Te.comparator),a=!n.has(i);return this.index[e]=n.add(i),a}has(t){const e=t.lastSegment(),i=t.popLast(),n=this.index[e];return n&&n.has(i)}getEntries(t){return(this.index[t]||new We(Te.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wR=41943040;class Pi{static withCacheSize(t){return new Pi(t,Pi.DEFAULT_COLLECTION_PERCENTILE,Pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pi.DEFAULT_COLLECTION_PERCENTILE=10,Pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pi.DEFAULT=new Pi(wR,Pi.DEFAULT_COLLECTION_PERCENTILE,Pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pi.DISABLED=new Pi(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new Ko(0)}static ur(){return new Ko(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DS="LruGarbageCollector",lM=1048576;function CS([r,t],[e,i]){const n=Gt(r,e);return n===0?Gt(t,i):n}class uM{constructor(t){this.Tr=t,this.buffer=new We(CS),this.Ir=0}dr(){return++this.Ir}Er(t){const e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{const i=this.buffer.last();CS(e,i)<0&&(this.buffer=this.buffer.delete(i).add(e))}}get maxValue(){return this.buffer.last()[0]}}class cM{constructor(t,e,i){this.garbageCollector=t,this.asyncQueue=e,this.localStore=i,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){St(DS,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Qo(e)?St(DS,"Ignoring IndexedDB error during garbage collection: ",e):await Yo(e)}await this.Rr(3e5)})}}class hM{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(i=>Math.floor(e/100*i))}nthSequenceNumber(t,e){if(e===0)return dt.resolve(Sf.ue);const i=new uM(e);return this.Vr.forEachTarget(t,n=>i.Er(n.sequenceNumber)).next(()=>this.Vr.gr(t,n=>i.Er(n))).next(()=>i.maxValue)}removeTargets(t,e,i){return this.Vr.removeTargets(t,e,i)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(St("LruGarbageCollector","Garbage collection skipped; disabled"),dt.resolve(LS)):this.getCacheSize(t).next(i=>i<this.params.cacheSizeCollectionThreshold?(St("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),LS):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let i,n,a,l,c,f,h;const g=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(St("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),n=this.params.maximumSequenceNumbersToCollect):n=p,l=Date.now(),this.nthSequenceNumber(t,n))).next(p=>(i=p,c=Date.now(),this.removeTargets(t,i,e))).next(p=>(a=p,f=Date.now(),this.removeOrphanedDocuments(t,i))).next(p=>(h=Date.now(),Io()<=Jt.DEBUG&&St("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-g}ms
	Determined least recently used ${n} in `+(c-l)+`ms
	Removed ${a} targets in `+(f-c)+`ms
	Removed ${p} documents in `+(h-f)+`ms
Total Duration: ${h-g}ms`),dt.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:a,documentsRemoved:p})))}}function fM(r,t){return new hM(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(){this.changes=new xa(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ai.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return i!==void 0?dt.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gM{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mM{constructor(t,e,i,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=n}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(n=>(i=n,this.remoteDocumentCache.getEntry(t,e))).next(n=>(i!==null&&Tu(i.mutation,n,xn.empty(),Se.now()),n))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,jt()).next(()=>i))}getLocalViewOfDocuments(t,e,i=jt()){const n=ya();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,i).next(a=>{let l=uu();return a.forEach((c,f)=>{l=l.insert(c,f.overlayedDocument)}),l}))}getOverlayedDocuments(t,e){const i=ya();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,jt()))}populateOverlays(t,e,i){const n=[];return i.forEach(a=>{e.has(a)||n.push(a)}),this.documentOverlayCache.getOverlays(t,n).next(a=>{a.forEach((l,c)=>{e.set(l,c)})})}computeViews(t,e,i,n){let a=Bs();const l=vu(),c=function(){return vu()}();return e.forEach((f,h)=>{const g=i.get(h.key);n.has(h.key)&&(g===void 0||g.mutation instanceof Ia)?a=a.insert(h.key,h):g!==void 0?(l.set(h.key,g.mutation.getFieldMask()),Tu(g.mutation,h,g.mutation.getFieldMask(),Se.now())):l.set(h.key,xn.empty())}),this.recalculateAndSaveOverlays(t,a).next(f=>(f.forEach((h,g)=>l.set(h,g)),e.forEach((h,g)=>{var p;return c.set(h,new gM(g,(p=l.get(h))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(t,e){const i=vu();let n=new Ie((l,c)=>l-c),a=jt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(l=>{for(const c of l)c.keys().forEach(f=>{const h=e.get(f);if(h===null)return;let g=i.get(f)||xn.empty();g=c.applyToLocalView(h,g),i.set(f,g);const p=(n.get(c.batchId)||jt()).add(f);n=n.insert(c.batchId,p)})}).next(()=>{const l=[],c=n.getReverseIterator();for(;c.hasNext();){const f=c.getNext(),h=f.key,g=f.value,p=fR();g.forEach(E=>{if(!a.has(E)){const T=ER(e.get(E),i.get(E));T!==null&&p.set(E,T),a=a.add(E)}}),l.push(this.documentOverlayCache.saveOverlays(t,h,p))}return dt.waitFor(l)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i,n){return function(l){return It.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):oR(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,n):this.getDocumentsMatchingCollectionQuery(t,e,i,n)}getNextDocuments(t,e,i,n){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,n).next(a=>{const l=n-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,n-a.size):dt.resolve(ya());let c=wu,f=a;return l.next(h=>dt.forEach(h,(g,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),a.get(g)?dt.resolve():this.remoteDocumentCache.getEntry(t,g).next(E=>{f=f.insert(g,E)}))).next(()=>this.populateOverlays(t,h,a)).next(()=>this.computeViews(t,f,h,jt())).next(g=>({batchId:c,changes:hR(g)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new It(e)).next(i=>{let n=uu();return i.isFoundDocument()&&(n=n.insert(i.key,i)),n})}getDocumentsMatchingCollectionGroupQuery(t,e,i,n){const a=e.collectionGroup;let l=uu();return this.indexManager.getCollectionParents(t,a).next(c=>dt.forEach(c,f=>{const h=function(p,E){return new Xo(E,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,f.child(a));return this.getDocumentsMatchingCollectionQuery(t,h,i,n).next(g=>{g.forEach((p,E)=>{l=l.insert(p,E)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(t,e,i,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next(l=>(a=l,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,a,n))).next(l=>{a.forEach((f,h)=>{const g=h.getKey();l.get(g)===null&&(l=l.insert(g,Ai.newInvalidDocument(g)))});let c=uu();return l.forEach((f,h)=>{const g=a.get(f);g!==void 0&&Tu(g.mutation,h,xn.empty(),Se.now()),bf(e,h)&&(c=c.insert(f,h))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return dt.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,function(n){return{id:n.id,version:n.version,createTime:Jn(n.createTime)}}(e)),dt.resolve()}getNamedQuery(t,e){return dt.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,function(n){return{name:n.name,query:rM(n.bundledQuery),readTime:Jn(n.readTime)}}(e)),dt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(){this.overlays=new Ie(It.comparator),this.kr=new Map}getOverlay(t,e){return dt.resolve(this.overlays.get(e))}getOverlays(t,e){const i=ya();return dt.forEach(e,n=>this.getOverlay(t,n).next(a=>{a!==null&&i.set(n,a)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((n,a)=>{this.wt(t,e,a)}),dt.resolve()}removeOverlaysForBatchId(t,e,i){const n=this.kr.get(i);return n!==void 0&&(n.forEach(a=>this.overlays=this.overlays.remove(a)),this.kr.delete(i)),dt.resolve()}getOverlaysForCollection(t,e,i){const n=ya(),a=e.length+1,l=new It(e.child("")),c=this.overlays.getIteratorFrom(l);for(;c.hasNext();){const f=c.getNext().value,h=f.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===a&&f.largestBatchId>i&&n.set(f.getKey(),f)}return dt.resolve(n)}getOverlaysForCollectionGroup(t,e,i,n){let a=new Ie((h,g)=>h-g);const l=this.overlays.getIterator();for(;l.hasNext();){const h=l.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>i){let g=a.get(h.largestBatchId);g===null&&(g=ya(),a=a.insert(h.largestBatchId,g)),g.set(h.getKey(),h)}}const c=ya(),f=a.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((h,g)=>c.set(h,g)),!(c.size()>=n)););return dt.resolve(c)}wt(t,e,i){const n=this.overlays.get(i.key);if(n!==null){const l=this.kr.get(n.largestBatchId).delete(i.key);this.kr.set(n.largestBatchId,l)}this.overlays=this.overlays.insert(i.key,new NP(e,i));let a=this.kr.get(e);a===void 0&&(a=jt(),this.kr.set(e,a)),this.kr.set(e,a.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EM{constructor(){this.sessionToken=mi.EMPTY_BYTE_STRING}getSessionToken(t){return dt.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,dt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(){this.qr=new We(ri.Qr),this.$r=new We(ri.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){const i=new ri(t,e);this.qr=this.qr.add(i),this.$r=this.$r.add(i)}Kr(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.Wr(new ri(t,e))}Gr(t,e){t.forEach(i=>this.removeReference(i,e))}zr(t){const e=new It(new Te([])),i=new ri(e,t),n=new ri(e,t+1),a=[];return this.$r.forEachInRange([i,n],l=>{this.Wr(l),a.push(l.key)}),a}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){const e=new It(new Te([])),i=new ri(e,t),n=new ri(e,t+1);let a=jt();return this.$r.forEachInRange([i,n],l=>{a=a.add(l.key)}),a}containsKey(t){const e=new ri(t,0),i=this.qr.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}}class ri{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return It.comparator(t.key,e.key)||Gt(t.Hr,e.Hr)}static Ur(t,e){return Gt(t.Hr,e.Hr)||It.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new We(ri.Qr)}checkEmpty(t){return dt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,n){const a=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new kP(a,e,i,n);this.mutationQueue.push(l);for(const c of n)this.Yr=this.Yr.add(new ri(c.key,a)),this.indexManager.addToCollectionParentIndex(t,c.key.path.popLast());return dt.resolve(l)}lookupMutationBatch(t,e){return dt.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){const i=e+1,n=this.Xr(i),a=n<0?0:n;return dt.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return dt.resolve(this.mutationQueue.length===0?xp:this.er-1)}getAllMutationBatches(t){return dt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new ri(e,0),n=new ri(e,Number.POSITIVE_INFINITY),a=[];return this.Yr.forEachInRange([i,n],l=>{const c=this.Zr(l.Hr);a.push(c)}),dt.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new We(Gt);return e.forEach(n=>{const a=new ri(n,0),l=new ri(n,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([a,l],c=>{i=i.add(c.Hr)})}),dt.resolve(this.ei(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,n=i.length+1;let a=i;It.isDocumentKey(a)||(a=a.child(""));const l=new ri(new It(a),0);let c=new We(Gt);return this.Yr.forEachWhile(f=>{const h=f.key.path;return!!i.isPrefixOf(h)&&(h.length===n&&(c=c.add(f.Hr)),!0)},l),dt.resolve(this.ei(c))}ei(t){const e=[];return t.forEach(i=>{const n=this.Zr(i);n!==null&&e.push(n)}),e}removeMutationBatch(t,e){oe(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Yr;return dt.forEach(e.mutations,n=>{const a=new ri(n.key,e.batchId);return i=i.delete(a),this.referenceDelegate.markPotentiallyOrphaned(t,n.key)}).next(()=>{this.Yr=i})}rr(t){}containsKey(t,e){const i=new ri(e,0),n=this.Yr.firstAfterOrEqual(i);return dt.resolve(e.isEqual(n&&n.key))}performConsistencyCheck(t){return this.mutationQueue.length,dt.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TM{constructor(t){this.ni=t,this.docs=function(){return new Ie(It.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,n=this.docs.get(i),a=n?n.size:0,l=this.ni(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:l}),this.size+=l-a,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return dt.resolve(i?i.document.mutableCopy():Ai.newInvalidDocument(e))}getEntries(t,e){let i=Bs();return e.forEach(n=>{const a=this.docs.get(n);i=i.insert(n,a?a.document.mutableCopy():Ai.newInvalidDocument(n))}),dt.resolve(i)}getDocumentsMatchingQuery(t,e,i,n){let a=Bs();const l=e.path,c=new It(l.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(c);for(;f.hasNext();){const{key:h,value:{document:g}}=f.getNext();if(!l.isPrefixOf(h.path))break;h.path.length>l.length+1||QO(YO(g),i)<=0||(n.has(g.key)||bf(e,g))&&(a=a.insert(g.key,g.mutableCopy()))}return dt.resolve(a)}getAllFromCollectionGroup(t,e,i,n){wt(9500)}ri(t,e){return dt.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new SM(this)}getSize(t){return dt.resolve(this.size)}}class SM extends dM{constructor(t){super(),this.Or=t}applyChanges(t){const e=[];return this.changes.forEach((i,n)=>{n.isValidDocument()?e.push(this.Or.addEntry(t,n)):this.Or.removeEntry(i)}),dt.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AM{constructor(t){this.persistence=t,this.ii=new xa(e=>Dp(e),Cp),this.lastRemoteSnapshotVersion=Mt.min(),this.highestTargetId=0,this.si=0,this.oi=new Np,this.targetCount=0,this._i=Ko.ar()}forEachTarget(t,e){return this.ii.forEach((i,n)=>e(n)),dt.resolve()}getLastRemoteSnapshotVersion(t){return dt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return dt.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),dt.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.si&&(this.si=e),dt.resolve()}hr(t){this.ii.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this._i=new Ko(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,dt.resolve()}updateTargetData(t,e){return this.hr(e),dt.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,dt.resolve()}removeTargets(t,e,i){let n=0;const a=[];return this.ii.forEach((l,c)=>{c.sequenceNumber<=e&&i.get(c.targetId)===null&&(this.ii.delete(l),a.push(this.removeMatchingKeysForTargetId(t,c.targetId)),n++)}),dt.waitFor(a).next(()=>n)}getTargetCount(t){return dt.resolve(this.targetCount)}getTargetData(t,e){const i=this.ii.get(e)||null;return dt.resolve(i)}addMatchingKeys(t,e,i){return this.oi.Kr(e,i),dt.resolve()}removeMatchingKeys(t,e,i){this.oi.Gr(e,i);const n=this.persistence.referenceDelegate,a=[];return n&&e.forEach(l=>{a.push(n.markPotentiallyOrphaned(t,l))}),dt.waitFor(a)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),dt.resolve()}getMatchingKeysForTargetId(t,e){const i=this.oi.Jr(e);return dt.resolve(i)}containsKey(t,e){return dt.resolve(this.oi.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(t,e){this.ai={},this.overlays={},this.ui=new Sf(0),this.ci=!1,this.ci=!0,this.li=new EM,this.referenceDelegate=t(this),this.hi=new AM(this),this.indexManager=new aM,this.remoteDocumentCache=function(n){return new TM(n)}(i=>this.referenceDelegate.Pi(i)),this.serializer=new sM(e),this.Ti=new pM(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new yM,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.ai[t.toKey()];return i||(i=new vM(e,this.referenceDelegate),this.ai[t.toKey()]=i),i}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,i){St("MemoryPersistence","Starting transaction:",t);const n=new _M(this.ui.next());return this.referenceDelegate.Ii(),i(n).next(a=>this.referenceDelegate.di(n).next(()=>a)).toPromise().then(a=>(n.raiseOnCommittedEvent(),a))}Ei(t,e){return dt.or(Object.values(this.ai).map(i=>()=>i.containsKey(t,e)))}}class _M extends WO{constructor(t){super(),this.currentSequenceNumber=t}}class Fp{constructor(t){this.persistence=t,this.Ai=new Np,this.Ri=null}static Vi(t){return new Fp(t)}get mi(){if(this.Ri)return this.Ri;throw wt(60996)}addReference(t,e,i){return this.Ai.addReference(i,e),this.mi.delete(i.toString()),dt.resolve()}removeReference(t,e,i){return this.Ai.removeReference(i,e),this.mi.add(i.toString()),dt.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),dt.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(n=>this.mi.add(n.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(n=>{n.forEach(a=>this.mi.add(a.toString()))}).next(()=>i.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return dt.forEach(this.mi,i=>{const n=It.fromPath(i);return this.fi(t,n).next(a=>{a||e.removeEntry(n,Mt.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(i=>{i?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return dt.or([()=>dt.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}}class df{constructor(t,e){this.persistence=t,this.gi=new xa(i=>tP(i.path),(i,n)=>i.isEqual(n)),this.garbageCollector=fM(this,e)}static Vi(t,e){return new df(t,e)}Ii(){}di(t){return dt.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){const e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(i=>e.next(n=>i+n))}yr(t){let e=0;return this.gr(t,i=>{e++}).next(()=>e)}gr(t,e){return dt.forEach(this.gi,(i,n)=>this.Sr(t,i,n).next(a=>a?dt.resolve():e(n)))}removeTargets(t,e,i){return this.persistence.getTargetCache().removeTargets(t,e,i)}removeOrphanedDocuments(t,e){let i=0;const n=this.persistence.getRemoteDocumentCache(),a=n.newChangeBuffer();return n.ri(t,l=>this.Sr(t,l,e).next(c=>{c||(i++,a.removeEntry(l,Mt.min()))})).next(()=>a.apply(t)).next(()=>i)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),dt.resolve()}removeTarget(t,e){const i=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,i)}addReference(t,e,i){return this.gi.set(i,t.currentSequenceNumber),dt.resolve()}removeReference(t,e,i){return this.gi.set(i,t.currentSequenceNumber),dt.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),dt.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Vh(t.data.value)),e}Sr(t,e,i){return dt.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const n=this.gi.get(e);return dt.resolve(n!==void 0&&n>i)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(t,e,i,n){this.targetId=t,this.fromCache=e,this.Is=i,this.ds=n}static Es(t,e){let i=jt(),n=jt();for(const a of e.docChanges)switch(a.type){case 0:i=i.add(a.doc.key);break;case 1:n=n.add(a.doc.key)}return new Up(t,e.fromCache,i,n)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RM{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return yw()?8:ZO(mw())>0?6:4}()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,i,n){const a={result:null};return this.ps(t,e).next(l=>{a.result=l}).next(()=>{if(!a.result)return this.ys(t,e,n,i).next(l=>{a.result=l})}).next(()=>{if(a.result)return;const l=new RM;return this.ws(t,e,l).next(c=>{if(a.result=c,this.Rs)return this.Ss(t,e,l,c.size)})}).next(()=>a.result)}Ss(t,e,i,n){return i.documentReadCount<this.Vs?(Io()<=Jt.DEBUG&&St("QueryEngine","SDK will not create cache indexes for query:",Lo(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),dt.resolve()):(Io()<=Jt.DEBUG&&St("QueryEngine","Query:",Lo(e),"scans",i.documentReadCount,"local documents and returns",n,"documents as results."),i.documentReadCount>this.fs*n?(Io()<=Jt.DEBUG&&St("QueryEngine","The SDK decides to create cache indexes for query:",Lo(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Zn(e))):dt.resolve())}ps(t,e){if(ES(e))return dt.resolve(null);let i=Zn(e);return this.indexManager.getIndexType(t,i).next(n=>n===0?null:(e.limit!==null&&n===1&&(e=Hm(e,null,"F"),i=Zn(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next(a=>{const l=jt(...a);return this.gs.getDocuments(t,l).next(c=>this.indexManager.getMinOffset(t,i).next(f=>{const h=this.bs(e,c);return this.Ds(e,h,l,f.readTime)?this.ps(t,Hm(e,null,"F")):this.vs(t,h,e,f)}))})))}ys(t,e,i,n){return ES(e)||n.isEqual(Mt.min())?dt.resolve(null):this.gs.getDocuments(t,i).next(a=>{const l=this.bs(e,a);return this.Ds(e,l,i,n)?dt.resolve(null):(Io()<=Jt.DEBUG&&St("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Lo(e)),this.vs(t,l,e,jO(n,wu)).next(c=>c))})}bs(t,e){let i=new We(uR(t));return e.forEach((n,a)=>{bf(t,a)&&(i=i.add(a))}),i}Ds(t,e,i,n){if(t.limit===null)return!1;if(i.size!==e.size)return!0;const a=t.limitType==="F"?e.last():e.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(n)>0)}ws(t,e,i){return Io()<=Jt.DEBUG&&St("QueryEngine","Using full collection scan to execute query:",Lo(e)),this.gs.getDocumentsMatchingQuery(t,e,Ir.min(),i)}vs(t,e,i,n){return this.gs.getDocumentsMatchingQuery(t,i,n).next(a=>(e.forEach(l=>{a=a.insert(l.key,l)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bp="LocalStore",xM=3e8;class IM{constructor(t,e,i,n){this.persistence=t,this.Cs=e,this.serializer=n,this.Fs=new Ie(Gt),this.Ms=new xa(a=>Dp(a),Cp),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(i)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new mM(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}}function LM(r,t,e,i){return new IM(r,t,e,i)}async function PR(r,t){const e=Nt(r);return await e.persistence.runTransaction("Handle user change","readonly",i=>{let n;return e.mutationQueue.getAllMutationBatches(i).next(a=>(n=a,e.Ns(t),e.mutationQueue.getAllMutationBatches(i))).next(a=>{const l=[],c=[];let f=jt();for(const h of n){l.push(h.batchId);for(const g of h.mutations)f=f.add(g.key)}for(const h of a){c.push(h.batchId);for(const g of h.mutations)f=f.add(g.key)}return e.localDocuments.getDocuments(i,f).next(h=>({Bs:h,removedBatchIds:l,addedBatchIds:c}))})})}function DM(r,t){const e=Nt(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const n=t.batch.keys(),a=e.Os.newChangeBuffer({trackRemovals:!0});return function(c,f,h,g){const p=h.batch,E=p.keys();let T=dt.resolve();return E.forEach(S=>{T=T.next(()=>g.getEntry(f,S)).next(R=>{const _=h.docVersions.get(S);oe(_!==null,48541),R.version.compareTo(_)<0&&(p.applyToRemoteDocument(R,h),R.isValidDocument()&&(R.setReadTime(h.commitVersion),g.addEntry(R)))})}),T.next(()=>c.mutationQueue.removeMutationBatch(f,p))}(e,i,t,a).next(()=>a.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,n,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(c){let f=jt();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(f=f.add(c.batch.mutations[h].key));return f}(t))).next(()=>e.localDocuments.getDocuments(i,n))})}function MR(r){const t=Nt(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function CM(r,t){const e=Nt(r),i=t.snapshotVersion;let n=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const l=e.Os.newChangeBuffer({trackRemovals:!0});n=e.Fs;const c=[];t.targetChanges.forEach((g,p)=>{const E=n.get(p);if(!E)return;c.push(e.hi.removeMatchingKeys(a,g.removedDocuments,p).next(()=>e.hi.addMatchingKeys(a,g.addedDocuments,p)));let T=E.withSequenceNumber(a.currentSequenceNumber);t.targetMismatches.get(p)!==null?T=T.withResumeToken(mi.EMPTY_BYTE_STRING,Mt.min()).withLastLimboFreeSnapshotVersion(Mt.min()):g.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(g.resumeToken,i)),n=n.insert(p,T),function(R,_,D){return R.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=xM?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(E,T,g)&&c.push(e.hi.updateTargetData(a,T))});let f=Bs(),h=jt();if(t.documentUpdates.forEach(g=>{t.resolvedLimboDocuments.has(g)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(a,g))}),c.push(wM(a,l,t.documentUpdates).next(g=>{f=g.Ls,h=g.ks})),!i.isEqual(Mt.min())){const g=e.hi.getLastRemoteSnapshotVersion(a).next(p=>e.hi.setTargetsMetadata(a,a.currentSequenceNumber,i));c.push(g)}return dt.waitFor(c).next(()=>l.apply(a)).next(()=>e.localDocuments.getLocalViewOfDocuments(a,f,h)).next(()=>f)}).then(a=>(e.Fs=n,a))}function wM(r,t,e){let i=jt(),n=jt();return e.forEach(a=>i=i.add(a)),t.getEntries(r,i).next(a=>{let l=Bs();return e.forEach((c,f)=>{const h=a.get(c);f.isFoundDocument()!==h.isFoundDocument()&&(n=n.add(c)),f.isNoDocument()&&f.version.isEqual(Mt.min())?(t.removeEntry(c,f.readTime),l=l.insert(c,f)):!h.isValidDocument()||f.version.compareTo(h.version)>0||f.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(f),l=l.insert(c,f)):St(Bp,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",f.version)}),{Ls:l,ks:n}})}function OM(r,t){const e=Nt(r);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(t===void 0&&(t=xp),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}function PM(r,t){const e=Nt(r);return e.persistence.runTransaction("Allocate target","readwrite",i=>{let n;return e.hi.getTargetData(i,t).next(a=>a?(n=a,dt.resolve(n)):e.hi.allocateTargetId(i).next(l=>(n=new vr(t,l,"TargetPurposeListen",i.currentSequenceNumber),e.hi.addTargetData(i,n).next(()=>n))))}).then(i=>{const n=e.Fs.get(i.targetId);return(n===null||i.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(i.targetId,i),e.Ms.set(t,i.targetId)),i})}async function Ym(r,t,e){const i=Nt(r),n=i.Fs.get(t),a=e?"readwrite":"readwrite-primary";try{e||await i.persistence.runTransaction("Release target",a,l=>i.persistence.referenceDelegate.removeTarget(l,n))}catch(l){if(!Qo(l))throw l;St(Bp,`Failed to update sequence numbers for target ${t}: ${l}`)}i.Fs=i.Fs.remove(t),i.Ms.delete(n.target)}function wS(r,t,e){const i=Nt(r);let n=Mt.min(),a=jt();return i.persistence.runTransaction("Execute query","readwrite",l=>function(f,h,g){const p=Nt(f),E=p.Ms.get(g);return E!==void 0?dt.resolve(p.Fs.get(E)):p.hi.getTargetData(h,g)}(i,l,Zn(t)).next(c=>{if(c)return n=c.lastLimboFreeSnapshotVersion,i.hi.getMatchingKeysForTargetId(l,c.targetId).next(f=>{a=f})}).next(()=>i.Cs.getDocumentsMatchingQuery(l,t,e?n:Mt.min(),e?a:jt())).next(c=>(MM(i,vP(t),c),{documents:c,qs:a})))}function MM(r,t,e){let i=r.xs.get(t)||Mt.min();e.forEach((n,a)=>{a.readTime.compareTo(i)>0&&(i=a.readTime)}),r.xs.set(t,i)}class OS{constructor(){this.activeTargetIds=bP()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class kM{constructor(){this.Fo=new OS,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,i){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new OS,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NM{xo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PS="ConnectivityMonitor";class MS{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){St(PS,"Network connectivity changed: AVAILABLE");for(const t of this.ko)t(0)}Lo(){St(PS,"Network connectivity changed: UNAVAILABLE");for(const t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ch=null;function Qm(){return Ch===null?Ch=function(){return 268435456+Math.round(2147483648*Math.random())}():Ch++,"0x"+Ch.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cm="RestConnection",FM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class UM{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${i}/databases/${n}`,this.Ko=this.databaseId.database===lf?`project_id=${i}`:`project_id=${i}&database_id=${n}`}Wo(t,e,i,n,a){const l=Qm(),c=this.Go(t,e.toUriEncodedString());St(cm,`Sending RPC '${t}' ${l}:`,c,i);const f={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(f,n,a);const{host:h}=new URL(c),g=Ap(h);return this.jo(t,c,f,i,g).then(p=>(St(cm,`Received RPC '${t}' ${l}: `,p),p),p=>{throw xr(cm,`RPC '${t}' ${l} failed with error: `,p,"url: ",c,"request:",i),p})}Jo(t,e,i,n,a,l){return this.Wo(t,e,i,n,a)}zo(t,e,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+jo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((n,a)=>t[a]=n),i&&i.headers.forEach((n,a)=>t[a]=n)}Go(t,e){const i=FM[t];return`${this.$o}/v1/${e}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BM{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi="WebChannelConnection";class VM extends UM{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,i,n,a){const l=Qm();return new Promise((c,f)=>{const h=new k_;h.setWithCredentials(!0),h.listenOnce(N_.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Bh.NO_ERROR:const p=h.getResponseJson();St(vi,`XHR for RPC '${t}' ${l} received:`,JSON.stringify(p)),c(p);break;case Bh.TIMEOUT:St(vi,`RPC '${t}' ${l} timed out`),f(new At(ht.DEADLINE_EXCEEDED,"Request time out"));break;case Bh.HTTP_ERROR:const E=h.getStatus();if(St(vi,`RPC '${t}' ${l} failed with status:`,E,"response text:",h.getResponseText()),E>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);const S=T?.error;if(S&&S.status&&S.message){const R=function(D){const N=D.toLowerCase().replace(/_/g,"-");return Object.values(ht).indexOf(N)>=0?N:ht.UNKNOWN}(S.status);f(new At(R,S.message))}else f(new At(ht.UNKNOWN,"Server responded with status "+h.getStatus()))}else f(new At(ht.UNAVAILABLE,"Connection failed."));break;default:wt(9055,{c_:t,streamId:l,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{St(vi,`RPC '${t}' ${l} completed.`)}});const g=JSON.stringify(n);St(vi,`RPC '${t}' ${l} sending request:`,n),h.send(e,"POST",g,i,15)})}P_(t,e,i){const n=Qm(),a=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],l=B_(),c=U_(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(f.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(f.useFetchStreams=!0),this.zo(f.initMessageHeaders,e,i),f.encodeInitMessageHeaders=!0;const g=a.join("");St(vi,`Creating RPC '${t}' stream ${n}: ${g}`,f);const p=l.createWebChannel(g,f);this.T_(p);let E=!1,T=!1;const S=new BM({Ho:_=>{T?St(vi,`Not sending because RPC '${t}' stream ${n} is closed:`,_):(E||(St(vi,`Opening RPC '${t}' stream ${n} transport.`),p.open(),E=!0),St(vi,`RPC '${t}' stream ${n} sending:`,_),p.send(_))},Yo:()=>p.close()}),R=(_,D,N)=>{_.listen(D,M=>{try{N(M)}catch(G){setTimeout(()=>{throw G},0)}})};return R(p,lu.EventType.OPEN,()=>{T||(St(vi,`RPC '${t}' stream ${n} transport opened.`),S.s_())}),R(p,lu.EventType.CLOSE,()=>{T||(T=!0,St(vi,`RPC '${t}' stream ${n} transport closed`),S.__(),this.I_(p))}),R(p,lu.EventType.ERROR,_=>{T||(T=!0,xr(vi,`RPC '${t}' stream ${n} transport errored. Name:`,_.name,"Message:",_.message),S.__(new At(ht.UNAVAILABLE,"The operation could not be completed")))}),R(p,lu.EventType.MESSAGE,_=>{var D;if(!T){const N=_.data[0];oe(!!N,16349);const M=N,G=M?.error||((D=M[0])===null||D===void 0?void 0:D.error);if(G){St(vi,`RPC '${t}' stream ${n} received error:`,G);const $=G.status;let q=function(O){const C=Ue[O];if(C!==void 0)return SR(C)}($),w=G.message;q===void 0&&(q=ht.INTERNAL,w="Unknown error status: "+$+" with message "+G.message),T=!0,S.__(new At(q,w)),p.close()}else St(vi,`RPC '${t}' stream ${n} received:`,N),S.a_(N)}}),R(c,F_.STAT_EVENT,_=>{_.stat===Nm.PROXY?St(vi,`RPC '${t}' stream ${n} detected buffering proxy`):_.stat===Nm.NOPROXY&&St(vi,`RPC '${t}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{S.o_()},0),S}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}}function hm(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(r){return new KP(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(t,e,i=1e3,n=1.5,a=6e4){this.Fi=t,this.timerId=e,this.d_=i,this.E_=n,this.A_=a,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();const e=Math.floor(this.R_+this.p_()),i=Math.max(0,Date.now()-this.m_),n=Math.max(0,e-i);n>0&&St("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,n,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kS="PersistentStream";class NR{constructor(t,e,i,n,a,l,c,f){this.Fi=t,this.w_=i,this.S_=n,this.connection=a,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=c,this.listener=f,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new kR(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===ht.RESOURCE_EXHAUSTED?(Us(e.toString()),Us("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===ht.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.n_(e)}U_(){}auth(){this.state=1;const t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,n])=>{this.b_===e&&this.W_(i,n)},i=>{t(()=>{const n=new At(ht.UNKNOWN,"Fetching auth token failed: "+i.message);return this.G_(n)})})}W_(t,e){const i=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{i(()=>this.listener.Zo())}),this.stream.e_(()=>{i(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(n=>{i(()=>this.G_(n))}),this.stream.onMessage(n=>{i(()=>++this.C_==1?this.j_(n):this.onNext(n))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(t){return St(kS,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(St(kS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class GM extends NR{constructor(t,e,i,n,a,l){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,n,l),this.serializer=a}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();const e=jP(this.serializer,t),i=function(a){if(!("targetChange"in a))return Mt.min();const l=a.targetChange;return l.targetIds&&l.targetIds.length?Mt.min():l.readTime?Jn(l.readTime):Mt.min()}(t);return this.listener.J_(e,i)}H_(t){const e={};e.database=jm(this.serializer),e.addTarget=function(a,l){let c;const f=l.target;if(c=Gm(f)?{documents:XP(a,f)}:{query:WP(a,f).Vt},c.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){c.resumeToken=RR(a,l.resumeToken);const h=Km(a,l.expectedCount);h!==null&&(c.expectedCount=h)}else if(l.snapshotVersion.compareTo(Mt.min())>0){c.readTime=ff(a,l.snapshotVersion.toTimestamp());const h=Km(a,l.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,t);const i=JP(this.serializer,t);i&&(e.labels=i),this.k_(e)}Y_(t){const e={};e.database=jm(this.serializer),e.removeTarget=t,this.k_(e)}}class $M extends NR{constructor(t,e,i,n,a,l){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,n,l),this.serializer=a}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return oe(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,oe(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){oe(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();const e=QP(t.writeResults,t.commitTime),i=Jn(t.commitTime);return this.listener.ta(i,e)}na(){const t={};t.database=jm(this.serializer),this.k_(t)}X_(t){const e={streamToken:this.lastStreamToken,writes:t.map(i=>YP(this.serializer,i))};this.k_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HM{}class KM extends HM{constructor(t,e,i,n){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=n,this.ra=!1}ia(){if(this.ra)throw new At(ht.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,i,n){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Wo(t,zm(e,i),n,a,l)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ht.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new At(ht.UNKNOWN,a.toString())})}Jo(t,e,i,n,a){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,c])=>this.connection.Jo(t,zm(e,i),n,l,c,a)).catch(l=>{throw l.name==="FirebaseError"?(l.code===ht.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new At(ht.UNKNOWN,l.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class zM{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Us(e),this._a=!1):St("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra="RemoteStore";class qM{constructor(t,e,i,n,a){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=a,this.Ea.xo(l=>{i.enqueueAndForget(async()=>{La(this)&&(St(Ra,"Restarting streams for network reachability change."),await async function(f){const h=Nt(f);h.Ia.add(4),await $u(h),h.Aa.set("Unknown"),h.Ia.delete(4),await Cf(h)}(this))})}),this.Aa=new zM(i,n)}}async function Cf(r){if(La(r))for(const t of r.da)await t(!0)}async function $u(r){for(const t of r.da)await t(!1)}function FR(r,t){const e=Nt(r);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),Hp(e)?$p(e):Wo(e).x_()&&Gp(e,t))}function Vp(r,t){const e=Nt(r),i=Wo(e);e.Ta.delete(t),i.x_()&&UR(e,t),e.Ta.size===0&&(i.x_()?i.B_():La(e)&&e.Aa.set("Unknown"))}function Gp(r,t){if(r.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Mt.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Wo(r).H_(t)}function UR(r,t){r.Ra.$e(t),Wo(r).Y_(t)}function $p(r){r.Ra=new VP({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>r.Ta.get(t)||null,lt:()=>r.datastore.serializer.databaseId}),Wo(r).start(),r.Aa.aa()}function Hp(r){return La(r)&&!Wo(r).M_()&&r.Ta.size>0}function La(r){return Nt(r).Ia.size===0}function BR(r){r.Ra=void 0}async function jM(r){r.Aa.set("Online")}async function YM(r){r.Ta.forEach((t,e)=>{Gp(r,t)})}async function QM(r,t){BR(r),Hp(r)?(r.Aa.la(t),$p(r)):r.Aa.set("Unknown")}async function XM(r,t,e){if(r.Aa.set("Online"),t instanceof _R&&t.state===2&&t.cause)try{await async function(n,a){const l=a.cause;for(const c of a.targetIds)n.Ta.has(c)&&(await n.remoteSyncer.rejectListen(c,l),n.Ta.delete(c),n.Ra.removeTarget(c))}(r,t)}catch(i){St(Ra,"Failed to remove targets %s: %s ",t.targetIds.join(","),i),await gf(r,i)}else if(t instanceof Hh?r.Ra.Ye(t):t instanceof AR?r.Ra.it(t):r.Ra.et(t),!e.isEqual(Mt.min()))try{const i=await MR(r.localStore);e.compareTo(i)>=0&&await function(a,l){const c=a.Ra.Pt(l);return c.targetChanges.forEach((f,h)=>{if(f.resumeToken.approximateByteSize()>0){const g=a.Ta.get(h);g&&a.Ta.set(h,g.withResumeToken(f.resumeToken,l))}}),c.targetMismatches.forEach((f,h)=>{const g=a.Ta.get(f);if(!g)return;a.Ta.set(f,g.withResumeToken(mi.EMPTY_BYTE_STRING,g.snapshotVersion)),UR(a,f);const p=new vr(g.target,f,h,g.sequenceNumber);Gp(a,p)}),a.remoteSyncer.applyRemoteEvent(c)}(r,e)}catch(i){St(Ra,"Failed to raise snapshot:",i),await gf(r,i)}}async function gf(r,t,e){if(!Qo(t))throw t;r.Ia.add(1),await $u(r),r.Aa.set("Offline"),e||(e=()=>MR(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{St(Ra,"Retrying IndexedDB access"),await e(),r.Ia.delete(1),await Cf(r)})}function VR(r,t){return t().catch(e=>gf(r,e,t))}async function wf(r){const t=Nt(r),e=wr(t);let i=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:xp;for(;WM(t);)try{const n=await OM(t.localStore,i);if(n===null){t.Pa.length===0&&e.B_();break}i=n.batchId,ZM(t,n)}catch(n){await gf(t,n)}GR(t)&&$R(t)}function WM(r){return La(r)&&r.Pa.length<10}function ZM(r,t){r.Pa.push(t);const e=wr(r);e.x_()&&e.Z_&&e.X_(t.mutations)}function GR(r){return La(r)&&!wr(r).M_()&&r.Pa.length>0}function $R(r){wr(r).start()}async function JM(r){wr(r).na()}async function tk(r){const t=wr(r);for(const e of r.Pa)t.X_(e.mutations)}async function ek(r,t,e){const i=r.Pa.shift(),n=Pp.from(i,t,e);await VR(r,()=>r.remoteSyncer.applySuccessfulWrite(n)),await wf(r)}async function ik(r,t){t&&wr(r).Z_&&await async function(i,n){if(function(l){return UP(l)&&l!==ht.ABORTED}(n.code)){const a=i.Pa.shift();wr(i).N_(),await VR(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,n)),await wf(i)}}(r,t),GR(r)&&$R(r)}async function NS(r,t){const e=Nt(r);e.asyncQueue.verifyOperationInProgress(),St(Ra,"RemoteStore received new credentials");const i=La(e);e.Ia.add(3),await $u(e),i&&e.Aa.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),await Cf(e)}async function nk(r,t){const e=Nt(r);t?(e.Ia.delete(2),await Cf(e)):t||(e.Ia.add(2),await $u(e),e.Aa.set("Unknown"))}function Wo(r){return r.Va||(r.Va=function(e,i,n){const a=Nt(e);return a.ia(),new GM(i,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,n)}(r.datastore,r.asyncQueue,{Zo:jM.bind(null,r),e_:YM.bind(null,r),n_:QM.bind(null,r),J_:XM.bind(null,r)}),r.da.push(async t=>{t?(r.Va.N_(),Hp(r)?$p(r):r.Aa.set("Unknown")):(await r.Va.stop(),BR(r))})),r.Va}function wr(r){return r.ma||(r.ma=function(e,i,n){const a=Nt(e);return a.ia(),new $M(i,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,n)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:JM.bind(null,r),n_:ik.bind(null,r),ea:tk.bind(null,r),ta:ek.bind(null,r)}),r.da.push(async t=>{t?(r.ma.N_(),await wf(r)):(await r.ma.stop(),r.Pa.length>0&&(St(Ra,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))})),r.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(t,e,i,n,a){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=n,this.removalCallback=a,this.deferred=new va,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,n,a){const l=Date.now()+i,c=new Kp(t,e,l,n,a);return c.start(i),c}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new At(ht.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zp(r,t){if(Us("AsyncQueue",`${t}: ${r}`),Qo(r))return new At(ht.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{static emptySet(t){return new No(t.comparator)}constructor(t){this.comparator=t?(e,i)=>t(e,i)||It.comparator(e.key,i.key):(e,i)=>It.comparator(e.key,i.key),this.keyedMap=uu(),this.sortedSet=new Ie(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,i)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof No)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){const n=e.getNext().key,a=i.getNext().key;if(!n.isEqual(a))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const i=new No;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(){this.fa=new Ie(It.comparator)}track(t){const e=t.doc.key,i=this.fa.get(e);i?t.type!==0&&i.type===3?this.fa=this.fa.insert(e,t):t.type===3&&i.type!==1?this.fa=this.fa.insert(e,{type:i.type,doc:t.doc}):t.type===2&&i.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&i.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&i.type===0?this.fa=this.fa.remove(e):t.type===1&&i.type===2?this.fa=this.fa.insert(e,{type:1,doc:i.doc}):t.type===0&&i.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):wt(63341,{At:t,ga:i}):this.fa=this.fa.insert(e,t)}pa(){const t=[];return this.fa.inorderTraversal((e,i)=>{t.push(i)}),t}}class zo{constructor(t,e,i,n,a,l,c,f,h){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=n,this.mutatedKeys=a,this.fromCache=l,this.syncStateChanged=c,this.excludesMetadataChanges=f,this.hasCachedResults=h}static fromInitialDocuments(t,e,i,n,a){const l=[];return e.forEach(c=>{l.push({type:0,doc:c})}),new zo(t,e,No.emptySet(e),l,i,n,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Rf(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(e[n].type!==i[n].type||!e[n].doc.isEqual(i[n].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sk{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}}class rk{constructor(){this.queries=US(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,i){const n=Nt(e),a=n.queries;n.queries=US(),a.forEach((l,c)=>{for(const f of c.wa)f.onError(i)})})(this,new At(ht.ABORTED,"Firestore shutting down"))}}function US(){return new xa(r=>lR(r),Rf)}async function ak(r,t){const e=Nt(r);let i=3;const n=t.query;let a=e.queries.get(n);a?!a.Sa()&&t.ba()&&(i=2):(a=new sk,i=t.ba()?0:1);try{switch(i){case 0:a.ya=await e.onListen(n,!0);break;case 1:a.ya=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(l){const c=zp(l,`Initialization of query '${Lo(t.query)}' failed`);return void t.onError(c)}e.queries.set(n,a),a.wa.push(t),t.va(e.onlineState),a.ya&&t.Ca(a.ya)&&qp(e)}async function ok(r,t){const e=Nt(r),i=t.query;let n=3;const a=e.queries.get(i);if(a){const l=a.wa.indexOf(t);l>=0&&(a.wa.splice(l,1),a.wa.length===0?n=t.ba()?0:1:!a.Sa()&&t.ba()&&(n=2))}switch(n){case 0:return e.queries.delete(i),e.onUnlisten(i,!0);case 1:return e.queries.delete(i),e.onUnlisten(i,!1);case 2:return e.onLastRemoteStoreUnlisten(i);default:return}}function lk(r,t){const e=Nt(r);let i=!1;for(const n of t){const a=n.query,l=e.queries.get(a);if(l){for(const c of l.wa)c.Ca(n)&&(i=!0);l.ya=n}}i&&qp(e)}function uk(r,t,e){const i=Nt(r),n=i.queries.get(t);if(n)for(const a of n.wa)a.onError(e);i.queries.delete(t)}function qp(r){r.Da.forEach(t=>{t.next()})}var Xm,BS;(BS=Xm||(Xm={})).Fa="default",BS.Cache="cache";class ck{constructor(t,e,i){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=i||{}}Ca(t){if(!this.options.includeMetadataChanges){const i=[];for(const n of t.docChanges)n.type!==3&&i.push(n);t=new zo(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;const i=e!=="Offline";return(!this.options.ka||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;const e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=zo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==Xm.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(t){this.key=t}}class KR{constructor(t){this.key=t}}class hk{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=jt(),this.mutatedKeys=jt(),this.Xa=uR(t),this.eu=new No(this.Xa)}get tu(){return this.Ha}nu(t,e){const i=e?e.ru:new FS,n=e?e.eu:this.eu;let a=e?e.mutatedKeys:this.mutatedKeys,l=n,c=!1;const f=this.query.limitType==="F"&&n.size===this.query.limit?n.last():null,h=this.query.limitType==="L"&&n.size===this.query.limit?n.first():null;if(t.inorderTraversal((g,p)=>{const E=n.get(g),T=bf(this.query,p)?p:null,S=!!E&&this.mutatedKeys.has(E.key),R=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let _=!1;E&&T?E.data.isEqual(T.data)?S!==R&&(i.track({type:3,doc:T}),_=!0):this.iu(E,T)||(i.track({type:2,doc:T}),_=!0,(f&&this.Xa(T,f)>0||h&&this.Xa(T,h)<0)&&(c=!0)):!E&&T?(i.track({type:0,doc:T}),_=!0):E&&!T&&(i.track({type:1,doc:E}),_=!0,(f||h)&&(c=!0)),_&&(T?(l=l.add(T),a=R?a.add(g):a.delete(g)):(l=l.delete(g),a=a.delete(g)))}),this.query.limit!==null)for(;l.size>this.query.limit;){const g=this.query.limitType==="F"?l.last():l.first();l=l.delete(g.key),a=a.delete(g.key),i.track({type:1,doc:g})}return{eu:l,ru:i,Ds:c,mutatedKeys:a}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i,n){const a=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;const l=t.ru.pa();l.sort((g,p)=>function(T,S){const R=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return wt(20277,{At:_})}};return R(T)-R(S)}(g.type,p.type)||this.Xa(g.doc,p.doc)),this.su(i),n=n!=null&&n;const c=e&&!n?this.ou():[],f=this.Za.size===0&&this.current&&!n?1:0,h=f!==this.Ya;return this.Ya=f,l.length!==0||h?{snapshot:new zo(this.query,t.eu,a,l,t.mutatedKeys,f===0,h,!1,!!i&&i.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new FS,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];const t=this.Za;this.Za=jt(),this.eu.forEach(i=>{this.au(i.key)&&(this.Za=this.Za.add(i.key))});const e=[];return t.forEach(i=>{this.Za.has(i)||e.push(new KR(i))}),this.Za.forEach(i=>{t.has(i)||e.push(new HR(i))}),e}uu(t){this.Ha=t.qs,this.Za=jt();const e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return zo.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const jp="SyncEngine";class fk{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}}class dk{constructor(t){this.key=t,this.lu=!1}}class gk{constructor(t,e,i,n,a,l){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=n,this.currentUser=a,this.maxConcurrentLimboResolutions=l,this.hu={},this.Pu=new xa(c=>lR(c),Rf),this.Tu=new Map,this.Iu=new Set,this.du=new Ie(It.comparator),this.Eu=new Map,this.Au=new Np,this.Ru={},this.Vu=new Map,this.mu=Ko.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function mk(r,t,e=!0){const i=XR(r);let n;const a=i.Pu.get(t);return a?(i.sharedClientState.addLocalQueryTarget(a.targetId),n=a.view.cu()):n=await zR(i,t,e,!0),n}async function pk(r,t){const e=XR(r);await zR(e,t,!0,!1)}async function zR(r,t,e,i){const n=await PM(r.localStore,Zn(t)),a=n.targetId,l=r.sharedClientState.addLocalQueryTarget(a,e);let c;return i&&(c=await yk(r,t,a,l==="current",n.resumeToken)),r.isPrimaryClient&&e&&FR(r.remoteStore,n),c}async function yk(r,t,e,i,n){r.gu=(p,E,T)=>async function(R,_,D,N){let M=_.view.nu(D);M.Ds&&(M=await wS(R.localStore,_.query,!1).then(({documents:w})=>_.view.nu(w,M)));const G=N&&N.targetChanges.get(_.targetId),$=N&&N.targetMismatches.get(_.targetId)!=null,q=_.view.applyChanges(M,R.isPrimaryClient,G,$);return GS(R,_.targetId,q._u),q.snapshot}(r,p,E,T);const a=await wS(r.localStore,t,!0),l=new hk(t,a.qs),c=l.nu(a.documents),f=Gu.createSynthesizedTargetChangeForCurrentChange(e,i&&r.onlineState!=="Offline",n),h=l.applyChanges(c,r.isPrimaryClient,f);GS(r,e,h._u);const g=new fk(t,e,l);return r.Pu.set(t,g),r.Tu.has(e)?r.Tu.get(e).push(t):r.Tu.set(e,[t]),h.snapshot}async function Ek(r,t,e){const i=Nt(r),n=i.Pu.get(t),a=i.Tu.get(n.targetId);if(a.length>1)return i.Tu.set(n.targetId,a.filter(l=>!Rf(l,t))),void i.Pu.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(n.targetId),i.sharedClientState.isActiveQueryTarget(n.targetId)||await Ym(i.localStore,n.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(n.targetId),e&&Vp(i.remoteStore,n.targetId),Wm(i,n.targetId)}).catch(Yo)):(Wm(i,n.targetId),await Ym(i.localStore,n.targetId,!0))}async function vk(r,t){const e=Nt(r),i=e.Pu.get(t),n=e.Tu.get(i.targetId);e.isPrimaryClient&&n.length===1&&(e.sharedClientState.removeLocalQueryTarget(i.targetId),Vp(e.remoteStore,i.targetId))}async function Tk(r,t,e){const i=Ik(r);try{const n=await function(l,c){const f=Nt(l),h=Se.now(),g=c.reduce((T,S)=>T.add(S.key),jt());let p,E;return f.persistence.runTransaction("Locally write mutations","readwrite",T=>{let S=Bs(),R=jt();return f.Os.getEntries(T,g).next(_=>{S=_,S.forEach((D,N)=>{N.isValidDocument()||(R=R.add(D))})}).next(()=>f.localDocuments.getOverlayedDocuments(T,S)).next(_=>{p=_;const D=[];for(const N of c){const M=PP(N,p.get(N.key).overlayedDocument);M!=null&&D.push(new Ia(N.key,M,tR(M.value.mapValue),Ns.exists(!0)))}return f.mutationQueue.addMutationBatch(T,h,D,c)}).next(_=>{E=_;const D=_.applyToLocalDocumentSet(p,R);return f.documentOverlayCache.saveOverlays(T,_.batchId,D)})}).then(()=>({batchId:E.batchId,changes:hR(p)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(n.batchId),function(l,c,f){let h=l.Ru[l.currentUser.toKey()];h||(h=new Ie(Gt)),h=h.insert(c,f),l.Ru[l.currentUser.toKey()]=h}(i,n.batchId,e),await Hu(i,n.changes),await wf(i.remoteStore)}catch(n){const a=zp(n,"Failed to persist write");e.reject(a)}}async function qR(r,t){const e=Nt(r);try{const i=await CM(e.localStore,t);t.targetChanges.forEach((n,a)=>{const l=e.Eu.get(a);l&&(oe(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,22616),n.addedDocuments.size>0?l.lu=!0:n.modifiedDocuments.size>0?oe(l.lu,14607):n.removedDocuments.size>0&&(oe(l.lu,42227),l.lu=!1))}),await Hu(e,i,t)}catch(i){await Yo(i)}}function VS(r,t,e){const i=Nt(r);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){const n=[];i.Pu.forEach((a,l)=>{const c=l.view.va(t);c.snapshot&&n.push(c.snapshot)}),function(l,c){const f=Nt(l);f.onlineState=c;let h=!1;f.queries.forEach((g,p)=>{for(const E of p.wa)E.va(c)&&(h=!0)}),h&&qp(f)}(i.eventManager,t),n.length&&i.hu.J_(n),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Sk(r,t,e){const i=Nt(r);i.sharedClientState.updateQueryState(t,"rejected",e);const n=i.Eu.get(t),a=n&&n.key;if(a){let l=new Ie(It.comparator);l=l.insert(a,Ai.newNoDocument(a,Mt.min()));const c=jt().add(a),f=new Lf(Mt.min(),new Map,new Ie(Gt),l,c);await qR(i,f),i.du=i.du.remove(a),i.Eu.delete(t),Yp(i)}else await Ym(i.localStore,t,!1).then(()=>Wm(i,t,e)).catch(Yo)}async function Ak(r,t){const e=Nt(r),i=t.batch.batchId;try{const n=await DM(e.localStore,t);YR(e,i,null),jR(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await Hu(e,n)}catch(n){await Yo(n)}}async function _k(r,t,e){const i=Nt(r);try{const n=await function(l,c){const f=Nt(l);return f.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let g;return f.mutationQueue.lookupMutationBatch(h,c).next(p=>(oe(p!==null,37113),g=p.keys(),f.mutationQueue.removeMutationBatch(h,p))).next(()=>f.mutationQueue.performConsistencyCheck(h)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(h,g,c)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,g)).next(()=>f.localDocuments.getDocuments(h,g))})}(i.localStore,t);YR(i,t,e),jR(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),await Hu(i,n)}catch(n){await Yo(n)}}function jR(r,t){(r.Vu.get(t)||[]).forEach(e=>{e.resolve()}),r.Vu.delete(t)}function YR(r,t,e){const i=Nt(r);let n=i.Ru[i.currentUser.toKey()];if(n){const a=n.get(t);a&&(e?a.reject(e):a.resolve(),n=n.remove(t)),i.Ru[i.currentUser.toKey()]=n}}function Wm(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const i of r.Tu.get(t))r.Pu.delete(i),e&&r.hu.pu(i,e);r.Tu.delete(t),r.isPrimaryClient&&r.Au.zr(t).forEach(i=>{r.Au.containsKey(i)||QR(r,i)})}function QR(r,t){r.Iu.delete(t.path.canonicalString());const e=r.du.get(t);e!==null&&(Vp(r.remoteStore,e),r.du=r.du.remove(t),r.Eu.delete(e),Yp(r))}function GS(r,t,e){for(const i of e)i instanceof HR?(r.Au.addReference(i.key,t),Rk(r,i)):i instanceof KR?(St(jp,"Document no longer in limbo: "+i.key),r.Au.removeReference(i.key,t),r.Au.containsKey(i.key)||QR(r,i.key)):wt(19791,{yu:i})}function Rk(r,t){const e=t.key,i=e.path.canonicalString();r.du.get(e)||r.Iu.has(i)||(St(jp,"New document in limbo: "+e),r.Iu.add(i),Yp(r))}function Yp(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const t=r.Iu.values().next().value;r.Iu.delete(t);const e=new It(Te.fromString(t)),i=r.mu.next();r.Eu.set(i,new dk(e)),r.du=r.du.insert(e,i),FR(r.remoteStore,new vr(Zn(wp(e.path)),i,"TargetPurposeLimboResolution",Sf.ue))}}async function Hu(r,t,e){const i=Nt(r),n=[],a=[],l=[];i.Pu.isEmpty()||(i.Pu.forEach((c,f)=>{l.push(i.gu(f,t,e).then(h=>{var g;if((h||e)&&i.isPrimaryClient){const p=h?!h.fromCache:(g=e?.targetChanges.get(f.targetId))===null||g===void 0?void 0:g.current;i.sharedClientState.updateQueryState(f.targetId,p?"current":"not-current")}if(h){n.push(h);const p=Up.Es(f.targetId,h);a.push(p)}}))}),await Promise.all(l),i.hu.J_(n),await async function(f,h){const g=Nt(f);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>dt.forEach(h,E=>dt.forEach(E.Is,T=>g.persistence.referenceDelegate.addReference(p,E.targetId,T)).next(()=>dt.forEach(E.ds,T=>g.persistence.referenceDelegate.removeReference(p,E.targetId,T)))))}catch(p){if(!Qo(p))throw p;St(Bp,"Failed to update sequence numbers: "+p)}for(const p of h){const E=p.targetId;if(!p.fromCache){const T=g.Fs.get(E),S=T.snapshotVersion,R=T.withLastLimboFreeSnapshotVersion(S);g.Fs=g.Fs.insert(E,R)}}}(i.localStore,a))}async function bk(r,t){const e=Nt(r);if(!e.currentUser.isEqual(t)){St(jp,"User change. New user:",t.toKey());const i=await PR(e.localStore,t);e.currentUser=t,function(a,l){a.Vu.forEach(c=>{c.forEach(f=>{f.reject(new At(ht.CANCELLED,l))})}),a.Vu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await Hu(e,i.Bs)}}function xk(r,t){const e=Nt(r),i=e.Eu.get(t);if(i&&i.lu)return jt().add(i.key);{let n=jt();const a=e.Tu.get(t);if(!a)return n;for(const l of a){const c=e.Pu.get(l);n=n.unionWith(c.view.tu)}return n}}function XR(r){const t=Nt(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=qR.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=xk.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sk.bind(null,t),t.hu.J_=lk.bind(null,t.eventManager),t.hu.pu=uk.bind(null,t.eventManager),t}function Ik(r){const t=Nt(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ak.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_k.bind(null,t),t}class mf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Df(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)}Cu(t,e){return null}Fu(t,e){return null}vu(t){return LM(this.persistence,new bM,t.initialUser,this.serializer)}Du(t){return new OR(Fp.Vi,this.serializer)}bu(t){return new kM}async terminate(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mf.provider={build:()=>new mf};class Lk extends mf{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){oe(this.persistence.referenceDelegate instanceof df,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new cM(i,t.asyncQueue,e)}Du(t){const e=this.cacheSizeBytes!==void 0?Pi.withCacheSize(this.cacheSizeBytes):Pi.DEFAULT;return new OR(i=>df.Vi(i,e),this.serializer)}}class Zm{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>VS(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=bk.bind(null,this.syncEngine),await nk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new rk}()}createDatastore(t){const e=Df(t.databaseInfo.databaseId),i=function(a){return new VM(a)}(t.databaseInfo);return function(a,l,c,f){return new KM(a,l,c,f)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return function(i,n,a,l,c){return new qM(i,n,a,l,c)}(this.localStore,this.datastore,t.asyncQueue,e=>VS(this.syncEngine,e,0),function(){return MS.C()?new MS:new NM}())}createSyncEngine(t,e){return function(n,a,l,c,f,h,g){const p=new gk(n,a,l,c,f,h);return g&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(n){const a=Nt(n);St(Ra,"RemoteStore shutting down."),a.Ia.add(5),await $u(a),a.Ea.shutdown(),a.Aa.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(e=this.eventManager)===null||e===void 0||e.terminate()}}Zm.provider={build:()=>new Zm};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):Us("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Or="FirestoreClient";class Ck{constructor(t,e,i,n,a){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=n,this.user=Si.UNAUTHENTICATED,this.clientId=bp.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(i,async l=>{St(Or,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(i,l=>(St(Or,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new va;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=zp(e,"Failed to shutdown persistence");t.reject(i)}}),t.promise}}async function fm(r,t){r.asyncQueue.verifyOperationInProgress(),St(Or,"Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let i=e.initialUser;r.setCredentialChangeListener(async n=>{i.isEqual(n)||(await PR(t.localStore,n),i=n)}),t.persistence.setDatabaseDeletedListener(()=>{xr("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{St("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(n=>{xr("Terminating Firestore due to IndexedDb database deletion failed",n)})}),r._offlineComponents=t}async function $S(r,t){r.asyncQueue.verifyOperationInProgress();const e=await wk(r);St(Or,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener(i=>NS(t.remoteStore,i)),r.setAppCheckTokenChangeListener((i,n)=>NS(t.remoteStore,n)),r._onlineComponents=t}async function wk(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){St(Or,"Using user provided OfflineComponentProvider");try{await fm(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(n){return n.name==="FirebaseError"?n.code===ht.FAILED_PRECONDITION||n.code===ht.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}(e))throw e;xr("Error using user provided cache. Falling back to memory cache: "+e),await fm(r,new mf)}}else St(Or,"Using default OfflineComponentProvider"),await fm(r,new Lk(void 0));return r._offlineComponents}async function WR(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(St(Or,"Using user provided OnlineComponentProvider"),await $S(r,r._uninitializedComponentsProvider._online)):(St(Or,"Using default OnlineComponentProvider"),await $S(r,new Zm))),r._onlineComponents}function Ok(r){return WR(r).then(t=>t.syncEngine)}async function HS(r){const t=await WR(r),e=t.eventManager;return e.onListen=mk.bind(null,t.syncEngine),e.onUnlisten=Ek.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=pk.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=vk.bind(null,t.syncEngine),e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZR(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KS=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="firestore.googleapis.com",zS=!0;class qS{constructor(t){var e,i;if(t.host===void 0){if(t.ssl!==void 0)throw new At(ht.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=JR,this.ssl=zS}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:zS;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=wR;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<lM)throw new At(ht.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}qO("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ZR((i=t.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new At(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new At(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new At(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(i,n){return i.timeoutSeconds===n.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Of{constructor(t,e,i,n){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new At(ht.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new At(ht.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qS(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new FO;switch(i.type){case"firstParty":return new GO(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new At(ht.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const i=KS.get(e);i&&(St("ComponentProvider","Removing Datastore"),KS.delete(e),i.terminate())}(this),Promise.resolve()}}function Pk(r,t,e,i={}){var n;r=pu(r,Of);const a=Ap(t),l=r._getSettings(),c=Object.assign(Object.assign({},l),{emulatorOptions:r._getEmulatorOptions()}),f=`${t}:${e}`;a&&(cw(`https://${f}`),gw("Firestore",!0)),l.host!==JR&&l.host!==f&&xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},l),{host:f,ssl:a,emulatorOptions:i});if(!sf(h,c)&&(r._setSettings(h),i.mockUserToken)){let g,p;if(typeof i.mockUserToken=="string")g=i.mockUserToken,p=Si.MOCK_USER;else{g=hw(i.mockUserToken,(n=r._app)===null||n===void 0?void 0:n.options.projectId);const E=i.mockUserToken.sub||i.mockUserToken.user_id;if(!E)throw new At(ht.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Si(E)}r._authCredentials=new UO(new G_(g,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new Da(this.firestore,t,this._query)}}class Xe{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _r(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Xe(this.firestore,t,this._key)}toJSON(){return{type:Xe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,i){if(Bu(e,Xe._jsonSchema))return new Xe(t,i||null,new It(Te.fromString(e.referencePath)))}}Xe._jsonSchemaVersion="firestore/documentReference/1.0",Xe._jsonSchema={type:Ve("string",Xe._jsonSchemaVersion),referencePath:Ve("string")};class _r extends Da{constructor(t,e,i){super(t,e,wp(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Xe(this.firestore,null,new It(t))}withConverter(t){return new _r(this.firestore,t,this._path)}}function jS(r,t,...e){if(r=Aa(r),H_("collection","path",t),r instanceof Of){const i=Te.fromString(t,...e);return sS(i),new _r(r,null,i)}{if(!(r instanceof Xe||r instanceof _r))throw new At(ht.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=r._path.child(Te.fromString(t,...e));return sS(i),new _r(r.firestore,null,i)}}function Mk(r,t,...e){if(r=Aa(r),arguments.length===1&&(t=bp.newId()),H_("doc","path",t),r instanceof Of){const i=Te.fromString(t,...e);return nS(i),new Xe(r,null,new It(i))}{if(!(r instanceof Xe||r instanceof _r))throw new At(ht.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=r._path.child(Te.fromString(t,...e));return nS(i),new Xe(r.firestore,r instanceof _r?r.converter:null,new It(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YS="AsyncQueue";class QS{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new kR(this,"async_queue_retry"),this.oc=()=>{const i=hm();i&&St(YS,"Visibility state changed to "+i.visibilityState),this.F_.y_()},this._c=t;const e=hm();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;const e=hm();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});const e=new va;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!Qo(t))throw t;St(YS,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(t){const e=this._c.then(()=>(this.nc=!0,t().catch(i=>{throw this.tc=i,this.nc=!1,Us("INTERNAL UNHANDLED ERROR: ",XS(i)),i}).then(i=>(this.nc=!1,i))));return this._c=e,e}enqueueAfterDelay(t,e,i){this.ac(),this.sc.indexOf(t)>-1&&(e=0);const n=Kp.createAndSchedule(this,t,e,i,a=>this.lc(a));return this.ec.push(n),n}ac(){this.tc&&wt(47125,{hc:XS(this.tc)})}verifyOperationInProgress(){}async Pc(){let t;do t=this._c,await t;while(t!==this._c)}Tc(t){for(const e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(const e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){const e=this.ec.indexOf(t);this.ec.splice(e,1)}}function XS(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WS(r){return function(e,i){if(typeof e!="object"||e===null)return!1;const n=e;for(const a of i)if(a in n&&typeof n[a]=="function")return!0;return!1}(r,["next","error","complete"])}class pf extends Of{constructor(t,e,i,n){super(t,e,i,n),this.type="firestore",this._queue=new QS,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new QS(t),this._firestoreClient=void 0,await t}}}function kk(r,t){const e=typeof r=="object"?r:RO(),i=typeof r=="string"?r:lf,n=vO(e,"firestore").getImmediate({identifier:i});if(!n._initialized){const a=lw("firestore");a&&Pk(n,...a)}return n}function tb(r){if(r._terminated)throw new At(ht.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Nk(r),r._firestoreClient}function Nk(r){var t,e,i;const n=r._freezeSettings(),a=function(c,f,h,g){return new nP(c,f,h,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,ZR(g.experimentalLongPollingOptions),g.useFetchStreams,g.isUsingEmulator)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,n);r._componentsProvider||!((e=n.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((i=n.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(r._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),r._firestoreClient=new Ck(r._authCredentials,r._appCheckCredentials,r._queue,a,r._componentsProvider&&function(c){const f=c?._online.build();return{_offline:c?._offline.build(f),_online:f}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(t){this._byteString=t}static fromBase64String(t){try{return new cn(mi.fromBase64String(t))}catch(e){throw new At(ht.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new cn(mi.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:cn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Bu(t,cn._jsonSchema))return cn.fromBase64String(t.bytes)}}cn._jsonSchemaVersion="firestore/bytes/1.0",cn._jsonSchema={type:Ve("string",cn._jsonSchemaVersion),bytes:Ve("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new At(ht.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gi(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new At(ht.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new At(ht.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Gt(this._lat,t._lat)||Gt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ts._jsonSchemaVersion}}static fromJSON(t){if(Bu(t,ts._jsonSchema))return new ts(t.latitude,t.longitude)}}ts._jsonSchemaVersion="firestore/geoPoint/1.0",ts._jsonSchema={type:Ve("string",ts._jsonSchemaVersion),latitude:Ve("number"),longitude:Ve("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(i,n){if(i.length!==n.length)return!1;for(let a=0;a<i.length;++a)if(i[a]!==n[a])return!1;return!0}(this._values,t._values)}toJSON(){return{type:es._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Bu(t,es._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new es(t.vectorValues);throw new At(ht.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}es._jsonSchemaVersion="firestore/vectorValue/1.0",es._jsonSchema={type:Ve("string",es._jsonSchemaVersion),vectorValues:Ve("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk=/^__.*__$/;class Uk{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return this.fieldMask!==null?new Ia(t,this.data,this.fieldMask,e,this.fieldTransforms):new Vu(t,this.data,e,this.fieldTransforms)}}function eb(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw wt(40011,{Ec:r})}}class Wp{constructor(t,e,i,n,a,l){this.settings=t,this.databaseId=e,this.serializer=i,this.ignoreUndefinedProperties=n,a===void 0&&this.Ac(),this.fieldTransforms=a||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new Wp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;const i=(e=this.path)===null||e===void 0?void 0:e.child(t),n=this.Rc({path:i,mc:!1});return n.fc(t),n}gc(t){var e;const i=(e=this.path)===null||e===void 0?void 0:e.child(t),n=this.Rc({path:i,mc:!1});return n.Ac(),n}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return yf(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(eb(this.Ec)&&Fk.test(t))throw this.wc('Document fields cannot begin and end with "__"')}}class Bk{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=i||Df(t)}Dc(t,e,i,n=!1){return new Wp({Ec:t,methodName:e,bc:i,path:gi.emptyPath(),mc:!1,Sc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ib(r){const t=r._freezeSettings(),e=Df(r._databaseId);return new Bk(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Vk(r,t,e,i,n,a={}){const l=r.Dc(a.merge||a.mergeFields?2:0,t,e,n);rb("Data must be an object, but it was:",l,i);const c=nb(i,l);let f,h;if(a.merge)f=new xn(l.fieldMask),h=l.fieldTransforms;else if(a.mergeFields){const g=[];for(const p of a.mergeFields){const E=$k(t,p,e);if(!l.contains(E))throw new At(ht.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Kk(g,E)||g.push(E)}f=new xn(g),h=l.fieldTransforms.filter(p=>f.covers(p.field))}else f=null,h=l.fieldTransforms;return new Uk(new un(c),f,h)}class Zp extends Xp{_toFieldTransform(t){return new DP(t.path,new Nu)}isEqual(t){return t instanceof Zp}}function Gk(r,t,e,i=!1){return Jp(e,r.Dc(i?4:3,t))}function Jp(r,t){if(sb(r=Aa(r)))return rb("Unsupported field value:",t,r),nb(r,t);if(r instanceof Xp)return function(i,n){if(!eb(n.Ec))throw n.wc(`${i._methodName}() can only be used with update() and set()`);if(!n.path)throw n.wc(`${i._methodName}() is not currently supported inside arrays`);const a=i._toFieldTransform(n);a&&n.fieldTransforms.push(a)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return function(i,n){const a=[];let l=0;for(const c of i){let f=Jp(c,n.yc(l));f==null&&(f={nullValue:"NULL_VALUE"}),a.push(f),l++}return{arrayValue:{values:a}}}(r,t)}return function(i,n){if((i=Aa(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return xP(n.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const a=Se.fromDate(i);return{timestampValue:ff(n.serializer,a)}}if(i instanceof Se){const a=new Se(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:ff(n.serializer,a)}}if(i instanceof ts)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof cn)return{bytesValue:RR(n.serializer,i._byteString)};if(i instanceof Xe){const a=n.databaseId,l=i.firestore._databaseId;if(!l.isEqual(a))throw n.wc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:kp(i.firestore._databaseId||n.databaseId,i._key.path)}}if(i instanceof es)return function(l,c){return{mapValue:{fields:{[Z_]:{stringValue:J_},[uf]:{arrayValue:{values:l.toArray().map(h=>{if(typeof h!="number")throw c.wc("VectorValues must only contain numeric values.");return Op(c.serializer,h)})}}}}}}(i,n);throw n.wc(`Unsupported field value: ${Tf(i)}`)}(r,t)}function nb(r,t){const e={};return q_(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ba(r,(i,n)=>{const a=Jp(n,t.Vc(i));a!=null&&(e[i]=a)}),{mapValue:{fields:e}}}function sb(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Se||r instanceof ts||r instanceof cn||r instanceof Xe||r instanceof Xp||r instanceof es)}function rb(r,t,e){if(!sb(e)||!K_(e)){const i=Tf(e);throw i==="an object"?t.wc(r+" a custom object"):t.wc(r+" "+i)}}function $k(r,t,e){if((t=Aa(t))instanceof Qp)return t._internalPath;if(typeof t=="string")return ab(r,t);throw yf("Field path arguments must be of type string or ",r,!1,void 0,e)}const Hk=new RegExp("[~\\*/\\[\\]]");function ab(r,t,e){if(t.search(Hk)>=0)throw yf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Qp(...t.split("."))._internalPath}catch{throw yf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function yf(r,t,e,i,n){const a=i&&!i.isEmpty(),l=n!==void 0;let c=`Function ${t}() called with invalid data`;e&&(c+=" (via `toFirestore()`)"),c+=". ";let f="";return(a||l)&&(f+=" (found",a&&(f+=` in field ${i}`),l&&(f+=` in document ${n}`),f+=")"),new At(ht.INVALID_ARGUMENT,c+r+f)}function Kk(r,t){return r.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(t,e,i,n,a){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=n,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Xe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new zk(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(t0("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class zk extends ob{data(){return super.data()}}function t0(r,t){return typeof t=="string"?ab(r,t):t instanceof Qp?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qk(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new At(ht.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class e0{}class lb extends e0{}function jk(r,t,...e){let i=[];t instanceof e0&&i.push(t),i=i.concat(e),function(a){const l=a.filter(f=>f instanceof n0).length,c=a.filter(f=>f instanceof i0).length;if(l>1||l>0&&c>0)throw new At(ht.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const n of i)r=n._apply(r);return r}class i0 extends lb{constructor(t,e,i){super(),this._field=t,this._op=e,this._value=i,this.type="where"}static _create(t,e,i){return new i0(t,e,i)}_apply(t){const e=this._parse(t);return ub(t._query,e),new Da(t.firestore,t.converter,$m(t._query,e))}_parse(t){const e=ib(t.firestore);return function(a,l,c,f,h,g,p){let E;if(h.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new At(ht.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){JS(p,g);const S=[];for(const R of p)S.push(ZS(f,a,R));E={arrayValue:{values:S}}}else E=ZS(f,a,p)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||JS(p,g),E=Gk(c,l,p,g==="in"||g==="not-in");return Be.create(h,g,E)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}class n0 extends e0{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n0(t,e)}_parse(t){const e=this._queryConstraints.map(i=>i._parse(t)).filter(i=>i.getFilters().length>0);return e.length===1?e[0]:In.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:(function(n,a){let l=n;const c=a.getFlattenedFilters();for(const f of c)ub(l,f),l=$m(l,f)}(t._query,e),new Da(t.firestore,t.converter,$m(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class s0 extends lb{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new s0(t,e)}_apply(t){const e=function(n,a,l){if(n.startAt!==null)throw new At(ht.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new At(ht.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ku(a,l)}(t._query,this._field,this._direction);return new Da(t.firestore,t.converter,function(n,a){const l=n.explicitOrderBy.concat([a]);return new Xo(n.path,n.collectionGroup,l,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}(t._query,e))}}function Yk(r,t="asc"){const e=t,i=t0("orderBy",r);return s0._create(i,e)}function ZS(r,t,e){if(typeof(e=Aa(e))=="string"){if(e==="")throw new At(ht.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oR(t)&&e.indexOf("/")!==-1)throw new At(ht.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const i=t.path.child(Te.fromString(e));if(!It.isDocumentKey(i))throw new At(ht.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return fS(r,new It(i))}if(e instanceof Xe)return fS(r,e._key);throw new At(ht.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Tf(e)}.`)}function JS(r,t){if(!Array.isArray(r)||r.length===0)throw new At(ht.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ub(r,t){const e=function(n,a){for(const l of n)for(const c of l.getFlattenedFilters())if(a.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new At(ht.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new At(ht.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class Qk{convertValue(t,e="none"){switch(Cr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pe(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Dr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw wt(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const i={};return ba(t,(n,a)=>{i[n]=this.convertValue(a,e)}),i}convertVectorValue(t){var e,i,n;const a=(n=(i=(e=t.fields)===null||e===void 0?void 0:e[uf].arrayValue)===null||i===void 0?void 0:i.values)===null||n===void 0?void 0:n.map(l=>Pe(l.doubleValue));return new es(a)}convertGeoPoint(t){return new ts(Pe(t.latitude),Pe(t.longitude))}convertArray(t,e){return(t.values||[]).map(i=>this.convertValue(i,e))}convertServerTimestamp(t,e){switch(e){case"previous":const i=_f(t);return i==null?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(Ou(t));default:return null}}convertTimestamp(t){const e=Lr(t);return new Se(e.seconds,e.nanos)}convertDocumentKey(t,e){const i=Te.fromString(t);oe(CR(i),9688,{name:t});const n=new Pu(i.get(1),i.get(3)),a=new It(i.popFirst(5));return n.isEqual(e)||Us(`Document ${a} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xk(r,t,e){let i;return i=r?r.toFirestore(t):t,i}class hu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ta extends ob{constructor(t,e,i,n,a,l){super(t,e,i,n,l),this._firestore=t,this._firestoreImpl=t,this.metadata=a}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Kh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const i=this._document.data.field(t0("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new At(ht.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ta._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ta._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ta._jsonSchema={type:Ve("string",Ta._jsonSchemaVersion),bundleSource:Ve("string","DocumentSnapshot"),bundleName:Ve("string"),bundle:Ve("string")};class Kh extends Ta{data(t={}){return super.data(t)}}class Fo{constructor(t,e,i,n){this._firestore=t,this._userDataWriter=e,this._snapshot=n,this.metadata=new hu(n.hasPendingWrites,n.fromCache),this.query=i}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(i=>{t.call(e,new Kh(this._firestore,this._userDataWriter,i.key,i,new hu(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new At(ht.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(n,a){if(n._snapshot.oldDocs.isEmpty()){let l=0;return n._snapshot.docChanges.map(c=>{const f=new Kh(n._firestore,n._userDataWriter,c.doc.key,c.doc,new hu(n._snapshot.mutatedKeys.has(c.doc.key),n._snapshot.fromCache),n.query.converter);return c.doc,{type:"added",doc:f,oldIndex:-1,newIndex:l++}})}{let l=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(c=>a||c.type!==3).map(c=>{const f=new Kh(n._firestore,n._userDataWriter,c.doc.key,c.doc,new hu(n._snapshot.mutatedKeys.has(c.doc.key),n._snapshot.fromCache),n.query.converter);let h=-1,g=-1;return c.type!==0&&(h=l.indexOf(c.doc.key),l=l.delete(c.doc.key)),c.type!==1&&(l=l.add(c.doc),g=l.indexOf(c.doc.key)),{type:Wk(c.type),doc:f,oldIndex:h,newIndex:g}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new At(ht.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Fo._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=bp.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],i=[],n=[];return this.docs.forEach(a=>{a._document!==null&&(e.push(a._document),i.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),n.push(a.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Wk(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return wt(61501,{type:r})}}Fo._jsonSchemaVersion="firestore/querySnapshot/1.0",Fo._jsonSchema={type:Ve("string",Fo._jsonSchemaVersion),bundleSource:Ve("string","QuerySnapshot"),bundleName:Ve("string"),bundle:Ve("string")};class cb extends Qk{constructor(t){super(),this.firestore=t}convertBytes(t){return new cn(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Xe(this.firestore,null,e)}}function Zk(r,t){const e=pu(r.firestore,pf),i=Mk(r),n=Xk(r.converter,t);return tN(e,[Vk(ib(r.firestore),"addDoc",i._key,n,r.converter!==null,{}).toMutation(i._key,Ns.exists(!1))]).then(()=>i)}function Jk(r,...t){var e,i,n;r=Aa(r);let a={includeMetadataChanges:!1,source:"default"},l=0;typeof t[l]!="object"||WS(t[l])||(a=t[l++]);const c={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(WS(t[l])){const p=t[l];t[l]=(e=p.next)===null||e===void 0?void 0:e.bind(p),t[l+1]=(i=p.error)===null||i===void 0?void 0:i.bind(p),t[l+2]=(n=p.complete)===null||n===void 0?void 0:n.bind(p)}let f,h,g;if(r instanceof Xe)h=pu(r.firestore,pf),g=wp(r._key.path),f={next:p=>{t[l]&&t[l](eN(h,r,p))},error:t[l+1],complete:t[l+2]};else{const p=pu(r,Da);h=pu(p.firestore,pf),g=p._query;const E=new cb(h);f={next:T=>{t[l]&&t[l](new Fo(h,E,p,T))},error:t[l+1],complete:t[l+2]},qk(r._query)}return function(E,T,S,R){const _=new Dk(R),D=new ck(T,_,S);return E.asyncQueue.enqueueAndForget(async()=>ak(await HS(E),D)),()=>{_.Ou(),E.asyncQueue.enqueueAndForget(async()=>ok(await HS(E),D))}}(tb(h),g,c,f)}function tN(r,t){return function(i,n){const a=new va;return i.asyncQueue.enqueueAndForget(async()=>Tk(await Ok(i),n,a)),a.promise}(tb(r),t)}function eN(r,t,e){const i=e.docs.get(t._key),n=new cb(r);return new Ta(r,n,t._key,i,new hu(e.hasPendingWrites,e.fromCache),t.converter)}function iN(){return new Zp("serverTimestamp")}(function(t,e=!0){(function(n){jo=n})(_O),af(new Du("firestore",(i,{instanceIdentifier:n,options:a})=>{const l=i.getProvider("app").getImmediate(),c=new pf(new BO(i.getProvider("auth-internal")),new $O(l,i.getProvider("app-check-internal")),function(h,g){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new At(ht.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pu(h.options.projectId,g)}(l,n),l);return a=Object.assign({useFetchStreams:e},a),c._setSettings(a),c},"PUBLIC").setMultipleInstances(!0)),ko(ZT,JT,t),ko(ZT,JT,"esm2017")})();const nN={apiKey:"AIzaSyCBnc_PoAYJiBDEkYLCDIjSWsBg5a89fF4",authDomain:"streaming-app-9d004.firebaseapp.com",projectId:"streaming-app-9d004",storageBucket:"streaming-app-9d004.firebasestorage.app",messagingSenderId:"1020863331679",appId:"1:1020863331679:web:f0f889b21f77378a1ccaea",measurementId:"G-8F92LFJ9Y9"},sN=w_(nN),tA=kk(sN);function rN(){return"Anon"+Math.floor(1e3+Math.random()*9e3)}function aN(r){const t=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),e=Date.now(),n=r*1e3-e,a=Math.round(n/1e3);if(Math.abs(a)<60)return t.format(a,"second");const l=Math.round(n/(1e3*60));if(Math.abs(l)<60)return t.format(l,"minute");const c=Math.round(n/(1e3*60*60));if(Math.abs(c)<24)return t.format(c,"hour");const f=Math.round(n/(1e3*60*60*24));return t.format(f,"day")}function oN(){const[r,t]=fi.useState([]),[e,i]=fi.useState(""),[n,a]=fi.useState(!1),[l,c]=fi.useState([]),[f,h]=fi.useState(0),g=fi.useRef(null),p=fi.useRef(null);fi.useEffect(()=>{const R=jk(jS(tA,"comments"),Yk("timestamp","asc")),_=Jk(R,D=>{const N=D.docs.map(M=>({id:M.id,...M.data()}));t(N)});return()=>_()},[]),fi.useEffect(()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})},[r]),fi.useEffect(()=>{const R=setInterval(()=>{h(_=>_+1)},1e3);return()=>clearInterval(R)},[]);const E=R=>{const _=R.target.value;i(_);const D=R.target.selectionStart,M=_.slice(0,D).match(/@(\w*)$/);if(M){const G=M[1].toLowerCase(),$=r.map(q=>q.anonId).filter(q=>q&&q.toLowerCase().startsWith(G));c($),a($.length>0)}else a(!1)},T=R=>{if(!g.current)return;const _=g.current,D=_.selectionStart,N=e.slice(0,D),M=e.slice(D),G=N.replace(/@(\w*)$/,"@"+R+" "),$=G+M;i($),a(!1),setTimeout(()=>{const q=G.length;_.setSelectionRange(q,q),_.focus()},0)},S=async()=>{if(!e.trim())return;const R=rN();await Zk(jS(tA,"comments"),{content:e.trim(),timestamp:iN(),anonId:R}),i(""),setTimeout(()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})},100)};return kt.jsxs("div",{className:"anon-box",children:[kt.jsxs("div",{className:"comment-list mt-4 max-h-60 text-black overflow-y-auto border rounded border-gray-200 bg-white px-3 py-2",style:{scrollBehavior:"smooth"},children:[r.length===0?kt.jsx("p",{className:"text-sm text-gray-500",children:"No comments yet."}):r.map(R=>kt.jsxs("div",{className:"mb-3 p-2 border-b border-gray-100",children:[kt.jsxs("p",{className:"text-sm",children:[kt.jsx("strong",{children:R.anonId||"Anon"}),": ",R.content]}),kt.jsx("span",{className:"text-xs text-gray-400",children:R.timestamp?.seconds?aN(R.timestamp.seconds):"Just now"})]},R.id)),kt.jsx("div",{ref:p})]}),kt.jsxs("div",{className:"comments-box mt-4 p-4  max-w-2xl text-black mx-auto bg-gray-50 rounded shadow relative",children:[kt.jsx("h2",{className:"text-lg font-semibold mb-3",children:"💬 Anonymous Comments"}),kt.jsx("textarea",{ref:g,value:e,onChange:E,onKeyDown:R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),S())},placeholder:"Shift + Enter for new line",rows:4,style:{fontFamily:"monospace",fontSize:"14px"},className:"w-full p-2 border border-gray-300 rounded mb-2"}),n&&kt.jsx("ul",{className:"absolute bg-white border border-gray-300 rounded max-h-40 overflow-auto w-full z-10",style:{top:"calc(100% - 10px)",left:0},children:l.map(R=>kt.jsxs("li",{className:"p-2 hover:bg-blue-100 cursor-pointer",onClick:()=>T(R),children:["@",R]},R))}),kt.jsx("button",{onClick:S,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-2",children:"Post Comment"})]})]})}function lN({url:r}){const t=fi.useRef(null),[e,i]=fi.useState(0);return fi.useEffect(()=>{const n=t.current;let a;if(!(!n||!r))return a=new ln,a.loadSource(r),a.attachMedia(n),a.on(ln.Events.MANIFEST_PARSED,()=>{console.log("📃 HLS manifest parsed."),n.play()}),a.on(ln.Events.ERROR,(l,c)=>{if(console.error("💥 HLS.js error:",c),c.fatal)switch(c.type){case ln.ErrorTypes.NETWORK_ERROR:console.warn("🛜 Fatal network error. Retrying..."),e<3?(i(f=>f+1),a.startLoad()):a.destroy();break;case ln.ErrorTypes.MEDIA_ERROR:console.warn("🎥 Fatal media error. Trying to recover..."),a.recoverMediaError();break;default:console.warn("🧯 Fatal error. Destroying player."),a.destroy();break}}),()=>{a&&a.destroy()}}),kt.jsxs("div",{children:[kt.jsxs("div",{className:"video-wrapper",children:[kt.jsx("video",{ref:t,controls:!0,autoPlay:!0,muted:!0,playsInline:!0,src:r,className:"video-player"}),kt.jsx(oN,{})]}),kt.jsx(WC,{})]})}const uN="/live-streaming/assets/CBSSPORTS-CPG0f84B.png",cN="/live-streaming/assets/FUEL-CsH_QH-l.webp",hN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAFoBAMAAACIy3zmAAAAG1BMVEXu7u4AAAD///8dHR339/dGRkbHx8d4eHigoKCuUFzIAAAMb0lEQVR42u2cy3vTOBfGg2suy/ozTrI0qutkiWHasjQmFJYknVKWrZmWWZIMLV2SMJT5sz9bvkiydXHTmWfaeV7PYjCR5J9l6eicV0f0SHH5veK6E7c9QAMa0IAGNKABDWhA/xehy8sq//4u3QIa0IAGNKABDWhAA/q/BY0gANCABjSgAQ1oQAMa0FBNEbkAGtCABjSgAQ1oQAMaqimgAQ1oQAMa0IAGNKChmiJyATSgAQ1oQAMa0IAGNFRTQAMa0IAGNKABDWhAQzVFEABoQAMa0IAGNKABDWiopoAGNKABDWhA/63QQXxnoO3sD2c/v379enVMyORuQCfk0blTXjuXFolvP7RNwj8c7nIvsr+85dA2+RQ54rVnBbddNT11WpeXBmav17b/rSDAJh8dR0bta9uyCX/dBCsR/tcNWtbPHLXiSSR48PMwu44uj2W/Nq9gom5q/6/MaF1eXaenk/uO4hoksfpJn6bs7S4TErNf/5JcZ9mbBfKmmAnY+9YV2ho7yms3UEGHU6Gg+62kzn+Vt+V+SKUD4IfQTWk3aH+qhnYWvhz6YavkB/pV6K+RorHMjraaCuaNQu+7QCcfNcyOZ8UyaNkk2KvHUqRs7kWrqbmkjG+CtseO9urLBuKpgig2QTvDRlOyHhtYsQE6meuhnVXcgh5pZoAB2nknNCVvachGmhTaGhmYnWHQhA4jzQwwQTsrrimimE67RAtt7OjsKY0pT9RVXCs2Qg9ZU9a2qtCXQANtGzu6Hob1k+5rZ4ARmnZ10VSitFtuGquhO3S046SCsxFGxs+ih+7XTWl6bKiBHndgdjaF5fNEW3ZAjNCOVTZlLTXt+Groky7QLlfZDg2FF2boWcnha8o9i5WqqR91gXZmMXNzTa+5yD6GodV+GV6M9F9DEQTY252YnaFf140NRQeBGdoLCox7hskvh24Nqp3Lq7Ozs5/nzaemdd0t00fxzdBZcxRirh1BKmhfHLpHx5Vx8z9NJeMj/2VqGv5doBcFhvDsr+fTxuiQQ4ujYy+3bPuZW390lbvsQsxYjI+2tTk6TrIqU97QCNBfq+v8QJxl1LnlvBa6fj2ai0uDHJqfVBckSCpv3PtMJqLDbBV1A2EYequsWP6Cp5xJ56FdLnB5xL9aLM7DQRXcnPKjQw7NfUb3TxInbyPOqY0Tfy7YBFo3EoKxWn54yNaNBjQLsLlFqe+L06NavYKqoUQNzb61u8oc0HEkuOI9K2DzdNOndcfCSsuaIm/qFVoJTba50ZZXfMIsTk1VNNRX6x72Fs9sNwKYz3kPzvkFqsc9J7t+5d+f3K8+sxqafaYCuh6cj33WFO3rhRqaGbxFblyXbZeFsBexaN25xI0qmqbVZ3ropQJ6xlNlAYarUZjqtnez27ZfPQz48ZAPahIIsYG4TmVD1iN66Cci9FIK3SPLoQY6ZHPXl/nVFOt1efNLrkeOGq/EN51sO78YoLfl0K4IbYcrDfSIzV1f5iUOA27Zyi01vxwu4pYAN0+vBz1nS5e4TgdqaPtlUeVpfiv1q1NuCfBy6CXvPrSgfWKAHokmb8lMU2fVtJyHxUAcq/3ojeLGFiK63AQqn2Ts6WJxWUpMnlE1ndYeTs+6p/DGsiuOqm6PZSGTTBWpoQX5wa4n4jMiemsrv7NqWna0Jlhb0aKvq5V1LIYF14W2TligINw6A8vvCB2yju4pwhG6DvYm06J3uCWtvw40W1xS2vH3eHkm6AY9Zh1tb6kDtazsRjnAXzI3bQ1othK4xWjhH+r9RuIu0LTffvW1EabN3O4hH2ktrg+dsNW1XxQWw6YPFonN0FtUXNHrD6ui8EmxBDGzmHSE5lzTcN4MbBsWy7swbCrk9y+LEJMaCF1MXArYHgftkY7QZ3n0ll+/n7clhNZTvW9G6BO6UtM7ZVi8WW5f5LiclzboCK0OWmnJ9vfdSw3Qy2oaNkdXK8yy6FBKiGg81oaubLwlUyMu9NBZ7z0u5amXymC/hA6pnar/+vFNoGsBUi5gDCwD9Ir0lK9cTf+6cMpi9//dBJpJvb5iS00DPc3nk0lTmzBTswpFM70mNCeqKzrLTX0N9GZVWa2aWGwl4qBn60ML2xdj1fZlrIZemKFT5l0txuLash50FvazwslSJb2qoKN8iegMfcJDz24ypr9w29sqCfadL881TSKXVJ7rXK+n+3T48dD61AGDLLZgvji5r9oGkQcBmWlfdIdOpn8fNI3zy8Lku7zMUyX0ZpWGstTKxHnl7DsuQokeuQ40HxTbwVyt40uhB4ERuhK+tkWTdzPoLCpmGMF3pdYrha50YrW671aFlwL05g2hh1xQKMnpqUyjBHpeSa6i2iVazLJwvnalE37/4UbQteJI1Tmy/4e8u+TQVRgsBC7PuavUiamXYDOWQVdorinpflkpqZFPU9lqL4Fesjce6bb8ssK07IS5kl5HaD4IIA/OnZYg7VfpSO0x8kwKfVJZFkGTb9XMC4fUd+LWILszdDAprkaOiNWqG/yImv3Vhqb+qFfeRppNwex6RXuXFyo6Q/O/BhvNhoW6YmLgQAq9zVVe6sx0IesMfE7RoYb62tAkiMRP2Kx7KtoAiSw24pyuJzrjUQz5vs/F/H1/LWhmW/vSukKSkRR6zFxy1Uzsc6v845gLJalgtgb0dsNDbdblfZFEBu1zXEGkGdLjyt8IRe9vDeiw8Q1bdTk3KJWqplPOzp+oF/FywOfelagtrAHtm6C5uDGVqqbLyntR5RLRkVv9lNXgbN5Q4k/7iV7Ly2VBMfjstdP0fO5jylTTe8y9taTbx4vcRgTTumv4mC5tQVsbhWqsg47F4NMezdQBxEoKXX4JL8lvX7WXcRr0JBusa3nJ8GkLOoyojKKFDkXoZOm21JmpvqfHLDHNImLmR5T9l3mHXEpnLnXwgaibNKGXhW6shR6L0GFlRmTQ8p4mTIi3CNfVbK70mI8+o8pnxHe1CD0qhWMdNDfNJtX+wzvV8JD3dG1evDSRJEXksTpLUKR5q4JAksY8dCHkznwtNKtPJ2JhaFeKiWjLoWs1bJC0syJ2hbjTK7K8twXngFcnql0nHTQXfOfQZWuuMKffOKqhVT6J2bkXrciYOo9vmvsVofhaLLnyY51Yo9lz4bf0fJYwKuhgS66EFJrbNX7R8Fe8vMDbRnpOMzH1Q1LuObA4zyMqUT13PoWNEZaZ6/5JglYW60ABzUsHNLflYfW0vaThvaRlCrA4XXcKFfz3aePtaugHtap+dsUn4OTrFm/1P5TRyDgSSkiht5opJ2HuibtH3xr9wqT/Zriwc3R+GLUcQ3PiXOYGhGL+1NWxuF3wLFZAh82tmhzWJoGY8M8L0snSmMPXCXpR7plp8/sUGZANM3dUnn948HMq0ZSJIT2ULZ1m6FSTHFvrtQro9v7hzsHhQaQIBnQZz4I7a4TOZtnIWEIFHTqdrk3uqMZrw8M6jenHfm9fX2jTV+aadspErrYTe9IhJZFEzWLNSsjDUpVQHDizOiWbDgJpyCQf0V2gB4Eha7P4YMpTclEH6IV4EHSu7aAu0EUqjS57fKaFfmVm9ohYV3cAqZOW5xFTKrKnP4/om6FnzUD/o+5ZHaAXlS7+UdvRauhgw9zRzfAzmOtnjwF6l+U/LbV6i/rkpzFZfdaCtsKpegvICE1P3lU+1Fy9P6o9rrptNLytQD+RzqH3nfTp4oRX7fl9V+6P6s/Yzk0rnETZkPT1+06i+nsSi2d7T1UNaaGDhjXgRfXn0a7ivHbYUO/rU3s+p2605P3MBY2bp6jfHohlPpO4y2lmzVz0EkW6XEO9P0q57rEPDjMXprx26M1O9qfLq6R09hvn1T8dCA11PII916cMSHP87Mz5Lw887Fz+RvjUUztRnbNV/csA+z8PD54/3zmkDXWEVp79/KI/3Z2FWw+OexPSfFJs9+pPbNM7W5vjyI5FB9c47K5YUd93OZI+mcT/zgl9Mp6qmW/vCX2JDftM4n/60P1NTujT2x/NTJHgLvzbYvzGqXtxCyi7QOeWh8aHz+mZorsCndmwoNyovEPQPZtur1p3C/o23wIa0IAGNKDx75r+40EAoAENaEADGtCABjSg7zY0ggBAAxrQgAY0oAENaEBDNUXkAmhAAxrQgAY0oAENaKimgAY0oAENaEADGtCAhmqKyAXQgAY0oAENaEADGtBQTQENaEADGtCABjSgAQ3VFEEAoAENaEADGtCABjSgoZoCGtCABjSgAQ1oQAP67kD/H94gMJ5WA35BAAAAAElFTkSuQmCC",fN="/live-streaming/assets/dwnews-Bww6xTUw.png",dN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAFoBAMAAACIy3zmAAAAGFBMVEWQDQzv7u7///+IAACdKCe4ZGPt3t7csbHbGKMcAAAJbElEQVR42u2cz1fbOBDH3VXoXpe03b2usyS5iienubYxLFeakO21Gx7hykva8u9v9NMj2XGSJcKG99XjARaJ+ejLzEgzkkl6uqWnur2IywTQgAY0oAENaEADGtCvEdp87Zr+F3EJaEADGtCABjSgAQ3oVwmNJADQgAY0oAENaEADGtComiJzATSgAQ1oQAMa0IAGNKqmgAY0oAENaEADGtCAfnFV07TXVR/PfakvuoclAbYtdfu3ocvDoPudi84n+WHap+e61Bcd87PpYdCiFe1AaJ60oDFAAxrQgAY0oAFdB129cm0L9EFJAKABDWhAAxrQgAY0oF82NJIAQAMa0IAGNKABDWhAe7cstwN7G6ia8vIOKzust4Ek4G16Grb3nH0+rehNKnq/8Qag2ZteqfU5m5R7z7j7O5P2G29E6Uq8yb69zSj99gCl2wy9TemkXdDDR9lCpVXvz4qh/DG/uPy6aA5a2/SZCl+XXR9P9550Q6XvmEiE6PzTsNIbzE0Tv/pKm95xoPQHoW4rxKRpaKlpwhe+0rpXrDylBzlnsp+raNko9Hh5fyOMlFbpvtdrh/LAWfZ1cf8jF780bNNc2sCMjQOlP8reZEyVHjCWKemHs/PGlXafqU1/VJ9HdCgbmzET4+BLG6D7Pp6BLnqV0rNk1JI47UMXNv2xNJSU+RPPU6D//3q6wjzOtpiHVHrIxeJg6GMnAVTptXhTYdNrdk6GYofQFuih4NOy0kMmpkTpP81foxXQo/mciZNeYNOqd0RnxHfJefPQSTEj8mTVK8+IpFcqfct+aY/SySbZY51VYNOqN1uRobQKWqepJxVrDyFGbVV6417LG3PU2YvTy++mt4U2rWLCzC1UScizS5IWRg/DNSrHaTsl6qH0Wxan5XSXVSg95JzOiHzRSmh/7dEbWGiz9pi2y6b7u5XeWPioeKqlvTZ95g2FrKev2gCdujjhR49kRDMXYTOXfPxE6Cevp0ePj4/Xzpbd2mPTu0kS39ChrGWOuNzkiGzcdI5oEu+Fr7RJ0lc0Gx8ym42Pm85cEkkh/g7XHqr3yq973Am9JlGvbhJaLzKuqipMRa+tMP1Q3VnTFSZdy1tV1fJcL6nlDeeXl1+7TdfyXmTVFPVp7LlssenTvXe3WFt2t5LsU9jT2fR0kj1799r8PDo045wl3oesmVf0CrljmwTdgjcC/Rx744BuGBrnPQANaEADGtCABvQT2GRdJw60qLi16wsPCpZerCpLIal9r/10dGh2Mp9fB73scj6fyz4299pNJj/x4N3z3Mt7Nh3XivlSHna6v6nICp6utCzmi/JNBwp6EWSyqjgd/voZfa8s5/0lma/Mr74rUz+5aqrS7Bkv3VSxiZUPrQrR9DCpGtUtD2+3+VpsxNyJ4ycBk3K3g2Yh9CQQ1hTXAxGZP9z10aF1QSPfD1pV2qmwZmOGOOZCXTO6TXfLoyjde8/3gx759zCFHWIwHVMQpm+8jaT0gO0HzReesMajZr70t8Zsevf6tOQ6ktL+n1BQ6GF24f5fmDNZYgxe+U7tk2/GILdm0mu5t76KYR6mSOdFPU/pYTG3cBccqB9STzSDUi97EPK0ZLaKYB5G6XTNt0F7cdn3RONuxUusH67kppd+xyie0r2+2AdaaetuooxhQQ0mK/zQvkp8/hbLpj1vEtuhE+qJyhi8OdH+IRak5JtdR4keg2CKqFHa80RlDNRgrB/KIOP0ZUkUmx5KkjTfC5p6orIVGrrVkISGrimuH0VppRYNXDXmQYWV37+jodv4YcK7tWXD4yitJrAi6tVBdwpL0sagJiDm/1CuowYistLirTdz1UETYZUx5Mpg1oX08i5qIDMer2qqDsdkXRr16qKHJDXmb4yhMBjrh3o4fREtR1RKm82r2R5KE080MbvwRBda9Km3BxEtsdXQIxr16qCJsOa7wmCE+07dbrDNQI6kdKIPx+R7QI/s6KwxKAPOyXzoVlJDxmMqbVbt3/iOBROV0xqD80Q2dt7MPpfWBhGU1st2s6z2oAePrs2cJzJCzz6qcG1SAuMXWXdLfnhMpY3Ua16XBMw8T3R2Yj3RDUe+Sp9u6X0XMZXWz+HoCaYW2vofG9tMSs5/8o2MLqa4eWuVMx5NaWOGM75TaaOwC8pJMtWemNFll60hDPOYSieZmzLrlbYLfbfes5449vJBe2joPY+otLlVvhM60bRFUDYLJ3VQhK7Kv+h35TGVLiYYH7obQBu7GBXGoD1RFdMYLUVOe2Et5+hKF1HPj9Mdl40zOieSNapQnliRm63K5YkjK11EvW2TC50TaYVML/eykqrGGdcxlXZRr3YaN55Ia5HaE8dlPu2MZzxG1dRy6RlhxndA66SKBmVV3z0Pq77W4oZRsnF3V7Os3gGdSE+8oRIqT5xUmK+2OBYlc/FqApsMage0JHmkVRvliVtNqaT/cZU2UU/sgO6USiXT3rboNokB7Smtl9XpLqVN3TFlYZlqXZ5HKtzzyEqb6tztpB7aeH/xE1tDd5IyL2dYx1XauPsOpc2DT8QYRr70/DuPCh0orU+aLuqhTbWUlHBF17s7W7LnVNqmHPXQWViyZFNPerZ6oCE8ttIJn+wBrXbiUhYWjB0cXw1yXuzKzGIrbZ+nroeehvca+3646n0QhY/ksZU2xYTKBZPw5kRv+1AONRUJybW+C2H+A8SAR1fahK8iGy/2xn94+xbrMHQXN1fr8Lvc/FeNMx5dabMHWJW5DLxtilloMAWczmrTe/3/S9bxlbaPX1RB0w2hlIWhe+07qnsKLY9UNS1Vc6uhaQW7Xyq2z8oL5kjpVllpHb/qld68JGAZET90zztXC33czIWGgh1Kj8MZgy/ovVnmDOQhQgmhQmkV9aoOqZA1fhbOGGzqSc+yn9vrYk9XWqbZ4XGgzPSxC7+R181DmBN/FIxfPi6XP66j1PIqD16x6oNXXlGjfJ/yPQSPVDWNecaN4TAhoAENaEC/Kmg8cAZoQAMa0IAGNKABDeiWQCMJADSgAQ1oQAMa0IAGNKqmyFwADWhAAxrQgI4CLVrRDoQ2zzR1TLto5DI5DDpd6mZ6f2/o8vQw6LTXVR+m6Yvuc1+mB1VN230JaEADGtCABjSgAQ3oVwldv3Jt5yWgAQ1oQAMa0IAGNKBfJTSSAEADGtCABjSgAQ1oQKNqiswF0IAGNKABDWhAAxrQqJoCGtCABjSgAQ1oQAO6fZf/AY7x9xk+BM4wAAAAAElFTkSuQmCC",gN="data:image/webp;base64,UklGRooEAABXRUJQVlA4IH4EAADwJACdASrEAOoAPp1Mn0ulpCKhqPOYWLATiWNu4W1H++lBP0edvdMAeCGjt+/MX53unEKCaeSfS8Cv7bWBTy/fg/ih46OfVxtGi0ic4kYL6cguC+rjaNFpE5xIwX05BcF9XG0KsC3uRqX5q6lbWuQFG+3P0rNr+0R0RUWyrIAUIB15YnlhRN9efsrnH49q+ZASUvrLL7EYqQMIj0H0orkHDJUQEDNi+lYb1M9WQLDRBRvhV+4nXRYXMBkfGHpsNNc5XM1vLDDsUBNDy/EIChdtsfkDAai31O401h1MH2O/GsrzIMSSxhqgD54oTatYIVMElB8XKTTysAKYYhPcQOTeCXF0RDKaxN5+yUH61PWCKRKc4rl6uNo0WkTnEjBfTkFwX1cbRotInOJGC+nILgtgAP7+OdAAAAAADkcbJNM1cgxzlavqRnw7Ual49es3wz6UHgR7AjZtT+cZtOaamgTUz+S50R3A3v26ToswTjJ0QIxOEgItD6lfoNQ0qMDQh054OcNKpVdhMk7dPFFJmU98Y2dTe7zy+y4+akYBRBjtRtpT1P2zaHGX4w7aVl3CYWfVqfNIjM7Kq0ZNy9jDPCsWfIIvZV0spxKJgt52yUNgHmcZNUxieJEEdJ53fh8/lb3n7GS7G18hduoMJj0kpmVliXxMzR4mVUNfJz1mTJPkBNO60Ngaq4zjiK9ErzcPs3FRnyzhamjnCrGAzIDagPIO7pcnWg+AYIynLDmevvVt/ngoS0Mu9+cqrycbiFQTa+dJDNs+MKBLJ7xDBl9Mba5Lt8p6uXEgYstXW3J4N85kWFl9eg5eSZF2sdY1agJkVNCv73OFM4xYMDamhsIZSxLmosBfJq0I0FDAuM5z/gsfvVVf7W+JANAwSwjFWj1Nh+nPq7ClfTSku0mNpsHrAfW7ypuxLxAKBUWWJ0AsBFAw+bk0B5Hx0S05o1EfwYM/p3pXPU88Bz7C5cnQz+4nrnkm1gv0YtXttBftHdai5WL7Faw4fvFg3esLJFgQnGuD3zusH+wKbSchj21L2hMuTdKE01i1jXtJrL7Ue6GI2rj5y5iSc+aVOAp5ymANwOpjtsppDFvlb64Z0V11PE2Kt6ac4i4a4R/VpTYz4amUyBfKtTe96GtqoKHK5B0MXFizwmAFMoA88cSomA5H80cM0Wqt1d3AHkKpCB8AE4PlHoJ087nwsoK6AxOyBGPTzP1rXHbPDj6bYgmc/Z9F1A3G0tz8VvVnER+hYu6xDeoECoGFAoOlYVZd8q3CVU2yDb+rgg53ZTdlt75+OJ0GwN2037PB/+VkH7nXq4OE48KKhP7KJv9ETcKC/wvEHvAGfDYtF/xcRnx/dC894ZKR5eP5DTOtCtbqFsjx2QvnsQqpcES5ucIFoJebAYDRgAKD0beGsyuykKxcZJ9f1GUbltc5Up3Ry1MV59q/GRyyl+sEj5Asr4jeaP48z87iHsM8uJFLdl56KIOrmQE5AwgPrCigxD5JYpgf/7WBHS5rcO8osuckMUSqbJwBlTAAAAAAAAAA",mN="data:image/webp;base64,UklGRngFAABXRUJQVlA4IGwFAACwKQCdASpQAeoAPp1Opk2lpCQjINtocLATiWdu4XJhlfn9+Aev3//H9E78B5idmfxmyrVh5RfFX/D853qI/M3sFeMl+s3uR8wH7J+Td7rPQA/m/+M60j0FfLc9m/9w/SZi2NRHALK94R6QJoxBmlNkE8zMXsgnmZi9kE8zMXsgnmZi9kE8zMXsgnmZi9kE8zMXsgnmZi9kE8zMXsgnmZi9kE8zMXsgmwGRr//baMR1N+qy68X5nnhZvoVGECiEaQZOtcSZ7banSuLnEb2prBmgmZnBBYhjJQopHYAsSV0YHX4HwPSwDGdRThWbk7RmhjRrCSFx/rCfDvDjw5H+b8VmZh2qVHDOz+zAFLSqHQVJr08BN59iPmNw/vrPEQXsgnmZjGvmZi9kE9GWwAeeYVI0oobIJ5mYvZBPMzF7IJ5mYvZBPMzF7IJ5mYvZBPMzF7IJ5mYvYQAA/v9EBaRYAMBSBqJqBlVIAAAAABYSYjfdG11+xtTTnoY3XNFvI3ZCKNbwpnOMv5b9anpj7HfroVc4A6P/+lqgdxo4l3pkX///JaqqIbLz+3YwgcLbXQsHdzslci6f874R6OTi3kILgo2RUr95sCmRb5g6OKI+hBrNc7PngEVekALhoypi+EZ+YiFVE7a/Gj2STPvzqu1JJYn8e4eOJfvW8DkNJhTAw7HN9+eaOmMS2444nq0Xb4rNoXph8TEd7PcLb6SCqlWpn1ISYXXAdRzJKE/oqJm9SdzzI60+vpf3/uNqSG3EIr4+epA80YwIQ4RxGPvH8RG3nXluINj/bR9KB76D90NrbLX0eueE7FL2+/C9Cs6yHpaqnvwmXTtDmbBdyvbeny3l5WiF+vDIRlTD9Jhq+MKDWZ1N5OhAHFEG2vuE9Diks1JEMrP7j8gJnxZSGSl2j+9BV6sRtJIhZdU+5RnGCknJm4sAGBMvy41er1UDvz+9Rn6oof7S30HI7ITxzW3GAOG2RMBWpuy/VaCT74KfpzYWjLVoHFsZePAYLNwGZyFpbrqdeJY9sBSF9mq8TUFkgWP119OYIWzckYZ/gDcQr2uw41Xx6ut75wxukRIFDrZpKE1WCZVSzpCCLrDok3KrpRsursKUroeBygir8MELDATYTF8pywmQkhQDRc3rifePGap+Mf+7ujcNO3Ka2X8M9qESxP4GdD1Bx7R6CKea2vzBSaLQzGLyxm/QxV/W5lAp3FEHHy7trhDH9K+XaMzbEOr0Y5CkDBRf1vuaAzs0qgDtAIezVSoXSKVb/wMuNU0h2U9bYbWWX0A7Xq7zXXwv1ZRry9srq8K8r4K2YnLC/ooYOvYdEQdnBeyEl3n+HDBCa20jSDyuDsnjoIgd5TmwzQ3IAHxxxa6uJN76WQjLOMS67DVL2u2KNsw+Bw1kVLIzhbclhcyoouVIXO1kM/ipSjrSrKl7CvpN/vMV4ylg0e8Zf0XjsO/Ncor/sfAHyK0jpDSgUb/SpbUe9g3D4V5wGAG00McdiBYay5oAp+Ecg/gwTZIGVi/vspDHEebnWPFn5PEmzeO/iA8IAyfjfRobc8DYlAdOf1zFRFgY1j6S/rcRXiguX1GzHdeTjrewQE6GWqLNG3dnf4RYubp6q8Ov3ucQogtPGnpitz5IrcFD0gfd1F0Uj7l4eWBYy7H8sTfiIwOK9EjqW+3716C/29I0ywojDYyd4IQKPJ9HafM/LAg4kexs1zgUQVjUtqk7E2kOt8BUbzgYwtn+7Pn5waTZ+oJVvYjo91Ut9wCBuSCn9rO6ox5UWf8sZLAKpPgis+VyccVDqLdoHLR2wRLUN/dWbFXNMAMKB0+7uH0EXiKTgZnRAAAAD3Vnm4kdvNxI7eXIAA==",pN="/live-streaming/assets/TNT-C4OSVcN_.png",yN="/live-streaming/assets/MOTOSPORTS-4N726gmA.png",EN="/live-streaming/assets/DISNEY-DUTT51TO.png",vN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAFoBAMAAACIy3zmAAAAG1BMVEXu7u7///8BAQEtLS1fX1+CgoKjo6Pa2tq/v7/XaKeFAAALbklEQVR42u2bzXvTuBaHo84wnaXUJk6WxU7SLtsApUuapp0uSWg6LG/CLcOSFBi6JIUB/uwrnXMky87HMNwhD+H5ZUHjWLZenS+dc2wqhj+6wp+1OKwAGtCABjSgAQ1oQAP6R4SWj5Lf1+kQ0IAGNKABDWhAAxrQPxY0igBAAxrQgAY0oAENaECja4rKBdCABjSgAQ1oQAMa0OiaAhrQgAY0oAENaEADGl1TVC6ABjSgAQ1oQAMa0IBG1xTQgAY0oAENaEADGtDomqIIADSgAQ1oQAMa0IAGNLqmgAY0oAENaEADGtCARtcURQCgAQ1oQAP6h4KWz9pAn9zjz/3e5UuzLtCdNHyy8zWETtOWWkPotLUeXdMidHpk1qAIUCXotK+/f2hdhm6aNSi3HPTlc/u5EPxj/Z1Dm4p6bUOdWP5/2Re/a+ib5y9eGm0s9UTOviLqUWmw+hc4fGz4P6EbJw7wTGkzCND2q/3s63iwMvqtiq81ZvPzp+JMN58nEq8CoS4C1z/bITr6ie5cpFLm76CTsJ2oJIdO2D6Med3r9aZusKo/cd75e7jWvOm6zfNp0IMmq7r/jjg+2Ov6MlF0QENOJ2x4dfvzuY1b+qOmefpyq5r7fQm0aoSgcWjUeOrPqrH7ya7B/R25wfUuD3ug+FpnTXId36k+kBzgsf1B3dpvux7aXUrQT7yAKl4yVjDJiZ1ow37fE5VuRNfOgzaDPMYdm2QSoKspT3Qr0EQhM5Lg7xS3ofhObnzV76r2u3Y/Op2/9yPaNEuDxvzScRPV6DtDjwlmITSz+cCsVCls7+fQST5ulwTfKW5D6lV8o0rFAaUyUUJR3xCYv8RDt+lGB6budCTQTjHTxdCmG28ncWBWA9KXh1bXReiY0cXGwiKsB/MGO+WJqnyrWKutAH0rkqfxRKWJfzF0rZgkxdDXfGsPTavLgmALjOm0uAgb73nRx/mtDoxJCpcIdFN2X3KePlElIV+bC50bqp88P1vl9Qo0ae8P/esTVqLaZqe8upDFchKQnQ67ojMi3cmVNjKGlHX29uZZypZH0PJhTzwgqqpcuQC6lI7ai/KzCRulQDuVPHRnXltVCkf6SCKANSvyjabzY0Jq8y/t3D0mbABH7h5jsfEA3XxhTNV7Cy33eHHXtFHKkdpRIlsnAZAnjxTdcuRCmXl9oBWf3KPk9Wea/5pV7qJ1l2MF6cZZP32z2ZdbXjZRftpJ7txHbovJjYKmXFwEVEvQWQRNcWoaQ085tFl75TgwlaDppOJIH7LJ1SQ6dJiMB+8a9ZNbp1Z+v+0H6CPCyt2vw6tdBH1dgnaThLMF6G1SWTi7katFJV4t00oekQ7Es9zgLTom/xnxvO5uBx66yVgh0GmJR4ugx2XofnS2Q7iRpJt54jQmDjlSHIFb/uxPHOE2mEyxWxgHZQWo/Fa4pwX6WKBvJXzXvHEvgO6WoY8XSZp0/mAiwjXdYC082Ilux0PXWHxVJuPBxrjA3fKpTYfWmKTBJGStB7kaFkHXy8WKHzxr03XW5B8kbGV4snzwdbxgsU6KwpoPW2xB7c23L/2e1xToXY9Vk4Pr4IdzoRsz0Hd1MXooD+2VcugSD8XxIIK+LZhWh1ONDu8yCcOUI1Um0Mceqy7hw3mpWgydzEDv5NB0Rx2gt31ItVut4kwngh7nfij2MDF8Ke9D5f2Qd81EMknJqrtsK53IPf4pNLleDh3q3uaEodsx9KAAPWDoDbIZ2iums9A2UiXBpI1P7iak4d2vhd6ggBCg8xTtSM+HnpSgyUh3NG2eZiF0M4feoChTLbrWFzji3SLHbgRt7vjR01nzmCdpMtK29lFjAXQrxyJcssPRsrZYd0n04Fwkgja/yvBdM+OI48JMXXJENlLdkKDg/mb38k/G0O0ci0fe5n44H3qweHOpcjkeQxvzV4e3ML005PmASNdOqxIhWDvK30pVdBna6aTtVtxc2oCc2cZzFY85FSlCm4ZkQ5y3VQoOEPyhIXqg7aJ/He3OzRxaSyIZQw/clCTuZdDbCxOmRJK+IrSN0FyQDKJUREmoCXGq6t3UeeLBWCIElTKqwFGGdutrRAnC/K5p2TlaIZ/u+vTa14i+w0KCozxhTwdNxxGXDXzHFUFOuDtdWQ4nUL421aGw1XmW71b7gYx0Wd+j3HTc8RzPxL/zcusv6fxukxFtU27MY7dtRUh7/oG0YySJYUdvdiTssglJxZSMQo0YQbvjezLvknKrlOaJHdS5PdHWObTpPDQBmv2eKxkbN31FKJ3AV5LjGr7YuygFeqm3zaA9T9JSSDX1cuhqqbnbOB0OL05E/qNKJS63zo0W3Rup4kcSgfY1+Vx6GPWmwgp9MOQgeuRqNdfn6c+RtESzveXQJft4WPDMtsmhyUcOJ4yU+Y5C9vTlzQkZCrc50gfvNjkqHjB0zWcZNC+p9VwZ/SGqEQuSvvUNiKXQhcrfGmkcuMn9vKS52L5/IpIouXC/ZGjZhCfSoS3iDlmt2b2O7yHMSHrbbxbLG5C6Gws6RvmN250MXS/W7BUpx0PnRSrDcCffKu2GjlSltAG350k6SXN/WNaArEXNLBO1QQ4lxol5vI+TBu0Defx0ZlwSdCXo+9jPG3vQaJ5Na/HDv+1P++ZnNo0FfShuHqLHs0ghVL28LzUgo4risRct63sa5h1H18yTNOmi/QXQ5kNI7oP6QtM531z0s1whHOMHoYvKOgtt1PO8rZ4EP6zke1Z4tprMQN+yH37B44v6Ve/0hS2jGr1e7+LiYjj8FDX7b+/d61CrV7IlW9xKuJRlPFB+bNKVBecT6U4RSz/x15CkbdZXMA/agPpf/qCo+JRh3rMPoz9eXX6KHzI0rk4v38WDP16cXoY8iq7crGy+LGD9edEbuvK49MpAJOnJv/oGpDJf9WRo9kFR/CxYV0o23dRr9tpmXXaBtYKuih+u07umlBz01+wdJiku1ws6bymsCbSSqmh3JdCFSEaPOguDVX5SmeJbaTq+1ebbm6tCa+9bQps3PXlL685vWn14LGd/fiSDa7/bne+cBjfOTKV+ybxD+xnRra6oaguPrKYrgKaMg7Ifc72n1WBH2uaDlgzesp5VbdLgqi1hEnY0SnX3uUnSj6Gbq3gD0nSzYZdn2rDQ432B7qQB+thD12xmnWSyi5z2Lv7DfWEq2vzD1R3z5unoz28MnVhBNY4jaGltZp2Rh26ZakugMyXQOuXWwwz0xCT9/YtvDF3NjD/csI7vJb29N5a24FaWTj10lh4HSQdHFGg2j0f2VP/s8ttCq42WDtDNXq8jkr69u7XHe/DW3mDXQzdvWwHapsGVMnR25k71h8+/saQ32jm0f5TvsrV+rclZ99bedhagq+lNltdVkwi68svnz29Da3KVkh5edvflec3llTTZt9r1dOjNQ3cOvaQvh8NY0nSTVb0/Pd+ma3k9u9W2laFEj8zueZEjxja90pe+ExvRGg/L0WPLmneXW78WupoGSTfSBY74te+aft0hxWl+eWDPSvqA35Wwf7b5wcRWW+sOdwVqVuADLnNdnKZXsbTq3O/1Riv+D2c139dh6Lt01hWnNd77LLS6ZmhrSlbqE/+kIr1L0PzUZLXQNveQ8vvOY2Nej9zZzaElqw+5TfDUlvlnBG1zD5t08KWUexA0ZyErhp7J53Qx2ZP0rlKsivOj/N+VQuM/UQIa0IAGNKABvSLo77iXt6oiANCABjSgAQ1oQAMa0N/HIYoAQAMa0IAGNKABDWhAo2uKygXQgAY0oAENaEADGtDomgIa0IAGNKABDWhAAxpdU1QugAY0oAENaEADGtCARtcU0IAGNKABDWhAAxrQ6JqiCAA0oAENaEADGtCABjS6poAGNKABDWhAAxrQgEbXFEUAoAENaEADGtCABjSg/+Hh/wAsi4XWkRZluwAAAABJRU5ErkJggg==",TN="/live-streaming/assets/DISNEYXD-DmCNh4Ug.png",SN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAEOBAMAAABWZpChAAAAHlBMVEXu7u4AAAD///8dHR36+vrGxsbZ2dlRUVF9fX2np6dU4ZplAAAInElEQVR42u2cz1fbRhDHFaGScGMQtuybELLBt8q0odxcxU2aI34Qwg3cNCS3yi0Pc5QpsXuLzcuv/7a7kmwkS7uSC1rjvtmXl5e1N/DRVzOzO7MrSYbfdMlvC9GVEBqhERqhERqhERqhEfr/CB00Ofh8kboIjdAIjdAIjdAIjdAI/f+CxiQAoREaoREaoREaoREaobFqipkLQiM0QiM0QiM0QiM0QmPVFKERGqERGqERGqERGqGxajqPJECRpIakZOw+EOiZWuMhQG+qqrUzw58Zr1HPBXoDZmsIjdALCa12P500pd+/OosDrX32RpnNprHiJEBX34ZbhDH6lS0O+twMY5zFofcjH/TCo6M/rSUKWv3bjN7gmjUNfRr5oBAevDkXaHUUM8uKxYUGee7QowRnilDHoevzhv4rMQRsc6G1+4LOvpCNQP/ICFxLPOiwK8agc0kClA2GZtHm8qALoqEjSveY0BUedMgVxStdZk9s9m886PoclW7xpmOLA63NT+kidxHxjAN9a1fClW5xoU2LA12YF3QhZb32iAM9cUXR5jFKga7yoOvzUVpLXRoPOdDafJSup0JvcaDHrihY6XZ6FmJxoAvzgC5lSJ32OdCBK4o1j3oG6F950PU5KN3KAF3hQWt3h551Pa1lYDYdHrTvikKTgGIGaBe40AXh0J105hvgQ3uuKBQ63aTPIA26Lhg6vYD7GFKhNcHQ8eV/pX/RPUhKbdnQ1BVFQq8nG8N5QsGGRBEWdEEs9LQfvgh+69NggedAFqWJK4qEHrHS2N5tgE5XmriiSGg5aRE6WZK4/LJY2BUFQk8Fj1rUuW6mCpBspaEnEHpqEg9DladrvTyloSAQupywbh63d7H6NEdpeCYOusC0jsTtCw70jjjoVYNdGIeZlAZxVdO1eILyH5UGcZlLJG0x3ftUOr/Mpc72w4erdHQWh8VQOgKtwwIqraPSgqAXwKaVRYweCSHPWQylF21GlHJee+QHXWRuKmdQ2pqTefDW019SlFZP56S0ZjCNujSVbcWVrt0b9J1yxLB9dKby2rhNG+59rafvlo27kVJXpIIQVzrYixEPPVX3eBmte1S5dY/Jtqho6OkK03j7fs87z2SGjzHFlWbH7Xyh16ZreX7M2Euw8rjS7ExYdNV05WJn94NhTxf3EpVmumK+0OlbLmccpUOXJBI6fevTvOEozXLF+e+5uGylWa6YM/RqhqOuDlNplivmDJ1lH7HqMJVmuGLehwkz7Of7c06i0oxZMW/oDEbtR+tkpZvWPKDLGaBP2Uonu2LuZ03lzOc9kpROdsXcz5p2slkHS+lEV8z9OFD6KZV94CidOCvmf8QtbXtcB67SSbNi/kfc0k5PbAJX6aQcXcAJyBRXdPhKJ7migLOm32c44MZWOmkHQYDSqpxBaLbSCbOiiKPIxQyHetlKJ8yKAsyDd9y0akGq0vFZUYTSnFg9hHSl464oROnx+Q6mF/KVjs2KQpRmPcpQ49Y94mdbBEOrLebqP4PS07OiGPMgKUyLlWdlUHp6VhSkdMITZxWHXzXlHGDI+axpuH2IMD+xUp5H5Oyr554EhNpPtwfyKlcJOwEvD8MtelvC3xzbQp+x3b0+Ib9w+fjPxO0LwzSbZtNu0r/sZgTaDrfJvRcDzd9zmaUhNEIjdJbRerMZdJWm37jdxoN4vwddvfvNztR9MK9/Wch31iC0KGjv9TnKxIglKWrEimGG/y/1TZbF05Fhf8jx7UDvP5GPGkqTfECChGQoJzRcKIbx3SsyWNaPD0xFapBLa9A3HJ1IeuPkjU7DiexFtOXGSZuEoYZs6N/IyGV6maRrG8qyMpt22Rey8pn3aD4J2AX9FxqK/zCDLY0zb8/WdOgi24UfDAveSLSmN6pAyauSlf2E9wjK1fY+1KveSLr+Ltn70FkabzDcexIgSTU/OSSr5JLuPw0g+9Bep2cueXm6Sy7CgrZkkCtanUD7S+v3UNruDKGz7430kgby744zPuN8/9DyI79QQ9bvagDd8aF9Lr+WPiJf95wAWq1GlX5Fxq65MJqMJDftFC4nefL9Qysu7N2QhNZSiZAVUI+HUP/2GuDb5yFo5H6TG9G1oE5QimNo+EChy4eHH1cOLTg/NkA7LTiwMh55fQSlU7Ame2Y5KG2BbLSMKmhD6FW8JyjW6EMjdLuiVwXYInd8E9aJpurYPECj0Nqg37KJMXTISNUhX9KRz4BI3q5RaCBekBd00xdkG8obUCewFxbBIPKa5Gps2YHHsE6+LPqGEEBDYB49yYf2zFjdhFVjC1Zd2HWoeeSYjUuKpfo1c+JVxUqwqRhAt4naL4i9E5RE6FEA7QY+QEeuu4Ej3u7j5GAeDvRqe/4D+OVKUKj2oB14+gRgG9S2S2/61Rhacz3owvJb24c2vSBS2gL1jTeShst9YtOl/KCH9Gxd3VOShAVtiW6Ue9AeiubvtXRcEiMCaHXLgy4NBue6r/Qj+iMK/m3qufDJg76c2EcO5uFVF+sOdC8AnoNWozZOoaVtX3bvdsuuF8t8aNMKzKMUQG9AaUiulY5UbRdaFoxInLbGT9/lMLnQ36WZfrj4TIhondqDtmnobnv7h0/JoBG5ugM6I6rG6TiI6wZ1W+IQxZ9hTdn2LtKhxKtkgtwfn53LAVqpXu22qt2BLn/pf+xeGkf9nvGcdCWlcrU70g3j3c6lYR71D5r9gUL+7+AfozK4rg1Iu24YX7+ODNIf1QYjyX5NRhpf+u3t7vlZf1Tr9nObxqXgqJIuhdcttu4tZUxpku41FLoaHPdkf003yQVl+uPCZRv6kW3kB/0wuvheU0y3EBqhERqhERqhERqhEfoOXUwCEBqhERqhERqhERqhERqrppi5IDRCIzRCIzRCIzRCIzRWTREaoREaoREaoREaoREaq6aYuSA0QiM0QiM0QiM0QiM0o/svWbGiQExkPh4AAAAASUVORK5CYII=",AN="/live-streaming/assets/GAMEPLUS-1EXJfGlQ.jpg",dm=[{id:1,name:"CBS Sports",logo:uN,category:"Sports",streamUrl:"https://fl3.moveonjoy.com/CBS_SPORTS_NETWORK/tracks-v1a1/mono.ts.m3u8"},{id:2,name:"FUEL TV",logo:cN,category:"Sports",streamUrl:"https://amg01074-fueltv-fueltvemeaen-rakuten-b6j62.amagi.tv/hls/amagi_hls_data_rakutenAA-fueltvemeaen/CDN/master.m3u8"},{id:3,name:"CBS",logo:hN,category:"News",streamUrl:"https://cbsn-us.cbsnstream.cbsnews.com/out/v1/55a8648e8f134e82a470f83d562deeca/master.m3u8"},{id:4,name:"DW News",logo:fN,category:"News",streamUrl:"https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/stream05/streamPlaylist.m3u8"},{id:5,name:"BBC News",logo:dN,category:"News",streamUrl:"https://vs-hls-push-ww-live.akamaized.net/x=4/i=urn:bbc:pips:service:bbc_news_channel_hd/t=3840/v=pv14/b=5070016/main.m3u8"},{id:6,name:"CGTN Russian",logo:gN,category:"News",streamUrl:"https://russian-livews.cgtn.com/hls/LSvexABhNipibK5KRuUkvHZ7220802LSTeze9o8tdFXMHsb1VosgoT220802cd/playlist.m3u8"},{id:7,name:"CRAVE",logo:mN,category:"Movies",streamUrl:"https://fl3.moveonjoy.com/CRAVE_4/tracks-v1a1/mono.ts.m3u8"},{id:8,name:"TNT",logo:pN,category:"Music",streamUrl:"https://streaming.televizor-24-tochka.ru/live/38-req_offset_28000000-req_window_0-2k_v5.m3u8"},{id:9,name:"MOTO SPORT",logo:yN,category:"Sports",streamUrl:"https://d39g1vxj2ef6in.cloudfront.net/v1/manifest/3fec3e5cac39a52b2132f9c66c83dae043dc17d4/prod-rakuten-stitched/3dc9603b-ed0a-4d55-90ac-d21905c26883/3.m3u8"},{id:10,name:"DISNEY",logo:EN,category:"Kids",streamUrl:"https://fl5.moveonjoy.com/DISNEY/tracks-v1a1/mono.ts.m3u8"},{id:11,name:"SMITHSONIAN ",logo:vN,category:"Science",streamUrl:"https://fl3.moveonjoy.com/SMITHSONIAN_CHANNEL/tracks-v1a1/mono.ts.m3u8"},{id:12,name:"DISNEYXD",logo:TN,category:"Kids",streamUrl:"https://fl3.moveonjoy.com/DISNEY_XD/tracks-v1a1/mono.ts.m3u8"},{id:13,name:"TOONAMI",logo:SN,category:"Kids",streamUrl:"http://api.toonamiaftermath.com:3000/pst/playlist.m3u8"},{id:14,name:"GAME+",logo:AN,category:"Sports",streamUrl:"https://a-cdn.klowdtv.com/live2/fntsy_720p/chunks.m3u8"}];function _N(){const[r,t]=fi.useState(()=>localStorage.getItem("selectedStream")||null),[e,i]=fi.useState("All"),n=fi.useRef(null),a=h=>{t(h),localStorage.setItem("selectedStream",h),setTimeout(()=>{n.current?.scrollIntoView({behavior:"smooth"})},100)},l=h=>{i(h)},c=["All",...new Set(dm.map(h=>h.category))],f=e==="All"?dm:dm.filter(h=>h.category===e);return kt.jsxs(kt.Fragment,{children:[kt.jsx(Qx,{}),kt.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:c.map(h=>kt.jsx("button",{onClick:()=>l(h),className:`category-btn ${e===h?"active":""}`,children:h},h))}),kt.jsx(Yx,{channels:f,onChannelSelect:a}),r?kt.jsx("div",{ref:n,children:kt.jsx(lN,{url:r})}):kt.jsx("div",{style:{textAlign:"center",marginTop:"2rem",color:"#ccc"},children:kt.jsx("p",{children:"Please select a channel to start streaming."})})]})}qx.createRoot(document.getElementById("root")).render(kt.jsx(Ux.StrictMode,{children:kt.jsx(_N,{})}));
